/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={268:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&o[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),t.push(c))}},t}},397:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),a="/*# ".concat(i," */"),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(o).concat([a]).join("\n")}return[t].join("\n")}},856:function(e,t){!function(e){"use strict";var t,n;e.ContainmentType=void 0,(t=e.ContainmentType||(e.ContainmentType={}))[t.Disjoint=0]="Disjoint",t[t.Contains=1]="Contains",t[t.Intersects=2]="Intersects",e.PlaneIntersectionType=void 0,(n=e.PlaneIntersectionType||(e.PlaneIntersectionType={}))[n.Back=0]="Back",n[n.Front=1]="Front",n[n.Intersecting=2]="Intersecting";var r=function(){function e(){}return e.clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},e.equals=function(t,n){return Math.abs(t-n)<=e.zeroTolerance},e.isPowerOf2=function(e){return 0==(e&e-1)},e.radianToDegree=function(t){return t*e.radToDegreeFactor},e.degreeToRadian=function(t){return t*e.degreeToRadFactor},e}();r.zeroTolerance=1e-6,r.radToDegreeFactor=180/Math.PI,r.degreeToRadFactor=Math.PI/180;var i=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=void 0,this.y=void 0,this.z=void 0,this.x=e,this.y=t,this.z=n}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z},e.subtract=function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z},e.multiply=function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z},e.divide=function(e,t,n){n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z},e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.cross=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.x,s=t.y,l=t.z;n.x=i*l-a*s,n.y=a*o-r*l,n.z=r*s-i*o},e.distance=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.sqrt(n*n+r*r+i*i)},e.distanceSquared=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return n*n+r*r+i*i},e.equals=function(e,t){return r.equals(e.x,t.x)&&r.equals(e.y,t.y)&&r.equals(e.z,t.z)},e.lerp=function(e,t,n,r){var i=e.x,a=e.y,o=e.z;r.x=i+(t.x-i)*n,r.y=a+(t.y-a)*n,r.z=o+(t.z-o)*n},e.max=function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z)},e.min=function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z)},e.negate=function(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z},e.normalize=function(e,t){var n=e.x,r=e.y,i=e.z,a=Math.sqrt(n*n+r*r+i*i);a>0&&(a=1/a,t.x=n*a,t.y=r*a,t.z=i*a)},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t},e.transformNormal=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements;n.x=r*o[0]+i*o[4]+a*o[8],n.y=r*o[1]+i*o[5]+a*o[9],n.z=r*o[2]+i*o[6]+a*o[10]},e.transformToVec3=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements;n.x=r*o[0]+i*o[4]+a*o[8]+o[12],n.y=r*o[1]+i*o[5]+a*o[9]+o[13],n.z=r*o[2]+i*o[6]+a*o[10]+o[14]},e.transformToVec4=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements;n.x=r*o[0]+i*o[4]+a*o[8]+o[12],n.y=r*o[1]+i*o[5]+a*o[9]+o[13],n.z=r*o[2]+i*o[6]+a*o[10]+o[14],n.w=r*o[3]+i*o[7]+a*o[11]+o[15]},e.transformCoordinate=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements,s=r*o[3]+i*o[7]+a*o[11]+o[15];s=1/s,n.x=(r*o[0]+i*o[4]+a*o[8]+o[12])*s,n.y=(r*o[1]+i*o[5]+a*o[9]+o[13])*s,n.z=(r*o[2]+i*o[6]+a*o[10]+o[14])*s},e.transformByQuat=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.x,s=t.y,l=t.z,u=t.w,c=u*r+s*a-l*i,d=u*i+l*r-o*a,f=u*a+o*i-s*r,h=-o*r-s*i-l*a;n.x=c*u-h*o-d*l+f*s,n.y=d*u-h*s-f*o+c*l,n.z=f*u-h*l-c*s+d*o};var t=e.prototype;return t.setValue=function(e,t,n){return this.x=e,this.y=t,this.z=n,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},t.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},t.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},t.multiply=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},t.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},t.length=function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)},t.lengthSquared=function(){var e=this.x,t=this.y,n=this.z;return e*e+t*t+n*n},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.normalize=function(){return e.normalize(this,this),this},t.scale=function(e){return this.x*=e,this.y*=e,this.z*=e,this},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z},t.clone=function(){return new e(this.x,this.y,this.z)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e.z=this.z,e},t.transformNormal=function(t){return e.transformNormal(this,t,this),this},t.transformToVec3=function(t){return e.transformToVec3(this,t,this),this},t.transformCoordinate=function(t){return e.transformCoordinate(this,t,this),this},t.transformByQuat=function(t){return e.transformByQuat(this,t,this),this},e}();i._zero=new i(0,0,0),i._one=new i(1,1,1);var a=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=0),this.center=new i,this.radius=0,e&&e.cloneTo(this.center),this.radius=t}e.fromPoints=function(t,n){if(!t||0===t.length)throw new Error("points must be array and length must > 0");var r=t.length,a=e._tempVec30;a.x=a.y=a.z=0;for(var o=0;o<r;++o)i.add(t[o],a,a);i.scale(a,1/r,n.center);for(var s=0,l=0;l<r;++l){var u=i.distanceSquared(a,t[l]);u>s&&(s=u)}n.radius=Math.sqrt(s)},e.fromBox=function(e,t){var n=t.center,r=e.min,a=e.max;n.x=.5*(r.x+a.x),n.y=.5*(r.y+a.y),n.z=.5*(r.z+a.z),t.radius=i.distance(n,a)};var t=e.prototype;return t.clone=function(){return new e(this.center,this.radius)},t.cloneTo=function(e){return this.center.cloneTo(e.center),e.radius=this.radius,e},e}();a._tempVec30=new i;var o=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.min=new i,this.max=new i,e&&e.cloneTo(this.min),t&&t.cloneTo(this.max)}e.fromCenterAndExtent=function(e,t,n){i.subtract(e,t,n.min),i.add(e,t,n.max)},e.fromPoints=function(e,t){if(!e||0===e.length)throw new Error("points must be array and length must > 0");var n=t.min,r=t.max;n.x=n.y=n.z=Number.MAX_VALUE,r.x=r.y=r.z=-Number.MAX_VALUE;for(var a=0,o=e.length;a<o;++a){var s=e[a];i.min(n,s,n),i.max(r,s,r)}},e.fromSphere=function(e,t){var n=e.center,r=e.radius,i=t.min,a=t.max;i.x=n.x-r,i.y=n.y-r,i.z=n.z-r,a.x=n.x+r,a.y=n.y+r,a.z=n.z+r},e.transform=function(t,n,r){var a=e._tempVec30,o=e._tempVec31;t.getCenter(a),t.getExtent(o),i.transformCoordinate(a,n,a);var s=o.x,l=o.y,u=o.z,c=n.elements;o.x=Math.abs(s*c[0])+Math.abs(l*c[4])+Math.abs(u*c[8]),o.y=Math.abs(s*c[1])+Math.abs(l*c[5])+Math.abs(u*c[9]),o.z=Math.abs(s*c[2])+Math.abs(l*c[6])+Math.abs(u*c[10]),i.subtract(a,o,r.min),i.add(a,o,r.max)},e.merge=function(e,t,n){return i.min(e.min,t.min,n.min),i.max(e.max,t.max,n.max),n};var t=e.prototype;return t.clone=function(){return new e(this.min,this.max)},t.cloneTo=function(e){return this.min.cloneTo(e.min),this.max.cloneTo(e.max),e},t.getCenter=function(e){return i.add(this.min,this.max,e),i.scale(e,.5,e),e},t.getExtent=function(e){return i.subtract(this.max,this.min,e),i.scale(e,.5,e),e},t.getCorners=function(e){void 0===e&&(e=[]);var t=this.min,n=this.max,r=t.x,a=t.y,o=t.z,s=n.x,l=n.y,u=n.z,c=e.length;if(c<8)for(var d=0,f=8-c;d<f;++d)e[c+d]=new i;return e[0].setValue(r,l,u),e[1].setValue(s,l,u),e[2].setValue(s,a,u),e[3].setValue(r,a,u),e[4].setValue(r,l,o),e[5].setValue(s,l,o),e[6].setValue(s,a,o),e[7].setValue(r,a,o),e},t.transform=function(t){return e.transform(this,t,this),this},e}();o._tempVec30=new i,o._tempVec31=new i;var s=function(){function t(){}return t.distancePlaneAndPoint=function(e,t){return i.dot(e.normal,t)+e.distance},t.intersectsPlaneAndPoint=function(n,r){var i=t.distancePlaneAndPoint(n,r);return i>0?e.PlaneIntersectionType.Front:i<0?e.PlaneIntersectionType.Back:e.PlaneIntersectionType.Intersecting},t.intersectsPlaneAndBox=function(n,r){var i=r.min,a=r.max,o=n.normal,s=t._tempVec30,l=t._tempVec31;return o.x>=0?(s.x=a.x,l.x=i.x):(s.x=i.x,l.x=a.x),o.y>=0?(s.y=a.y,l.y=i.y):(s.y=i.y,l.y=a.y),o.z>=0?(s.z=a.z,l.z=i.z):(s.z=i.z,l.z=a.z),t.distancePlaneAndPoint(n,s)<0?e.PlaneIntersectionType.Back:t.distancePlaneAndPoint(n,l)>0?e.PlaneIntersectionType.Front:e.PlaneIntersectionType.Intersecting},t.intersectsPlaneAndSphere=function(n,r){var i=r.center,a=r.radius,o=t.distancePlaneAndPoint(n,i);return o>a?e.PlaneIntersectionType.Front:o<-a?e.PlaneIntersectionType.Back:e.PlaneIntersectionType.Intersecting},t.intersectsRayAndPlane=function(e,t){var n=t.normal,a=r.zeroTolerance,o=i.dot(n,e.direction);if(Math.abs(o)<a)return-1;var s=i.dot(n,e.origin),l=(-t.distance-s)/o;if(l<0){if(l<-a)return-1;l=0}return l},t.intersectsRayAndBox=function(e,t){var n=r.zeroTolerance,i=e.origin,a=e.direction,o=t.min,s=t.max,l=a.x,u=a.y,c=a.z,d=i.x,f=i.y,h=i.z,p=0,_=Number.MAX_VALUE;if(Math.abs(l)<n){if(d<o.x||d>s.x)return-1}else{var v=1/l,m=(o.x-d)*v,g=(s.x-d)*v;if(m>g){var y=m;m=g,g=y}if((p=Math.max(m,p))>(_=Math.min(g,_)))return-1}if(Math.abs(u)<n){if(f<o.y||f>s.y)return-1}else{var x=1/u,b=(o.y-f)*x,w=(s.y-f)*x;if(b>w){var T=b;b=w,w=T}if((p=Math.max(b,p))>(_=Math.min(w,_)))return-1}if(Math.abs(c)<n){if(h<o.z||h>s.z)return-1}else{var S=1/c,C=(o.z-h)*S,P=(s.z-h)*S;if(C>P){var M=C;C=P,P=M}if((p=Math.max(C,p))>(_=Math.min(P,_)))return-1}return p},t.intersectsRayAndSphere=function(e,n){var r=e.origin,a=e.direction,o=n.center,s=n.radius,l=t._tempVec30;i.subtract(r,o,l);var u=i.dot(l,a),c=i.dot(l,l)-s*s;if(u>0&&c>0)return-1;var d=u*u-c;if(d<0)return-1;var f=-u-Math.sqrt(d);return f<0&&(f=0),f},t.intersectsFrustumAndBox=function(e,n){for(var r=n.min,a=n.max,o=t._tempVec30,s=0;s<6;++s){var l=e.getPlane(s),u=l.normal;if(o.x=u.x>=0?r.x:a.x,o.y=u.y>=0?r.y:a.y,o.z=u.z>=0?r.z:a.z,i.dot(l.normal,o)>-l.distance)return!1}return!0},t.frustumContainsBox=function(n,r){for(var i=r.min,a=r.max,o=t._tempVec30,s=t._tempVec31,l=e.ContainmentType.Contains,u=0;u<6;++u){var c=n.getPlane(u),d=c.normal;if(d.x>=0?(o.x=a.x,s.x=i.x):(o.x=i.x,s.x=a.x),d.y>=0?(o.y=a.y,s.y=i.y):(o.y=i.y,s.y=a.y),d.z>=0?(o.z=a.z,s.z=i.z):(o.z=i.z,s.z=a.z),t.intersectsPlaneAndPoint(c,s)===e.PlaneIntersectionType.Front)return e.ContainmentType.Disjoint;t.intersectsPlaneAndPoint(c,o)===e.PlaneIntersectionType.Front&&(l=e.ContainmentType.Intersects)}return l},t.frustumContainsSphere=function(n,r){for(var i=e.ContainmentType.Contains,a=0;a<6;++a){var o=n.getPlane(a),s=t.intersectsPlaneAndSphere(o,r);if(s===e.PlaneIntersectionType.Front)return e.ContainmentType.Disjoint;if(s===e.PlaneIntersectionType.Intersecting){i=e.ContainmentType.Intersects;break}}return i},t}();s._tempVec30=new i,s._tempVec31=new i;var l=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=0),this.normal=new i,this.distance=0,e&&e.cloneTo(this.normal),this.distance=t}e.normalize=function(e,t){var n=e.normal,r=1/n.length(),i=t.normal;i.x=n.x*r,i.y=n.y*r,i.z=n.z*r,t.distance=e.distance*r},e.fromPoints=function(e,t,n,r){var i=e.x,a=e.y,o=e.z,s=t.x-i,l=t.y-a,u=t.z-o,c=n.x-i,d=n.y-a,f=n.z-o,h=l*f-u*d,p=u*c-s*f,_=s*d-l*c,v=1/Math.sqrt(h*h+p*p+_*_),m=h*v,g=p*v,y=_*v,x=r.normal;x.x=m,x.y=g,x.z=y,r.distance=-(m*i+g*a+y*o)};var t=e.prototype;return t.normalize=function(){return e.normalize(this,this),this},t.clone=function(){var t=new e;return this.cloneTo(t),t},t.cloneTo=function(e){return this.normal.cloneTo(e.normal),e.distance=this.distance,e},e}(),u=function(){function t(e){void 0===e&&(e=null),this.near=void 0,this.far=void 0,this.left=void 0,this.right=void 0,this.top=void 0,this.bottom=void 0,this.near=new l,this.far=new l,this.left=new l,this.right=new l,this.top=new l,this.bottom=new l,e&&this.calculateFromMatrix(e)}var n=t.prototype;return n.clone=function(){var e=new t;return this.cloneTo(e),e},n.cloneTo=function(e){return this.near.cloneTo(e.near),this.far.cloneTo(e.far),this.left.cloneTo(e.left),this.right.cloneTo(e.right),this.top.cloneTo(e.top),this.bottom.cloneTo(e.bottom),e},n.getPlane=function(e){switch(e){case 0:return this.near;case 1:return this.far;case 2:return this.left;case 3:return this.right;case 4:return this.top;case 5:return this.bottom;default:return null}},n.calculateFromMatrix=function(e){var t=e.elements,n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],f=t[10],h=t[11],p=t[12],_=t[13],v=t[14],m=t[15],g=this.near.normal;g.x=-a-i,g.y=-u-l,g.z=-h-f,this.near.distance=-m-v,this.near.normalize();var y=this.far.normal;y.x=i-a,y.y=l-u,y.z=f-h,this.far.distance=v-m,this.far.normalize();var x=this.left.normal;x.x=-a-n,x.y=-u-o,x.z=-h-c,this.left.distance=-m-p,this.left.normalize();var b=this.right.normal;b.x=n-a,b.y=o-u,b.z=c-h,this.right.distance=p-m,this.right.normalize();var w=this.top.normal;w.x=r-a,w.y=s-u,w.z=d-h,this.top.distance=_-m,this.top.normalize();var T=this.bottom.normal;T.x=-a-r,T.y=-u-s,T.z=-h-d,this.bottom.distance=-m-_,this.bottom.normalize()},n.intersectsBox=function(e){return s.intersectsFrustumAndBox(this,e)},n.intersectsSphere=function(t){return s.frustumContainsSphere(this,t)!==e.ContainmentType.Disjoint},t}(),c=function(){function e(e,t,n,r,i,a,o,s,l){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=1),this.elements=new Float32Array(9);var u=this.elements;u[0]=e,u[1]=t,u[2]=n,u[3]=r,u[4]=i,u[5]=a,u[6]=o,u[7]=s,u[8]=l}e.add=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements;a[0]=r[0]+i[0],a[1]=r[1]+i[1],a[2]=r[2]+i[2],a[3]=r[3]+i[3],a[4]=r[4]+i[4],a[5]=r[5]+i[5],a[6]=r[6]+i[6],a[7]=r[7]+i[7],a[8]=r[8]+i[8]},e.subtract=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements;a[0]=r[0]-i[0],a[1]=r[1]-i[1],a[2]=r[2]-i[2],a[3]=r[3]-i[3],a[4]=r[4]-i[4],a[5]=r[5]-i[5],a[6]=r[6]-i[6],a[7]=r[7]-i[7],a[8]=r[8]-i[8]},e.multiply=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements,o=r[0],s=r[1],l=r[2],u=r[3],c=r[4],d=r[5],f=r[6],h=r[7],p=r[8],_=i[0],v=i[1],m=i[2],g=i[3],y=i[4],x=i[5],b=i[6],w=i[7],T=i[8];a[0]=o*_+u*v+f*m,a[1]=s*_+c*v+h*m,a[2]=l*_+d*v+p*m,a[3]=o*g+u*y+f*x,a[4]=s*g+c*y+h*x,a[5]=l*g+d*y+p*x,a[6]=o*b+u*w+f*T,a[7]=s*b+c*w+h*T,a[8]=l*b+d*w+p*T},e.equals=function(e,t){var n=e.elements,i=t.elements;return r.equals(n[0],i[0])&&r.equals(n[1],i[1])&&r.equals(n[2],i[2])&&r.equals(n[3],i[3])&&r.equals(n[4],i[4])&&r.equals(n[5],i[5])&&r.equals(n[6],i[6])&&r.equals(n[7],i[7])&&r.equals(n[8],i[8])},e.lerp=function(e,t,n,r){var i=e.elements,a=t.elements,o=r.elements,s=1-n;o[0]=i[0]*s+a[0]*n,o[1]=i[1]*s+a[1]*n,o[2]=i[2]*s+a[2]*n,o[3]=i[3]*s+a[3]*n,o[4]=i[4]*s+a[4]*n,o[5]=i[5]*s+a[5]*n,o[6]=i[6]*s+a[6]*n,o[7]=i[7]*s+a[7]*n,o[8]=i[8]*s+a[8]*n},e.rotationQuaternion=function(e,t){var n=t.elements,r=e.x,i=e.y,a=e.z,o=e.w,s=r+r,l=i+i,u=a+a,c=r*s,d=i*s,f=i*l,h=a*s,p=a*l,_=a*u,v=o*s,m=o*l,g=o*u;n[0]=1-f-_,n[3]=d-g,n[6]=h+m,n[1]=d+g,n[4]=1-c-_,n[7]=p-v,n[2]=h-m,n[5]=p+v,n[8]=1-c-f},e.scaling=function(e,t){var n=t.elements;n[0]=e.x,n[1]=0,n[2]=0,n[3]=0,n[4]=e.y,n[5]=0,n[6]=0,n[7]=0,n[8]=1},e.translation=function(e,t){var n=t.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=e.x,n[7]=e.y,n[8]=1},e.invert=function(e,t){var n=e.elements,r=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],d=n[7],f=n[8],h=f*l-u*d,p=-f*s+u*c,_=d*s-l*c,v=i*h+a*p+o*_;v&&(v=1/v,r[0]=h*v,r[1]=(-f*a+o*d)*v,r[2]=(u*a-o*l)*v,r[3]=p*v,r[4]=(f*i-o*c)*v,r[5]=(-u*i+o*s)*v,r[6]=_*v,r[7]=(-d*i+a*c)*v,r[8]=(l*i-a*s)*v)},e.normalMatrix=function(e,t){var n=e.elements,r=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],d=n[7],f=n[8],h=n[9],p=n[10],_=n[11],v=n[12],m=n[13],g=n[14],y=n[15],x=i*u-a*l,b=i*c-o*l,w=i*d-s*l,T=a*c-o*u,S=a*d-s*u,C=o*d-s*c,P=f*m-h*v,M=f*g-p*v,A=f*y-_*v,E=h*g-p*m,R=h*y-_*m,F=p*y-_*g,L=x*F-b*R+w*E+T*A-S*M+C*P;if(!L)return null;L=1/L,r[0]=(u*F-c*R+d*E)*L,r[1]=(c*A-l*F-d*M)*L,r[2]=(l*R-u*A+d*P)*L,r[3]=(o*R-a*F-s*E)*L,r[4]=(i*F-o*A+s*M)*L,r[5]=(a*A-i*R-s*P)*L,r[6]=(m*C-g*S+y*T)*L,r[7]=(g*w-v*C-y*b)*L,r[8]=(v*S-m*w+y*x)*L},e.rotate=function(e,t,n){var r=e.elements,i=n.elements,a=Math.sin(t),o=Math.cos(t),s=r[0],l=r[1],u=r[2],c=r[3],d=r[4],f=r[5],h=r[6],p=r[7],_=r[8];i[0]=o*s+a*c,i[1]=o*l+a*d,i[2]=o*u+a*f,i[3]=o*c-a*s,i[4]=o*d-a*l,i[5]=o*f-a*u,i[6]=h,i[7]=p,i[8]=_},e.scale=function(e,t,n){var r=t.x,i=t.y,a=e.elements,o=n.elements;o[0]=r*a[0],o[1]=r*a[1],o[2]=r*a[2],o[3]=i*a[3],o[4]=i*a[4],o[5]=i*a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8]},e.translate=function(e,t,n){var r=t.x,i=t.y,a=e.elements,o=n.elements,s=a[0],l=a[1],u=a[2],c=a[3],d=a[4],f=a[5],h=a[6],p=a[7],_=a[8];o[0]=s,o[1]=l,o[2]=u,o[3]=c,o[4]=d,o[5]=f,o[6]=r*s+i*c+h,o[7]=r*l+i*d+p,o[8]=r*u+i*f+_},e.transpose=function(e,t){var n=e.elements,r=t.elements;if(t===e){var i=n[1],a=n[2],o=n[5];r[1]=n[3],r[2]=n[6],r[3]=i,r[5]=n[7],r[6]=a,r[7]=o}else r[0]=n[0],r[1]=n[3],r[2]=n[6],r[3]=n[1],r[4]=n[4],r[5]=n[7],r[6]=n[2],r[7]=n[5],r[8]=n[8]};var t=e.prototype;return t.setValue=function(e,t,n,r,i,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=t,u[2]=n,u[3]=r,u[4]=i,u[5]=a,u[6]=o,u[7]=s,u[8]=l,this},t.setValueByArray=function(e,t){void 0===t&&(t=0);for(var n=this.elements,r=0;r<12;r++)n[r]=e[r+t];return this},t.setValueByMatrix=function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],this},t.toArray=function(e,t){void 0===t&&(t=0);var n=this.elements;e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8]},t.clone=function(){var t=this.elements;return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},t.cloneTo=function(e){var t=this.elements,n=e.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],e},t.add=function(t){return e.add(this,t,this),this},t.subtract=function(t){return e.subtract(this,t,this),this},t.multiply=function(t){return e.multiply(this,t,this),this},t.determinant=function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*(u*a-o*l)+n*(-u*i+o*s)+r*(l*i-a*s)},t.identity=function(){var e=this.elements;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},t.invert=function(){return e.invert(this,this),this},t.rotate=function(t){return e.rotate(this,t,this),this},t.scale=function(t){return e.scale(this,t,this),this},t.translate=function(t){return e.translate(this,t,this),this},t.transpose=function(){return e.transpose(this,this),this},e}(),d=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=e,this.y=t,this.z=n,this.w=r}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w},e.multiply=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w,s=t.x,l=t.y,u=t.z,c=t.w;n.x=r*c+o*s+i*u-a*l,n.y=i*c+o*l+a*s-r*u,n.z=a*c+o*u+r*l-i*s,n.w=o*c-r*s-i*l-a*u},e.conjugate=function(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w},e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.equals=function(e,t){return r.equals(e.x,t.x)&&r.equals(e.y,t.y)&&r.equals(e.z,t.z)&&r.equals(e.w,t.w)},e.rotationAxisAngle=function(t,n,r){var a=e._tempVector3;i.normalize(t,a),n*=.5;var o=Math.sin(n);r.x=a.x*o,r.y=a.y*o,r.z=a.z*o,r.w=Math.cos(n)},e.rotationEuler=function(t,n,r,i){e.rotationYawPitchRoll(n,t,r,i)},e.rotationYawPitchRoll=function(e,t,n,r){var i=.5*n,a=.5*t,o=.5*e,s=Math.sin(i),l=Math.cos(i),u=Math.sin(a),c=Math.cos(a),d=Math.sin(o),f=Math.cos(o),h=f*c,p=d*u;r.x=f*u*l+d*c*s,r.y=d*c*l-f*u*s,r.z=h*s-p*l,r.w=h*l+p*s},e.rotationMatrix3x3=function(e,t){var n,r,i=e.elements,a=i[0],o=i[1],s=i[2],l=i[3],u=i[4],c=i[5],d=i[6],f=i[7],h=i[8],p=a+u+h;p>0?(n=Math.sqrt(p+1),t.w=.5*n,n=.5/n,t.x=(c-f)*n,t.y=(d-s)*n,t.z=(o-l)*n):a>=u&&a>=h?(r=.5/(n=Math.sqrt(1+a-u-h)),t.x=.5*n,t.y=(o+l)*r,t.z=(s+d)*r,t.w=(c-f)*r):u>h?(r=.5/(n=Math.sqrt(1+u-a-h)),t.x=(l+o)*r,t.y=.5*n,t.z=(f+c)*r,t.w=(d-s)*r):(r=.5/(n=Math.sqrt(1+h-a-u)),t.x=(s+d)*r,t.y=(c+f)*r,t.z=.5*n,t.w=(o-l)*r)},e.invert=function(e,t){var n=e.x,i=e.y,a=e.z,o=e.w,s=n*n+i*i+a*a+o*o;if(s>r.zeroTolerance){var l=1/s;t.x=-n*l,t.y=-i*l,t.z=-a*l,t.w=o*l}},e.lerp=function(t,n,r,i){var a=1-r;e.dot(t,n)>=0?(i.x=t.x*a+n.x*r,i.y=t.y*a+n.y*r,i.z=t.z*a+n.z*r,i.w=t.w*a+n.w*r):(i.x=t.x*a-n.x*r,i.y=t.y*a-n.y*r,i.z=t.z*a-n.z*r,i.w=t.w*a-n.w*r),i.normalize()},e.slerp=function(e,t,n,i){var a,o,s=e.x,l=e.y,u=e.z,c=e.w,d=t.x,f=t.y,h=t.z,p=t.w,_=s*d+l*f+u*h+c*p;if(_<0&&(_=-_,d=-d,f=-f,h=-h,p=-p),1-_>r.zeroTolerance){var v=Math.acos(_),m=Math.sin(v);a=Math.sin((1-n)*v)/m,o=Math.sin(n*v)/m}else a=1-n,o=n;i.x=a*s+o*d,i.y=a*l+o*f,i.z=a*u+o*h,i.w=a*c+o*p},e.normalize=function(e,t){var n=e.x,i=e.y,a=e.z,o=e.w,s=Math.sqrt(n*n+i*i+a*a+o*o);s>r.zeroTolerance&&(s=1/s,t.x=n*s,t.y=i*s,t.z=a*s,t.w=o*s)},e.rotationX=function(e,t){e*=.5;var n=Math.sin(e),r=Math.cos(e);t.x=n,t.y=0,t.z=0,t.w=r},e.rotationY=function(e,t){e*=.5;var n=Math.sin(e),r=Math.cos(e);t.x=0,t.y=n,t.z=0,t.w=r},e.rotationZ=function(e,t){e*=.5;var n=Math.sin(e),r=Math.cos(e);t.x=0,t.y=0,t.z=n,t.w=r},e.rotateX=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w;t*=.5;var s=Math.sin(t),l=Math.cos(t);n.x=r*l+o*s,n.y=i*l+a*s,n.z=a*l-i*s,n.w=o*l-r*s},e.rotateY=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w;t*=.5;var s=Math.sin(t),l=Math.cos(t);n.x=r*l-a*s,n.y=i*l+o*s,n.z=a*l+r*s,n.w=o*l-i*s},e.rotateZ=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w;t*=.5;var s=Math.sin(t),l=Math.cos(t);n.x=r*l+i*s,n.y=i*l-r*s,n.z=a*l+o*s,n.w=o*l-a*s},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t};var t=e.prototype;return t.setValue=function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},t.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.getAxisAngle=function(e){var t=this.x,n=this.y,i=this.z,a=t*t+n*n+i*i;if(a<r.zeroTolerance)return e.x=1,e.y=0,e.z=0,0;var o=1/a;return e.x=this.x*o,e.y=this.y*o,e.z=this.z*o,2*Math.acos(this.w)},t.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},t.length=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return Math.sqrt(e*e+t*t+n*n+r*r)},t.lengthSquared=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return e*e+t*t+n*n+r*r},t.normalize=function(){return e.normalize(this,this),this},t.toEuler=function(e){this.toYawPitchRoll(e);var t=e.x;return e.x=e.y,e.y=t,e},t.toYawPitchRoll=function(e){var t=this.x,n=this.y,i=this.z,a=this.w,o=t*t,s=n*n,l=i*i,u=t*n,c=i*a,d=i*t,f=n*a,h=n*i,p=t*a;return e.y=Math.asin(2*(p-h)),Math.cos(e.y)>r.zeroTolerance?(e.z=Math.atan2(2*(u+c),1-2*(l+o)),e.x=Math.atan2(2*(d+f),1-2*(s+o))):(e.z=Math.atan2(-2*(u-c),1-2*(s+l)),e.x=0),e},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w},t.clone=function(){return new e(this.x,this.y,this.z,this.w)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},t.rotateX=function(t){return e.rotateX(this,t,this),this},t.rotateY=function(t){return e.rotateY(this,t,this),this},t.rotateZ=function(t){return e.rotateZ(this,t,this),this},t.rotationAxisAngle=function(t,n){return e.rotationAxisAngle(t,n,this),this},t.multiply=function(t){return e.multiply(this,t,this),this},t.invert=function(){return e.invert(this,this),this},t.dot=function(t){return e.dot(this,t)},t.lerp=function(t,n){return e.lerp(this,t,n,this),this},e}();d._tempVector3=new i;var f=function(){function e(e,t,n,r,i,a,o,s,l,u,c,d,f,h,p,_){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=1),void 0===d&&(d=0),void 0===f&&(f=0),void 0===h&&(h=0),void 0===p&&(p=0),void 0===_&&(_=1),this.elements=new Float32Array(16);var v=this.elements;v[0]=e,v[1]=t,v[2]=n,v[3]=r,v[4]=i,v[5]=a,v[6]=o,v[7]=s,v[8]=l,v[9]=u,v[10]=c,v[11]=d,v[12]=f,v[13]=h,v[14]=p,v[15]=_}e.multiply=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements,o=r[0],s=r[1],l=r[2],u=r[3],c=r[4],d=r[5],f=r[6],h=r[7],p=r[8],_=r[9],v=r[10],m=r[11],g=r[12],y=r[13],x=r[14],b=r[15],w=i[0],T=i[1],S=i[2],C=i[3],P=i[4],M=i[5],A=i[6],E=i[7],R=i[8],F=i[9],L=i[10],B=i[11],I=i[12],O=i[13],z=i[14],D=i[15];a[0]=o*w+c*T+p*S+g*C,a[1]=s*w+d*T+_*S+y*C,a[2]=l*w+f*T+v*S+x*C,a[3]=u*w+h*T+m*S+b*C,a[4]=o*P+c*M+p*A+g*E,a[5]=s*P+d*M+_*A+y*E,a[6]=l*P+f*M+v*A+x*E,a[7]=u*P+h*M+m*A+b*E,a[8]=o*R+c*F+p*L+g*B,a[9]=s*R+d*F+_*L+y*B,a[10]=l*R+f*F+v*L+x*B,a[11]=u*R+h*F+m*L+b*B,a[12]=o*I+c*O+p*z+g*D,a[13]=s*I+d*O+_*z+y*D,a[14]=l*I+f*O+v*z+x*D,a[15]=u*I+h*O+m*z+b*D},e.equals=function(e,t){var n=e.elements,i=t.elements;return r.equals(n[0],i[0])&&r.equals(n[1],i[1])&&r.equals(n[2],i[2])&&r.equals(n[3],i[3])&&r.equals(n[4],i[4])&&r.equals(n[5],i[5])&&r.equals(n[6],i[6])&&r.equals(n[7],i[7])&&r.equals(n[8],i[8])&&r.equals(n[9],i[9])&&r.equals(n[10],i[10])&&r.equals(n[11],i[11])&&r.equals(n[12],i[12])&&r.equals(n[13],i[13])&&r.equals(n[14],i[14])&&r.equals(n[15],i[15])},e.lerp=function(e,t,n,r){var i=e.elements,a=t.elements,o=r.elements,s=1-n;o[0]=i[0]*s+a[0]*n,o[1]=i[1]*s+a[1]*n,o[2]=i[2]*s+a[2]*n,o[3]=i[3]*s+a[3]*n,o[4]=i[4]*s+a[4]*n,o[5]=i[5]*s+a[5]*n,o[6]=i[6]*s+a[6]*n,o[7]=i[7]*s+a[7]*n,o[8]=i[8]*s+a[8]*n,o[9]=i[9]*s+a[9]*n,o[10]=i[10]*s+a[10]*n,o[11]=i[11]*s+a[11]*n,o[12]=i[12]*s+a[12]*n,o[13]=i[13]*s+a[13]*n,o[14]=i[14]*s+a[14]*n,o[15]=i[15]*s+a[15]*n},e.rotationQuaternion=function(e,t){var n=t.elements,r=e.x,i=e.y,a=e.z,o=e.w,s=r+r,l=i+i,u=a+a,c=r*s,d=i*s,f=i*l,h=a*s,p=a*l,_=a*u,v=o*s,m=o*l,g=o*u;n[0]=1-f-_,n[1]=d+g,n[2]=h-m,n[3]=0,n[4]=d-g,n[5]=1-c-_,n[6]=p+v,n[7]=0,n[8]=h+m,n[9]=p-v,n[10]=1-c-f,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},e.rotationAxisAngle=function(e,t,n){var i,a,o,s=n.elements,l=e.x,u=e.y,c=e.z,d=Math.sqrt(l*l+u*u+c*c);Math.abs(d)<r.zeroTolerance||(l*=d=1/d,u*=d,c*=d,i=Math.sin(t),o=1-(a=Math.cos(t)),s[0]=l*l*o+a,s[1]=u*l*o+c*i,s[2]=c*l*o-u*i,s[3]=0,s[4]=l*u*o-c*i,s[5]=u*u*o+a,s[6]=c*u*o+l*i,s[7]=0,s[8]=l*c*o+u*i,s[9]=u*c*o-l*i,s[10]=c*c*o+a,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1)},e.rotationTranslation=function(t,n,r){e.rotationQuaternion(t,r);var i=r.elements;i[12]=n.x,i[13]=n.y,i[14]=n.z},e.affineTransformation=function(e,t,n,r){var i=r.elements,a=t.x,o=t.y,s=t.z,l=t.w,u=a+a,c=o+o,d=s+s,f=a*u,h=a*c,p=a*d,_=o*c,v=o*d,m=s*d,g=l*u,y=l*c,x=l*d,b=e.x,w=e.y,T=e.z;i[0]=(1-(_+m))*b,i[1]=(h+x)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(h-x)*w,i[5]=(1-(f+m))*w,i[6]=(v+g)*w,i[7]=0,i[8]=(p+y)*T,i[9]=(v-g)*T,i[10]=(1-(f+_))*T,i[11]=0,i[12]=n.x,i[13]=n.y,i[14]=n.z,i[15]=1},e.scaling=function(e,t){var n=t.elements;n[0]=e.x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e.y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e.z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},e.translation=function(e,t){var n=t.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1},e.invert=function(e,t){var n=e.elements,r=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],d=n[7],f=n[8],h=n[9],p=n[10],_=n[11],v=n[12],m=n[13],g=n[14],y=n[15],x=i*u-a*l,b=i*c-o*l,w=i*d-s*l,T=a*c-o*u,S=a*d-s*u,C=o*d-s*c,P=f*m-h*v,M=f*g-p*v,A=f*y-_*v,E=h*g-p*m,R=h*y-_*m,F=p*y-_*g,L=x*F-b*R+w*E+T*A-S*M+C*P;if(!L)return null;L=1/L,r[0]=(u*F-c*R+d*E)*L,r[1]=(o*R-a*F-s*E)*L,r[2]=(m*C-g*S+y*T)*L,r[3]=(p*S-h*C-_*T)*L,r[4]=(c*A-l*F-d*M)*L,r[5]=(i*F-o*A+s*M)*L,r[6]=(g*w-v*C-y*b)*L,r[7]=(f*C-p*w+_*b)*L,r[8]=(l*R-u*A+d*P)*L,r[9]=(a*A-i*R-s*P)*L,r[10]=(v*S-m*w+y*x)*L,r[11]=(h*w-f*S-_*x)*L,r[12]=(u*M-l*E-c*P)*L,r[13]=(i*E-a*M+o*P)*L,r[14]=(m*b-v*T-g*x)*L,r[15]=(f*T-h*b+p*x)*L},e.lookAt=function(t,n,r,a){var o=a.elements,s=e._tempVec30,l=e._tempVec31,u=e._tempVec32;i.subtract(t,n,u),u.normalize(),i.cross(r,u,s),s.normalize(),i.cross(u,s,l),o[0]=s.x,o[1]=l.x,o[2]=u.x,o[3]=0,o[4]=s.y,o[5]=l.y,o[6]=u.y,o[7]=0,o[8]=s.z,o[9]=l.z,o[10]=u.z,o[11]=0,o[12]=-i.dot(s,t),o[13]=-i.dot(l,t),o[14]=-i.dot(u,t),o[15]=1},e.ortho=function(e,t,n,r,i,a,o){var s=o.elements,l=1/(e-t),u=1/(n-r),c=1/(i-a);s[0]=-2*l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*u,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*c,s[11]=0,s[12]=(e+t)*l,s[13]=(r+n)*u,s[14]=(a+i)*c,s[15]=1},e.perspective=function(e,t,n,r,i){var a=i.elements,o=1/Math.tan(e/2),s=1/(n-r);a[0]=o/t,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(r+n)*s,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*r*n*s,a[15]=0},e.rotateAxisAngle=function(e,t,n,i){var a=t.x,o=t.y,s=t.z,l=Math.sqrt(a*a+o*o+s*s);if(!(Math.abs(l)<r.zeroTolerance)){var u,c,d,f=e.elements,h=i.elements;a*=l=1/l,o*=l,s*=l,u=Math.sin(n),d=1-(c=Math.cos(n));var p=f[0],_=f[1],v=f[2],m=f[3],g=f[4],y=f[5],x=f[6],b=f[7],w=f[8],T=f[9],S=f[10],C=f[11],P=a*a*d+c,M=o*a*d+s*u,A=s*a*d-o*u,E=a*o*d-s*u,R=o*o*d+c,F=s*o*d+a*u,L=a*s*d+o*u,B=o*s*d-a*u,I=s*s*d+c;h[0]=p*P+g*M+w*A,h[1]=_*P+y*M+T*A,h[2]=v*P+x*M+S*A,h[3]=m*P+b*M+C*A,h[4]=p*E+g*R+w*F,h[5]=_*E+y*R+T*F,h[6]=v*E+x*R+S*F,h[7]=m*E+b*R+C*F,h[8]=p*L+g*B+w*I,h[9]=_*L+y*B+T*I,h[10]=v*L+x*B+S*I,h[11]=m*L+b*B+C*I,e!==i&&(h[12]=f[12],h[13]=f[13],h[14]=f[14],h[15]=f[15])}},e.scale=function(e,t,n){var r=e.elements,i=n.elements,a=t.x,o=t.y,s=t.z;i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=r[3]*a,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[7]=r[7]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,i[11]=r[11]*s,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]},e.translate=function(e,t,n){var r=e.elements,i=n.elements,a=t.x,o=t.y,s=t.z;if(e===n)i[12]=r[0]*a+r[4]*o+r[8]*s+r[12],i[13]=r[1]*a+r[5]*o+r[9]*s+r[13],i[14]=r[2]*a+r[6]*o+r[10]*s+r[14],i[15]=r[3]*a+r[7]*o+r[11]*s+r[15];else{var l=r[0],u=r[1],c=r[2],d=r[3],f=r[4],h=r[5],p=r[6],_=r[7],v=r[8],m=r[9],g=r[10],y=r[11];i[0]=l,i[1]=u,i[2]=c,i[3]=d,i[4]=f,i[5]=h,i[6]=p,i[7]=_,i[8]=v,i[9]=m,i[10]=g,i[11]=y,i[12]=l*a+f*o+v*s+r[12],i[13]=u*a+h*o+m*s+r[13],i[14]=c*a+p*o+g*s+r[14],i[15]=d*a+_*o+y*s+r[15]}},e.transpose=function(e,t){var n=e.elements,r=t.elements;if(t===e){var i=n[1],a=n[2],o=n[3],s=n[6],l=n[7],u=n[11];r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=i,r[6]=n[9],r[7]=n[13],r[8]=a,r[9]=s,r[11]=n[14],r[12]=o,r[13]=l,r[14]=u}else r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15]};var t=e.prototype;return t.setValue=function(e,t,n,r,i,a,o,s,l,u,c,d,f,h,p,_){var v=this.elements;return v[0]=e,v[1]=t,v[2]=n,v[3]=r,v[4]=i,v[5]=a,v[6]=o,v[7]=s,v[8]=l,v[9]=u,v[10]=c,v[11]=d,v[12]=f,v[13]=h,v[14]=p,v[15]=_,this},t.setValueByArray=function(e,t){void 0===t&&(t=0);for(var n=this.elements,r=0;r<16;r++)n[r]=e[r+t];return this},t.toArray=function(e,t){void 0===t&&(t=0);var n=this.elements;e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15]},t.clone=function(){var t=this.elements;return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},t.cloneTo=function(e){var t=this.elements,n=e.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],e},t.multiply=function(t){return e.multiply(this,t,this),this},t.determinant=function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],d=e[10],f=e[11],h=e[12],p=e[13],_=e[14],v=e[15];return(t*o-n*a)*(d*v-f*_)-(t*s-r*a)*(c*v-f*p)+(t*l-i*a)*(c*_-d*p)+(n*s-r*o)*(u*v-f*h)-(n*l-i*o)*(u*_-d*h)+(r*l-i*s)*(u*p-c*h)},t.decompose=function(t,n,i){var a=e._tempMat30,o=this.elements,s=a.elements,l=o[0],u=o[1],c=o[2],f=o[3],h=o[4],p=o[5],_=o[6],v=o[7],m=o[8],g=o[9],y=o[10],x=o[11];t.x=o[12],t.y=o[13],t.z=o[14];var b=Math.sign(l*u*c*f)<0?-1:1,w=Math.sign(h*p*_*v)<0?-1:1,T=Math.sign(m*g*y*x)<0?-1:1,S=b*Math.sqrt(l*l+u*u+c*c),C=w*Math.sqrt(h*h+p*p+_*_),P=T*Math.sqrt(m*m+g*g+y*y);if(i.x=S,i.y=C,i.z=P,Math.abs(S)<r.zeroTolerance||Math.abs(C)<r.zeroTolerance||Math.abs(P)<r.zeroTolerance)return n.identity(),!1;var M=1/S,A=1/C,E=1/P;return s[0]=l*M,s[1]=u*M,s[2]=c*M,s[3]=h*A,s[4]=p*A,s[5]=_*A,s[6]=m*E,s[7]=g*E,s[8]=y*E,d.rotationMatrix3x3(a,n),!0},t.getRotation=function(e){var t=this.elements,n=t[0]+t[5]+t[10];if(n>r.zeroTolerance){var i=2*Math.sqrt(n+1);e.w=.25*i,e.x=(t[6]-t[9])/i,e.y=(t[8]-t[2])/i,e.z=(t[1]-t[4])/i}else if(t[0]>t[5]&&t[0]>t[10]){var a=2*Math.sqrt(1+t[0]-t[5]-t[10]);e.w=(t[6]-t[9])/a,e.x=.25*a,e.y=(t[1]+t[4])/a,e.z=(t[8]+t[2])/a}else if(t[5]>t[10]){var o=2*Math.sqrt(1+t[5]-t[0]-t[10]);e.w=(t[8]-t[2])/o,e.x=(t[1]+t[4])/o,e.y=.25*o,e.z=(t[6]+t[9])/o}else{var s=2*Math.sqrt(1+t[10]-t[0]-t[5]);e.w=(t[1]-t[4])/s,e.x=(t[8]+t[2])/s,e.y=(t[6]+t[9])/s,e.z=.25*s}return e},t.getScaling=function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],l=t[8],u=t[9],c=t[10];return e.x=Math.sqrt(n*n+r*r+i*i),e.y=Math.sqrt(a*a+o*o+s*s),e.z=Math.sqrt(l*l+u*u+c*c),e},t.getTranslation=function(e){var t=this.elements;return e.x=t[12],e.y=t[13],e.z=t[14],e},t.identity=function(){var e=this.elements;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},t.invert=function(){return e.invert(this,this),this},t.rotateAxisAngle=function(t,n){return e.rotateAxisAngle(this,t,n,this),this},t.scale=function(t){return e.scale(this,t,this),this},t.translate=function(t){return e.translate(this,t,this),this},t.transpose=function(){return e.transpose(this,this),this},e}();f._tempVec30=new i,f._tempVec31=new i,f._tempVec32=new i,f._tempMat30=new c,f._identity=new f(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);var h=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.origin=new i,this.direction=new i,e&&e.cloneTo(this.origin),t&&t.cloneTo(this.direction)}var t=e.prototype;return t.intersectPlane=function(e){return s.intersectsRayAndPlane(this,e)},t.intersectSphere=function(e){return s.intersectsRayAndSphere(this,e)},t.intersectBox=function(e){return s.intersectsRayAndBox(this,e)},t.getPoint=function(e,t){return i.scale(this.direction,e,t),t.add(this.origin)},e}(),p=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=void 0,this.y=void 0,this.x=e,this.y=t}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y},e.subtract=function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y},e.multiply=function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y},e.divide=function(e,t,n){n.x=e.x/t.x,n.y=e.y/t.y},e.dot=function(e,t){return e.x*t.x+e.y*t.y},e.distance=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},e.distanceSquared=function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},e.equals=function(e,t){return r.equals(e.x,t.x)&&r.equals(e.y,t.y)},e.lerp=function(e,t,n,r){var i=e.x,a=e.y;r.x=i+(t.x-i)*n,r.y=a+(t.y-a)*n},e.max=function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y)},e.min=function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y)},e.negate=function(e,t){t.x=-e.x,t.y=-e.y},e.normalize=function(e,t){var n=e.x,i=e.y,a=Math.sqrt(n*n+i*i);a>r.zeroTolerance&&(a=1/a,t.x=n*a,t.y=i*a)},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t};var t=e.prototype;return t.setValue=function(e,t){return this.x=e,this.y=t,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},t.add=function(e){return this.x+=e.x,this.y+=e.y,this},t.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},t.multiply=function(e){return this.x*=e.x,this.y*=e.y,this},t.divide=function(e){return this.x/=e.x,this.y/=e.y,this},t.length=function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)},t.lengthSquared=function(){var e=this.x,t=this.y;return e*e+t*t},t.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.normalize=function(){return e.normalize(this,this),this},t.scale=function(e){return this.x*=e,this.y*=e,this},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y},t.clone=function(){return new e(this.x,this.y)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e},e}();p._zero=new p(0,0),p._one=new p(1,1);var _=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=e,this.y=t,this.z=n,this.w=r}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w},e.subtract=function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w},e.multiply=function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w},e.divide=function(e,t,n){n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n.w=e.w/t.w},e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.distance=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z,a=t.w-e.w;return Math.sqrt(n*n+r*r+i*i+a*a)},e.distanceSquared=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z,a=t.w-e.w;return n*n+r*r+i*i+a*a},e.equals=function(e,t){return r.equals(e.x,t.x)&&r.equals(e.y,t.y)&&r.equals(e.z,t.z)&&r.equals(e.w,t.w)},e.lerp=function(e,t,n,r){var i=e.x,a=e.y,o=e.z,s=e.w;r.x=i+(t.x-i)*n,r.y=a+(t.y-a)*n,r.z=o+(t.z-o)*n,r.w=s+(t.w-s)*n},e.max=function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w)},e.min=function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w)},e.negate=function(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w},e.normalize=function(e,t){var n=e.x,i=e.y,a=e.z,o=e.w,s=Math.sqrt(n*n+i*i+a*a+o*o);s>r.zeroTolerance&&(s=1/s,t.x=n*s,t.y=i*s,t.z=a*s,t.w=o*s)},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t},e.transform=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w,s=t.elements;n.x=r*s[0]+i*s[4]+a*s[8]+o*s[12],n.y=r*s[1]+i*s[5]+a*s[9]+o*s[13],n.z=r*s[2]+i*s[6]+a*s[10]+o*s[14],n.w=r*s[3]+i*s[7]+a*s[11]+o*s[15]},e.transformByQuat=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w,s=t.x,l=t.y,u=t.z,c=t.w,d=c*r+l*a-u*i,f=c*i+u*r-s*a,h=c*a+s*i-l*r,p=-s*r-l*i-u*a;n.x=d*c-p*s-f*u+h*l,n.y=f*c-p*l-h*s+d*u,n.z=h*c-p*u-d*l+f*s,n.w=o};var t=e.prototype;return t.setValue=function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},t.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},t.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},t.multiply=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},t.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},t.length=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return Math.sqrt(e*e+t*t+n*n+r*r)},t.lengthSquared=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return e*e+t*t+n*n+r*r},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},t.normalize=function(){return e.normalize(this,this),this},t.scale=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w},t.clone=function(){return new e(this.x,this.y,this.z,this.w)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},e}();_._zero=new _(0,0,0,0),_._one=new _(1,1,1,1);var v,m=function(){function e(e,t,n,r){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=1),this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0,this.r=e,this.g=t,this.b=n,this.a=r}e.gammaToLinearSpace=function(e){return e<=0?0:e<=.04045?e/12.92:e<1?Math.pow((e+.055)/1.055,2.4):Math.pow(e,2.4)},e.linearToGammaSpace=function(e){return e<=0?0:e<.0031308?12.92*e:e<1?1.055*Math.pow(e,.41666)-.055:Math.pow(e,.41666)},e.equals=function(e,t){return r.equals(e.r,t.r)&&r.equals(e.g,t.g)&&r.equals(e.b,t.b)&&r.equals(e.a,t.a)},e.add=function(e,t,n){return n.r=e.r+t.r,n.g=e.g+t.g,n.b=e.b+t.b,n.a=e.a+t.a,n},e.scale=function(e,t,n){return n.r=e.r*t,n.g=e.g*t,n.b=e.b*t,n.a=e.a*t,n};var t=e.prototype;return t.setValue=function(e,t,n,r){return this.r=e,this.g=t,this.b=n,this.a=r,this},t.add=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},t.scale=function(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this},t.clone=function(){return new e(this.r,this.g,this.b,this.a)},t.cloneTo=function(e){return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e},t.toLinear=function(t){return t.r=e.gammaToLinearSpace(this.r),t.g=e.gammaToLinearSpace(this.g),t.b=e.gammaToLinearSpace(this.b),t},t.toGamma=function(t){return t.r=e.linearToGammaSpace(this.r),t.g=e.linearToGammaSpace(this.g),t.b=e.linearToGammaSpace(this.b),t},e}(),g=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.x=e,this.y=t,this.width=n,this.height=r}var t=e.prototype;return t.setValue=function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},t.clone=function(){return new e(this.x,this.y,this.width,this.height)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},e}(),y=function(){function e(){this.coefficients=new Float32Array(27)}var t=e.prototype;return t.addLight=function(e,t,n){t.scale(n);var r=this.coefficients,i=e.x,a=e.y,o=e.z,s=t.r,l=t.g,u=t.b,c=.282095,d=-.488603*a,f=.488603*o,h=-.488603*i,p=i*a*1.092548,_=a*o*-1.092548,v=.315392*(3*o*o-1),m=i*o*-1.092548,g=.546274*(i*i-a*a);r[0]+=s*c,r[1]+=l*c,r[2]+=u*c,r[3]+=s*d,r[4]+=l*d,r[5]+=u*d,r[6]+=s*f,r[7]+=l*f,r[8]+=u*f,r[9]+=s*h,r[10]+=l*h,r[11]+=u*h,r[12]+=s*p,r[13]+=l*p,r[14]+=u*p,r[15]+=s*_,r[16]+=l*_,r[17]+=u*_,r[18]+=s*v,r[19]+=l*v,r[20]+=u*v,r[21]+=s*m,r[22]+=l*m,r[23]+=u*m,r[24]+=s*g,r[25]+=l*g,r[26]+=u*g},t.evaluate=function(e,t){var n=this.coefficients,r=e.x,i=e.y,a=e.z,o=.886227,s=-1.023327*i,l=1.023327*a,u=-1.023327*r,c=.858086*i*r,d=-.858086*i*a,f=.247708*(3*a*a-1),h=-.858086*a*r,p=.429042*(r*r-i*i),_=n[0]*o,v=n[1]*o,m=n[2]*o;return _+=n[3]*s+n[6]*l+n[9]*u,v+=n[4]*s+n[7]*l+n[10]*u,m+=n[5]*s+n[8]*l+n[11]*u,_+=n[12]*c+n[15]*d+n[18]*f+n[21]*h+n[24]*p,v+=n[13]*c+n[16]*d+n[19]*f+n[22]*h+n[25]*p,m+=n[14]*c+n[17]*d+n[20]*f+n[23]*h+n[26]*p,t.setValue(_,v,m,1),t},t.scale=function(e){var t=this.coefficients;t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t[4]*=e,t[5]*=e,t[6]*=e,t[7]*=e,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t[12]*=e,t[13]*=e,t[14]*=e,t[15]*=e,t[16]*=e,t[17]*=e,t[18]*=e,t[19]*=e,t[20]*=e,t[21]*=e,t[22]*=e,t[23]*=e,t[24]*=e,t[25]*=e,t[26]*=e},t.setValueByArray=function(e,t){void 0===t&&(t=0);var n=this.coefficients;n[0]=e[t],n[1]=e[1+t],n[2]=e[2+t],n[3]=e[3+t],n[4]=e[4+t],n[5]=e[5+t],n[6]=e[6+t],n[7]=e[7+t],n[8]=e[8+t],n[9]=e[9+t],n[10]=e[10+t],n[11]=e[11+t],n[12]=e[12+t],n[13]=e[13+t],n[14]=e[14+t],n[15]=e[15+t],n[16]=e[16+t],n[17]=e[17+t],n[18]=e[18+t],n[19]=e[19+t],n[20]=e[20+t],n[21]=e[21+t],n[22]=e[22+t],n[23]=e[23+t],n[24]=e[24+t],n[25]=e[25+t],n[26]=e[26+t]},t.toArray=function(e,t){void 0===t&&(t=0);var n=this.coefficients;e[0+t]=n[0],e[1+t]=n[1],e[2+t]=n[2],e[3+t]=n[3],e[4+t]=n[4],e[5+t]=n[5],e[6+t]=n[6],e[7+t]=n[7],e[8+t]=n[8],e[9+t]=n[9],e[10+t]=n[10],e[11+t]=n[11],e[12+t]=n[12],e[13+t]=n[13],e[14+t]=n[14],e[15+t]=n[15],e[16+t]=n[16],e[17+t]=n[17],e[18+t]=n[18],e[19+t]=n[19],e[20+t]=n[20],e[21+t]=n[21],e[22+t]=n[22],e[23+t]=n[23],e[24+t]=n[24],e[25+t]=n[25],e[26+t]=n[26]},t.clone=function(){var t=new e;return this.cloneTo(t),t},t.cloneTo=function(e){this.toArray(e.coefficients)},e}();function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),e}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function P(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,A(e,t)}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function R(e,t,n){return(R=E()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&A(i,n.prototype),i}).apply(null,arguments)}function F(e){var t="function"==typeof Map?new Map:void 0;return(F=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return R(e,arguments,M(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),A(r,e)})(e)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function O(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}e.AssetPromiseStatus=void 0,(v=e.AssetPromiseStatus||(e.AssetPromiseStatus={}))[v.Success=0]="Success",v[v.Pending=1]="Pending",v[v.Failed=2]="Failed";var z=function(t){P(r,t),r.all=function(e){return new r((function(t,n,r){if(!Array.isArray(e))return t([e]);var i=0,a=e.length,o=new Array(a);e.forEach((function(e,s){Promise.resolve(e).then((function(e){o[s]=e,r((i+=1)/a),i==a&&t(o)})).catch((function(e){return n(e)}))}))}))};var n=r.prototype;function r(n){var r,i,a=function(e){if(!(e<=r._progress)){r._progress=e;for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(r._listeners);!(t=n()).done;)(0,t.value)(e)}};return(r=t.call(this,(function(t,o){n((function(n){Promise.resolve().then((function(){a(1),r._status=e.AssetPromiseStatus.Success,t(n)}))}),i=function(t){Promise.resolve().then((function(){r._status=e.AssetPromiseStatus.Failed,o(t)}))},(function(e){Promise.resolve().then((function(){a(e)}))}))}))||this)._status=void 0,r._progress=void 0,r._reject=void 0,r._listeners=void 0,r._reject=i,r._listeners=new Set,r._progress=0,r._status=e.AssetPromiseStatus.Pending,r}return n.onProgress=function(e){return this._listeners.add(e),this},n.cancel=function(){return this._status!==e.AssetPromiseStatus.Pending||this._reject("Promise Canceled"),this},T(r,[{key:"status",get:function(){return this._status}},{key:"progress",get:function(){return this._progress}}]),r}(F(Promise)),D={isArray:"isArray"in Array?Array.isArray:function(e){return"[object Array]"===toString.call(e)},isArrayLike:function(e){return!!e&&"number"==typeof e.length&&"function"!=typeof e},clone:function(e){if("object"!=typeof e||null===e)return e;var t;if(D.isArrayLike(e)){t=e.slice();for(var n=0,r=e.length;n<r;n++)t[n]=D.clone(e[n])}else for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=D.clone(e[i]));return t},downloadBlob:function(e,t){if(void 0===t&&(t=""),navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var n=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=n,r.download=t,r.addEventListener("click",(function(){r.parentElement&&r.parentElement.removeChild(r)})),r.click(),window.URL.revokeObjectURL(n)}}};function k(e){return Object.keys(e).map((function(t){return e[t]}))}var N=function(){function e(e){this.engine=e,this.retryCount=1,this.retryInterval=0,this.timeout=2e4,this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._refObjectPool=Object.create(null),this._loadingPromises={}}e._addLoader=function(e,t,n){this._loaders[e]=t;for(var r=0,i=n.length;r<i;r++)this._extTypeMapping[n[r]]=e},e._getTypeByUrl=function(e){var t=e.split("?")[0];return this._extTypeMapping[t.substring(t.lastIndexOf(".")+1)]};var t=e.prototype;return t.load=function(e){var t=this;if(!Array.isArray(e))return this._loadSingleItem(e);var n=e.map((function(e){return t._loadSingleItem(e)}));return z.all(n)},t.cancelNotLoaded=function(e){var t=this;if(e)if("string"==typeof e){var n;null===(n=this._loadingPromises[e])||void 0===n||n.cancel()}else e.forEach((function(e){var n;null===(n=t._loadingPromises[e])||void 0===n||n.cancel()}));else k(this._loadingPromises).forEach((function(e){e.cancel()}))},t.gc=function(){for(var e=k(this._refObjectPool),t=0,n=e.length;t<n;t++)e[t].isGCIgnored||e[t].destroy()},t.getAssetPath=function(e){return this._assetPool[e]},t._addAsset=function(e,t){this._assetPool[t.instanceId]=e,this._assetUrlPool[e]=t},t._deleteAsset=function(e){var t=e.instanceId,n=this._assetPool[t];n&&(delete this._assetPool[t],delete this._assetUrlPool[n])},t._addRefObject=function(e,t){this._refObjectPool[e]=t},t._deleteRefObject=function(e){delete this._refObjectPool[e]},t._assignDefaultOptions=function(t){var n,r,i,a,o;if(t.type=null!=(n=t.type)?n:e._getTypeByUrl(t.url),void 0===t.type)throw"asset type should be specified: "+t.url;return t.retryCount=null!=(r=t.retryCount)?r:this.retryCount,t.timeout=null!=(i=t.timeout)?i:this.timeout,t.retryInterval=null!=(a=t.retryInterval)?a:this.retryInterval,t.url=null!=(o=t.url)?o:t.urls.join(","),t},t._loadSingleItem=function(t){var n=this,r=this._assignDefaultOptions("string"==typeof t?{url:t}:t),i=r.url;if(this._assetUrlPool[i])return new z((function(e){e(n._assetUrlPool[i])}));if(this._loadingPromises[i])return this._loadingPromises[r.url];var a=e._loaders[r.type],o=a.load(r,this);return this._loadingPromises[i]=o,o.then((function(e){a.useCache&&n._addAsset(i,e),delete n._loadingPromises[i]})).catch((function(){})),o},e}();function U(e,t,n){return void 0===n&&(n=!0),function(r){var i=new r(n);N._addLoader(e,i,t)}}N._loaders={},N._extTypeMapping={};var V,G=function(){function e(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n={}),void 0===r&&(r=!0),this.data=void 0,this._timeStamp=void 0,this._target=void 0,this._currentTarget=void 0,this._bubbles=void 0,this._propagationStopped=void 0,this._type=void 0,this._timeStamp=(new Date).getTime(),this._target=t,this.data=n,this._currentTarget=null,this._bubbles=r,this._propagationStopped=!1,this._type=e}return e.prototype.stopPropagation=function(){this._propagationStopped=!0},T(e,[{key:"propagationStopped",get:function(){return this._propagationStopped}},{key:"target",get:function(){return this._target},set:function(e){this._target=e}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"currentTarget",get:function(){return this._currentTarget},set:function(e){this._currentTarget=e}},{key:"bubbles",get:function(){return this._bubbles}},{key:"type",get:function(){return this._type}}]),e}();function H(e,t){J.registerCloneMode(e,t,V.Ignore)}function W(e,t){J.registerCloneMode(e,t,V.Assignment)}function j(e,t){J.registerCloneMode(e,t,V.Shallow)}function X(e,t){J.registerCloneMode(e,t,V.Deep)}!function(e){e[e.Ignore=0]="Ignore",e[e.Assignment=1]="Assignment",e[e.Shallow=2]="Shallow",e[e.Deep=3]="Deep"}(V||(V={}));var K,q,Q,Y,$,J=function(){function e(){}return e.registerCloneMode=function(t,n,r){var i=e._subCloneModeMap.get(t.constructor);i||(i=Object.create(null),e._subCloneModeMap.set(t.constructor,i)),i[n]=r},e.getCloneMode=function(t){var n=e._cloneModeMap.get(t);if(!n){n=Object.create(null),e._cloneModeMap.set(t,n);for(var r=e._objectType,i=e._subCloneModeMap;t!==r;){var a=i.get(t);a&&C(n,a),t=Object.getPrototypeOf(t)}}return n},e.deepCloneObject=function(t,n){switch(t.constructor){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:n.set(t);break;case Array:for(var r=0,i=t.length;r<i;r++)e._deepCloneObjectItem(t,n,r);break;default:var a=t;if(a.clone&&a.cloneTo)a.cloneTo(n);else for(var o=Object.keys(t),s=0,l=o.length;s<l;s++)e._deepCloneObjectItem(t,n,o[s])}},e._deepCloneObjectItem=function(t,n,r){var i=t[r];if(i instanceof Object)switch(i.constructor){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:var a=i,o=n[r];null==o?n[r]=a.slice():o.set(a);break;case Array:var s=i,l=n[r];null==l?n[r]=new Array(s.length):l.length=s.length,e.deepCloneObject(s,l);break;default:if(!i.clone||!i.cloneTo){var u=n[r];null==u&&(n[r]=u=new i.constructor),e.deepCloneObject(i,u);break}var c=i,d=n[r];d?c.cloneTo(d):n[r]=c.clone()}else n[r]=i},e}();J._subCloneModeMap=new Map,J._cloneModeMap=new Map,J._objectType=Object.getPrototypeOf(Object);var Z,ee,te,ne,re=($=Y=function(){function e(e){I(this,"instanceId",q,this),I(this,"_engine",Q,this),this._engine=e}return T(e,[{key:"engine",get:function(){return this._engine}}]),e}(),Y._instanceIdCounter=0,q=O((K=$).prototype,"instanceId",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return++re._instanceIdCounter}}),Q=O(K.prototype,"_engine",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K),ie=(ee=O((Z=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return I(t=e.call.apply(e,[this].concat(r))||this,"_evts",ee,L(t)),t._evtCount=0,t}P(t,e);var n=t.prototype;return n.hasEvent=function(e){return null!=this._evts[e]},n.eventNames=function(){return 0===this._evtCount?[]:Object.keys(this._evts)},n.listenerCount=function(e){var t=this._evts[e];return t?t.fn?1:t.length:0},n.dispatch=function(e,t){if(!this._evts[e])return!1;var n=this._evts[e];if(n.fn)n.once&&this.removeEventListener(e,n.fn),n.fn(t);else for(var r=n.length,i=0;i<r;i++)n[i].once&&this.removeEventListener(e,n[i].fn),n[i].fn(t);return!0},n.on=function(e,t){return this.addEventListener(e,t)},n.once=function(e,t){return this.addEventListener(e,t,!0)},n.addEventListener=function(e,t,n){var r={fn:t,once:n},i=this._evts;return i[e]?i[e].fn?i[e]=[i[e],r]:i[e].push(r):(i[e]=r,this._evtCount++),this},n.off=function(e,t){if(!this._evts[e])return this;if(!t)return this._clearEvent(e),this;var n=this._evts[e];if(n.fn&&n.fn===t)this._clearEvent(e);else{var r=n.indexOf(t);if(r>-1){var i=n[n.length-1];n[r]=i,n.length--,1===n.length&&(this._evts[e]=n[0])}}return this},n.removeEventListener=function(e,t){return this.off(e,t)},n.removeAllEventListeners=function(e){e?this._evts[e]&&this._clearEvent(e):(this._evts=Object.create(null),this._evtCount=0)},n.trigger=function(e){this.dispatch(e.type,e.data)},n._clearEvent=function(e){0==--this._evtCount?this._evts=Object.create(null):delete this._evts[e]},t}(re)).prototype,"_evts",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Object.create(null)}}),Z),ae=function(e){},oe=console.log.bind(console),se=console.info.bind(console),le=console.warn.bind(console),ue=console.error.bind(console),ce={debug:ae,info:ae,warn:ae,error:ae,isEnabled:!1,enable:function(){this.debug=oe,this.info=se,this.warn=le,this.error=ue,this.isEnabled=!0},disable:function(){this.debug=ae,this.info=ae,this.warn=ae,this.error=ae,this.isEnabled=!1}},de=function(){function e(){this._clock=void 0,this._timeScale=void 0,this._deltaTime=void 0,this._startTime=void 0,this._lastTickTime=void 0,this._clock=performance||Date,this._timeScale=1,this._deltaTime=1e-4;var e=this._clock.now();this._startTime=e,this._lastTickTime=e}var t=e.prototype;return t.reset=function(){this._lastTickTime=this._clock.now()},t.tick=function(){var e=this.nowTime;this._deltaTime=(e-this._lastTickTime)*this._timeScale,this._lastTickTime=e},T(e,[{key:"nowTime",get:function(){return this._clock.now()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"timeScale",get:function(){return this._timeScale},set:function(e){this._timeScale=e}},{key:"unscaledDeltaTime",get:function(){return this._deltaTime/this._timeScale}},{key:"timeSinceStartup",get:function(){return this.nowTime-this._startTime}}]),e}();e.DataType=void 0,(te=e.DataType||(e.DataType={}))[te.FLOAT=5126]="FLOAT",te[te.FLOAT_VEC2=35664]="FLOAT_VEC2",te[te.FLOAT_VEC3=35665]="FLOAT_VEC3",te[te.FLOAT_VEC4=35666]="FLOAT_VEC4",te[te.INT=5124]="INT",te[te.INT_VEC2=35667]="INT_VEC2",te[te.INT_VEC3=35668]="INT_VEC3",te[te.INT_VEC4=35669]="INT_VEC4",te[te.BOOL=35670]="BOOL",te[te.BOOL_VEC2=35671]="BOOL_VEC2",te[te.BOOL_VEC3=35672]="BOOL_VEC3",te[te.BOOL_VEC4=35673]="BOOL_VEC4",te[te.FLOAT_MAT2=35674]="FLOAT_MAT2",te[te.FLOAT_MAT3=35675]="FLOAT_MAT3",te[te.FLOAT_MAT4=35676]="FLOAT_MAT4",te[te.FLOAT_ARRAY=35677]="FLOAT_ARRAY",te[te.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",te[te.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",te[te.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",te[te.INT_ARRAY=100003]="INT_ARRAY",te[te.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",te[te.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",te[te.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",te[te.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",te[te.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",te[te.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",te[te.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",te[te.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",te[te.SAMPLER_2D=35678]="SAMPLER_2D",te[te.SAMPLER_CUBE=35680]="SAMPLER_CUBE",te[te.BYTE=5120]="BYTE",te[te.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",te[te.SHORT=5122]="SHORT",te[te.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",te[te.UNSIGNED_INT=5125]="UNSIGNED_INT",e.GLCapabilityType=void 0,(ne=e.GLCapabilityType||(e.GLCapabilityType={})).shaderVertexID="shaderVertexID",ne.standardDerivatives="OES_standard_derivatives",ne.shaderTextureLod="EXT_shader_texture_lod",ne.elementIndexUint="OES_element_index_uint",ne.depthTexture="WEBGL_depth_texture",ne.drawBuffers="WEBGL_draw_buffers",ne.vertexArrayObject="OES_vertex_array_object",ne.instancedArrays="ANGLE_instanced_arrays",ne.multipleSample="multipleSampleOnlySupportedInWebGL2",ne.textureFloat="OES_texture_float",ne.textureFloatLinear="OES_texture_float_linear",ne.textureHalfFloat="OES_texture_half_float",ne.textureHalfFloatLinear="OES_texture_half_float_linear",ne.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",ne.colorBufferFloat="EXT_color_buffer_float",ne.colorBufferHalfFloat="EXT_color_buffer_half_float",ne.textureFilterAnisotropic="EXT_texture_filter_anisotropic",ne.blendMinMax="EXT_blend_minmax",ne.astc="WEBGL_compressed_texture_astc",ne.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",ne.etc="WEBGL_compressed_texture_etc",ne.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",ne.etc1="WEBGL_compressed_texture_etc1",ne.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",ne.pvrtc="WEBGL_compressed_texture_pvrtc",ne.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",ne.s3tc="WEBGL_compressed_texture_s3tc",ne.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc";var fe=function(){function e(e){void 0===e&&(e=0),this._elements=void 0,this.length=0,this._elements=new Array(e)}var t=e.prototype;return t.add=function(e){this.length===this._elements.length?this._elements.push(e):this._elements[this.length]=e,this.length++},t.delete=function(e){var t=this._elements.indexOf(e);this.deleteByIndex(t)},t.get=function(e){if(e>=this.length)throw"Index is out of range.";return this._elements[e]},t.deleteByIndex=function(e){var t=this._elements,n=null,r=this.length-1;return e!==r&&(n=t[r],t[e]=n),this.length--,n},t.garbageCollection=function(){this._elements.length=this.length},e}(),he=function(){function e(){this._mask=[],this._length=0}e.unionCollection=function(e,t,n){var r,i,a,o,s=n._mask;e._length<t._length?(r=e._length,i=t._length,a=e._mask,o=t._mask):(r=t._length,i=e._length,a=t._mask,o=e._mask);var l=0;for(s.length<i&&(s.length=i);l<r;l++)s[l]=a[l]|o[l];for(;l<i;l++)s[l]=o[l];n._length=i};var t=e.prototype;return t.enable=function(e){var t=e._index,n=t+1,r=this._mask,i=this._length;if(i<n){for(r.length<n&&(r.length=n);i<t;i++)r[i]=0;r[t]=e._value,this._length=n}else r[t]|=e._value},t.disable=function(e){var t=e._index,n=this._mask,r=this._length-1;if(!(t>r)){var i=n[t]&~e._value;t==r&&0===i?this._length--:n[t]=i}},t.unionCollection=function(e){var t=e._mask,n=e._length,r=this._mask,i=this._length;if(i<n){r.length<n&&(r.length=n);for(var a=0;a<i;a++)r[a]|=t[a];for(;a<n;a++)r[a]=t[a];this._length=n}else for(var o=0;o<n;o++)r[o]|=t[o]},t.complementaryCollection=function(e){for(var t=e._mask,n=this._mask,r=this._length-1,i=Math.min(e._length-1,r);i>=0;i--){var a=n[i]&~t[i];i==r&&0===a?(r--,this._length--):n[i]=a}},t.intersectionCollection=function(e){for(var t=e._mask,n=this._mask,r=this._length-1;r>=0;r--){var i=n[r]&t[r];0==i&&r==this._length-1?this._length--:n[r]=i}},t.isEnable=function(e){var t=e._index;return!(t>=this._length)&&0!=(this._mask[t]&e._value)},t.clear=function(){this._length=0},e}(),pe=function(){function e(){this._onStartScripts=new fe,this._onUpdateScripts=new fe,this._onLateUpdateScripts=new fe,this._destroyComponents=[],this._onUpdateAnimations=new fe,this._renderers=new fe,this._onUpdateRenderers=new fe,this._componentsContainerPool=[]}var t=e.prototype;return t.addRenderer=function(e){e._rendererIndex=this._renderers.length,this._renderers.add(e)},t.removeRenderer=function(e){var t=this._renderers.deleteByIndex(e._rendererIndex);t&&(t._rendererIndex=e._rendererIndex),e._rendererIndex=-1},t.addOnStartScript=function(e){e._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(e)},t.removeOnStartScript=function(e){var t=this._onStartScripts.deleteByIndex(e._onStartIndex);t&&(t._onStartIndex=e._onStartIndex),e._onStartIndex=-1},t.addOnUpdateScript=function(e){e._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(e)},t.removeOnUpdateScript=function(e){var t=this._onUpdateScripts.deleteByIndex(e._onUpdateIndex);t&&(t._onUpdateIndex=e._onUpdateIndex),e._onUpdateIndex=-1},t.addOnLateUpdateScript=function(e){e._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(e)},t.removeOnLateUpdateScript=function(e){var t=this._onLateUpdateScripts.deleteByIndex(e._onLateUpdateIndex);t&&(t._onLateUpdateIndex=e._onLateUpdateIndex),e._onLateUpdateIndex=-1},t.addOnUpdateAnimations=function(e){e._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(e)},t.removeOnUpdateAnimations=function(e){var t=this._onUpdateAnimations.deleteByIndex(e._onUpdateIndex);t&&(t._onUpdateIndex=e._onUpdateIndex),e._onUpdateIndex=-1},t.addOnUpdateRenderers=function(e){e._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(e)},t.removeOnUpdateRenderers=function(e){var t=this._onUpdateRenderers.deleteByIndex(e._onUpdateIndex);t&&(t._onUpdateIndex=e._onUpdateIndex),e._onUpdateIndex=-1},t.addDestroyComponent=function(e){this._destroyComponents.push(e)},t.callScriptOnStart=function(){var e=this._onStartScripts;if(e.length>0){for(var t=e._elements,n=0;n<e.length;n++){var r=t[n];r._started=!0,r._onStartIndex=-1,r.onStart()}e.length=0}},t.callScriptOnUpdate=function(e){for(var t=this._onUpdateScripts._elements,n=this._onUpdateScripts.length-1;n>=0;--n){var r=t[n];r._started&&r.onUpdate(e)}},t.callScriptOnLateUpdate=function(e){for(var t=this._onLateUpdateScripts._elements,n=this._onLateUpdateScripts.length-1;n>=0;--n){var r=t[n];r._started&&r.onLateUpdate(e)}},t.callAnimationUpdate=function(e){for(var t=this._onUpdateAnimations._elements,n=this._onUpdateAnimations.length-1;n>=0;--n)t[n].update(e)},t.callRendererOnUpdate=function(e){for(var t=this._onUpdateRenderers._elements,n=this._onUpdateRenderers.length-1;n>=0;--n)t[n].update(e)},t.callRender=function(t){for(var n=t._camera,r=this._renderers._elements,a=this._renderers.length-1;a>=0;--a){var o=r[a];if(n.cullingMask&o._entity.layer&&(!n.enableFrustumCulling||(o.isCulled=!n._frustum.intersectsBox(o.bounds),!o.isCulled))){var s=n.entity.transform,l=s.worldPosition,u=o.bounds.getCenter(e._tempVector0);if(n.isOrthographic){var c=s.getWorldForward(e._tempVector1);i.subtract(u,l,u),o._distanceForSort=i.dot(u,c)}else o._distanceForSort=i.distanceSquared(u,l);o._updateShaderData(t),o._render(n),he.unionCollection(n._globalShaderMacro,o.shaderData._macroCollection,o._globalShaderMacro)}}},t.callComponentDestroy=function(){var e=this._destroyComponents,t=e.length;if(t>0){for(var n=t-1;n>=0;--n)e[n].onDestroy();e.length=0}},t.callCameraOnBeginRender=function(e){for(var t=e.entity._components,n=t.length-1;n>=0;--n){var r=t[n];r.onBeginRender&&r.onBeginRender(e)}},t.callCameraOnEndRender=function(e){for(var t=e.entity._components,n=t.length-1;n>=0;--n){var r=t[n];r.onBeginRender&&r.onEndRender(e)}},t.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},t.putActiveChangedTempList=function(e){e.length=0,this._componentsContainerPool.push(e)},e}();pe._tempVector0=new i,pe._tempVector1=new i;var _e,ve,me,ge,ye,xe,be=function(){function e(){}return e.cloneComponent=function(e,t){for(var n=J.getCloneMode(e.constructor),r=Object.keys(e),i=0,a=r.length;i<a;i++){var o=r[i];switch(n[o]){case void 0:case V.Assignment:t[o]=e[o];break;case V.Shallow:var s=e[o];if(s instanceof Object){var l=t[o];null==l&&(l=t[o]=s.constructor()),C(l,s)}else t[o]=s;break;case V.Deep:var u=e[o];if(u instanceof Object){var c=t[o];null==c&&(c=t[o]=u.constructor()),J.deepCloneObject(u,c)}else t[o]=u}}e._cloneTo&&e._cloneTo(t)},e}(),we=function(){function e(){}return e.register=function(e,t){this._addDependency(e,t,this._dependenciesMap),this._addDependency(t,e,this._invDependenciesMap)},e._addCheck=function(t,n){var r=e._dependenciesMap.get(n);if(r)for(var i=0,a=r.length;i<a;i++)if(!t.getComponent(r[i]))throw"you should add "+r[i]+" before adding "+n},e._removeCheck=function(t,n){var r=e._invDependenciesMap.get(n);if(r)for(var i=0,a=r.length;i<a;i++)if(t.getComponent(r[i]))throw"you should remove "+r[i]+" before adding "+n},e._addDependency=function(e,t,n){var r=n.get(e);r||(r=[],n.set(e,r)),-1===r.indexOf(t)&&r.push(t)},e}();function Te(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){t.forEach((function(t){return we.register(e,t)}))}}we._dependenciesMap=new Map,we._invDependenciesMap=new Map,e.Layer=void 0,(_e=e.Layer||(e.Layer={}))[_e.Layer0=1]="Layer0",_e[_e.Layer1=2]="Layer1",_e[_e.Layer2=4]="Layer2",_e[_e.Layer3=8]="Layer3",_e[_e.Layer4=16]="Layer4",_e[_e.Layer5=32]="Layer5",_e[_e.Layer6=64]="Layer6",_e[_e.Layer7=128]="Layer7",_e[_e.Layer8=256]="Layer8",_e[_e.Layer9=512]="Layer9",_e[_e.Layer10=1024]="Layer10",_e[_e.Layer11=2048]="Layer11",_e[_e.Layer12=4096]="Layer12",_e[_e.Layer13=8192]="Layer13",_e[_e.Layer14=16384]="Layer14",_e[_e.Layer15=32768]="Layer15",_e[_e.Layer16=65536]="Layer16",_e[_e.Layer17=131072]="Layer17",_e[_e.Layer18=262144]="Layer18",_e[_e.Layer19=524288]="Layer19",_e[_e.Layer20=1048576]="Layer20",_e[_e.Layer21=2097152]="Layer21",_e[_e.Layer22=4194304]="Layer22",_e[_e.Layer23=8388608]="Layer23",_e[_e.Layer24=16777216]="Layer24",_e[_e.Layer25=33554432]="Layer25",_e[_e.Layer26=67108864]="Layer26",_e[_e.Layer27=134217728]="Layer27",_e[_e.Layer28=268435456]="Layer28",_e[_e.Layer29=536870912]="Layer29",_e[_e.Layer30=1073741824]="Layer30",_e[_e.Layer31=2147483648]="Layer31",_e[_e.Everything=4294967295]="Everything",_e[_e.Nothing=0]="Nothing";var Se,Ce,Pe,Me,Ae,Ee,Re,Fe,Le,Be,Ie,Oe,ze,De,ke,Ne,Ue,Ve=(me=O((ve=function(e){function t(t){var n;return I(n=e.call(this,t.engine)||this,"_entity",me,L(n)),I(n,"_destroyed",ge,L(n)),I(n,"_enabled",ye,L(n)),I(n,"_awoken",xe,L(n)),n._entity=t,n}P(t,e);var n=t.prototype;return n.destroy=function(){this._destroyed||(this._entity._removeComponent(this),this._entity.isActiveInHierarchy&&(this._enabled&&this._onDisable(),this._onInActive()),this._destroyed=!0,this._onDestroy())},n._onAwake=function(){},n._onEnable=function(){},n._onDisable=function(){},n._onDestroy=function(){},n._onActive=function(){},n._onInActive=function(){},n._setActive=function(e){e?(this._awoken||(this._awoken=!0,this._onAwake()),this._entity._isActiveInHierarchy&&(this._onActive(),this._enabled&&this._onEnable())):(this._enabled&&this._onDisable(),this._onInActive())},T(t,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,e?this._entity.isActiveInHierarchy&&this._onEnable():this._entity.isActiveInHierarchy&&this._onDisable())}},{key:"destroyed",get:function(){return this._destroyed}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}}]),t}(re)).prototype,"_entity",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ge=O(ve.prototype,"_destroyed",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ye=O(ve.prototype,"_enabled",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xe=O(ve.prototype,"_awoken",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ve),Ge=function(){function e(e){void 0===e&&(e=[]),this._flags=e,this.flag=!0,this._flags.push(this)}return e.prototype.destroy=function(){!function(e,t){var n=e.indexOf(t);if(n<0)return!1;var r=e.length-1;if(n!==r){var i=e[r];e[n]=i}e.length--}(this._flags,this),this._flags=null},e}(),He=function(){function e(){this._updateFlags=[]}var t=e.prototype;return t.register=function(){return new Ge(this._updateFlags)},t.distribute=function(){for(var e=this._updateFlags,t=e.length-1;t>=0;t--)e[t].flag=!0},e}(),We=(Ne=ke=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return I(t=e.call.apply(e,[this].concat(r))||this,"_position",Ce,L(t)),I(t,"_rotation",Pe,L(t)),I(t,"_rotationQuaternion",Me,L(t)),I(t,"_scale",Ae,L(t)),I(t,"_worldPosition",Ee,L(t)),I(t,"_worldRotation",Re,L(t)),I(t,"_worldRotationQuaternion",Fe,L(t)),I(t,"_lossyWorldScale",Le,L(t)),I(t,"_localMatrix",Be,L(t)),I(t,"_worldMatrix",Ie,L(t)),I(t,"_updateFlagManager",Oe,L(t)),I(t,"_isParentDirty",ze,L(t)),I(t,"_parentTransformCache",De,L(t)),t._dirtyFlag=Ue.WmWpWeWqWs,t}P(t,e);var n=t.prototype;return n.setPosition=function(e,t,n){this._position.setValue(e,t,n),this.position=this._position},n.setRotation=function(e,t,n){this._rotation.setValue(e,t,n),this.rotation=this._rotation},n.setRotationQuaternion=function(e,t,n,r){this._rotationQuaternion.setValue(e,t,n,r),this.rotationQuaternion=this._rotationQuaternion},n.setScale=function(e,t,n){this._scale.setValue(e,t,n),this.scale=this._scale},n.setWorldPosition=function(e,t,n){this._worldPosition.setValue(e,t,n),this.worldPosition=this._worldPosition},n.setWorldRotation=function(e,t,n){this._worldRotation.setValue(e,t,n),this.worldRotation=this._worldRotation},n.setWorldRotationQuaternion=function(e,t,n,r){this._worldRotationQuaternion.setValue(e,t,n,r),this.worldRotationQuaternion=this._worldRotationQuaternion},n.getWorldForward=function(e){var t=this.worldMatrix.elements;return e.setValue(-t[8],-t[9],-t[10]),e.normalize()},n.getWorldRight=function(e){var t=this.worldMatrix.elements;return e.setValue(t[0],t[1],t[2]),e.normalize()},n.getWorldUp=function(e){var t=this.worldMatrix.elements;return e.setValue(t[4],t[5],t[6]),e.normalize()},n.translate=function(e,n,r,i){if("number"==typeof e){var a=t._tempVec3;a.setValue(e,n,r),this._translate(a,i)}else this._translate(e,n)},n.rotate=function(e,t,n,r){"number"==typeof e?this._rotateXYZ(e,t,n,r):this._rotateXYZ(e.x,e.y,e.z,t)},n.rotateByAxis=function(e,n,i){void 0===i&&(i=!0);var a=n*r.degreeToRadFactor;d.rotationAxisAngle(e,a,t._tempQuat0),this._rotateByQuat(t._tempQuat0,i)},n.lookAt=function(e,n){var i,a=this.worldPosition,o=r.zeroTolerance;if(!(Math.abs(a.x-e.x)<o&&Math.abs(a.y-e.y)<o&&Math.abs(a.z-e.z)<o)){var s=t._tempMat43,l=this._worldRotationQuaternion;n=null!=(i=n)?i:t._tempVec3.setValue(0,1,0),f.lookAt(a,e,n,s),s.getRotation(l).invert(),this.worldRotationQuaternion=l}},n.registerWorldChangeFlag=function(){return this._updateFlagManager.register()},n._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},n._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(Ue.WmWp)){this._worldAssociatedChange(Ue.WmWp);for(var e=this._entity._children,t=0,n=e.length;t<n;t++){var r;null===(r=e[t].transform)||void 0===r||r._updateWorldPositionFlag()}}},n._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(Ue.WmWeWq)){this._worldAssociatedChange(Ue.WmWeWq);for(var e=this._entity._children,t=0,n=e.length;t<n;t++){var r;null===(r=e[t].transform)||void 0===r||r._updateWorldPositionAndRotationFlag()}}},n._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(Ue.WmWpWeWq)){this._worldAssociatedChange(Ue.WmWpWeWq);for(var e=this._entity._children,t=0,n=e.length;t<n;t++){var r;null===(r=e[t].transform)||void 0===r||r._updateWorldPositionAndRotationFlag()}}},n._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(Ue.WmWs)){this._worldAssociatedChange(Ue.WmWs);for(var e=this._entity._children,t=0,n=e.length;t<n;t++){var r;null===(r=e[t].transform)||void 0===r||r._updateWorldPositionAndScaleFlag()}}},n._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(Ue.WmWpWs)){this._worldAssociatedChange(Ue.WmWpWs);for(var e=this._entity._children,t=0,n=e.length;t<n;t++){var r;null===(r=e[t].transform)||void 0===r||r._updateWorldPositionAndScaleFlag()}}},n._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(Ue.WmWpWeWqWs)){this._worldAssociatedChange(Ue.WmWpWeWqWs);for(var e=this._entity._children,t=0,n=e.length;t<n;t++){var r;null===(r=e[t].transform)||void 0===r||r._updateAllWorldFlag()}}},n._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,t=this._entity.parent;t;){var n=t.transform;if(n){e=n;break}t=t.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},n._getScaleMatrix=function(){var e=t._tempQuat0,n=t._tempMat30,r=t._tempMat31,i=t._tempMat32;return r.setValueByMatrix(this.worldMatrix),d.invert(this.worldRotationQuaternion,e),c.rotationQuaternion(e,n),c.multiply(n,r,i),i},n._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},n._isContainDirtyFlag=function(e){return 0!=(this._dirtyFlag&e)},n._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},n._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},n._worldAssociatedChange=function(e){this._dirtyFlag|=e,this._updateFlagManager.distribute()},n._rotateByQuat=function(e,t){t?(d.multiply(this.rotationQuaternion,e,this._rotationQuaternion),this.rotationQuaternion=this._rotationQuaternion):(d.multiply(this.worldRotationQuaternion,e,this._worldRotationQuaternion),this.worldRotationQuaternion=this._worldRotationQuaternion)},n._translate=function(e,t){void 0===t&&(t=!0),t?this.position=this._position.add(e):this.worldPosition=this._worldPosition.add(e)},n._rotateXYZ=function(e,n,i,a){void 0===a&&(a=!0);var o=r.degreeToRadFactor,s=t._tempQuat0;d.rotationEuler(e*o,n*o,i*o,s),this._rotateByQuat(s,a)},T(t,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&e.cloneTo(this._position),this._setDirtyFlagTrue(Ue.LocalMatrix),this._updateWorldPositionFlag()}},{key:"worldPosition",get:function(){return this._isContainDirtyFlag(Ue.WorldPosition)&&(this._getParentTransform()?this.worldMatrix.getTranslation(this._worldPosition):this._position.cloneTo(this._worldPosition),this._setDirtyFlagFalse(Ue.WorldPosition)),this._worldPosition},set:function(e){this._worldPosition!==e&&e.cloneTo(this._worldPosition);var n=this._getParentTransform();n?(f.invert(n.worldMatrix,t._tempMat41),i.transformCoordinate(e,t._tempMat41,this._position)):e.cloneTo(this._position),this.position=this._position,this._setDirtyFlagFalse(Ue.WorldPosition)}},{key:"rotation",get:function(){return this._isContainDirtyFlag(Ue.LocalEuler)&&(this._rotationQuaternion.toEuler(this._rotation),this._rotation.scale(r.radToDegreeFactor),this._setDirtyFlagFalse(Ue.LocalEuler)),this._rotation},set:function(e){this._rotation!==e&&e.cloneTo(this._rotation),this._setDirtyFlagTrue(Ue.LocalMatrix|Ue.LocalQuat),this._setDirtyFlagFalse(Ue.LocalEuler),this._updateWorldRotationFlag()}},{key:"worldRotation",get:function(){return this._isContainDirtyFlag(Ue.WorldEuler)&&(this.worldRotationQuaternion.toEuler(this._worldRotation),this._worldRotation.scale(r.radToDegreeFactor),this._setDirtyFlagFalse(Ue.WorldEuler)),this._worldRotation},set:function(e){this._worldRotation!==e&&e.cloneTo(this._worldRotation),d.rotationEuler(r.degreeToRadian(e.x),r.degreeToRadian(e.y),r.degreeToRadian(e.z),this._worldRotationQuaternion),this.worldRotationQuaternion=this._worldRotationQuaternion,this._setDirtyFlagFalse(Ue.WorldEuler)}},{key:"rotationQuaternion",get:function(){return this._isContainDirtyFlag(Ue.LocalQuat)&&(d.rotationEuler(r.degreeToRadian(this._rotation.x),r.degreeToRadian(this._rotation.y),r.degreeToRadian(this._rotation.z),this._rotationQuaternion),this._setDirtyFlagFalse(Ue.LocalQuat)),this._rotationQuaternion},set:function(e){this._rotationQuaternion!==e&&e.cloneTo(this._rotationQuaternion),this._setDirtyFlagTrue(Ue.LocalMatrix|Ue.LocalEuler),this._setDirtyFlagFalse(Ue.LocalQuat),this._updateWorldRotationFlag()}},{key:"worldRotationQuaternion",get:function(){if(this._isContainDirtyFlag(Ue.WorldQuat)){var e=this._getParentTransform();null!=e?d.multiply(e.worldRotationQuaternion,this.rotationQuaternion,this._worldRotationQuaternion):this.rotationQuaternion.cloneTo(this._worldRotationQuaternion),this._setDirtyFlagFalse(Ue.WorldQuat)}return this._worldRotationQuaternion},set:function(e){this._worldRotationQuaternion!==e&&e.cloneTo(this._worldRotationQuaternion);var n=this._getParentTransform();n?(d.invert(n.worldRotationQuaternion,t._tempQuat0),d.multiply(e,t._tempQuat0,this._rotationQuaternion)):e.cloneTo(this._rotationQuaternion),this.rotationQuaternion=this._rotationQuaternion,this._setDirtyFlagFalse(Ue.WorldQuat)}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&e.cloneTo(this._scale),this._setDirtyFlagTrue(Ue.LocalMatrix),this._updateWorldScaleFlag()}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(Ue.WorldScale)){if(this._getParentTransform()){var e=this._getScaleMatrix().elements;this._lossyWorldScale.setValue(e[0],e[4],e[8])}else this._scale.cloneTo(this._lossyWorldScale);this._setDirtyFlagFalse(Ue.WorldScale)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(Ue.LocalMatrix)&&(f.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(Ue.LocalMatrix)),this._localMatrix},set:function(e){this._localMatrix!==e&&e.cloneTo(this._localMatrix),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(Ue.LocalEuler),this._setDirtyFlagFalse(Ue.LocalMatrix),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(Ue.WorldMatrix)){var e=this._getParentTransform();e?f.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._setDirtyFlagFalse(Ue.WorldMatrix)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&e.cloneTo(this._worldMatrix);var n=this._getParentTransform();n?(f.invert(n.worldMatrix,t._tempMat42),f.multiply(e,t._tempMat42,this._localMatrix)):e.cloneTo(this._localMatrix),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(Ue.WorldMatrix)}}]),t}(Ve),ke._tempQuat0=new d,ke._tempVec3=new i,ke._tempMat30=new c,ke._tempMat31=new c,ke._tempMat32=new c,ke._tempMat40=new f,ke._tempMat41=new f,ke._tempMat42=new f,ke._tempMat43=new f,Ce=O((Se=Ne).prototype,"_position",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i}}),Pe=O(Se.prototype,"_rotation",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i}}),Me=O(Se.prototype,"_rotationQuaternion",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d}}),Ae=O(Se.prototype,"_scale",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(1,1,1)}}),Ee=O(Se.prototype,"_worldPosition",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i}}),Re=O(Se.prototype,"_worldRotation",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i}}),Fe=O(Se.prototype,"_worldRotationQuaternion",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d}}),Le=O(Se.prototype,"_lossyWorldScale",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(1,1,1)}}),Be=O(Se.prototype,"_localMatrix",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Ie=O(Se.prototype,"_worldMatrix",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Oe=O(Se.prototype,"_updateFlagManager",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new He}}),ze=O(Se.prototype,"_isParentDirty",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),De=O(Se.prototype,"_parentTransformCache",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se);!function(e){e[e.LocalEuler=1]="LocalEuler",e[e.LocalQuat=2]="LocalQuat",e[e.WorldPosition=4]="WorldPosition",e[e.WorldEuler=8]="WorldEuler",e[e.WorldQuat=16]="WorldQuat",e[e.WorldScale=32]="WorldScale",e[e.LocalMatrix=64]="LocalMatrix",e[e.WorldMatrix=128]="WorldMatrix",e[e.WmWp=132]="WmWp",e[e.WmWeWq=152]="WmWeWq",e[e.WmWpWeWq=156]="WmWpWeWq",e[e.WmWs=160]="WmWs",e[e.WmWpWs=164]="WmWpWs",e[e.WmWpWeWqWs=188]="WmWpWeWqWs"}(Ue||(Ue={}));var je,Xe=function(t){function n(n,r){var i;return(i=t.call(this,n)||this).name=void 0,i.layer=e.Layer.Layer0,i.transform=void 0,i._isActiveInHierarchy=!1,i._components=[],i._scripts=new fe,i._children=[],i._scene=void 0,i._isRoot=!1,i._isActive=!0,i._parent=null,i._activeChangedComponents=void 0,i._invModelMatrix=new f,i._inverseWorldMatFlag=void 0,i.name=r,i.transform=i.addComponent(We),i._inverseWorldMatFlag=i.transform.registerWorldChangeFlag(),i}P(n,t),n._findChildByName=function(e,t){for(var n=e._children,r=n.length-1;r>=0;r--){var i=n[r];if(i.name===t)return i}return null},n._traverseSetOwnerScene=function(e,t){e._scene=t;for(var n=e._children,r=e.childCount-1;r>=0;r--)this._traverseSetOwnerScene(n[r],t)};var r=n.prototype;return r.addComponent=function(e){we._addCheck(this,e);var t=new e(this);return this._components.push(t),this._isActiveInHierarchy&&t._setActive(!0),t},r.getComponent=function(e){for(var t=this._components.length-1;t>=0;t--){var n=this._components[t];if(n instanceof e)return n}},r.getComponents=function(e,t){t.length=0;for(var n=this._components.length-1;n>=0;n--){var r=this._components[n];r instanceof e&&t.push(r)}return t},r.getComponentsIncludeChildren=function(e,t){return t.length=0,this._getComponentsInChildren(e,t),t},r.addChild=function(e){e.parent=this},r.removeChild=function(e){e.parent=null},r.getChild=function(e){return this._children[e]},r.findByName=function(e){var t=this._children,r=n._findChildByName(this,e);if(r)return r;for(var i=t.length-1;i>=0;i--){var a=t[i].findByName(e);if(a)return a}return null},r.findByPath=function(e){for(var t=e.split("/"),r=this,i=0,a=t.length;i<a;++i){var o=t[i];if(o&&!(r=n._findChildByName(r,o)))return null}return r},r.createChild=function(e){var t=new n(this.engine,e);return t.layer=this.layer,t.parent=this,t},r.clearChildren=function(){for(var e=this._children,t=e.length-1;t>=0;t--){var r=e[t];r._parent=null,r._isActiveInHierarchy&&r._processInActive(),n._traverseSetOwnerScene(r,null)}e.length=0},r.clone=function(){var e=new n(this._engine,this.name);e._isActive=this._isActive,e.transform.localMatrix=this.transform.localMatrix;for(var t=this._children,r=0,i=this._children.length;r<i;r++){var a=t[r];e.addChild(a.clone())}for(var o=this._components,s=0,l=o.length;s<l;s++){var u=o[s];if(!(u instanceof We)){var c=e.addComponent(u.constructor);be.cloneComponent(u,c)}}return e},r.destroy=function(){for(var e=this._components,t=e.length-1;t>=0;t--)e[t].destroy();this._components.length=0;for(var n=this._children,r=n.length-1;r>=0;r--)n[r].destroy();if(this._children.length=0,null!=this._parent){var i=this._parent._children;i.splice(i.indexOf(this),1)}this._parent=null},r._removeComponent=function(e){we._removeCheck(this,e.constructor);var t=this._components;t.splice(t.indexOf(e),1)},r._addScript=function(e){e._entityCacheIndex=this._scripts.length,this._scripts.add(e)},r._removeScript=function(e){var t=this._scripts.deleteByIndex(e._entityCacheIndex);t&&(t._entityCacheIndex=e._entityCacheIndex),e._entityCacheIndex=-1},r._removeFromParent=function(){var e=this._parent;if(null!=e){var t=e._children;t.splice(t.indexOf(this),1),this._parent=null}return e},r._processActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!0)},r._processInActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!1)},r._getComponentsInChildren=function(e,t){for(var n=this._components.length-1;n>=0;n--){var r=this._components[n];r instanceof e&&t.push(r)}for(var i=this._children.length-1;i>=0;i--)this._children[i]._getComponentsInChildren(e,t)},r._setActiveComponents=function(e){for(var t=this._activeChangedComponents,n=0,r=t.length;n<r;++n)t[n]._setActive(e);this._engine._componentsManager.putActiveChangedTempList(t),this._activeChangedComponents=null},r._setActiveInHierarchy=function(e){this._isActiveInHierarchy=!0;for(var t=this._components,n=t.length-1;n>=0;n--)e.push(t[n]);for(var r=this._children,i=r.length-1;i>=0;i--){var a=r[i];a.isActive&&a._setActiveInHierarchy(e)}},r._setInActiveInHierarchy=function(e){this._isActiveInHierarchy=!1;for(var t=this._components,n=t.length-1;n>=0;n--)e.push(t[n]);for(var r=this._children,i=r.length-1;i>=0;i--){var a=r[i];a.isActive&&a._setInActiveInHierarchy(e)}},r._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,t=this._children.length;e<t;e++)this._children[e]._setTransformDirty()},r.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&(f.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},T(n,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var t=this._parent;(null!=t&&t._isActiveInHierarchy||this._isRoot&&this._scene._isActiveInEngine)&&this._processActive()}else this._isActiveInHierarchy&&this._processInActive()}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){if(e!==this._parent){var t=this._removeFromParent(),r=this._parent=e;if(r){r._children.push(this);var i=r._scene;this._scene!==i&&n._traverseSetOwnerScene(this,i),r._isActiveInHierarchy?!this._isActiveInHierarchy&&this._isActive&&this._processActive():this._isActiveInHierarchy&&this._processInActive()}else this._isActiveInHierarchy&&this._processInActive(),t&&n._traverseSetOwnerScene(this,null);this._setTransformDirty()}}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"position",get:function(){return this.transform.position},set:function(e){this.transform.position=e}},{key:"worldPosition",get:function(){return this.transform.worldPosition},set:function(e){this.transform.worldPosition=e}},{key:"rotation",get:function(){return this.transform.rotationQuaternion},set:function(e){this.transform.rotationQuaternion=e}},{key:"scale",get:function(){return this.transform.scale},set:function(e){this.transform.scale=e}}]),n}(re),Ke=function(){function e(){this._features=[],this._objects=[]}var t=e.prototype;return t.registerFeature=function(e){for(var t=this._features,n=0,r=t.length;n<r;n++)if(t[n]===e)return;t.push(e);for(var i=this._objects,a=0,o=i.length;a<o;a++)i[a].features.push(new e)},t.addObject=function(e){e.features=[];for(var t=0,n=this._features.length;t<n;t++){var r;e.features.push(new this._features[t](null!=(r=e.engine)?r:e))}this._objects.push(e)},t.callFeatureMethod=function(e,t,n){for(var r=e.features,i=r.length,a=0;a<i;a++){var o=r[a];o[t]&&o[t].apply(o,n)}},t.findFeature=function(e,t){for(var n=e.features,r=n.length,i=0;i<r;i++){var a=n[i];if(a.constructor===t)return a}},e}();e.RenderQueueType=void 0,(je=e.RenderQueueType||(e.RenderQueueType={}))[je.Opaque=1e3]="Opaque",je[je.AlphaTest=2e3]="AlphaTest",je[je.Transparent=3e3]="Transparent";var qe,Qe=function(e){function t(t){var n;return(n=e.call(this,t)||this).isGCIgnored=!1,n._refCount=0,n._destroyed=!1,t.resourceManager._addRefObject(n.instanceId,L(n)),n}P(t,e);var n=t.prototype;return n.destroy=function(e){if(void 0===e&&(e=!1),this._destroyed)return!0;if(!e&&0!==this._refCount)return!1;var t=this._engine.resourceManager;t&&(t._deleteAsset(this),t._deleteRefObject(this.instanceId));var n=this._getRefCount();return n>0&&this._addRefCount(-n),this._engine=null,this._onDestroy(),this._destroyed=!0,!0},n._getRefCount=function(){return this._refCount},n._addRefCount=function(e){this._refCount+=e},n._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},T(t,[{key:"refCount",get:function(){return this._refCount}},{key:"destroyed",get:function(){return this._destroyed}}]),t}(re);!function(e){e[e.Scene=0]="Scene",e[e.Camera=1]="Camera",e[e.Renderer=2]="Renderer",e[e.Material=3]="Material"}(qe||(qe={}));var Ye=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).name=void 0,t._platformTexture=void 0,t._mipmap=void 0,t._width=void 0,t._height=void 0,t._mipmapCount=void 0,t._wrapModeU=void 0,t._wrapModeV=void 0,t._filterMode=void 0,t._anisoLevel=1,t}P(t,e);var n=t.prototype;return n.generateMipmaps=function(){this._mipmap&&this._platformTexture.generateMipmaps()},n._onDestroy=function(){this._platformTexture.destroy(),this._platformTexture=null},n._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},n._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},T(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){e!==this._wrapModeU&&(this._wrapModeU=e,this._platformTexture.wrapModeU=e)}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){e!==this._wrapModeV&&(this._wrapModeV=e,this._platformTexture.wrapModeV=e)}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,this._platformTexture.filterMode=e)}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var t=this._engine._hardwareRenderer.capability.maxAnisoLevel;e>t&&(ce.warn("anisoLevel:"+e+", exceeds the limit and is automatically downgraded to:"+t),e=t),e<1&&(ce.warn("anisoLevel:"+e+", must be greater than 0, and is automatically downgraded to 1"),e=1),e!==this._anisoLevel&&(this._anisoLevel=e,this._platformTexture.anisoLevel=e)}}]),t}(Qe),$e=b(b({common:"#define GLSLIFY 1\n#define PI 3.14159265359\n#define LOG2 1.442695\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n",common_vert:"#define GLSLIFY 1\nattribute vec3 POSITION;\n#ifdef O3_HAS_UV\nattribute vec2 TEXCOORD_0;\n#endif\n#ifdef O3_HAS_SKIN\nattribute vec4 JOINTS_0;attribute vec4 WEIGHTS_0;\n#ifdef O3_USE_JOINT_TEXTURE\nuniform sampler2D u_jointSampler;uniform float u_jointCount;mat4 getJointMatrix(sampler2D smp,float index){float base=index/u_jointCount;float hf=0.5/u_jointCount;float v=base+hf;vec4 m0=texture2D(smp,vec2(0.125,v));vec4 m1=texture2D(smp,vec2(0.375,v));vec4 m2=texture2D(smp,vec2(0.625,v));vec4 m3=texture2D(smp,vec2(0.875,v));return mat4(m0,m1,m2,m3);}\n#else\nuniform mat4 u_jointMatrix[O3_JOINTS_NUM];\n#endif\n#endif\n#ifdef O3_HAS_VERTEXCOLOR\nattribute vec4 COLOR_0;\n#endif\nuniform mat4 u_localMat;uniform mat4 u_modelMat;uniform mat4 u_viewMat;uniform mat4 u_projMat;uniform mat4 u_MVMat;uniform mat4 u_MVPMat;uniform mat4 u_normalMat;uniform vec3 u_cameraPos;uniform vec4 u_tilingOffset;\n#ifndef OMIT_NORMAL\n#ifdef O3_HAS_NORMAL\nattribute vec3 NORMAL;\n#endif\n#ifdef O3_HAS_TANGENT\nattribute vec4 TANGENT;\n#endif\n#endif\n",common_frag:"#define GLSLIFY 1\nuniform O3_VERTEX_PRECISION mat4 u_localMat;uniform O3_VERTEX_PRECISION mat4 u_modelMat;uniform O3_VERTEX_PRECISION mat4 u_viewMat;uniform O3_VERTEX_PRECISION mat4 u_projMat;uniform O3_VERTEX_PRECISION mat4 u_MVMat;uniform O3_VERTEX_PRECISION mat4 u_MVPMat;uniform O3_VERTEX_PRECISION mat4 u_normalMat;uniform O3_VERTEX_PRECISION vec3 u_cameraPos;",color_share:"#define GLSLIFY 1\n#ifdef O3_HAS_VERTEXCOLOR\nvarying vec4 v_color;\n#endif\n",normal_share:"#define GLSLIFY 1\n#ifdef O3_HAS_NORMAL\n#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )\nvarying mat3 v_TBN;\n#else\nvarying vec3 v_normal;\n#endif\n#endif\n",uv_share:"#define GLSLIFY 1\nvarying vec2 v_uv;",worldpos_share:"#define GLSLIFY 1\n#ifdef O3_NEED_WORLDPOS\nvarying vec3 v_pos;\n#endif\n",shadow_share:"#define GLSLIFY 1\n#ifdef O3_GENERATE_SHADOW_MAP\nuniform mat4 u_viewMatFromLight;uniform mat4 u_projMatFromLight;\n#endif\n#ifdef O3_SHADOW_MAP_COUNT\nuniform mat4 u_viewMatFromLight[O3_SHADOW_MAP_COUNT];uniform mat4 u_projMatFromLight[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];\n#endif\n",fog_share:"#define GLSLIFY 1\n#ifdef O3_HAS_FOG\nvarying vec3 v_fogDepth;uniform O3_VERTEX_PRECISION vec3 u_fogColor;\n#ifdef O3_FOG_EXP2\nuniform O3_VERTEX_PRECISION float u_fogDensity;\n#else\nuniform O3_VERTEX_PRECISION float u_fogNear;uniform O3_VERTEX_PRECISION float u_fogFar;\n#endif\n#endif\n",begin_normal_vert:"#define GLSLIFY 1\n#ifdef O3_HAS_NORMAL\nvec3 normal=vec3(NORMAL);\n#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )\nvec4 tangent=vec4(TANGENT);\n#endif\n#endif\n",begin_position_vert:"#define GLSLIFY 1\nvec4 position=vec4(POSITION,1.0);",position_vert:"#define GLSLIFY 1\n#ifndef O3_GENERATE_SHADOW_MAP\ngl_Position=u_MVPMat*position;\n#endif\n",color_vert:"#define GLSLIFY 1\n#ifdef O3_HAS_VERTEXCOLOR\nv_color=COLOR_0;\n#endif\n",normal_vert:"#define GLSLIFY 1\n#ifdef O3_HAS_NORMAL\n#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )\nvec3 normalW=normalize(mat3(u_normalMat)*normal.xyz);vec3 tangentW=normalize(mat3(u_normalMat)*tangent.xyz);vec3 bitangentW=cross(normalW,tangentW)*tangent.w;v_TBN=mat3(tangentW,bitangentW,normalW);\n#else\nv_normal=normalize(mat3(u_normalMat)*normal);\n#endif\n#endif\n",skinning_vert:"#define GLSLIFY 1\n#ifdef O3_HAS_SKIN\n#ifdef O3_USE_JOINT_TEXTURE\nmat4 skinMatrix=WEIGHTS_0.x*getJointMatrix(u_jointSampler,JOINTS_0.x)+WEIGHTS_0.y*getJointMatrix(u_jointSampler,JOINTS_0.y)+WEIGHTS_0.z*getJointMatrix(u_jointSampler,JOINTS_0.z)+WEIGHTS_0.w*getJointMatrix(u_jointSampler,JOINTS_0.w);\n#else\nmat4 skinMatrix=WEIGHTS_0.x*u_jointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*u_jointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*u_jointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*u_jointMatrix[int(JOINTS_0.w)];\n#endif\nposition=skinMatrix*position;\n#if defined(O3_HAS_NORMAL) && !defined(OMIT_NORMAL)\nnormal=vec4(skinMatrix*vec4(normal,0.0)).xyz;\n#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE )\ntangent.xyz=vec4(skinMatrix*vec4(tangent.xyz,0.0)).xyz;\n#endif\n#endif\n#endif\n",blendShape_input:"#define GLSLIFY 1\n#ifdef OASIS_BLENDSHAPE\n#ifndef OASIS_BLENDSHAPE_TEXTURE\nattribute vec3 POSITION_BS0;attribute vec3 POSITION_BS1;attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;\n#ifdef OASIS_BLENDSHAPE_NORMAL\nattribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 NORMAL_BS2;attribute vec3 NORMAL_BS3;\n#endif\n#ifdef OASIS_BLENDSHAPE_TANGENT\nattribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;attribute vec3 TANGENT_BS2;attribute vec3 TANGENT_BS3;\n#endif\n#endif\nuniform float u_blendShapeWeights[4];\n#endif\n",blendShape_vert:"#define GLSLIFY 1\n#ifdef OASIS_BLENDSHAPE\n#ifdef OASIS_BLENDSHAPE_TEXTURE\n#else\nposition.xyz+=POSITION_BS0*u_blendShapeWeights[0];position.xyz+=POSITION_BS1*u_blendShapeWeights[1];position.xyz+=POSITION_BS2*u_blendShapeWeights[2];position.xyz+=POSITION_BS3*u_blendShapeWeights[3];\n#if defined( O3_HAS_NORMAL ) && defined( OASIS_BLENDSHAPE_NORMAL )\nnormal.xyz+=NORMAL_BS0*u_blendShapeWeights[0];normal.xyz+=NORMAL_BS1*u_blendShapeWeights[1];normal.xyz+=NORMAL_BS2*u_blendShapeWeights[2];normal.xyz+=NORMAL_BS3*u_blendShapeWeights[3];\n#endif\n#if defined( O3_HAS_TANGENT ) && defined( O3_NORMAL_TEXTURE ) && defined(OASIS_BLENDSHAPE_TANGENT)\ntangent.xyz+=TANGENT_BS0*u_blendShapeWeights[0];tangent.xyz+=TANGENT_BS1*u_blendShapeWeights[1];tangent.xyz+=TANGENT_BS2*u_blendShapeWeights[2];tangent.xyz+=TANGENT_BS3*u_blendShapeWeights[3];\n#endif\n#endif\n#endif\n",uv_vert:"#define GLSLIFY 1\n#ifdef O3_HAS_UV\nv_uv=TEXCOORD_0;\n#else\nv_uv=vec2(0.,0.);\n#endif\n#ifdef O3_NEED_TILINGOFFSET\nv_uv=v_uv*u_tilingOffset.xy+u_tilingOffset.zw;\n#endif\n",worldpos_vert:"#define GLSLIFY 1\n#ifdef O3_NEED_WORLDPOS\nvec4 temp_pos=u_modelMat*position;v_pos=temp_pos.xyz/temp_pos.w;\n#endif\n",shadow_vert:"#define GLSLIFY 1\n#ifdef O3_GENERATE_SHADOW_MAP\ngl_Position=u_projMatFromLight*u_viewMatFromLight*u_modelMat*position;\n#endif\n#ifdef O3_SHADOW_MAP_COUNT\nfor(int i=0;i<O3_SHADOW_MAP_COUNT;i++){v_PositionFromLight[i]=u_projMatFromLight[i]*u_viewMatFromLight[i]*u_modelMat*vec4(POSITION,1.0);}\n#endif\n",fog_vert:"#define GLSLIFY 1\n#ifdef O3_HAS_FOG\nv_fogDepth=(u_MVMat*position).xyz;\n#endif\n",direct_light_frag:"#define GLSLIFY 1\n#ifdef O3_DIRECT_LIGHT_COUNT\nstruct DirectLight{vec3 color;vec3 direction;};uniform vec3 u_directLightColor[O3_DIRECT_LIGHT_COUNT];uniform vec3 u_directLightDirection[O3_DIRECT_LIGHT_COUNT];\n#endif\n",point_light_frag:"#define GLSLIFY 1\n#ifdef O3_POINT_LIGHT_COUNT\nstruct PointLight{vec3 color;vec3 position;float distance;};uniform vec3 u_pointLightColor[O3_POINT_LIGHT_COUNT];uniform vec3 u_pointLightPosition[O3_POINT_LIGHT_COUNT];uniform float u_pointLightDistance[O3_POINT_LIGHT_COUNT];\n#endif\n",spot_light_frag:"#define GLSLIFY 1\n#ifdef O3_SPOT_LIGHT_COUNT\nstruct SpotLight{vec3 color;vec3 position;vec3 direction;float distance;float angleCos;float penumbraCos;};uniform vec3 u_spotLightColor[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightPosition[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightDirection[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightDistance[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightAngleCos[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightPenumbraCos[O3_SPOT_LIGHT_COUNT];\n#endif\n",mobile_material_frag:"#define GLSLIFY 1\nuniform vec4 u_emissiveColor;uniform vec4 u_diffuseColor;uniform vec4 u_specularColor;uniform float u_shininess;uniform float u_normalIntensity;uniform float u_alphaCutoff;\n#ifdef O3_EMISSIVE_TEXTURE\nuniform sampler2D u_emissiveTexture;\n#endif\n#ifdef O3_DIFFUSE_TEXTURE\nuniform sampler2D u_diffuseTexture;\n#endif\n#ifdef O3_SPECULAR_TEXTURE\nuniform sampler2D u_specularTexture;\n#endif\n#ifdef O3_NORMAL_TEXTURE\nuniform sampler2D u_normalTexture;\n#endif\n",fog_frag:"#define GLSLIFY 1\n#ifdef O3_HAS_FOG\nfloat fogDepth=length(v_fogDepth);\n#ifdef O3_FOG_EXP2\nfloat fogFactor=whiteCompliment(exp2(-u_fogDensity*u_fogDensity*fogDepth*fogDepth*LOG2));\n#else\nfloat fogFactor=smoothstep(u_fogNear,u_fogFar,fogDepth);\n#endif\ngl_FragColor.rgb=mix(gl_FragColor.rgb,u_fogColor,fogFactor);\n#endif\n",begin_mobile_frag:"#define GLSLIFY 1\nvec4 ambient=vec4(0.0);vec4 emission=u_emissiveColor;vec4 diffuse=u_diffuseColor;vec4 specular=u_specularColor;\n#ifdef O3_EMISSIVE_TEXTURE\nemission*=texture2D(u_emissiveTexture,v_uv);\n#endif\n#ifdef O3_DIFFUSE_TEXTURE\ndiffuse*=texture2D(u_diffuseTexture,v_uv);\n#endif\n#ifdef O3_HAS_VERTEXCOLOR\ndiffuse*=v_color;\n#endif\n#ifdef O3_SPECULAR_TEXTURE\nspecular*=texture2D(u_specularTexture,v_uv);\n#endif\nambient=vec4(u_envMapLight.diffuse*u_envMapLight.diffuseIntensity,1.0)*diffuse;",begin_viewdir_frag:"#define GLSLIFY 1\n#ifdef O3_NEED_WORLDPOS\nvec3 V=normalize(u_cameraPos-v_pos);\n#endif\n",mobile_blinnphong_frag:"#define GLSLIFY 1\nvec3 N=getNormal();vec3 lightDiffuse=vec3(0.0,0.0,0.0);vec3 lightSpecular=vec3(0.0,0.0,0.0);\n#ifdef O3_DIRECT_LIGHT_COUNT\nDirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];float d=max(dot(N,-directionalLight.direction),0.0);lightDiffuse+=directionalLight.color*d;vec3 halfDir=normalize(V-directionalLight.direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess);lightSpecular+=directionalLight.color*s;}\n#endif\n#ifdef O3_POINT_LIGHT_COUNT\nPointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];vec3 direction=v_pos-pointLight.position;float dist=length(direction);direction/=dist;float decay=clamp(1.0-pow(dist/pointLight.distance,4.0),0.0,1.0);float d=max(dot(N,-direction),0.0)*decay;lightDiffuse+=pointLight.color*d;vec3 halfDir=normalize(V-direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decay;lightSpecular+=pointLight.color*s;}\n#endif\n#ifdef O3_SPOT_LIGHT_COUNT\nSpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];vec3 direction=spotLight.position-v_pos;float lightDistance=length(direction);direction/=lightDistance;float angleCos=dot(direction,-spotLight.direction);float decay=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayTotal=decay*spotEffect;float d=max(dot(N,direction),0.0)*decayTotal;lightDiffuse+=spotLight.color*d;vec3 halfDir=normalize(V+direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decayTotal;lightSpecular+=spotLight.color*s;}\n#endif\ndiffuse*=vec4(lightDiffuse,1.0);specular*=vec4(lightSpecular,1.0);\n#ifdef ALPHA_CUTOFF\nif(diffuse.a<u_alphaCutoff){discard;}\n#endif\n",noise_common:"#define GLSLIFY 1\nvec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod7(vec4 x){return x-floor(x*(1.0/7.0))*7.0;}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 permute(vec4 x){return mod289((34.0*x+1.0)*x);}vec3 permute(vec3 x){return mod289((34.0*x+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float taylorInvSqrt(float r){return 1.79284291400159-0.85373472095314*r;}vec4 fade(vec4 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}\n#define K 0.142857142857\n#define Ko 0.428571428571\n#define K2 0.020408163265306\n#define Kd2 0.0714285714285\n#define Kz 0.166666666667\n#define Kzo 0.416666666667\n#define jitter 1.0\n#define jitter1 0.8\n",noise_cellular_2D:"#define GLSLIFY 1\nvec2 cellular(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec3 oi=vec3(-1.0,0.0,1.0);vec3 of=vec3(-0.5,0.5,1.5);vec3 px=permute(Pi.x+oi);vec3 p=permute(px.x+Pi.y+oi);vec3 ox=fract(p*K)-Ko;vec3 oy=mod7(floor(p*K))*K-Ko;vec3 dx=Pf.x+0.5+jitter*ox;vec3 dy=Pf.y-of+jitter*oy;vec3 d1=dx*dx+dy*dy;p=permute(px.y+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-0.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d2=dx*dx+dy*dy;p=permute(px.z+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-1.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d3=dx*dx+dy*dy;vec3 d1a=min(d1,d2);d2=max(d1,d2);d2=min(d2,d3);d1=min(d1a,d2);d2=max(d1a,d2);d1.xy=(d1.x<d1.y)? d1.xy : d1.yx;d1.xz=(d1.x<d1.z)? d1.xz : d1.zx;d1.yz=min(d1.yz,d2.yz);d1.y=min(d1.y,d1.z);d1.y=min(d1.y,d2.x);return sqrt(d1.xy);}",noise_cellular_2x2:"#define GLSLIFY 1\nvec2 cellular2x2(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec4 Pfx=Pf.x+vec4(-0.5,-1.5,-0.5,-1.5);vec4 Pfy=Pf.y+vec4(-0.5,-0.5,-1.5,-1.5);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 ox=mod7(p)*K+Kd2;vec4 oy=mod7(floor(p*K))*K+Kd2;vec4 dx=Pfx+jitter1*ox;vec4 dy=Pfy+jitter1*oy;vec4 d=dx*dx+dy*dy;d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.y=min(d.y,d.z);d.y=min(d.y,d.w);return sqrt(d.xy);}",noise_cellular_2x2x2:"#define GLSLIFY 1\nvec2 cellular2x2x2(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P);vec4 Pfx=Pf.x+vec4(0.0,-1.0,0.0,-1.0);vec4 Pfy=Pf.y+vec4(0.0,0.0,-1.0,-1.0);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 p1=permute(p+Pi.z);vec4 p2=permute(p+Pi.z+vec4(1.0));vec4 ox1=fract(p1*K)-Ko;vec4 oy1=mod7(floor(p1*K))*K-Ko;vec4 oz1=floor(p1*K2)*Kz-Kzo;vec4 ox2=fract(p2*K)-Ko;vec4 oy2=mod7(floor(p2*K))*K-Ko;vec4 oz2=floor(p2*K2)*Kz-Kzo;vec4 dx1=Pfx+jitter1*ox1;vec4 dy1=Pfy+jitter1*oy1;vec4 dz1=Pf.z+jitter1*oz1;vec4 dx2=Pfx+jitter1*ox2;vec4 dy2=Pfy+jitter1*oy2;vec4 dz2=Pf.z-1.0+jitter1*oz2;vec4 d1=dx1*dx1+dy1*dy1+dz1*dz1;vec4 d2=dx2*dx2+dy2*dy2+dz2*dz2;vec4 d=min(d1,d2);d2=max(d1,d2);d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.yzw=min(d.yzw,d2.yzw);d.y=min(d.y,d.z);d.y=min(d.y,d.w);d.y=min(d.y,d2.x);return sqrt(d.xy);}",noise_cellular_3D:"#define GLSLIFY 1\nvec2 cellular(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P)-0.5;vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);vec3 p=permute(Pi.x+vec3(-1.0,0.0,1.0));vec3 p1=permute(p+Pi.y-1.0);vec3 p2=permute(p+Pi.y);vec3 p3=permute(p+Pi.y+1.0);vec3 p11=permute(p1+Pi.z-1.0);vec3 p12=permute(p1+Pi.z);vec3 p13=permute(p1+Pi.z+1.0);vec3 p21=permute(p2+Pi.z-1.0);vec3 p22=permute(p2+Pi.z);vec3 p23=permute(p2+Pi.z+1.0);vec3 p31=permute(p3+Pi.z-1.0);vec3 p32=permute(p3+Pi.z);vec3 p33=permute(p3+Pi.z+1.0);vec3 ox11=fract(p11*K)-Ko;vec3 oy11=mod7(floor(p11*K))*K-Ko;vec3 oz11=floor(p11*K2)*Kz-Kzo;vec3 ox12=fract(p12*K)-Ko;vec3 oy12=mod7(floor(p12*K))*K-Ko;vec3 oz12=floor(p12*K2)*Kz-Kzo;vec3 ox13=fract(p13*K)-Ko;vec3 oy13=mod7(floor(p13*K))*K-Ko;vec3 oz13=floor(p13*K2)*Kz-Kzo;vec3 ox21=fract(p21*K)-Ko;vec3 oy21=mod7(floor(p21*K))*K-Ko;vec3 oz21=floor(p21*K2)*Kz-Kzo;vec3 ox22=fract(p22*K)-Ko;vec3 oy22=mod7(floor(p22*K))*K-Ko;vec3 oz22=floor(p22*K2)*Kz-Kzo;vec3 ox23=fract(p23*K)-Ko;vec3 oy23=mod7(floor(p23*K))*K-Ko;vec3 oz23=floor(p23*K2)*Kz-Kzo;vec3 ox31=fract(p31*K)-Ko;vec3 oy31=mod7(floor(p31*K))*K-Ko;vec3 oz31=floor(p31*K2)*Kz-Kzo;vec3 ox32=fract(p32*K)-Ko;vec3 oy32=mod7(floor(p32*K))*K-Ko;vec3 oz32=floor(p32*K2)*Kz-Kzo;vec3 ox33=fract(p33*K)-Ko;vec3 oy33=mod7(floor(p33*K))*K-Ko;vec3 oz33=floor(p33*K2)*Kz-Kzo;vec3 dx11=Pfx+jitter*ox11;vec3 dy11=Pfy.x+jitter*oy11;vec3 dz11=Pfz.x+jitter*oz11;vec3 dx12=Pfx+jitter*ox12;vec3 dy12=Pfy.x+jitter*oy12;vec3 dz12=Pfz.y+jitter*oz12;vec3 dx13=Pfx+jitter*ox13;vec3 dy13=Pfy.x+jitter*oy13;vec3 dz13=Pfz.z+jitter*oz13;vec3 dx21=Pfx+jitter*ox21;vec3 dy21=Pfy.y+jitter*oy21;vec3 dz21=Pfz.x+jitter*oz21;vec3 dx22=Pfx+jitter*ox22;vec3 dy22=Pfy.y+jitter*oy22;vec3 dz22=Pfz.y+jitter*oz22;vec3 dx23=Pfx+jitter*ox23;vec3 dy23=Pfy.y+jitter*oy23;vec3 dz23=Pfz.z+jitter*oz23;vec3 dx31=Pfx+jitter*ox31;vec3 dy31=Pfy.z+jitter*oy31;vec3 dz31=Pfz.x+jitter*oz31;vec3 dx32=Pfx+jitter*ox32;vec3 dy32=Pfy.z+jitter*oy32;vec3 dz32=Pfz.y+jitter*oz32;vec3 dx33=Pfx+jitter*ox33;vec3 dy33=Pfy.z+jitter*oy33;vec3 dz33=Pfz.z+jitter*oz33;vec3 d11=dx11*dx11+dy11*dy11+dz11*dz11;vec3 d12=dx12*dx12+dy12*dy12+dz12*dz12;vec3 d13=dx13*dx13+dy13*dy13+dz13*dz13;vec3 d21=dx21*dx21+dy21*dy21+dz21*dz21;vec3 d22=dx22*dx22+dy22*dy22+dz22*dz22;vec3 d23=dx23*dx23+dy23*dy23+dz23*dz23;vec3 d31=dx31*dx31+dy31*dy31+dz31*dz31;vec3 d32=dx32*dx32+dy32*dy32+dz32*dz32;vec3 d33=dx33*dx33+dy33*dy33+dz33*dz33;vec3 d1a=min(d11,d12);d12=max(d11,d12);d11=min(d1a,d13);d13=max(d1a,d13);d12=min(d12,d13);vec3 d2a=min(d21,d22);d22=max(d21,d22);d21=min(d2a,d23);d23=max(d2a,d23);d22=min(d22,d23);vec3 d3a=min(d31,d32);d32=max(d31,d32);d31=min(d3a,d33);d33=max(d3a,d33);d32=min(d32,d33);vec3 da=min(d11,d21);d21=max(d11,d21);d11=min(da,d31);d31=max(da,d31);d11.xy=(d11.x<d11.y)? d11.xy : d11.yx;d11.xz=(d11.x<d11.z)? d11.xz : d11.zx;d12=min(d12,d21);d12=min(d12,d22);d12=min(d12,d31);d12=min(d12,d32);d11.yz=min(d11.yz,d12.xy);d11.y=min(d11.y,d12.z);d11.y=min(d11.y,d11.z);return sqrt(d11.xy);}",noise_cellular:"#define GLSLIFY 1\n#include <noise_cellular_2D>\n#include <noise_cellular_3D>\n#include <noise_cellular_2x2>\n#include <noise_cellular_2x2x2>\n",noise_perlin_2D:"#define GLSLIFY 1\nfloat perlin(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}float perlin(vec2 P,vec2 rep){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod(Pi,rep.xyxy);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}",noise_perlin_3D:"#define GLSLIFY 1\nfloat perlin(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}float perlin(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep);vec3 Pi1=mod(Pi0+vec3(1.0),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}",noise_perlin_4D:"#define GLSLIFY 1\nfloat perlin(vec4 P){vec4 Pi0=floor(P);vec4 Pi1=Pi0+1.0;Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}float perlin(vec4 P,vec4 rep){vec4 Pi0=mod(floor(P),rep);vec4 Pi1=mod(Pi0+1.0,rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}",noise_perlin:"#define GLSLIFY 1\n#include <noise_perlin_2D>\n#include <noise_perlin_3D>\n#include <noise_perlin_4D>\n",noise_psrd_2D:"#define GLSLIFY 1\nvec2 rgrad2(vec2 p,float rot){float u=permute(permute(p.x)+p.y)*0.0243902439+rot;u=fract(u)*6.28318530718;return vec2(cos(u),sin(u));}vec3 psrdnoise(vec2 pos,vec2 per,float rot){pos.y+=0.01;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 psdnoise(vec2 pos,vec2 per){return psrdnoise(pos,per,0.0);}float psrnoise(vec2 pos,vec2 per,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float psnoise(vec2 pos,vec2 per){return psrnoise(pos,per,0.0);}vec3 srdnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 sdnoise(vec2 pos){return srdnoise(pos,0.0);}float srnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float snoise(vec2 pos){return srnoise(pos,0.0);}",noise_simplex_2D:"#define GLSLIFY 1\nfloat simplex(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}",noise_simplex_3D_grad:"#define GLSLIFY 1\nfloat simplex(vec3 v,out vec3 gradient){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);vec4 m2=m*m;vec4 m4=m2*m2;vec4 pdotx=vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3));vec4 temp=m2*m*pdotx;gradient=-8.0*(temp.x*x0+temp.y*x1+temp.z*x2+temp.w*x3);gradient+=m4.x*p0+m4.y*p1+m4.z*p2+m4.w*p3;gradient*=42.0;return 42.0*dot(m4,pdotx);}",noise_simplex_3D:"#define GLSLIFY 1\nfloat simplex(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}",noise_simplex_4D:"#define GLSLIFY 1\nvec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}\n#define F4 0.309016994374947451\nfloat simplex(vec4 v){const vec4 C=vec4(0.138196601125011,0.276393202250021,0.414589803375032,-0.447213595499958);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}",noise_simplex:"#define GLSLIFY 1\n#include <noise_simplex_2D>\n#include <noise_simplex_3D>\n#include <noise_simplex_3D_grad>\n#include <noise_simplex_4D>\n",gamma_frag:"#define GLSLIFY 1\n#ifdef GAMMA\nfloat gamma=2.2;gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(1.0/gamma));\n#endif\n"},{pbr_common_frag_define:"#define GLSLIFY 1\n#ifndef EPSILON\n#define EPSILON 1e-6\n#endif\n#ifndef RECIPROCAL_PI\n#define RECIPROCAL_PI 0.31830988618\n#endif\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n#define RE_Direct RE_Direct_Physical\n#define RE_IndirectDiffuse RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular RE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material ) GGXRoughnessToBlinnExponent( material.specularRoughness )\n",pbr_util_frag_define:"#define GLSLIFY 1\nvec4 SRGBtoLINEAR(vec4 srgbIn){\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\nvec3 linOut=pow(srgbIn.xyz,vec3(2.2));\n#else\nvec3 bLess=step(vec3(0.04045),srgbIn.xyz);vec3 linOut=mix(srgbIn.xyz/vec3(12.92),pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)),bLess);\n#endif\nreturn vec4(linOut,srgbIn.w);;\n#else\nreturn srgbIn;\n#endif\n}float pow2(const in float x){return x*x;}vec3 inverseTransformDirection(in vec3 dir,in mat4 matrix){return normalize((vec4(dir,0.0)*matrix).xyz);}vec3 BRDF_Diffuse_Lambert(const in vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}float GGXRoughnessToBlinnExponent(const in float ggxRoughness){return(2.0/pow2(ggxRoughness+0.0001)-2.0);}float computeSpecularOcclusion(const in float dotNV,const in float ambientOcclusion,const in float roughness){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}",pbr_envmap_light_frag_define:"#define GLSLIFY 1\nstruct EnvMapLight{vec3 diffuse;float mipMapLevel;float diffuseIntensity;float specularIntensity;mat4 transformMatrix;};uniform EnvMapLight u_envMapLight;\n#ifdef O3_USE_SH\nuniform vec3 u_env_sh[9];\n#endif\n#ifdef O3_USE_SPECULAR_ENV\nuniform samplerCube u_env_specularSampler;\n#endif\n",pbr_base_frag_define:"#define GLSLIFY 1\nuniform float u_alphaCutoff;uniform vec4 u_baseColor;uniform float u_metal;uniform float u_roughness;uniform vec3 u_specularColor;uniform float u_glossinessFactor;uniform vec3 u_emissiveColor;uniform float u_normalIntensity;uniform float u_occlusionStrength;",pbr_texture_frag_define:"#define GLSLIFY 1\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_baseColorSampler;\n#endif\n#ifdef O3_NORMAL_TEXTURE\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_emissiveSampler;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_metallicRoughnessSampler;\n#endif\n#ifdef HAS_SPECULARGLOSSINESSMAP\nuniform sampler2D u_specularGlossinessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_occlusionSampler;\n#endif\n",pbr_runtime_frag_define:"#define GLSLIFY 1\nstruct IncidentLight{vec3 color;vec3 direction;};struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct GeometricContext{vec3 position;vec3 normal;vec3 viewDir;};struct PhysicalMaterial{vec3 diffuseColor;float specularRoughness;vec3 specularColor;};",pbr_brdf_cook_torrance_frag_define:"#define GLSLIFY 1\nvec3 F_Schlick(const in vec3 specularColor,const in float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_SmithCorrelated(const in float alpha,const in float dotNL,const in float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}float D_GGX(const in float alpha,const in float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight,const in GeometricContext geometry,const in vec3 specularColor,const in float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentLight.direction+geometry.viewDir);float dotNL=saturate(dot(geometry.normal,incidentLight.direction));float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float dotNH=saturate(dot(geometry.normal,halfDir));float dotLH=saturate(dot(incidentLight.direction,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);float D=D_GGX(alpha,dotNH);return F*(G*D);}",pbr_direct_irradiance_frag_define:"#define GLSLIFY 1\nvoid RE_Direct_Physical(const in IncidentLight directLight,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){float dotNL=saturate(dot(geometry.normal,directLight.direction));vec3 irradiance=dotNL*directLight.color;\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nirradiance*=PI;\n#endif\nreflectedLight.directSpecular+=irradiance*BRDF_Specular_GGX(directLight,geometry,material.specularColor,material.specularRoughness);reflectedLight.directDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}\n#ifdef O3_DIRECT_LIGHT_COUNT\nvoid getDirectionalDirectLightIrradiance(const in DirectLight directionalLight,const in GeometricContext geometry,out IncidentLight directLight){directLight.color=directionalLight.color;directLight.direction=-directionalLight.direction;}\n#endif\n#ifdef O3_POINT_LIGHT_COUNT\nvoid getPointDirectLightIrradiance(const in PointLight pointLight,const in GeometricContext geometry,out IncidentLight directLight){vec3 lVector=pointLight.position-geometry.position;directLight.direction=normalize(lVector);float lightDistance=length(lVector);directLight.color=pointLight.color;directLight.color*=clamp(1.0-pow(lightDistance/pointLight.distance,4.0),0.0,1.0);}\n#endif\n#ifdef O3_SPOT_LIGHT_COUNT\nvoid getSpotDirectLightIrradiance(const in SpotLight spotLight,const in GeometricContext geometry,out IncidentLight directLight){vec3 lVector=spotLight.position-geometry.position;directLight.direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(directLight.direction,-spotLight.direction);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayEffect=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);directLight.color=spotLight.color;directLight.color*=spotEffect*decayEffect;}\n#endif\n",pbr_ibl_specular_frag_define:"#define GLSLIFY 1\nvec3 BRDF_Specular_GGX_Environment(const in GeometricContext geometry,const in vec3 specularColor,const in float roughness){float dotNV=saturate(dot(geometry.normal,geometry.viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float getSpecularMIPLevel(const in float blinnShininessExponent,const in int maxMIPLevel){float maxMIPLevelScalar=float(maxMIPLevel);float desiredMIPLevel=maxMIPLevelScalar+0.79248-0.5*log2(pow2(blinnShininessExponent)+1.0);return clamp(desiredMIPLevel,0.0,maxMIPLevelScalar);}vec3 getLightProbeIndirectRadiance(const in GeometricContext geometry,const in float blinnShininessExponent,const in int maxMIPLevel){\n#ifndef O3_USE_SPECULAR_ENV\nreturn vec3(0.0);\n#else\nvec3 reflectVec=reflect(-geometry.viewDir,geometry.normal);float specularMIPLevel=getSpecularMIPLevel(blinnShininessExponent,maxMIPLevel);\n#ifdef HAS_TEX_LOD\nvec4 envMapColor=textureCubeLodEXT(u_env_specularSampler,reflectVec,specularMIPLevel);\n#else\nvec4 envMapColor=textureCube(u_env_specularSampler,reflectVec,specularMIPLevel);\n#endif\nenvMapColor.rgb=SRGBtoLINEAR(envMapColor*u_envMapLight.specularIntensity).rgb;return envMapColor.rgb;\n#endif\n}void RE_IndirectSpecular_Physical(const in vec3 radiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float dotNL=dotNV;reflectedLight.indirectSpecular+=radiance*BRDF_Specular_GGX_Environment(geometry,material.specularColor,material.specularRoughness);}",pbr_ibl_diffuse_frag_define:"#define GLSLIFY 1\nvoid RE_IndirectDiffuse_Physical(const in vec3 irradiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}vec3 getLightProbeIrradiance(vec3 sh[9],vec3 normal){vec3 result=sh[0]+sh[1]*(normal.y)+sh[2]*(normal.z)+sh[3]*(normal.x)+sh[4]*(normal.y*normal.x)+sh[5]*(normal.y*normal.z)+sh[6]*(3.0*normal.z*normal.z-1.0)+sh[7]*(normal.z*normal.x)+sh[8]*(normal.x*normal.x-normal.y*normal.y);return max(result,vec3(0.0));}",pbr_begin_frag:"#define GLSLIFY 1\nvec3 normal=getNormal();vec4 diffuseColor=u_baseColor;vec3 totalEmissiveRadiance=u_emissiveColor;float metalnessFactor=u_metal;float roughnessFactor=u_roughness;vec3 specularFactor=u_specularColor;float glossinessFactor=u_glossinessFactor;ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));PhysicalMaterial material;GeometricContext geometry;IncidentLight directLight;\n#ifdef HAS_BASECOLORMAP\nvec4 baseMapColor=texture2D(u_baseColorSampler,v_uv);baseMapColor=SRGBtoLINEAR(baseMapColor);diffuseColor*=baseMapColor;\n#endif\n#ifdef O3_HAS_VERTEXCOLOR\ndiffuseColor*=v_color;\n#endif\n#ifdef ALPHA_CUTOFF\nif(diffuseColor.a<u_alphaCutoff){discard;}\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nvec4 metalRoughMapColor=texture2D(u_metallicRoughnessSampler,v_uv);roughnessFactor*=metalRoughMapColor.g;metalnessFactor*=metalRoughMapColor.b;\n#endif\n#ifdef HAS_SPECULARGLOSSINESSMAP\nvec4 specularGlossinessColor=texture2D(u_specularGlossinessSampler,v_uv);specularFactor*=specularGlossinessColor.rgb;glossinessFactor*=specularGlossinessColor.a;\n#endif\n#ifdef IS_METALLIC_WORKFLOW\nmaterial.diffuseColor=diffuseColor.rgb*(1.0-metalnessFactor);material.specularRoughness=clamp(roughnessFactor,0.04,1.0);material.specularColor=mix(vec3(MAXIMUM_SPECULAR_COEFFICIENT),diffuseColor.rgb,metalnessFactor);\n#else\nfloat specularStrength=max(max(specularFactor.r,specularFactor.g),specularFactor.b);material.diffuseColor=diffuseColor.rgb*(1.0-specularStrength);material.specularRoughness=clamp(1.0-glossinessFactor,0.04,1.0);material.specularColor=specularFactor;\n#endif\ngeometry.position=v_pos;geometry.normal=normal;geometry.viewDir=normalize(u_cameraPos-v_pos);",pbr_direct_irradiance_frag:"#define GLSLIFY 1\n#if defined( O3_DIRECT_LIGHT_COUNT ) && defined( RE_Direct )\nDirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];getDirectionalDirectLightIrradiance(directionalLight,geometry,directLight);RE_Direct(directLight,geometry,material,reflectedLight);}\n#endif\n#if defined( O3_POINT_LIGHT_COUNT ) && defined( RE_Direct )\nPointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];getPointDirectLightIrradiance(pointLight,geometry,directLight);RE_Direct(directLight,geometry,material,reflectedLight);}\n#endif\n#if defined( O3_SPOT_LIGHT_COUNT ) && defined( RE_Direct )\nSpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];getSpotDirectLightIrradiance(spotLight,geometry,directLight);RE_Direct(directLight,geometry,material,reflectedLight);}\n#endif\n",pbr_ibl_diffuse_frag:"#define GLSLIFY 1\n#ifdef O3_USE_SH\nvec3 irradiance=getLightProbeIrradiance(u_env_sh,normal)*u_envMapLight.diffuseIntensity;\n#else\nvec3 irradiance=u_envMapLight.diffuse*u_envMapLight.diffuseIntensity;\n#endif\n#ifndef PHYSICALLY_CORRECT_LIGHTS\nirradiance*=PI;\n#endif\nRE_IndirectDiffuse_Physical(irradiance,geometry,material,reflectedLight);",pbr_ibl_specular_frag:"#define GLSLIFY 1\n#if defined( RE_IndirectSpecular )\nvec3 radiance=vec3(0.0);\n#endif\n#if defined( RE_IndirectSpecular )\nradiance+=getLightProbeIndirectRadiance(geometry,Material_BlinnShininessExponent(material),int(u_envMapLight.mipMapLevel));\n#endif\n#if defined( RE_IndirectSpecular )\nRE_IndirectSpecular(radiance,geometry,material,reflectedLight);\n#endif\n",pbr_end_frag:"#define GLSLIFY 1\n#ifdef HAS_OCCLUSIONMAP\nfloat ambientOcclusion=(texture2D(u_occlusionSampler,v_uv).r-1.0)*u_occlusionStrength+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined(O3_USE_SPECULAR_ENV)\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.specularRoughness);\n#endif\n#endif\n#ifdef HAS_EMISSIVEMAP\nvec4 emissiveMapColor=texture2D(u_emissiveSampler,v_uv);emissiveMapColor=SRGBtoLINEAR(emissiveMapColor);totalEmissiveRadiance*=emissiveMapColor.rgb;\n#endif\nvec3 outgoingLight=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+totalEmissiveRadiance;gl_FragColor=vec4(outgoingLight,diffuseColor.a);"}),{},{normal_get:"#define GLSLIFY 1\nvec3 getNormal(){\n#ifdef O3_NORMAL_TEXTURE\n#ifndef O3_HAS_TANGENT\n#ifdef HAS_DERIVATIVES\nvec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 tex_dx=dFdx(vec3(v_uv,0.0));vec3 tex_dy=dFdy(vec3(v_uv,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);\n#ifdef O3_HAS_NORMAL\nvec3 ng=normalize(v_normal);\n#else\nvec3 ng=normalize(cross(pos_dx,pos_dy));\n#endif\nt=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);\n#else\n#ifdef O3_HAS_NORMAL\nvec3 ng=normalize(v_normal);\n#else\nvec3 ng=vec3(0.0,0.0,1.0);\n#endif\nmat3 tbn=mat3(vec3(0.0),vec3(0.0),ng);\n#endif\n#else\nmat3 tbn=v_TBN;\n#endif\nvec3 n=texture2D(u_normalTexture,v_uv).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(u_normalIntensity,u_normalIntensity,1.0)));\n#else\n#ifdef O3_HAS_NORMAL\nvec3 n=normalize(v_normal);\n#elif defined(HAS_DERIVATIVES)\nvec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 n=normalize(cross(pos_dx,pos_dy));\n#else\nvec3 n=vec3(0.0,0.0,1.0);\n#endif\n#endif\nn*=float(gl_FrontFacing)*2.0-1.0;return n;}"}),Je=function(){function e(){}return e.parseCustomMacros=function(e){return e.map((function(e){return"#define "+e+"\n"})).join("")},e.parseIncludes=function(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,(function(t,n){var r=$e[n];return void 0===r?(ce.error('Shader slice "'+t.trim()+'" not founded.'),""):e.parseIncludes(r)}))},e.parseExtension=function(e){return e.map((function(e){return"#extension "+e+" : enable\n"})).join("")},e.convertTo300=function(e,t){if(e=(e=(e=(e=e.replace(/\battribute\b/g,"in")).replace(/\bvarying\b/g,t?"in":"out")).replace(/\btexture(2D|Cube)\b/g,"texture")).replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod"),t)if(/\bgl_FragData\[.+?\]/g.test(e)){var n=(e=e.replace(/\bgl_FragColor\b/g,"gl_FragData[0]")).match(/\bgl_FragData\[.+?\]/g);e=this._replaceMRTShader(e,n)}else e=(e=e.replace(/void\s+?main\s*\(/g,"out vec4 glFragColor;\nvoid main(")).replace(/\bgl_FragColor\b/g,"glFragColor");return e},e._replaceMRTShader=function(e,t){for(var n="",r=new Set,i=0;i<t.length;i++){var a=t[i].match(/\bgl_FragData\[(.+?)\]/);r.add(a[1])}return r.forEach((function(e){n+="layout(location="+e+") out vec4 fragOutColor"+e+";\n"})),n+="void main(",(e=e.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1")).replace(/void\s+?main\s*\(/g,n)},e}(),Ze=function(e,t,n){this.name=void 0,this._index=void 0,this._value=void 0,this.name=e,this._index=t,this._value=n},et=function(){function e(e){this.name=void 0,this.propertyId=void 0,this.location=void 0,this.applyFunc=void 0,this.cacheValue=void 0,this.textureIndex=void 0,this.textureDefault=void 0,this._rhi=void 0,this._gl=void 0;var t=e._hardwareRenderer;this._rhi=t,this._gl=t.gl}var t=e.prototype;return t.upload1f=function(e,t){this.cacheValue!==t&&(this._gl.uniform1f(e.location,t),this.cacheValue=t)},t.upload1fv=function(e,t){this._gl.uniform1fv(e.location,t)},t.upload2f=function(e,t){var n=this.cacheValue;void 0!==t.r?n.x===t.r&&n.y===t.g||(this._gl.uniform2f(e.location,t.r,t.g),n.x=t.r,n.y=t.g):n.x===t.x&&n.y===t.y||(this._gl.uniform2f(e.location,t.x,t.y),n.x=t.x,n.y=t.y)},t.upload2fv=function(e,t){this._gl.uniform2fv(e.location,t)},t.upload3f=function(e,t){var n=this.cacheValue;void 0!==t.r?n.x===t.r&&n.y===t.g&&n.z===t.b||(this._gl.uniform3f(e.location,t.r,t.g,t.b),n.x=t.r,n.y=t.g,n.z=t.b):n.x===t.x&&n.y===t.y&&n.z===t.z||(this._gl.uniform3f(e.location,t.x,t.y,t.z),n.x=t.x,n.y=t.y,n.z=t.z)},t.upload3fv=function(e,t){this._gl.uniform3fv(e.location,t)},t.upload4f=function(e,t){var n=this.cacheValue;void 0!==t.r?n.x===t.r&&n.y===t.g&&n.z===t.b&&n.w===t.a||(this._gl.uniform4f(e.location,t.r,t.g,t.b,t.a),n.x=t.r,n.y=t.g,n.z=t.b,n.w=t.a):n.x===t.x&&n.y===t.y&&n.z===t.z&&n.w===t.w||(this._gl.uniform4f(e.location,t.x,t.y,t.z,t.w),n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w)},t.upload4fv=function(e,t){this._gl.uniform4fv(e.location,t)},t.upload1i=function(e,t){this.cacheValue!==t&&(this._gl.uniform1i(e.location,t),this.cacheValue=t)},t.upload1iv=function(e,t){this._gl.uniform1iv(e.location,t)},t.upload2i=function(e,t){var n=this.cacheValue;void 0!==t.r?n.x===t.r&&n.y===t.g||(this._gl.uniform2i(e.location,t.r,t.g),n.x=t.r,n.y=t.g):n.x===t.x&&n.y===t.y||(this._gl.uniform2i(e.location,t.x,t.y),n.x=t.x,n.y=t.y)},t.upload2iv=function(e,t){this._gl.uniform2iv(e.location,t)},t.upload3i=function(e,t){var n=this.cacheValue;void 0!==t.r?n.x===t.r&&n.y===t.g&&n.z===t.b||(this._gl.uniform3i(e.location,t.r,t.g,t.b),n.x=t.r,n.y=t.g,n.z=t.b):n.x===t.x&&n.y===t.y&&n.z===t.z||(this._gl.uniform3i(e.location,t.x,t.y,t.z),n.x=t.x,n.y=t.y,n.z=t.z)},t.upload3iv=function(e,t){this._gl.uniform3iv(e.location,t)},t.upload4i=function(e,t){var n=this.cacheValue;void 0!==t.r?n.x===t.r&&n.y===t.g&&n.z===t.b&&n.w===t.a||(this._gl.uniform4i(e.location,t.r,t.g,t.b,t.a),n.x=t.r,n.y=t.g,n.z=t.b,n.w=t.a):n.x===t.x&&n.y===t.y&&n.z===t.z&&n.w===t.w||(this._gl.uniform4i(e.location,t.x,t.y,t.z,t.w),n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w)},t.upload4iv=function(e,t){this._gl.uniform4iv(e.location,t)},t.uploadMat4=function(e,t){this._gl.uniformMatrix4fv(e.location,!1,t.elements)},t.uploadMat4v=function(e,t){this._gl.uniformMatrix4fv(e.location,!1,t)},t.uploadTexture=function(e,t){var n=this._rhi;n.activeTexture(e.textureIndex),n.bindTexture(t._platformTexture)},t.uploadTextureArray=function(e,t){for(var n=this._rhi,r=e.textureIndex,i=0;i<t.length;i++){var a=t[i];n.activeTexture(r[i]),n.bindTexture(a._platformTexture)}},e}(),tt=function(){this.constUniforms=[],this.textureUniforms=[]},nt=function(){function e(t,n,r){this.id=void 0,this.sceneUniformBlock=new tt,this.cameraUniformBlock=new tt,this.rendererUniformBlock=new tt,this.materialUniformBlock=new tt,this.otherUniformBlock=new tt,this._uploadRenderCount=-1,this._uploadCamera=void 0,this._uploadRenderer=void 0,this._uploadMaterial=void 0,this.attributeLocation=Object.create(null),this._isValid=void 0,this._engine=void 0,this._gl=void 0,this._vertexShader=void 0,this._fragmentShader=void 0,this._glProgram=void 0,this._activeTextureUint=0,this._engine=t,this._gl=t._hardwareRenderer.gl,this._glProgram=this._createProgram(n,r),this._glProgram?(this._isValid=!0,this._recordLocation()):this._isValid=!1,this.id=e._counter++}e._addLineNum=function(e){var t,n=e.split("\n"),r=(n.length+1).toString().length+6;return n.map((function(e,n){if((t="0:"+(n+1)).length>=r)return t.substring(0,r)+e;for(var i=0;i<r-t.length;i++)t+=" ";return t+e})).join("\n")};var t=e.prototype;return t.uploadAll=function(e,t){this.uploadUniforms(e,t),this.uploadTextures(e,t)},t.uploadUniforms=function(e,t){for(var n=t._properties,r=e.constUniforms,i=0,a=r.length;i<a;i++){var o=r[i],s=n[o.propertyId];null!=s&&o.applyFunc(o,s)}},t.uploadTextures=function(e,t){var n=t._properties,r=e.textureUniforms;if(r)for(var i=0,a=r.length;i<a;i++){var o=r[i],s=n[o.propertyId];s?o.applyFunc(o,s):o.applyFunc(o,o.textureDefault)}},t.uploadUngroupTextures=function(){var e=this.otherUniformBlock.textureUniforms;if(e)for(var t=0,n=e.length;t<n;t++){var r=e[t];r.applyFunc(r,r.textureDefault)}},t.groupingOtherUniformBlock=function(){var e=this.otherUniformBlock,t=e.constUniforms,n=e.textureUniforms;t.length>0&&this._groupingSubOtherUniforms(t,!1),n.length>0&&this._groupingSubOtherUniforms(n,!0)},t.bind=function(){var e=this._engine._hardwareRenderer;return e._currentBind!==this&&(this._gl.useProgram(this._glProgram),e._currentBind=this,!0)},t.destroy=function(){var e=this._gl;this._vertexShader&&e.deleteShader(this._vertexShader),this._fragmentShader&&e.deleteShader(this._fragmentShader),this._glProgram&&e.deleteProgram(this._glProgram)},t._groupingSubOtherUniforms=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e[n],i=it._getShaderPropertyGroup(r.name);void 0!==i&&(e.splice(e.indexOf(r),1),this._groupingUniform(r,i,t))}},t._groupingUniform=function(e,t,n){switch(t){case qe.Scene:n?this.sceneUniformBlock.textureUniforms.push(e):this.sceneUniformBlock.constUniforms.push(e);break;case qe.Camera:n?this.cameraUniformBlock.textureUniforms.push(e):this.cameraUniformBlock.constUniforms.push(e);break;case qe.Renderer:n?this.rendererUniformBlock.textureUniforms.push(e):this.rendererUniformBlock.constUniforms.push(e);break;case qe.Material:n?this.materialUniformBlock.textureUniforms.push(e):this.materialUniformBlock.constUniforms.push(e);break;default:n?this.otherUniformBlock.textureUniforms.push(e):this.otherUniformBlock.constUniforms.push(e)}},t._createProgram=function(e,t){var n=this._gl,r=this._createShader(n.VERTEX_SHADER,e);if(!r)return null;var i=this._createShader(n.FRAGMENT_SHADER,t);if(!i)return null;var a=n.createProgram();return n.attachShader(a,r),n.attachShader(a,i),n.linkProgram(a),n.validateProgram(a),n.isContextLost()?(ce.error("Context lost while linking program."),n.deleteShader(r),n.deleteShader(i),null):ce.isEnabled&&!n.getProgramParameter(a,n.LINK_STATUS)?(ce.error("Could not link WebGL program. \n"+n.getProgramInfoLog(a)),n.deleteProgram(a),null):(this._vertexShader=r,this._fragmentShader=i,a)},t._createShader=function(t,n){var r=this._gl,i=r.createShader(t);return i?(r.shaderSource(i,n),r.compileShader(i),r.isContextLost()?(ce.error("Context lost while compiling shader."),r.deleteShader(i),null):ce.isEnabled&&!r.getShaderParameter(i,r.COMPILE_STATUS)?(ce.error("Could not compile WebGL shader.\n"+r.getShaderInfoLog(i),e._addLineNum(n)),r.deleteShader(i),null):i):(ce.error("Context lost while create shader."),null)},t._recordLocation=function(){var e=this,t=this._gl,n=this._glProgram,r=this._getUniformInfos(),a=this._getAttributeInfos();r.forEach((function(r){var a=r.name,o=r.size,s=r.type,l=new et(e._engine),u=!1,c=!1;a.indexOf("[0]")>0&&(a=a.substr(0,a.length-3),u=!0);var d=it._getShaderPropertyGroup(a),f=t.getUniformLocation(n,a);switch(l.name=a,l.propertyId=it.getPropertyByName(a)._uniqueId,l.location=f,s){case t.FLOAT:u?l.applyFunc=l.upload1fv:(l.applyFunc=l.upload1f,l.cacheValue=0);break;case t.FLOAT_VEC2:u?l.applyFunc=l.upload2fv:(l.applyFunc=l.upload2f,l.cacheValue=new p(0,0));break;case t.FLOAT_VEC3:u?l.applyFunc=l.upload3fv:(l.applyFunc=l.upload3f,l.cacheValue=new i(0,0,0));break;case t.FLOAT_VEC4:u?l.applyFunc=l.upload4fv:(l.applyFunc=l.upload4f,l.cacheValue=new _(0,0,0,0));break;case t.BOOL:case t.INT:u?l.applyFunc=l.upload1iv:(l.applyFunc=l.upload1i,l.cacheValue=0);break;case t.BOOL_VEC2:case t.INT_VEC2:u?l.applyFunc=l.upload2iv:(l.applyFunc=l.upload2i,l.cacheValue=new p(0,0));break;case t.BOOL_VEC3:case t.INT_VEC3:l.applyFunc=u?l.upload3iv:l.upload3i,l.cacheValue=new i(0,0,0);break;case t.BOOL_VEC4:case t.INT_VEC4:u?l.applyFunc=l.upload4iv:(l.applyFunc=l.upload4i,l.cacheValue=new _(0,0,0));break;case t.FLOAT_MAT4:l.applyFunc=u?l.uploadMat4v:l.uploadMat4;break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:var h=s===t.SAMPLER_2D?e._engine._whiteTexture2D:e._engine._whiteTextureCube;if(c=!0,u){for(var v=new Array(o),m=new Int32Array(o),g=new Array(o),y=0;y<o;y++)v[y]=h,m[y]=e._activeTextureUint,g[y]=t.TEXTURE0+e._activeTextureUint++;l.textureDefault=v,l.textureIndex=g,l.applyFunc=l.uploadTextureArray,e.bind(),t.uniform1iv(f,m),l.uploadTextureArray(l,v)}else{var x=t.TEXTURE0+e._activeTextureUint;l.textureDefault=h,l.textureIndex=x,l.applyFunc=l.uploadTexture,e.bind(),t.uniform1i(f,e._activeTextureUint++),l.uploadTexture(l,h)}}e._groupingUniform(l,d,c)})),a.forEach((function(r){var i=r.name;e.attributeLocation[i]=t.getAttribLocation(n,i)}))},t._getUniformInfos=function(){for(var e=this._gl,t=this._glProgram,n=[],r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;++i){var a=e.getActiveUniform(t,i);n[i]=a}return n},t._getAttributeInfos=function(){for(var e=this._gl,t=this._glProgram,n=[],r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;++i){var a=e.getActiveAttrib(t,i);n[i]=a}return n},T(e,[{key:"isValid",get:function(){return this._isValid}}]),e}();nt._counter=0;var rt=function e(t){this._uniqueId=void 0,this._group=void 0,this.name=void 0,this.name=t,this._uniqueId=e._propertyNameCounter++};rt._propertyNameCounter=0;var it=function(){function t(e,n,r){this.name=void 0,this._shaderId=0,this._vertexSource=void 0,this._fragmentSource=void 0,this._shaderId=t._shaderCounter++,this.name=e,this._vertexSource=n,this._fragmentSource=r}t.create=function(e,n,r){var i=t._shaderMap;if(i[e])throw'Shader named "'+e+'" already exists.';return i[e]=new t(e,n,r)},t.find=function(e){return t._shaderMap[e]},t.getMacroByName=function(e){var n=t._macroMap[e];if(!n){var r=t._macroMaskMap,i=t._macroCounter,a=Math.floor(i/32),o=i%32;n=new Ze(e,a,1<<o),t._macroMap[e]=n,a==r.length&&(r.length++,r[a]=new Array(32)),r[a][o]=e,t._macroCounter++}return n},t.getPropertyByName=function(e){var n=t._propertyNameMap;if(null!=n[e])return n[e];var r=new rt(e);return n[e]=r,r},t._getShaderPropertyGroup=function(e){var n=t._propertyNameMap[e];return null==n?void 0:n._group},t._getNamesByMacros=function(e,n){var r=t._macroMaskMap,i=e._mask;n.length=0;for(var a=0,o=e._length;a<o;a++)for(var s=r[a],l=i[a],u=l<0?32:Math.floor(Math.log2(l))+1,c=0;c<u;c++)l&1<<c&&n.push(s[c])};var n=t.prototype;return n.compileVariant=function(e,n){var r=t._compileMacros;r.clear();for(var i=0,a=n.length;i<a;i++)r.enable(t.getMacroByName(n[i]));return this._getShaderProgram(e,r).isValid},n._getShaderProgram=function(n,r){var i=n._getShaderProgramPool(this),a=i.get(r);if(a)return a;var o=n._hardwareRenderer.isWebGL2,s=[];t._getNamesByMacros(r,s);var l=Je.parseCustomMacros(s),u=o?"#version 300 es":"#version 100",c="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      precision highp int;\n      #define O3_VERTEX_PRECISION highp\n      #define O3_FRAGMENT_PRECISION highp\n    #else\n      precision mediump float;\n      precision mediump int;\n      #define O3_VERTEX_PRECISION mediump\n      #define O3_FRAGMENT_PRECISION mediump\n    #endif\n    ";n._hardwareRenderer.canIUse(e.GLCapabilityType.shaderTextureLod)&&(c+="#define HAS_TEX_LOD\n"),n._hardwareRenderer.canIUse(e.GLCapabilityType.standardDerivatives)&&(c+="#define HAS_DERIVATIVES\n");var d=Je.parseIncludes(" "+u+"\n        "+c+"\n        "+l+"\n        "+this._vertexSource),f=Je.parseIncludes(" "+u+"\n        "+(o?"":Je.parseExtension(t._shaderExtension))+"\n        "+c+"\n        "+l+"\n      "+this._fragmentSource);return o&&(d=Je.convertTo300(d),f=Je.convertTo300(f,!0)),a=new nt(n,d,f),i.cache(a),a},t}();it._compileMacros=new he,it._shaderCounter=0,it._shaderMap=Object.create(null),it._propertyNameMap=Object.create(null),it._macroMaskMap=[],it._macroCounter=0,it._macroMap=Object.create(null),it._shaderExtension=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"];var at,ot,st,lt=function(){function e(e){this._group=void 0,this._properties=Object.create(null),this._macroCollection=new he,this._variableMacros=Object.create(null),this._refCount=0,this._group=e}var t=e.prototype;return t.getFloat=function(e){return this._getData(e)},t.setFloat=function(e,t){this._setData(e,t)},t.getInt=function(e){return this._getData(e)},t.setInt=function(e,t){this._setData(e,t)},t.getFloatArray=function(e){return this._getData(e)},t.setFloatArray=function(e,t){this._setData(e,t)},t.getIntArray=function(e){return this._getData(e)},t.setIntArray=function(e,t){this._setData(e,t)},t.getVector2=function(e){return this._getData(e)},t.setVector2=function(e,t){this._setData(e,t)},t.getVector3=function(e){return this._getData(e)},t.setVector3=function(e,t){this._setData(e,t)},t.getVector4=function(e){return this._getData(e)},t.setVector4=function(e,t){this._setData(e,t)},t.getMatrix=function(e){return this._getData(e)},t.setMatrix=function(e,t){this._setData(e,t)},t.getColor=function(e){return this._getData(e)},t.setColor=function(e,t){this._setData(e,t)},t.getTexture=function(e){return this._getData(e)},t.setTexture=function(e,t){if(this._getRefCount()>0){var n=this._getData(e);n&&n._addRefCount(-1),t&&t._addRefCount(1)}this._setData(e,t)},t.getTextureArray=function(e){return this._getData(e)},t.setTextureArray=function(e,t){if(this._getRefCount()>0){var n=this._getData(e);if(n)for(var r=0,i=n.length;r<i;r++)n[r]._addRefCount(-1);if(t)for(var a=0,o=t.length;a<o;a++)t[a]._addRefCount(1)}this._setData(e,t)},t.enableMacro=function(e,t){void 0===t&&(t=null),t?this._enableVariableMacro(e,t):("string"==typeof e&&(e=it.getMacroByName(e)),this._macroCollection.enable(e))},t.disableMacro=function(e){if("string"==typeof e){var t=this._variableMacros[e];t?this._disableVariableMacro(e,t):(e=it.getMacroByName(e),this._macroCollection.disable(e))}else this._macroCollection.disable(e)},t.clone=function(){var t=new e(this._group);return this.cloneTo(t),t},t.cloneTo=function(e){J.deepCloneObject(this._macroCollection,e._macroCollection),C(e._variableMacros,this._variableMacros);for(var t=this._properties,n=e._properties,r=Object.keys(t),i=0,a=r.length;i<a;i++){var o=r[i],s=t[o];if(null!=s)if("number"==typeof s)n[o]=s;else if(s instanceof Ye)n[o]=s;else if(s instanceof Array||s instanceof Float32Array||s instanceof Int32Array)n[o]=s.slice();else{var l=n[o];l?s.cloneTo(l):n[o]=s.clone()}else n[o]=s}},t._getData=function(e){return"string"==typeof e&&(e=it.getPropertyByName(e)),this._properties[e._uniqueId]},t._setData=function(e,t){if("string"==typeof e&&(e=it.getPropertyByName(e)),e._group!==this._group){if(void 0!==e._group)throw"Shader property "+e.name+" has been used as "+qe[e._group]+" property.";e._group=this._group}this._properties[e._uniqueId]=t},t._getRefCount=function(){return this._refCount},t._addRefCount=function(e){this._refCount+=e;var t=this._properties;for(var n in t){var r=t[n];r&&r instanceof Ye&&r._addRefCount(e)}},t._enableVariableMacro=function(e,t){var n=this._variableMacros,r=n[e];if(r!==t){r&&this._disableVariableMacro(e,r);var i=it.getMacroByName(e+" "+t);this._macroCollection.enable(i),n[e]=t}},t._disableVariableMacro=function(e,t){var n=it.getMacroByName(e+" "+t);this._macroCollection.disable(n),delete this._variableMacros[e]},e}();e.BlendFactor=void 0,(at=e.BlendFactor||(e.BlendFactor={}))[at.Zero=0]="Zero",at[at.One=1]="One",at[at.SourceColor=2]="SourceColor",at[at.OneMinusSourceColor=3]="OneMinusSourceColor",at[at.DestinationColor=4]="DestinationColor",at[at.OneMinusDestinationColor=5]="OneMinusDestinationColor",at[at.SourceAlpha=6]="SourceAlpha",at[at.OneMinusSourceAlpha=7]="OneMinusSourceAlpha",at[at.DestinationAlpha=8]="DestinationAlpha",at[at.OneMinusDestinationAlpha=9]="OneMinusDestinationAlpha",at[at.SourceAlphaSaturate=10]="SourceAlphaSaturate",at[at.BlendColor=11]="BlendColor",at[at.OneMinusBlendColor=12]="OneMinusBlendColor",e.BlendOperation=void 0,(ot=e.BlendOperation||(e.BlendOperation={}))[ot.Add=0]="Add",ot[ot.Subtract=1]="Subtract",ot[ot.ReverseSubtract=2]="ReverseSubtract",ot[ot.Min=3]="Min",ot[ot.Max=4]="Max",e.ColorWriteMask=void 0,(st=e.ColorWriteMask||(e.ColorWriteMask={}))[st.None=0]="None",st[st.Red=1]="Red",st[st.Green=2]="Green",st[st.Blue=4]="Blue",st[st.Alpha=8]="Alpha",st[st.All=15]="All";var ut,ct=function(){this.enabled=!1,this.colorBlendOperation=e.BlendOperation.Add,this.alphaBlendOperation=e.BlendOperation.Add,this.sourceColorBlendFactor=e.BlendFactor.One,this.sourceAlphaBlendFactor=e.BlendFactor.One,this.destinationColorBlendFactor=e.BlendFactor.Zero,this.destinationAlphaBlendFactor=e.BlendFactor.Zero,this.colorWriteMask=e.ColorWriteMask.All},dt=function(){function t(){this.targetBlendState=new ct,this.blendColor=new m(0,0,0,0),this.alphaToCoverage=!1}t._getGLBlendFactor=function(t){switch(t){case e.BlendFactor.Zero:return WebGLRenderingContext.ZERO;case e.BlendFactor.One:return WebGLRenderingContext.ONE;case e.BlendFactor.SourceColor:return WebGLRenderingContext.SRC_COLOR;case e.BlendFactor.OneMinusSourceColor:return WebGLRenderingContext.ONE_MINUS_SRC_COLOR;case e.BlendFactor.DestinationColor:return WebGLRenderingContext.DST_COLOR;case e.BlendFactor.OneMinusDestinationColor:return WebGLRenderingContext.ONE_MINUS_DST_COLOR;case e.BlendFactor.SourceAlpha:return WebGLRenderingContext.SRC_ALPHA;case e.BlendFactor.OneMinusSourceAlpha:return WebGLRenderingContext.ONE_MINUS_SRC_ALPHA;case e.BlendFactor.DestinationAlpha:return WebGLRenderingContext.DST_ALPHA;case e.BlendFactor.OneMinusDestinationAlpha:return WebGLRenderingContext.ONE_MINUS_DST_ALPHA;case e.BlendFactor.SourceAlphaSaturate:return WebGLRenderingContext.SRC_ALPHA_SATURATE;case e.BlendFactor.BlendColor:return WebGLRenderingContext.CONSTANT_COLOR;case e.BlendFactor.OneMinusBlendColor:return WebGLRenderingContext.ONE_MINUS_CONSTANT_COLOR}},t._getGLBlendOperation=function(t,n){var r=n.gl;switch(t){case e.BlendOperation.Add:return r.FUNC_ADD;case e.BlendOperation.Subtract:return r.FUNC_SUBTRACT;case e.BlendOperation.ReverseSubtract:return r.FUNC_REVERSE_SUBTRACT;case e.BlendOperation.Min:if(!n.canIUse(e.GLCapabilityType.blendMinMax))throw new Error("BlendOperation.Min is not supported in this context");return r.MIN;case e.BlendOperation.Max:if(!n.canIUse(e.GLCapabilityType.blendMinMax))throw new Error("BlendOperation.Max is not supported in this context");return r.MAX}};var n=t.prototype;return n._apply=function(e,t){this._platformApply(e,t.blendState)},n._platformApply=function(n,r){var i=n.gl,a=r.targetBlendState,o=this.targetBlendState,s=o.enabled,l=o.colorBlendOperation,u=o.alphaBlendOperation,c=o.sourceColorBlendFactor,d=o.destinationColorBlendFactor,f=o.sourceAlphaBlendFactor,h=o.destinationAlphaBlendFactor,p=o.colorWriteMask;if(s!==a.enabled&&(s?i.enable(i.BLEND):i.disable(i.BLEND),a.enabled=s),s){c===a.sourceColorBlendFactor&&d===a.destinationColorBlendFactor&&f===a.sourceAlphaBlendFactor&&h===a.destinationAlphaBlendFactor||(i.blendFuncSeparate(t._getGLBlendFactor(c),t._getGLBlendFactor(d),t._getGLBlendFactor(f),t._getGLBlendFactor(h)),a.sourceColorBlendFactor=c,a.destinationColorBlendFactor=d,a.sourceAlphaBlendFactor=f,a.destinationAlphaBlendFactor=h),l===a.colorBlendOperation&&u===a.alphaBlendOperation||(i.blendEquationSeparate(t._getGLBlendOperation(l,n),t._getGLBlendOperation(u,n)),a.colorBlendOperation=l,a.alphaBlendOperation=u);var _=this.blendColor;m.equals(r.blendColor,_)||(i.blendColor(_.r,_.g,_.b,_.a),_.cloneTo(r.blendColor))}p!==a.colorWriteMask&&(i.colorMask(0!=(p&e.ColorWriteMask.Red),0!=(p&e.ColorWriteMask.Green),0!=(p&e.ColorWriteMask.Blue),0!=(p&e.ColorWriteMask.Alpha)),a.colorWriteMask=p);var v=this.alphaToCoverage;v!==r.alphaToCoverage&&(v?i.enable(i.SAMPLE_ALPHA_TO_COVERAGE):i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),r.alphaToCoverage=v)},t}();e.CompareFunction=void 0,(ut=e.CompareFunction||(e.CompareFunction={}))[ut.Never=0]="Never",ut[ut.Less=1]="Less",ut[ut.Equal=2]="Equal",ut[ut.LessEqual=3]="LessEqual",ut[ut.Greater=4]="Greater",ut[ut.NotEqual=5]="NotEqual",ut[ut.GreaterEqual=6]="GreaterEqual",ut[ut.Always=7]="Always";var ft,ht=function(){function t(){this.enabled=!0,this.writeEnabled=!0,this.compareFunction=e.CompareFunction.Less}t._getGLCompareFunction=function(t){switch(t){case e.CompareFunction.Never:return WebGLRenderingContext.NEVER;case e.CompareFunction.Less:return WebGLRenderingContext.LESS;case e.CompareFunction.Equal:return WebGLRenderingContext.EQUAL;case e.CompareFunction.LessEqual:return WebGLRenderingContext.LEQUAL;case e.CompareFunction.Greater:return WebGLRenderingContext.GREATER;case e.CompareFunction.NotEqual:return WebGLRenderingContext.NOTEQUAL;case e.CompareFunction.GreaterEqual:return WebGLRenderingContext.GEQUAL;case e.CompareFunction.Always:return WebGLRenderingContext.ALWAYS}};var n=t.prototype;return n._apply=function(e,t){this._platformApply(e,t.depthState)},n._platformApply=function(e,n){var r=e.gl,i=this.enabled,a=this.compareFunction,o=this.writeEnabled;i!=n.enabled&&(i?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),n.enabled=i),i&&(a!=n.compareFunction&&(r.depthFunc(t._getGLCompareFunction(a)),n.compareFunction=a),o!=n.writeEnabled&&(r.depthMask(o),n.writeEnabled=o))},t}();e.CullMode=void 0,(ft=e.CullMode||(e.CullMode={}))[ft.Off=0]="Off",ft[ft.Front=1]="Front",ft[ft.Back=2]="Back";var pt,_t=function(){function t(){this.cullMode=e.CullMode.Back,this.depthBias=0,this.slopeScaledDepthBias=0,this._cullFaceEnable=!0}var n=t.prototype;return n._apply=function(e,t){this._platformApply(e,t.rasterState)},n._platformApply=function(t,n){var r=t.gl,i=this.cullMode,a=this.depthBias,o=this.slopeScaledDepthBias,s=i!==e.CullMode.Off;s!==n._cullFaceEnable&&(s?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),n._cullFaceEnable=s),s&&i!==n.cullMode&&(i==e.CullMode.Back?r.cullFace(r.BACK):r.cullFace(r.FRONT),n.cullMode=i),a===n.depthBias&&o===n.slopeScaledDepthBias||(0!==a||0!==o?(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(o,a)):r.disable(r.POLYGON_OFFSET_FILL),n.depthBias=a,n.slopeScaledDepthBias=o)},t}();e.StencilOperation=void 0,(pt=e.StencilOperation||(e.StencilOperation={}))[pt.Keep=0]="Keep",pt[pt.Zero=1]="Zero",pt[pt.Replace=2]="Replace",pt[pt.IncrementSaturate=3]="IncrementSaturate",pt[pt.DecrementSaturate=4]="DecrementSaturate",pt[pt.Invert=5]="Invert",pt[pt.IncrementWrap=6]="IncrementWrap",pt[pt.DecrementWrap=7]="DecrementWrap";var vt,mt,gt,yt,xt,bt,wt,Tt,St,Ct,Pt,Mt,At,Et,Rt,Ft,Lt,Bt,It,Ot,zt=function(){function t(){this.enabled=!1,this.referenceValue=0,this.mask=255,this.writeMask=255,this.compareFunctionFront=e.CompareFunction.Always,this.compareFunctionBack=e.CompareFunction.Always,this.passOperationFront=e.StencilOperation.Keep,this.passOperationBack=e.StencilOperation.Keep,this.failOperationFront=e.StencilOperation.Keep,this.failOperationBack=e.StencilOperation.Keep,this.zFailOperationFront=e.StencilOperation.Keep,this.zFailOperationBack=e.StencilOperation.Keep}t._getGLCompareFunction=function(t){switch(t){case e.CompareFunction.Never:return WebGLRenderingContext.NEVER;case e.CompareFunction.Less:return WebGLRenderingContext.LESS;case e.CompareFunction.Equal:return WebGLRenderingContext.EQUAL;case e.CompareFunction.LessEqual:return WebGLRenderingContext.LEQUAL;case e.CompareFunction.Greater:return WebGLRenderingContext.GREATER;case e.CompareFunction.NotEqual:return WebGLRenderingContext.NOTEQUAL;case e.CompareFunction.GreaterEqual:return WebGLRenderingContext.GEQUAL;case e.CompareFunction.Always:return WebGLRenderingContext.ALWAYS}},t._getGLStencilOperation=function(t){switch(t){case e.StencilOperation.Keep:return WebGLRenderingContext.KEEP;case e.StencilOperation.Zero:return WebGLRenderingContext.ZERO;case e.StencilOperation.Replace:return WebGLRenderingContext.REPLACE;case e.StencilOperation.IncrementSaturate:return WebGLRenderingContext.INCR;case e.StencilOperation.DecrementSaturate:return WebGLRenderingContext.DECR;case e.StencilOperation.Invert:return WebGLRenderingContext.INVERT;case e.StencilOperation.IncrementWrap:return WebGLRenderingContext.INCR_WRAP;case e.StencilOperation.DecrementWrap:return WebGLRenderingContext.DECR_WRAP}};var n=t.prototype;return n._apply=function(e,t){this._platformApply(e,t.stencilState)},n._platformApply=function(e,n){var r=e.gl,i=this.enabled,a=this.referenceValue,o=this.mask,s=this.compareFunctionFront,l=this.compareFunctionBack,u=this.failOperationFront,c=this.zFailOperationFront,d=this.passOperationFront,f=this.failOperationBack,h=this.zFailOperationBack,p=this.passOperationBack,_=this.writeMask;if(i!=n.enabled&&(i?r.enable(r.STENCIL_TEST):r.disable(WebGLRenderingContext.STENCIL_TEST),n.enabled=i),i){var v=a!==n.referenceValue||o!==n.mask;(v||s!==n.compareFunctionFront)&&(r.stencilFuncSeparate(r.FRONT,t._getGLCompareFunction(s),a,o),n.compareFunctionFront=s),(v||l!==n.compareFunctionBack)&&(r.stencilFuncSeparate(r.BACK,t._getGLCompareFunction(l),a,o),n.compareFunctionBack=this.compareFunctionBack),v&&(n.referenceValue=this.referenceValue,n.mask=this.mask),u===n.failOperationFront&&c===n.zFailOperationFront&&d===n.passOperationFront||(r.stencilOpSeparate(r.FRONT,t._getGLStencilOperation(u),t._getGLStencilOperation(c),t._getGLStencilOperation(d)),n.failOperationFront=u,n.zFailOperationFront=c,n.passOperationFront=d),f===n.failOperationBack&&h===n.zFailOperationBack&&p===n.passOperationBack||(r.stencilOpSeparate(r.BACK,t._getGLStencilOperation(f),t._getGLStencilOperation(h),t._getGLStencilOperation(p)),n.failOperationBack=f,n.zFailOperationBack=h,n.passOperationBack=p),_!==n.writeMask&&(r.stencilMask(_),n.writeMask=_)}},t}(),Dt=function(){function e(){this.blendState=new dt,this.depthState=new ht,this.stencilState=new zt,this.rasterState=new _t}return e.prototype._apply=function(e){var t=e._hardwareRenderer,n=e._lastRenderState;this.blendState._apply(t,n),this.depthState._apply(t,n),this.stencilState._apply(t,n),this.rasterState._apply(t,n)},e}(),kt=function(t){function n(n,r){var i;return(i=t.call(this,n)||this).name=void 0,i.shader=void 0,i.renderQueueType=e.RenderQueueType.Opaque,i.shaderData=new lt(qe.Material),i.renderState=new Dt,i.shader=r,i}P(n,t);var r=n.prototype;return r.clone=function(){var e=new n(this._engine,this.shader);return this.cloneTo(e),e},r.cloneTo=function(e){e.shader=this.shader,e.renderQueueType=this.renderQueueType,this.shaderData.cloneTo(e.shaderData),J.deepCloneObject(this.renderState,e.renderState)},r._addRefCount=function(e){t.prototype._addRefCount.call(this,e),this.shaderData._addRefCount(e)},r._preRender=function(e){},r._onDestroy=function(){},n}(Qe),Nt=function(){function e(e){this._elementPoolIndex=0,this._elementPool=[],this._type=void 0,this._type=e}var t=e.prototype;return t.getFromPool=function(){var e=this._elementPoolIndex,t=this._elementPool;if(this._elementPoolIndex++,t.length===e){var n=new this._type;return t.push(n),n}return t[e]},t.resetPool=function(){this._elementPoolIndex=0},e}(),Ut=function(){function e(){this._camera=void 0,this._viewProjectMatrix=new f}return e.prototype._setContext=function(e){this._camera=e,f.multiply(e.projectionMatrix,e.viewMatrix,this._viewProjectMatrix)},e}(),Vt=function(){function e(){this.component=void 0,this.mesh=void 0,this.subMesh=void 0,this.material=void 0}return e.prototype.setValue=function(e,t,n,r){this.component=e,this.mesh=t,this.subMesh=n,this.material=r},e}(),Gt=function(){function e(){this.component=void 0,this.positions=void 0,this.uv=void 0,this.triangles=void 0,this.color=void 0,this.material=void 0,this.camera=void 0}return e.prototype.setValue=function(e,t,n,r,i,a,o){this.component=e,this.positions=t,this.uv=n,this.triangles=r,this.color=i,this.material=a,this.camera=o},e}(),Ht=function(){function e(){this.component=void 0,this.positions=void 0,this.uv=void 0,this.triangles=void 0,this.material=void 0,this.isAdd=!0,this.camera=void 0}return e.prototype.setValue=function(e,t,n,r,i){this.component=e,this.positions=t,this.uv=n,this.triangles=r,this.material=i},e}();e.SpriteMaskInteraction=void 0,(vt=e.SpriteMaskInteraction||(e.SpriteMaskInteraction={}))[vt.None=0]="None",vt[vt.VisibleInsideMask=1]="VisibleInsideMask",vt[vt.VisibleOutsideMask=2]="VisibleOutsideMask";var Wt,jt,Xt,Kt,qt,Qt,Yt,$t,Jt,Zt,en=(Ot=It=function(e){function t(n){var r;I(r=e.call(this,n)||this,"shaderData",gt,L(r)),I(r,"isCulled",yt,L(r)),I(r,"_distanceForSort",xt,L(r)),I(r,"_onUpdateIndex",bt,L(r)),I(r,"_rendererIndex",wt,L(r)),I(r,"_globalShaderMacro",Tt,L(r)),I(r,"_renderSortId",St,L(r)),I(r,"_overrideUpdate",Ct,L(r)),I(r,"_materials",Pt,L(r)),I(r,"_transformChangeFlag",Mt,L(r)),I(r,"_bounds",At,L(r)),I(r,"_mvMatrix",Et,L(r)),I(r,"_mvpMatrix",Rt,L(r)),I(r,"_mvInvMatrix",Ft,L(r)),I(r,"_normalMatrix",Lt,L(r)),I(r,"_materialsInstanced",Bt,L(r));var i=t.prototype;return r._overrideUpdate=r.update!==i.update,r._transformChangeFlag=r.entity.transform.registerWorldChangeFlag(),r.shaderData._addRefCount(1),r}P(t,e);var n=t.prototype;return n.getInstanceMaterial=function(e){void 0===e&&(e=0);var t=this._materials;if(t.length>e){var n=t[e];if(n)return this._materialsInstanced[e]?n:this._createInstanceMaterial(n,e)}return null},n.getMaterial=function(e){return void 0===e&&(e=0),this._materials[e]||null},n.setMaterial=function(e,t){var n;void 0===t&&(t=null),"number"==typeof e?n=e:(n=0,t=e);var r=this._materials;n>=r.length&&(r.length=n+1);var i=this._materialsInstanced,a=r[n];a!==t&&(r[n]=t,n<i.length&&(i[n]=!1),a&&a._addRefCount(-1),t&&t._addRefCount(1))},n.getInstanceMaterials=function(){for(var e=this._materials,t=this._materialsInstanced,n=0,r=e.length;n<r;n++)t[n]||this._createInstanceMaterial(this._materials[n],n);return e},n.getMaterials=function(){return this._materials},n.setMaterials=function(e){for(var t=e.length,n=this._materials,r=this._materialsInstanced,i=t,a=n.length;i<a;i++){var o=n[i];o&&o._addRefCount(-1)}n.length!==t&&(n.length=t),0!==r.length&&(r.length=0);for(var s=0;s<t;s++){var l=n[s],u=e[s];l!==u&&(n[s]=u,l&&l._addRefCount(-1),u&&u._addRefCount(1))}},n.update=function(e){},n._updateShaderData=function(e){var n=this.shaderData,r=this.entity.transform.worldMatrix,i=this._mvMatrix,a=this._mvpMatrix,o=this._mvInvMatrix,s=this._normalMatrix;f.multiply(e._camera.viewMatrix,r,i),f.multiply(e._viewProjectMatrix,r,a),f.invert(i,o),f.invert(r,s),s.transpose(),n.setMatrix(t._localMatrixProperty,this.entity.transform.localMatrix),n.setMatrix(t._worldMatrixProperty,r),n.setMatrix(t._mvMatrixProperty,i),n.setMatrix(t._mvpMatrixProperty,a),n.setMatrix(t._mvInvMatrixProperty,o),n.setMatrix(t._normalMatrixProperty,s)},n._onEnable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},n._onDisable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},n._onDestroy=function(){var e=this._transformChangeFlag;e&&(e.destroy(),this._transformChangeFlag=null),this.shaderData._addRefCount(-1);for(var t=0,n=this._materials.length;t<n;t++)this._materials[t]._addRefCount(-1)},n._updateBounds=function(e){},n._createInstanceMaterial=function(e,t){var n=e.clone();return n.name=n.name+"(Instance)",e._addRefCount(-1),n._addRefCount(1),this._materialsInstanced[t]=!0,this._materials[t]=n,n},T(t,[{key:"materialCount",get:function(){return this._materials.length},set:function(e){var t=this._materials,n=this._materialsInstanced;t.length!==e&&(t.length=e),n.length>e&&(n.length=e)}},{key:"bounds",get:function(){var e=this._transformChangeFlag;return e.flag&&(this._updateBounds(this._bounds),e.flag=!1),this._bounds}}]),t}(Ve),It._localMatrixProperty=it.getPropertyByName("u_localMat"),It._worldMatrixProperty=it.getPropertyByName("u_modelMat"),It._mvMatrixProperty=it.getPropertyByName("u_MVMat"),It._mvpMatrixProperty=it.getPropertyByName("u_MVPMat"),It._mvInvMatrixProperty=it.getPropertyByName("u_MVInvMat"),It._normalMatrixProperty=it.getPropertyByName("u_normalMat"),gt=O((mt=Ot).prototype,"shaderData",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lt(qe.Renderer)}}),yt=O(mt.prototype,"isCulled",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xt=O(mt.prototype,"_distanceForSort",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bt=O(mt.prototype,"_onUpdateIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),wt=O(mt.prototype,"_rendererIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Tt=O(mt.prototype,"_globalShaderMacro",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new he}}),St=O(mt.prototype,"_renderSortId",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ct=O(mt.prototype,"_overrideUpdate",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pt=O(mt.prototype,"_materials",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mt=O(mt.prototype,"_transformChangeFlag",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=O(mt.prototype,"_bounds",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new o(new i,new i)}}),Et=O(mt.prototype,"_mvMatrix",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Rt=O(mt.prototype,"_mvpMatrix",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Ft=O(mt.prototype,"_mvInvMatrix",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Lt=O(mt.prototype,"_normalMatrix",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Bt=O(mt.prototype,"_materialsInstanced",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mt);e.SpriteMaskLayer=void 0,(Wt=e.SpriteMaskLayer||(e.SpriteMaskLayer={}))[Wt.Layer0=1]="Layer0",Wt[Wt.Layer1=2]="Layer1",Wt[Wt.Layer2=4]="Layer2",Wt[Wt.Layer3=8]="Layer3",Wt[Wt.Layer4=16]="Layer4",Wt[Wt.Layer5=32]="Layer5",Wt[Wt.Layer6=64]="Layer6",Wt[Wt.Layer7=128]="Layer7",Wt[Wt.Layer8=256]="Layer8",Wt[Wt.Layer9=512]="Layer9",Wt[Wt.Layer10=1024]="Layer10",Wt[Wt.Layer11=2048]="Layer11",Wt[Wt.Layer12=4096]="Layer12",Wt[Wt.Layer13=8192]="Layer13",Wt[Wt.Layer14=16384]="Layer14",Wt[Wt.Layer15=32768]="Layer15",Wt[Wt.Layer16=65536]="Layer16",Wt[Wt.Layer17=131072]="Layer17",Wt[Wt.Layer18=262144]="Layer18",Wt[Wt.Layer19=524288]="Layer19",Wt[Wt.Layer20=1048576]="Layer20",Wt[Wt.Layer21=2097152]="Layer21",Wt[Wt.Layer22=4194304]="Layer22",Wt[Wt.Layer23=8388608]="Layer23",Wt[Wt.Layer24=16777216]="Layer24",Wt[Wt.Layer25=33554432]="Layer25",Wt[Wt.Layer26=67108864]="Layer26",Wt[Wt.Layer27=134217728]="Layer27",Wt[Wt.Layer28=268435456]="Layer28",Wt[Wt.Layer29=536870912]="Layer29",Wt[Wt.Layer30=1073741824]="Layer30",Wt[Wt.Layer31=2147483648]="Layer31",Wt[Wt.Everything=4294967295]="Everything";var tn,nn,rn,an=(Zt=Jt=function(e){function t(n){var r;return(r=e.call(this,n)||this)._maskElement=void 0,I(r,"_positions",Xt,L(r)),I(r,"_isSpriteDirty",Kt,L(r)),I(r,"_worldMatrixDirtyFlag",qt,L(r)),I(r,"_sprite",Qt,L(r)),I(r,"_alphaCutoff",Yt,L(r)),I(r,"influenceLayers",$t,L(r)),r._worldMatrixDirtyFlag=n.transform.registerWorldChangeFlag(),r.setMaterial(r._engine._spriteMaskDefaultMaterial),r.shaderData.setFloat(t._alphaCutoffProperty,r._alphaCutoff),r}P(t,e);var n=t.prototype;return n._onDestroy=function(){this._worldMatrixDirtyFlag.destroy(),e.prototype._onDestroy.call(this)},n._render=function(e){var n=this.sprite;if(!n)return null;var r=n.texture;if(!r)return null;var a=this._positions,o=this.entity.transform,s=n._updateMeshData();if(this._worldMatrixDirtyFlag.flag||s||this._isSpriteDirty){for(var l=n._positions,u=t._tempVec3,c=o.worldMatrix,d=0,f=a.length;d<f;d++){var h=l[d];u.setValue(h.x,h.y,0),i.transformToVec3(u,c,a[d])}this._isSpriteDirty=!1,this._worldMatrixDirtyFlag.flag=!1}this.shaderData.setTexture(t._textureProperty,r);var p=this._engine._spriteMaskElementPool.getFromPool();p.setValue(this,a,n._uv,n._triangles,this.getMaterial()),p.camera=e,e._renderPipeline._allSpriteMasks.add(this),this._maskElement=p},T(t,[{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._isSpriteDirty=!0)}},{key:"alphaCutoff",get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff!==e&&(this._alphaCutoff=e,this.shaderData.setFloat(t._alphaCutoffProperty,e))}}]),t}(en),Jt._textureProperty=it.getPropertyByName("u_maskTexture"),Jt._alphaCutoffProperty=it.getPropertyByName("u_maskAlphaCutoff"),Jt._tempVec3=new i,Xt=O((jt=Zt).prototype,"_positions",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new i,new i,new i,new i]}}),Kt=O(jt.prototype,"_isSpriteDirty",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),qt=O(jt.prototype,"_worldMatrixDirtyFlag",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qt=O(jt.prototype,"_sprite",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yt=O(jt.prototype,"_alphaCutoff",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$t=O(jt.prototype,"influenceLayers",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e.SpriteMaskLayer.Everything}}),jt);e.VertexElementFormat=void 0,(tn=e.VertexElementFormat||(e.VertexElementFormat={}))[tn.Float=0]="Float",tn[tn.Vector2=1]="Vector2",tn[tn.Vector3=2]="Vector3",tn[tn.Vector4=3]="Vector4",tn[tn.Byte4=4]="Byte4",tn[tn.UByte4=5]="UByte4",tn[tn.NormalizedByte4=6]="NormalizedByte4",tn[tn.NormalizedUByte4=7]="NormalizedUByte4",tn[tn.Short2=8]="Short2",tn[tn.UShort2=9]="UShort2",tn[tn.NormalizedShort2=10]="NormalizedShort2",tn[tn.NormalizedUShort2=11]="NormalizedUShort2",tn[tn.Short4=12]="Short4",tn[tn.UShort4=13]="UShort4",tn[tn.NormalizedShort4=14]="NormalizedShort4",tn[tn.NormalizedUShort4=15]="NormalizedUShort4",e.BufferUsage=void 0,(nn=e.BufferUsage||(e.BufferUsage={}))[nn.Static=0]="Static",nn[nn.Dynamic=1]="Dynamic",nn[nn.Stream=2]="Stream",e.IndexFormat=void 0,(rn=e.IndexFormat||(e.IndexFormat={}))[rn.UInt8=0]="UInt8",rn[rn.UInt16=1]="UInt16",rn[rn.UInt32=2]="UInt32";var on,sn,ln=function(){function t(){}return t._getGLBufferUsage=function(t,n){switch(n){case e.BufferUsage.Static:return t.STATIC_DRAW;case e.BufferUsage.Dynamic:return t.DYNAMIC_DRAW;case e.BufferUsage.Stream:return t.STREAM_DRAW}},t._getGLIndexType=function(t){switch(t){case e.IndexFormat.UInt8:return e.DataType.UNSIGNED_BYTE;case e.IndexFormat.UInt16:return e.DataType.UNSIGNED_SHORT;case e.IndexFormat.UInt32:return e.DataType.UNSIGNED_INT}},t._getGLIndexByteCount=function(t){switch(t){case e.IndexFormat.UInt8:return 1;case e.IndexFormat.UInt16:return 2;case e.IndexFormat.UInt32:return 4}},t._getElementInfo=function(t){var n,r,i=!1;switch(t){case e.VertexElementFormat.Float:n=1,r=e.DataType.FLOAT;break;case e.VertexElementFormat.Vector2:n=2,r=e.DataType.FLOAT;break;case e.VertexElementFormat.Vector3:n=3,r=e.DataType.FLOAT;break;case e.VertexElementFormat.Vector4:n=4,r=e.DataType.FLOAT;break;case e.VertexElementFormat.Byte4:n=4,r=e.DataType.BYTE;break;case e.VertexElementFormat.UByte4:n=4,r=e.DataType.UNSIGNED_BYTE;break;case e.VertexElementFormat.NormalizedByte4:n=4,r=e.DataType.BYTE,i=!0;break;case e.VertexElementFormat.NormalizedUByte4:n=4,r=e.DataType.UNSIGNED_BYTE,i=!0;break;case e.VertexElementFormat.Short2:n=2,r=e.DataType.SHORT;break;case e.VertexElementFormat.UShort2:n=2,r=e.DataType.UNSIGNED_SHORT;break;case e.VertexElementFormat.NormalizedShort2:n=2,r=e.DataType.SHORT,i=!0;break;case e.VertexElementFormat.NormalizedUShort2:n=2,r=e.DataType.UNSIGNED_SHORT,i=!0;break;case e.VertexElementFormat.Short4:n=4,r=e.DataType.SHORT;break;case e.VertexElementFormat.UShort4:n=4,r=e.DataType.UNSIGNED_SHORT;break;case e.VertexElementFormat.NormalizedShort4:n=4,r=e.DataType.SHORT,i=!0;break;case e.VertexElementFormat.NormalizedUShort4:n=4,r=e.DataType.UNSIGNED_SHORT,i=!0}return{size:n,type:r,normalized:i}},t}(),un=function(){function e(e,t,n,r,i){void 0===i&&(i=0),this._glElementInfo=void 0,this._semantic=void 0,this._offset=void 0,this._format=void 0,this._bindingIndex=void 0,this._instanceStepRate=void 0,this._semantic=e,this._offset=t,this._format=n,this._bindingIndex=r,this._glElementInfo=ln._getElementInfo(this.format),this._instanceStepRate=Math.floor(i)}return T(e,[{key:"semantic",get:function(){return this._semantic}},{key:"offset",get:function(){return this._offset}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}}]),e}();e.BufferBindFlag=void 0,(on=e.BufferBindFlag||(e.BufferBindFlag={}))[on.VertexBuffer=0]="VertexBuffer",on[on.IndexBuffer=1]="IndexBuffer",e.SetDataOptions=void 0,(sn=e.SetDataOptions||(e.SetDataOptions={}))[sn.None=0]="None",sn[sn.Discard=1]="Discard";var cn,dn=function(t){function n(n,r,i,a){var o;void 0===a&&(a=e.BufferUsage.Static),(o=t.call(this,n)||this)._glBindTarget=void 0,o._glBufferUsage=void 0,o._nativeBuffer=void 0,o._hardwareRenderer=void 0,o._type=void 0,o._byteLength=void 0,o._bufferUsage=void 0,o._engine=n,o._type=r,o._bufferUsage=a;var s=n._hardwareRenderer,l=s.gl,u=ln._getGLBufferUsage(l,a),c=r===e.BufferBindFlag.VertexBuffer?l.ARRAY_BUFFER:l.ELEMENT_ARRAY_BUFFER;return o._nativeBuffer=l.createBuffer(),o._hardwareRenderer=s,o._glBufferUsage=u,o._glBindTarget=c,o.bind(),"number"==typeof i?(o._byteLength=i,l.bufferData(c,i,u)):(o._byteLength=i.byteLength,l.bufferData(c,i,u)),l.bindBuffer(c,null),o}P(n,t);var r=n.prototype;return r.bind=function(){this._hardwareRenderer.gl.bindBuffer(this._glBindTarget,this._nativeBuffer)},r.setData=function(t,n,r,i,a){void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=e.SetDataOptions.None);var o=this._hardwareRenderer.gl,s=this._hardwareRenderer.isWebGL2,l=this._glBindTarget;this.bind(),a===e.SetDataOptions.Discard&&o.bufferData(l,this._byteLength,this._glBufferUsage);var u=t.BYTES_PER_ELEMENT||1,c=i?u*i:t.byteLength;if(0!==r||c<t.byteLength){var d=void 0!==t.byteOffset;if(s&&d)o.bufferSubData(l,n,t,r,c/u);else{var f=new Uint8Array(d?t.buffer:t,r*u,c);o.bufferSubData(l,n,f)}}else o.bufferSubData(l,n,t);o.bindBuffer(l,null)},r.getData=function(e,t,n,r){if(void 0===t&&(t=0),void 0===n&&(n=0),!this._hardwareRenderer.isWebGL2)throw"Buffer is write-only on WebGL1.0 platforms.";var i=this._hardwareRenderer.gl;this.bind(),i.getBufferSubData(this._glBindTarget,t,e,n,r)},r._onDestroy=function(){this._hardwareRenderer.gl.deleteBuffer(this._nativeBuffer),this._nativeBuffer=null,this._hardwareRenderer=null},r.resize=function(e){this.bind(),this._hardwareRenderer.gl.bufferData(this._glBindTarget,e,this._glBufferUsage),this._byteLength=e},T(n,[{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),n}(Qe);e.MeshTopology=void 0,(cn=e.MeshTopology||(e.MeshTopology={}))[cn.Points=0]="Points",cn[cn.Lines=1]="Lines",cn[cn.LineLoop=2]="LineLoop",cn[cn.LineStrip=3]="LineStrip",cn[cn.Triangles=4]="Triangles",cn[cn.TriangleStrip=5]="TriangleStrip",cn[cn.TriangleFan=6]="TriangleFan";var fn,hn,pn=function(){function e(e,t){this._buffer=void 0,this._format=void 0,this._buffer=e,this._format=t}return T(e,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),e}(),_n=function(t,n,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=e.MeshTopology.Triangles),this.start=void 0,this.count=void 0,this.topology=void 0,this.start=t,this.count=n,this.topology=r},vn=function(t){function n(e,n){var r;return(r=t.call(this,e)||this).name=void 0,r.bounds=new o,r._vertexElementMap={},r._glIndexType=void 0,r._glIndexByteCount=void 0,r._platformPrimitive=void 0,r._instanceCount=0,r._vertexBufferBindings=[],r._indexBufferBinding=null,r._vertexElements=[],r._subMeshes=[],r._updateFlagManager=new He,r.name=n,r._platformPrimitive=r._engine._hardwareRenderer.createPlatformPrimitive(L(r)),r}P(n,t);var r=n.prototype;return r.addSubMesh=function(t,n,r){return void 0===r&&(r=e.MeshTopology.Triangles),"number"==typeof t&&(t=new _n(t,n,r)),this._subMeshes.push(t),t},r.removeSubMesh=function(e){var t=this._subMeshes,n=t.indexOf(e);-1!==n&&t.splice(n,1)},r.clearSubMesh=function(){this._subMeshes.length=0},r.registerUpdateFlag=function(){return this._updateFlagManager.register()},r._draw=function(e,t){this._platformPrimitive.draw(e,t)},r._addRefCount=function(e){t.prototype._addRefCount.call(this,e);for(var n=this._vertexBufferBindings,r=0,i=n.length;r<i;r++)n[r]._buffer._addRefCount(e)},r._onDestroy=function(){this._vertexBufferBindings=null,this._indexBufferBinding=null,this._vertexElements=null,this._vertexElementMap=null,this._platformPrimitive.destroy()},r._setVertexElements=function(e){this._clearVertexElements();for(var t=0,n=e.length;t<n;t++)this._addVertexElement(e[t])},r._setVertexBufferBinding=function(e,t){if(this._getRefCount()>0){var n=this._vertexBufferBindings[e];n&&n._buffer._addRefCount(-1),t._buffer._addRefCount(1)}this._vertexBufferBindings[e]=t},r._setIndexBufferBinding=function(e){e?(this._indexBufferBinding=e,this._glIndexType=ln._getGLIndexType(e.format),this._glIndexByteCount=ln._getGLIndexByteCount(e.format)):(this._indexBufferBinding=null,this._glIndexType=void 0)},r._clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var t in e)delete e[t]},r._addVertexElement=function(e){var t=e.semantic;this._vertexElementMap[t]=e,this._vertexElements.push(e),this._updateFlagManager.distribute()},T(n,[{key:"subMesh",get:function(){return this._subMeshes[0]||null}},{key:"subMeshes",get:function(){return this._subMeshes}}]),n}(Qe),mn=function(){function e(e,t){this._buffer=void 0,this._stride=void 0,this._buffer=e,this._stride=t}return T(e,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),e}();e.TextureFilterMode=void 0,(fn=e.TextureFilterMode||(e.TextureFilterMode={}))[fn.Point=0]="Point",fn[fn.Bilinear=1]="Bilinear",fn[fn.Trilinear=2]="Trilinear",e.TextureFormat=void 0,(hn=e.TextureFormat||(e.TextureFormat={}))[hn.R8G8B8=0]="R8G8B8",hn[hn.R8G8B8A8=1]="R8G8B8A8",hn[hn.R4G4B4A4=2]="R4G4B4A4",hn[hn.R5G5B5A1=3]="R5G5B5A1",hn[hn.R5G6B5=4]="R5G6B5",hn[hn.Alpha8=5]="Alpha8",hn[hn.LuminanceAlpha=6]="LuminanceAlpha",hn[hn.R32G32B32A32=7]="R32G32B32A32",hn[hn.DXT1=8]="DXT1",hn[hn.DXT5=9]="DXT5",hn[hn.ETC1_RGB=10]="ETC1_RGB",hn[hn.ETC2_RGB=11]="ETC2_RGB",hn[hn.ETC2_RGBA5=12]="ETC2_RGBA5",hn[hn.ETC2_RGBA8=13]="ETC2_RGBA8",hn[hn.PVRTC_RGB2=14]="PVRTC_RGB2",hn[hn.PVRTC_RGBA2=15]="PVRTC_RGBA2",hn[hn.PVRTC_RGB4=16]="PVRTC_RGB4",hn[hn.PVRTC_RGBA4=17]="PVRTC_RGBA4",hn[hn.ASTC_4x4=18]="ASTC_4x4",hn[hn.ASTC_5x5=19]="ASTC_5x5",hn[hn.ASTC_6x6=20]="ASTC_6x6",hn[hn.ASTC_8x8=21]="ASTC_8x8",hn[hn.ASTC_10x10=22]="ASTC_10x10",hn[hn.ASTC_12x12=23]="ASTC_12x12",e.TextureWrapMode=void 0,function(e){e[e.Clamp=0]="Clamp",e[e.Repeat=1]="Repeat",e[e.Mirror=2]="Mirror"}(e.TextureWrapMode||(e.TextureWrapMode={}));var gn,yn,xn,bn=function(t){function n(n,r,i,a,o){var s;return void 0===a&&(a=e.TextureFormat.R8G8B8A8),void 0===o&&(o=!0),(s=t.call(this,n)||this)._format=void 0,s._mipmap=o,s._width=r,s._height=i,s._format=a,s._mipmapCount=s._getMipmapCount(),s._platformTexture=n._hardwareRenderer.createPlatformTexture2D(L(s)),s.filterMode=e.TextureFilterMode.Bilinear,s.wrapModeU=s.wrapModeV=e.TextureWrapMode.Repeat,s}P(n,t);var r=n.prototype;return r.setPixelBuffer=function(e,t,n,r,i,a){void 0===t&&(t=0),this._platformTexture.setPixelBuffer(e,t,n,r,i,a)},r.setImageSource=function(e,t,n,r,i,a){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1),this._platformTexture.setImageSource(e,t,n,r,i,a)},r.getPixelBuffer=function(e,t,n,r,i){this._platformTexture.getPixelBuffer(e,t,n,r,i)},T(n,[{key:"format",get:function(){return this._format}}]),n}(Ye);e.RenderBufferColorFormat=void 0,(gn=e.RenderBufferColorFormat||(e.RenderBufferColorFormat={}))[gn.R8G8B8=0]="R8G8B8",gn[gn.R8G8B8A8=1]="R8G8B8A8",gn[gn.R4G4B4A4=2]="R4G4B4A4",gn[gn.R5G5B5A1=3]="R5G5B5A1",gn[gn.R5G6B5=4]="R5G6B5",gn[gn.Alpha8=5]="Alpha8",gn[gn.R16G16B16A16=6]="R16G16B16A16",gn[gn.R32G32B32A32=7]="R32G32B32A32",e.RenderBufferDepthFormat=void 0,(yn=e.RenderBufferDepthFormat||(e.RenderBufferDepthFormat={}))[yn.Depth=0]="Depth",yn[yn.DepthStencil=1]="DepthStencil",yn[yn.Stencil=2]="Stencil",yn[yn.Depth16=3]="Depth16",yn[yn.Depth24=4]="Depth24",yn[yn.Depth32=5]="Depth32",yn[yn.Depth24Stencil8=6]="Depth24Stencil8",yn[yn.Depth32Stencil8=7]="Depth32Stencil8",e.TextureCubeFace=void 0,(xn=e.TextureCubeFace||(e.TextureCubeFace={}))[xn.PositiveX=0]="PositiveX",xn[xn.NegativeX=1]="NegativeX",xn[xn.PositiveY=2]="PositiveY",xn[xn.NegativeY=3]="NegativeY",xn[xn.PositiveZ=4]="PositiveZ",xn[xn.NegativeZ=5]="NegativeZ";var wn,Tn=function(t){function n(n,r,i,a){var o;return void 0===i&&(i=e.TextureFormat.R8G8B8A8),void 0===a&&(a=!0),(o=t.call(this,n)||this)._format=void 0,o._mipmap=a,o._width=r,o._height=r,o._format=i,o._mipmapCount=o._getMipmapCount(),o._platformTexture=n._hardwareRenderer.createPlatformTextureCubeMap(L(o)),o.filterMode=e.TextureFilterMode.Bilinear,o.wrapModeU=o.wrapModeV=e.TextureWrapMode.Clamp,o}P(n,t);var r=n.prototype;return r.setPixelBuffer=function(e,t,n,r,i,a,o){void 0===n&&(n=0),this._platformTexture.setPixelBuffer(e,t,n,r,i,a,o)},r.setImageSource=function(e,t,n,r,i,a,o){void 0===n&&(n=0),void 0===r&&(r=!1),void 0===i&&(i=!1),this._platformTexture.setImageSource(e,t,n,r,i,a,o)},r.getPixelBuffer=function(e,t,n,r,i,a){this._platformTexture.getPixelBuffer(e,t,n,r,i,a)},T(n,[{key:"format",get:function(){return this._format}}]),n}(Ye),Sn=function(t){function n(n,r,i,a,o,s){var l;return void 0===a&&(a=e.RenderBufferDepthFormat.Depth),void 0===o&&(o=!1),void 0===s&&(s=!1),(l=t.call(this,n)||this)._autoMipmap=!1,l._format=void 0,l._isCube=!1,l._isCube=s,l._mipmap=o,l._width=r,l._height=i,l._format=a,l._mipmapCount=l._getMipmapCount(),l._platformTexture=n._hardwareRenderer.createPlatformRenderDepthTexture(L(l)),l.filterMode=e.TextureFilterMode.Bilinear,l.wrapModeU=l.wrapModeV=e.TextureWrapMode.Clamp,l}return P(n,t),T(n,[{key:"format",get:function(){return this._format}},{key:"isCube",get:function(){return this._isCube}},{key:"autoGenerateMipmaps",get:function(){return this._autoMipmap},set:function(e){this._autoMipmap=e}}]),n}(Ye),Cn=function(t){function n(n,r,i,a,o,s){var l;return void 0===o&&(o=e.RenderBufferDepthFormat.Depth),void 0===s&&(s=1),(l=t.call(this,n)||this)._platformRenderTarget=void 0,l._colorTextures=void 0,l._depth=void 0,l._antiAliasing=void 0,l._width=void 0,l._height=void 0,l._depthTexture=void 0,l._width=r,l._height=i,l._antiAliasing=s,l._depth=o,l._colorTextures=a?a instanceof Array?a.slice():[a]:[],o instanceof Sn&&(l._depthTexture=o),l._platformRenderTarget=n._hardwareRenderer.createPlatformRenderTarget(L(l)),l}P(n,t);var r=n.prototype;return r.getColorTexture=function(e){return void 0===e&&(e=0),this._colorTextures[e]},r.generateMipmaps=function(){var e,t=this.colorTextureCount;null!==(e=this._depthTexture)&&void 0!==e&&e.autoGenerateMipmaps&&this._depthTexture.generateMipmaps();for(var n=0;n<t;n++){var r=this._colorTextures[n];r.autoGenerateMipmaps&&r.generateMipmaps()}},r.destroy=function(){this._platformRenderTarget.destroy(),this._colorTextures.length=0,this._depthTexture=null,this._depth=null},r._setRenderTargetFace=function(e){this._platformRenderTarget.setRenderTargetFace(e)},r._blitRenderTarget=function(){this._platformRenderTarget.blitRenderTarget()},T(n,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),n}(re),Pn=function(t){function n(n,r,i,a,o,s){var l;return void 0===a&&(a=e.RenderBufferColorFormat.R8G8B8A8),void 0===o&&(o=!1),void 0===s&&(s=!1),(l=t.call(this,n)||this)._autoMipmap=!1,l._format=void 0,l._isCube=!1,l._isCube=s,l._mipmap=o,l._width=r,l._height=i,l._format=a,l._mipmapCount=l._getMipmapCount(),l._platformTexture=n._hardwareRenderer.createPlatformRenderColorTexture(L(l)),l.filterMode=e.TextureFilterMode.Bilinear,l.wrapModeU=l.wrapModeV=e.TextureWrapMode.Clamp,l}return P(n,t),n.prototype.getPixelBuffer=function(e,t,n,r,i,a){this._platformTexture.getPixelBuffer(e,t,n,r,i,a)},T(n,[{key:"format",get:function(){return this._format}},{key:"isCube",get:function(){return this._isCube}},{key:"autoGenerateMipmaps",get:function(){return this._autoMipmap},set:function(e){this._autoMipmap=e}}]),n}(Ye),Mn=function(t){function n(e,n){var r;return(r=t.call(this,e)||this)._hasBlendShape=!1,r._useBlendShapeNormal=!1,r._useBlendShapeTangent=!1,r._blendShapeTexture=void 0,r._vertexCount=0,r._accessible=!0,r._verticesFloat32=null,r._verticesUint8=null,r._indices=null,r._indicesFormat=null,r._vertexSlotChanged=!0,r._vertexChangeFlag=0,r._indicesChangeFlag=!1,r._elementCount=0,r._vertexElementsCache=[],r._positions=[],r._normals=null,r._colors=null,r._tangents=null,r._uv=null,r._uv1=null,r._uv2=null,r._uv3=null,r._uv4=null,r._uv5=null,r._uv6=null,r._uv7=null,r._boneWeights=null,r._boneIndices=null,r._blendShapes=[],r._blendShapeUpdateFlags=[],r.name=n,r}P(n,t);var r=n.prototype;return r.setPositions=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";var t=e.length;this._positions=e,this._vertexChangeFlag|=wn.Position,this._vertexCount!==t&&(this._vertexCount=t)},r.getPositions=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._positions},r.setNormals=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._normals!=!!e,this._vertexChangeFlag|=wn.Normal,this._normals=e},r.getNormals=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._normals},r.setColors=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._colors!=!!e,this._vertexChangeFlag|=wn.Color,this._colors=e},r.getColors=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._colors},r.setBoneWeights=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=null!=e,this._vertexChangeFlag|=wn.BoneWeight,this._boneWeights=e},r.getBoneWeights=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneWeights},r.setBoneIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._boneIndices!=!!e,this._vertexChangeFlag|=wn.BoneIndex,this._boneIndices=e},r.getBoneIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneIndices},r.setTangents=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._tangents!=!!e,this._vertexChangeFlag|=wn.Tangent,this._tangents=e},r.getTangents=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._tangents},r.setUVs=function(e,t){var n;if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";switch(t=null!=(n=t)?n:0){case 0:this._vertexSlotChanged=!!this._uv!=!!e,this._vertexChangeFlag|=wn.UV,this._uv=e;break;case 1:this._vertexSlotChanged=!!this._uv1!=!!e,this._vertexChangeFlag|=wn.UV1,this._uv1=e;break;case 2:this._vertexSlotChanged=!!this._uv2!=!!e,this._vertexChangeFlag|=wn.UV2,this._uv2=e;break;case 3:this._vertexSlotChanged=!!this._uv3!=!!e,this._vertexChangeFlag|=wn.UV3,this._uv3=e;break;case 4:this._vertexSlotChanged=!!this._uv4!=!!e,this._vertexChangeFlag|=wn.UV4,this._uv4=e;break;case 5:this._vertexSlotChanged=!!this._uv5!=!!e,this._vertexChangeFlag|=wn.UV5,this._uv5=e;break;case 6:this._vertexSlotChanged=!!this._uv6!=!!e,this._vertexChangeFlag|=wn.UV6,this._uv6=e;break;case 7:this._vertexSlotChanged=!!this._uv7!=!!e,this._vertexChangeFlag|=wn.UV7,this._uv7=e;break;default:throw"The index of channel needs to be in range [0 - 7]."}},r.getUVs=function(e){var t;if(!this._accessible)throw"Not allowed to access data while accessible is false.";switch(e=null!=(t=e)?t:0){case 0:return this._uv;case 1:return this._uv1;case 2:return this._uv2;case 3:return this._uv3;case 4:return this._uv4;case 5:return this._uv5;case 6:return this._uv6;case 7:return this._uv7}throw"The index of channel needs to be in range [0 - 7]."},r.setIndices=function(t){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._indices!==t&&(this._indices=t,t instanceof Uint8Array?this._indicesFormat=e.IndexFormat.UInt8:t instanceof Uint16Array?this._indicesFormat=e.IndexFormat.UInt16:t instanceof Uint32Array&&(this._indicesFormat=e.IndexFormat.UInt32)),this._indicesChangeFlag=!0},r.getIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._indices},r.addBlendShape=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._vertexChangeFlag|=wn.BlendShape,this._useBlendShapeNormal=this._useBlendShapeNormal||e._useBlendShapeNormal,this._useBlendShapeTangent=this._useBlendShapeTangent||e._useBlendShapeTangent,this._blendShapes.push(e),this._blendShapeUpdateFlags.push(e._registerChangeFlag()),this._hasBlendShape=!0},r.clearBlendShapes=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._vertexChangeFlag|=wn.BlendShape,this._useBlendShapeNormal=!1,this._useBlendShapeTangent=!1,this._blendShapes.length=0;for(var e=this._blendShapeUpdateFlags,t=0,n=e.length;t<n;t++)e[t].destroy();e.length=0,this._hasBlendShape=!1},r.uploadData=function(t){var n,r;if(!this._accessible)throw"Not allowed to access data while accessible is false.";var i=this._indices;if(this._vertexSlotChanged){var a=this._updateVertexElements();this._setVertexElements(a),this._vertexChangeFlag=wn.All,this._vertexSlotChanged=!1}var o=this._vertexBufferBindings,s=this._elementCount,l=null===(n=o[0])||void 0===n?void 0:n._buffer,u=s*this._vertexCount;if(l&&this._verticesFloat32.length===u){if(this._vertexChangeFlag&wn.All){var c=this._verticesFloat32;this._updateVertices(c),l.setData(c)}}else{null==l||l.destroy();var d=new Float32Array(u);this._verticesFloat32=d,this._verticesUint8=new Uint8Array(d.buffer),this._vertexChangeFlag=wn.All,this._updateVertices(d);var f=new dn(this._engine,e.BufferBindFlag.VertexBuffer,d,t?e.BufferUsage.Static:e.BufferUsage.Dynamic);this._setVertexBufferBinding(0,new mn(f,4*s))}var h=null===(r=this._indexBufferBinding)||void 0===r?void 0:r._buffer;if(i)if(h&&i.byteLength==h.byteLength)this._indicesChangeFlag&&(this._indicesChangeFlag=!1,h.setData(i),this._indexBufferBinding._format!==this._indicesFormat&&this._setIndexBufferBinding(new pn(h,this._indicesFormat)));else{null==h||h.destroy();var p=new dn(this._engine,e.BufferBindFlag.IndexBuffer,i);this._setIndexBufferBinding(new pn(p,this._indicesFormat))}else h&&(h.destroy(),this._setIndexBufferBinding(null));t&&(this._accessible=!1,this._releaseCache())},r._onDestroy=function(){t.prototype._onDestroy.call(this),this._accessible&&this._releaseCache()},r._updateVertexElements=function(){var t=this._vertexElementsCache;t.length=1,t[0]=An;var n=12,r=3;this._normals&&(t.push(new un("NORMAL",n,e.VertexElementFormat.Vector3,0)),n+=12,r+=3),this._colors&&(t.push(new un("COLOR_0",n,e.VertexElementFormat.Vector4,0)),n+=16,r+=4),this._boneWeights&&(t.push(new un("WEIGHTS_0",n,e.VertexElementFormat.Vector4,0)),n+=16,r+=4),this._boneIndices&&(t.push(new un("JOINTS_0",n,e.VertexElementFormat.UByte4,0)),n+=4,r+=1),this._tangents&&(t.push(new un("TANGENT",n,e.VertexElementFormat.Vector4,0)),n+=16,r+=4),this._uv&&(t.push(new un("TEXCOORD_0",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2),this._uv1&&(t.push(new un("TEXCOORD_1",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2),this._uv2&&(t.push(new un("TEXCOORD_2",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2),this._uv3&&(t.push(new un("TEXCOORD_3",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2),this._uv4&&(t.push(new un("TEXCOORD_4",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2),this._uv5&&(t.push(new un("TEXCOORD_5",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2),this._uv6&&(t.push(new un("TEXCOORD_6",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2),this._uv7&&(t.push(new un("TEXCOORD_7",n,e.VertexElementFormat.Vector2,0)),n+=8,r+=2);for(var i=0,a=Math.min(this._blendShapes.length,4);i<a;i++)t.push(new un("POSITION_BS"+i,n,e.VertexElementFormat.Vector3,0)),n+=12,r+=3,this._useBlendShapeNormal&&(t.push(new un("NORMAL_BS"+i,n,e.VertexElementFormat.Vector3,0)),n+=12,r+=3),this._useBlendShapeTangent&&(t.push(new un("TANGENT_BS"+i,n,e.VertexElementFormat.Vector3,0)),n+=12,r+=3);return this._elementCount=r,t},r._updateVertices=function(e){var t=this._elementCount,n=this._vertexCount,r=this._positions,i=this._normals,a=this._colors,o=this._vertexChangeFlag,s=this._boneWeights,l=this._boneIndices,u=this._tangents,c=this._uv,d=this._uv1,f=this._uv2,h=this._uv3,p=this._uv4,_=this._uv5,v=this._uv6,m=this._uv7;if(o&wn.Position)for(var g=0;g<n;g++){var y=t*g,x=r[g];e[y]=x.x,e[y+1]=x.y,e[y+2]=x.z}var b=3;if(i){if(o&wn.Normal)for(var w=0;w<n;w++){var T=t*w+b,S=i[w];S&&(e[T]=S.x,e[T+1]=S.y,e[T+2]=S.z)}b+=3}if(a){if(o&wn.Color)for(var C=0;C<n;C++){var P=t*C+b,M=a[C];M&&(e[P]=M.r,e[P+1]=M.g,e[P+2]=M.b,e[P+3]=M.a)}b+=4}if(s){if(o&wn.BoneWeight)for(var A=0;A<n;A++){var E=t*A+b,R=s[A];R&&(e[E]=R.x,e[E+1]=R.y,e[E+2]=R.z,e[E+3]=R.w)}b+=4}if(l){if(o&wn.BoneIndex)for(var F=this._verticesUint8,L=0;L<n;L++){var B=t*L+b,I=l[L];if(I){var O=4*B;F[O]=I.x,F[O+1]=I.y,F[O+2]=I.z,F[O+3]=I.w}}b+=1}if(u){if(o&wn.Tangent)for(var z=0;z<n;z++){var D=t*z+b,k=u[z];k&&(e[D]=k.x,e[D+1]=k.y,e[D+2]=k.z)}b+=4}if(c){if(o&wn.UV)for(var N=0;N<n;N++){var U=t*N+b,V=c[N];V&&(e[U]=V.x,e[U+1]=V.y)}b+=2}if(d){if(o&wn.UV1)for(var G=0;G<n;G++){var H=t*G+b,W=d[G];W&&(e[H]=W.x,e[H+1]=W.y)}b+=2}if(f){if(o&wn.UV2)for(var j=0;j<n;j++){var X=t*j+b,K=f[j];K&&(e[X]=K.x,e[X+1]=K.y)}b+=2}if(h){if(o&wn.UV3)for(var q=0;q<n;q++){var Q=t*q+b,Y=h[q];Y&&(e[Q]=Y.x,e[Q+1]=Y.y)}b+=2}if(p){if(o&wn.UV4)for(var $=0;$<n;$++){var J=t*$+b,Z=p[$];Z&&(e[J]=Z.x,e[J+1]=Z.y)}b+=2}if(_){if(o&wn.UV5)for(var ee=0;ee<n;ee++){var te=t*ee+b,ne=_[ee];ne&&(e[te]=ne.x,e[te+1]=ne.y)}b+=2}if(v){if(o&wn.UV6)for(var re=0;re<n;re++){var ie=t*re+b,ae=v[re];ae&&(e[ie]=ae.x,e[ie+1]=ae.y)}b+=2}if(m){if(o&wn.UV7)for(var oe=0;oe<n;oe++){var se=t*oe+b,le=m[oe];le&&(e[se]=le.x,e[se+1]=le.y)}b+=2}if(o&wn.BlendShape){var ue=this._blendShapes,ce=this._blendShapeUpdateFlags,de=Math.min(ue.length,4);this.engine._hardwareRenderer;for(var fe=0;fe<de;fe++){var he=ce[fe];if(he.flag){var pe=ue[fe].frames,_e=pe.length,ve=pe[_e-1];if(_e>0&&ve.deltaPositions.length!==this._vertexCount)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";for(var me=ve.deltaPositions,ge=0;ge<n;ge++){var ye=t*ge+b,xe=me[ge];xe&&(e[ye]=xe.x,e[ye+1]=xe.y,e[ye+2]=xe.z)}if(b+=3,this._useBlendShapeNormal){var be=ve.deltaNormals;if(be)for(var we=0;we<n;we++){var Te=t*we+b,Se=be[we];Se&&(e[Te]=Se.x,e[Te+1]=Se.y,e[Te+2]=Se.z)}b+=3}if(this._useBlendShapeTangent){var Ce=ve.deltaTangents;if(Ce)for(var Pe=0;Pe<n;Pe++){var Me=t*Pe+b,Ae=Ce[Pe];Ae&&(e[Me]=Ae.x,e[Me+1]=Ae.y,e[Me+2]=Ae.z)}b+=3}he.flag=!1}}}this._vertexChangeFlag=0},r._releaseCache=function(){for(var e=this._blendShapeUpdateFlags,t=0,n=e.length;t<n;t++)e[t].destroy();this._verticesUint8=null,this._indices=null,this._verticesFloat32=null,this._positions.length=0,this._tangents=null,this._normals=null,this._colors=null,this._uv=null,this._uv1=null,this._uv2=null,this._uv3=null,this._uv4=null,this._uv5=null,this._uv6=null,this._uv7=null,this._blendShapes=null,this._blendShapeUpdateFlags=null},T(n,[{key:"accessible",get:function(){return this._accessible}},{key:"vertexCount",get:function(){return this._vertexCount}},{key:"blendShapes",get:function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._blendShapes}}]),n}(vn),An=new un("POSITION",0,e.VertexElementFormat.Vector3,0);!function(e){e[e.Position=1]="Position",e[e.Normal=2]="Normal",e[e.Color=4]="Color",e[e.Tangent=8]="Tangent",e[e.BoneWeight=16]="BoneWeight",e[e.BoneIndex=32]="BoneIndex",e[e.UV=64]="UV",e[e.UV1=128]="UV1",e[e.UV2=256]="UV2",e[e.UV3=512]="UV3",e[e.UV4=1024]="UV4",e[e.UV5=2048]="UV5",e[e.UV6=4096]="UV6",e[e.UV7=8192]="UV7",e[e.BlendShape=16384]="BlendShape",e[e.All=65535]="All"}(wn||(wn={}));var En,Rn,Fn,Ln,Bn,In,On,zn,Dn,kn,Nn,Un,Vn,Gn,Hn=function(e){function t(t){var n;return(n=e.call(this,null)||this).name=t,n.inverseBindMatrices=void 0,n.joints=void 0,n.skeleton=void 0,n.inverseBindMatrices=[],n.joints=[],n.skeleton="none",n}return P(t,e),t}(re),Wn=(Bn=Ln=function(e){function t(t){var n;return I(n=e.call(this,t)||this,"_mesh",Rn,L(n)),I(n,"_meshUpdateFlag",Fn,L(n)),n}P(t,e);var n=t.prototype;return n._render=function(e){var n=this._mesh;if(n){if(this._meshUpdateFlag.flag){var r=this.shaderData,i=n._vertexElements;r.disableMacro(t._uvMacro),r.disableMacro(t._normalMacro),r.disableMacro(t._tangentMacro),r.disableMacro(t._vertexColorMacro);for(var a=0,o=i.length;a<o;a++)switch(i[a].semantic){case"TEXCOORD_0":r.enableMacro(t._uvMacro);break;case"NORMAL":r.enableMacro(t._normalMacro);break;case"TANGENT":r.enableMacro(t._tangentMacro);break;case"COLOR_0":r.enableMacro(t._vertexColorMacro)}this._meshUpdateFlag.flag=!1}for(var s=n.subMeshes,l=e._renderPipeline,u=this._engine._renderElementPool,c=0,d=s.length;c<d;c++){var f=this._materials[c];if(f){var h=u.getFromPool();h.setValue(this,n,s[c],f),l.pushPrimitive(h)}}}else ce.error("mesh is null.")},n._onDestroy=function(){e.prototype._onDestroy.call(this);var t=this._mesh;t&&!t.destroyed&&(t._addRefCount(-1),this._mesh=null)},n._cloneTo=function(e){e.mesh=this._mesh},n._updateBounds=function(e){var t=this._mesh;if(t){var n=t.bounds,r=this._entity.transform.worldMatrix;o.transform(n,r,e)}else e.min.setValue(0,0,0),e.max.setValue(0,0,0)},T(t,[{key:"mesh",get:function(){return this._mesh},set:function(e){var t=this._mesh;t!==e&&(t&&(t._addRefCount(-1),this._meshUpdateFlag.destroy()),e&&(e._addRefCount(1),this._meshUpdateFlag=e.registerUpdateFlag()),this._mesh=e)}}]),t}(en),Ln._uvMacro=it.getMacroByName("O3_HAS_UV"),Ln._normalMacro=it.getMacroByName("O3_HAS_NORMAL"),Ln._tangentMacro=it.getMacroByName("O3_HAS_TANGENT"),Ln._vertexColorMacro=it.getMacroByName("O3_HAS_VERTEXCOLOR"),Rn=O((En=Bn).prototype,"_mesh",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fn=O(En.prototype,"_meshUpdateFlag",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En),jn=(Gn=Vn=function(t){function n(e){var n;return I(n=t.call(this,e)||this,"matrixPalette",On,L(n)),I(n,"jointNodes",zn,L(n)),I(n,"jointTexture",Dn,L(n)),I(n,"_hasInitJoints",kn,L(n)),I(n,"_mat",Nn,L(n)),I(n,"_useJointTexture",Un,L(n)),n._skin=void 0,n._blendShapeWeights=void 0,n._mat=new f,n._skin=null,n}P(n,t);var r=n.prototype;return r._updateShaderData=function(e){t.prototype._updateShaderData.call(this,e);var r=this.shaderData;!this._useJointTexture&&this.matrixPalette&&r.setFloatArray(n._jointMatrixProperty,this.matrixPalette);var i=this.mesh;i._hasBlendShape?(r.setFloatArray(n._blendShapeWeightsProperty,this._blendShapeWeights),r.enableMacro(n._blendShapeMacro),i._useBlendShapeNormal?r.enableMacro(n._blendShapeNormalMacro):r.disableMacro(n._blendShapeNormalMacro),i._useBlendShapeTangent?r.enableMacro(n._blendShapeTangentMacro):r.disableMacro(n._blendShapeTangentMacro)):r.disableMacro(n._blendShapeMacro)},r._initJoints=function(){var e;if(this._skin){for(var t=this._skin.joints,r=[],i=t.length-1;i>=0;i--)r[i]=this.findByNodeName(this.entity,t[i]);this.matrixPalette=new Float32Array(16*r.length),this.jointNodes=r;var a=this.entity.engine._hardwareRenderer;if(a){var o=a.renderStates.getParameter(a.gl.MAX_VERTEX_UNIFORM_VECTORS),s=Math.floor((o-20)/4),l=this.shaderData,u=null===(e=this.jointNodes)||void 0===e?void 0:e.length;if(u)if(l.enableMacro("O3_HAS_SKIN"),l.setInt(n._jointCountProperty,u),t.length>s)a.canIUseMoreJoints?this._useJointTexture=!0:ce.error("component's joints count("+t+") greater than device's MAX_VERTEX_UNIFORM_VECTORS number "+o+", and don't support jointTexture in this device. suggest joint count less than "+s+".",this);else{var c=Math.max(n._maxJoints,t.length);n._maxJoints=c,l.disableMacro("O3_USE_JOINT_TEXTURE"),l.enableMacro("O3_JOINTS_NUM",c.toString())}else l.disableMacro("O3_HAS_SKIN")}}},r.findByNodeName=function(e,t){return e?e.findByName(t)||this.findByNodeName(e.parent,t):null},r.update=function(){if(this._hasInitJoints||(this._initJoints(),this._hasInitJoints=!0),this._skin){for(var e=this.jointNodes,t=this._skin.inverseBindMatrices,n=this.matrixPalette,r=this.entity.getInvModelMatrix(),i=this._mat,a=e.length-1;a>=0;a--)i.identity(),e[a]?f.multiply(e[a].transform.worldMatrix,t[a],i):t[a].cloneTo(i),f.multiply(r,i,i),n.set(i.elements,16*a);this._useJointTexture&&this.createJointTexture()}},r.createJointTexture=function(){if(!this.jointTexture){var t=this.engine;if(!t._hardwareRenderer)return;this.jointTexture=new bn(t,4,this.jointNodes.length,e.TextureFormat.R32G32B32A32,!1),this.jointTexture.filterMode=e.TextureFilterMode.Point,this.shaderData.enableMacro("O3_USE_JOINT_TEXTURE"),this.shaderData.setTexture(n._jointSamplerProperty,this.jointTexture)}this.jointTexture.setPixelBuffer(this.matrixPalette)},T(n,[{key:"blendShapeWeights",get:function(){return this._blendShapeWeights},set:function(e){this._blendShapeWeights=e}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin=e}}]),n}(Wn),Vn._blendShapeMacro=it.getMacroByName("OASIS_BLENDSHAPE"),Vn._blendShapeNormalMacro=it.getMacroByName("OASIS_BLENDSHAPE_NORMAL"),Vn._blendShapeTangentMacro=it.getMacroByName("OASIS_BLENDSHAPE_TANGENT"),Vn._jointCountProperty=it.getPropertyByName("u_jointCount"),Vn._jointSamplerProperty=it.getPropertyByName("u_jointSampler"),Vn._jointMatrixProperty=it.getPropertyByName("u_jointMatrix"),Vn._blendShapeWeightsProperty=it.getPropertyByName("u_blendShapeWeights"),Vn._maxJoints=0,On=O((In=Gn).prototype,"matrixPalette",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zn=O(In.prototype,"jointNodes",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=O(In.prototype,"jointTexture",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn=O(In.prototype,"_hasInitJoints",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Nn=O(In.prototype,"_mat",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Un=O(In.prototype,"_useJointTexture",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),In),Xn=function(){function t(){}return t.createSphere=function(e,n,r,a){void 0===n&&(n=.5),void 0===r&&(r=18),void 0===a&&(a=!0);for(var o=new Mn(e),s=(r=Math.max(2,Math.floor(r)))+1,l=s*s,u=r*r,c=t._generateIndices(e,l,6*u),d=Math.PI,f=2*d,h=1/s,_=1/r,v=new Array(l),m=new Array(l),g=new Array(l),y=0;y<l;++y){var x=y%s*_,b=(y*h|0)*_,w=x*f,T=b*d,S=Math.sin(T),C=-n*Math.cos(w)*S,P=n*Math.cos(T),M=n*Math.sin(w)*S;v[y]=new i(C,P,M),m[y]=new i(C,P,M),g[y]=new p(x,b)}for(var A=0,E=0;E<u;++E){var R=(E*_|0)*s+E%r,F=R+1,L=R+s,B=L+1;c[A++]=F,c[A++]=R,c[A++]=B,c[A++]=R,c[A++]=L,c[A++]=B}var I=o.bounds;return I.min.setValue(-n,-n,-n),I.max.setValue(n,n,n),t._initialize(o,v,m,g,c,a),o},t.createCuboid=function(e,n,r,a,o){void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===o&&(o=!0);var s=new Mn(e),l=n/2,u=r/2,c=a/2,d=new Array(24),f=new Array(24),h=new Array(24);d[0]=new i(-l,u,-c),d[1]=new i(l,u,-c),d[2]=new i(l,u,c),d[3]=new i(-l,u,c),f[0]=new i(0,1,0),f[1]=new i(0,1,0),f[2]=new i(0,1,0),f[3]=new i(0,1,0),h[0]=new p(0,0),h[1]=new p(1,0),h[2]=new p(1,1),h[3]=new p(0,1),d[4]=new i(-l,-u,-c),d[5]=new i(l,-u,-c),d[6]=new i(l,-u,c),d[7]=new i(-l,-u,c),f[4]=new i(0,-1,0),f[5]=new i(0,-1,0),f[6]=new i(0,-1,0),f[7]=new i(0,-1,0),h[4]=new p(0,1),h[5]=new p(1,1),h[6]=new p(1,0),h[7]=new p(0,0),d[8]=new i(-l,u,-c),d[9]=new i(-l,u,c),d[10]=new i(-l,-u,c),d[11]=new i(-l,-u,-c),f[8]=new i(-1,0,0),f[9]=new i(-1,0,0),f[10]=new i(-1,0,0),f[11]=new i(-1,0,0),h[8]=new p(0,0),h[9]=new p(1,0),h[10]=new p(1,1),h[11]=new p(0,1),d[12]=new i(l,u,-c),d[13]=new i(l,u,c),d[14]=new i(l,-u,c),d[15]=new i(l,-u,-c),f[12]=new i(1,0,0),f[13]=new i(1,0,0),f[14]=new i(1,0,0),f[15]=new i(1,0,0),h[12]=new p(1,0),h[13]=new p(0,0),h[14]=new p(0,1),h[15]=new p(1,1),d[16]=new i(-l,u,c),d[17]=new i(l,u,c),d[18]=new i(l,-u,c),d[19]=new i(-l,-u,c),f[16]=new i(0,0,1),f[17]=new i(0,0,1),f[18]=new i(0,0,1),f[19]=new i(0,0,1),h[16]=new p(0,0),h[17]=new p(1,0),h[18]=new p(1,1),h[19]=new p(0,1),d[20]=new i(-l,u,-c),d[21]=new i(l,u,-c),d[22]=new i(l,-u,-c),d[23]=new i(-l,-u,-c),f[20]=new i(0,0,-1),f[21]=new i(0,0,-1),f[22]=new i(0,0,-1),f[23]=new i(0,0,-1),h[20]=new p(1,0),h[21]=new p(0,0),h[22]=new p(0,1),h[23]=new p(1,1);var _=new Uint16Array(36);_[0]=0,_[1]=2,_[2]=1,_[3]=2,_[4]=0,_[5]=3,_[6]=4,_[7]=6,_[8]=7,_[9]=6,_[10]=4,_[11]=5,_[12]=8,_[13]=10,_[14]=9,_[15]=10,_[16]=8,_[17]=11,_[18]=12,_[19]=14,_[20]=15,_[21]=14,_[22]=12,_[23]=13,_[24]=16,_[25]=18,_[26]=17,_[27]=18,_[28]=16,_[29]=19,_[30]=20,_[31]=22,_[32]=23,_[33]=22,_[34]=20,_[35]=21;var v=s.bounds;return v.min.setValue(-l,-u,-c),v.max.setValue(l,u,c),t._initialize(s,d,f,h,_,o),s},t.createPlane=function(e,n,r,a,o,s){void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===o&&(o=1),void 0===s&&(s=!0);for(var l=new Mn(e),u=(a=Math.max(1,Math.floor(a)))+1,c=n/2,d=r/2,f=n/a,h=r/(o=Math.max(1,Math.floor(o))),_=u*(o+1),v=o*a,m=t._generateIndices(e,_,6*v),g=1/u,y=1/a,x=1/o,b=new Array(_),w=new Array(_),T=new Array(_),S=0;S<_;++S){var C=S%u,P=S*g|0;b[S]=new i(C*f-c,P*h-d,0),w[S]=new i(0,0,1),T[S]=new p(C*y,1-P*x)}for(var M=0,A=0;A<v;++A){var E=(A*y|0)*u+A%a,R=E+1,F=E+u,L=F+1;m[M++]=R,m[M++]=F,m[M++]=E,m[M++]=R,m[M++]=L,m[M++]=F}var B=l.bounds;return B.min.setValue(-c,-d,0),B.max.setValue(c,d,0),t._initialize(l,b,w,T,m,s),l},t.createCylinder=function(e,n,r,a,o,s,l){void 0===n&&(n=.5),void 0===r&&(r=.5),void 0===a&&(a=2),void 0===o&&(o=20),void 0===s&&(s=1),void 0===l&&(l=!0);for(var u=new Mn(e),c=(o=Math.floor(o))+1,d=.5*a,f=a/(s=Math.floor(s)),h=c*(s+1),_=o*s,v=2*o,m=h+2+v,g=t._generateIndices(e,m,6*_+3*v),y=1/c,x=1/o,b=1/s,w=new Array(m),T=new Array(m),S=new Array(m),C=0,P=Math.PI,M=2*Math.PI,A=(r-n)/a,E=0;E<h;++E){var R=E*y|0,F=E%c*x,L=R*b,B=P+F*M,I=Math.sin(B),O=Math.cos(B),z=r-R*(r-n),D=z*I,k=R*f-d,N=z*O;w[E]=new i(D,k,N),T[E]=new i(I,A,O),S[E]=new p(F,1-L)}for(var U=0;U<_;++U){var V=(U*x|0)*c+U%o,G=V+1,H=V+c,W=H+1;g[C++]=G,g[C++]=H,g[C++]=V,g[C++]=G,g[C++]=W,g[C++]=H}w[h]=new i(0,-d,0),T[h]=new i(0,-1,0),S[h]=new p(.5,.5),w[h+1]=new i(0,d,0),T[h+1]=new i(0,1,0),S[h+1]=new p(.5,.5);for(var j=h+2,X=1/(2*n),K=1/(2*r),q=c*s,Q=0;Q<o;++Q){var Y=w[Q],$=Y.x,J=Y.z;w[j]=new i($,-d,J),T[j]=new i(0,-1,0),S[j++]=new p($*K+.5,.5-J*K);var Z=w[Q+q];$=Z.x,J=Z.z,w[j]=new i($,d,J),T[j]=new i(0,1,0),S[j++]=new p($*X+.5,J*X+.5)}for(var ee=h+1,te=h+2,ne=te+1,re=0;re<o;++re){var ie=2*re,ae=re===o-1?0:ie+2;g[C++]=h,g[C++]=te+ae,g[C++]=te+ie,g[C++]=ee,g[C++]=ne+ie,g[C++]=ne+ae}var oe=u.bounds,se=Math.max(n,r);return oe.min.setValue(-se,-d,-se),oe.max.setValue(se,d,se),t._initialize(u,w,T,S,g,l),u},t.createTorus=function(e,n,r,a,o,s,l){void 0===n&&(n=.5),void 0===r&&(r=.1),void 0===a&&(a=30),void 0===o&&(o=30),void 0===s&&(s=360),void 0===l&&(l=!0);var u=new Mn(e),c=((a=Math.floor(a))+1)*((o=Math.floor(o))+1),d=a*o,f=t._generateIndices(e,c,6*d),h=new Array(c),_=new Array(c),v=new Array(c);s=s/180*Math.PI;for(var m=0,g=0;g<=a;g++)for(var y=0;y<=o;y++){var x=y/o*s,b=g/a*Math.PI*2,w=Math.cos(b),T=Math.sin(b),S=Math.cos(x),C=Math.sin(x),P=new i((n+r*w)*S,(n+r*w)*C,r*T);h[m]=P;var M=n*S,A=n*C;_[m]=new i(P.x-M,P.y-A,P.z).normalize(),v[m++]=new p(y/o,g/a)}m=0;for(var E=1;E<=a;E++)for(var R=1;R<=o;R++){var F=(o+1)*E+R-1,L=(o+1)*(E-1)+R-1,B=(o+1)*(E-1)+R,I=(o+1)*E+R;f[m++]=F,f[m++]=L,f[m++]=I,f[m++]=L,f[m++]=B,f[m++]=I}var O=u.bounds,z=n+r;return O.min.setValue(-z,-z,-r),O.max.setValue(z,z,r),t._initialize(u,h,_,v,f,l),u},t.createCone=function(e,n,r,a,o,s){void 0===n&&(n=.5),void 0===r&&(r=2),void 0===a&&(a=20),void 0===o&&(o=1),void 0===s&&(s=!0);for(var l=new Mn(e),u=(a=Math.floor(a))+1,c=.5*r,d=r/(o=Math.floor(o)),f=u*(o+1),h=a*o,_=f+1+a,v=t._generateIndices(e,_,6*h+3*a),m=1/u,g=1/a,y=1/o,x=new Array(_),b=new Array(_),w=new Array(_),T=0,S=Math.PI,C=2*Math.PI,P=n/r,M=0;M<f;++M){var A=M*m|0,E=M%u*g,R=A*y,F=S+E*C,L=Math.sin(F),B=Math.cos(F),I=n-A*n,O=I*L,z=A*d-c,D=I*B;x[M]=new i(O,z,D),b[M]=new i(L,P,B),w[M]=new p(E,1-R)}for(var k=0;k<h;++k){var N=(k*g|0)*u+k%a,U=N+1,V=N+u,G=V+1;v[T++]=U,v[T++]=V,v[T++]=N,v[T++]=U,v[T++]=G,v[T++]=V}x[f]=new i(0,-c,0),b[f]=new i(0,-1,0),w[f]=new p(.5,.5);for(var H=f+1,W=1/(2*n),j=0;j<a;++j){var X=x[j],K=X.x,q=X.z;x[H]=new i(K,-c,q),b[H]=new i(0,-1,0),w[H++]=new p(K*W+.5,.5-q*W)}for(var Q=f+1,Y=0;Y<a;++Y){var $=Y,J=Y===a-1?0:$+1;v[T++]=f,v[T++]=Q+J,v[T++]=Q+$}var Z=l.bounds;return Z.min.setValue(-n,-c,-n),Z.max.setValue(n,c,n),t._initialize(l,x,b,w,v,s),l},t._initialize=function(e,t,n,r,i,a){e.setPositions(t),e.setNormals(n),e.setUVs(r),e.setIndices(i),e.uploadData(a),e.addSubMesh(0,i.length)},t._generateIndices=function(t,n,r){var i=null;if(n>65535){if(!t._hardwareRenderer.canIUse(e.GLCapabilityType.elementIndexUint))throw Error("The vertex count is over limit.");i=new Uint32Array(r)}else i=new Uint16Array(r);return i},t}(),Kn=function(e){function t(){return e.apply(this,arguments)||this}P(t,e);var n=t.prototype;return n.setVertexElements=function(e){this._setVertexElements(e)},n.setVertexBufferBinding=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0);var r=e,i=void 0!==r.buffer;i||(r=new mn(e,t));var a=this._vertexBufferBindings;a.length<=n&&(a.length=n+1),this._setVertexBufferBinding(i?t:n,r)},n.setVertexBufferBindings=function(e,t){void 0===t&&(t=0);var n=this._vertexBufferBindings,r=e.length,i=t+r;n.length<i&&(n.length=i);for(var a=0;a<r;a++)this._setVertexBufferBinding(t+a,e[a])},n.setIndexBufferBinding=function(e,t){var n=e;n&&(void 0!==n.buffer||(n=new pn(e,t))),this._setIndexBufferBinding(n)},T(t,[{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"vertexBufferBindings",get:function(){return this._vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}},{key:"vertexElements",get:function(){return this._vertexElements}}]),t}(vn),qn=function(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),this.weight=void 0,this.deltaPositions=void 0,this.deltaNormals=void 0,this.deltaTangents=void 0,n&&n.length!==t.length)throw"deltaNormals length must same with deltaPositions length.";if(r&&r.length!==t.length)throw"deltaTangents length must same with deltaPositions length.";this.weight=e,this.deltaPositions=t,this.deltaNormals=n,this.deltaTangents=r},Qn=function(){function e(e){this.name=void 0,this._useBlendShapeNormal=!1,this._useBlendShapeTangent=!1,this._frames=[],this._updateFlagManager=new He,this.name=e}var t=e.prototype;return t.addFrame=function(e,t,n,r){if("number"==typeof e){var i=new qn(e,t,n,r);return this._addFrame(i),i}this._addFrame(e),this._updateFlagManager.distribute()},t.clearFrames=function(){this._frames.length=0,this._updateFlagManager.distribute(),this._useBlendShapeNormal=!1,this._useBlendShapeTangent=!1},t._registerChangeFlag=function(){return this._updateFlagManager.register()},t._addFrame=function(e){var t=this._frames,n=t.length;if(n>0&&e.deltaPositions.length!==t[n-1].deltaPositions.length)throw"Frame's deltaPositions length must same with before frame deltaPositions length.";this._useBlendShapeNormal=this._useBlendShapeNormal||null!==e.deltaNormals,this._useBlendShapeTangent=this._useBlendShapeTangent||null!==e.deltaTangents,this._frames.push(e)},T(e,[{key:"frames",get:function(){return this._frames}}]),e}(),Yn=function(){function t(e){this._subMeshPool=new Nt(_n),this._batchedQueue=[],this._meshes=[],this._meshCount=1,this._vertexBuffers=[],this._indiceBuffers=[],this._vertices=void 0,this._indices=void 0,this._flushId=0,this._vertexCount=0,this._elementCount=0;var n=t.MAX_VERTEX_COUNT;this._vertices=new Float32Array(9*n),this._indices=new Uint16Array(3*n);for(var r=this._meshes,i=this._meshCount,a=0;a<i;a++)r[a]=this._createMesh(e,a)}var n=t.prototype;return n.drawElement=function(e){var n=e.positions.length;this._vertexCount+n>t.MAX_VERTEX_COUNT&&this.flush(e.camera.engine),this._vertexCount+=n,this._batchedQueue[this._elementCount++]=e},n.flush=function(e){var n=this._batchedQueue;0!==n.length&&(this._updateData(e),this.drawBatches(e),t._canUploadSameBuffer||this._flushId++,n.length=0,this._subMeshPool.resetPool(),this._vertexCount=0,this._elementCount=0)},n.clear=function(){this._flushId=0,this._vertexCount=0,this._elementCount=0,this._batchedQueue.length=0},n.destroy=function(){this._batchedQueue=null;for(var e=this._meshes,t=this._vertexBuffers,n=this._indiceBuffers,r=0,i=e.length;r<i;++r)e[r].destroy();this._meshes=null;for(var a=0,o=t.length;a<o;++a)t[a].destroy();this._vertexBuffers=null;for(var s=0,l=n.length;s<l;++s)n[s].destroy();this._indiceBuffers=null},n._createMesh=function(n,r){var i=t.MAX_VERTEX_COUNT,a=new Kn(n,"BufferMesh"+r),o=[],s=this.createVertexElements(o);return this._vertexBuffers[r]=new dn(n,e.BufferBindFlag.VertexBuffer,4*i*s,e.BufferUsage.Dynamic),this._indiceBuffers[r]=new dn(n,e.BufferBindFlag.IndexBuffer,3*i,e.BufferUsage.Dynamic),a.setVertexBufferBinding(this._vertexBuffers[r],s),a.setIndexBufferBinding(this._indiceBuffers[r],e.IndexFormat.UInt16),a.setVertexElements(o),a},n._updateData=function(e){var n=this._meshes,r=this._flushId;!t._canUploadSameBuffer&&this._meshCount<=r&&(this._meshCount++,n[r]=this._createMesh(e,r));var i=this._batchedQueue,a=this._vertices,o=this._indices,s=n[r];s.clearSubMesh();for(var l=0,u=0,c=0,d=0,f=0,h=0,p=null,_=0,v=i.length;_<v;_++){var m=i[_];l=this.updateVertices(m,a,l);for(var g=m.triangles,y=g.length,x=0;x<y;x++)o[u++]=g[x]+f;f+=m.positions.length,null===p||this.canBatch(p,m)?d+=y:(s.addSubMesh(this._getSubMeshFromPool(c,d)),c+=d,d=y,i[h++]=p),p=m}s.addSubMesh(this._getSubMeshFromPool(c,d)),i[h]=p,this._vertexBuffers[r].setData(a,0,0,l),this._indiceBuffers[r].setData(o,0,0,u)},n._getSubMeshFromPool=function(t,n){var r=this._subMeshPool.getFromPool();return r.start=t,r.count=n,r.topology=e.MeshTopology.Triangles,r},t}();Yn.MAX_VERTEX_COUNT=4096,Yn._canUploadSameBuffer=!0;var $n,Jn,Zn=function(t){function n(){return t.apply(this,arguments)||this}P(n,t);var r=n.prototype;return r.createVertexElements=function(t){return t[0]=new un("POSITION",0,e.VertexElementFormat.Vector3,0),t[1]=new un("TEXCOORD_0",12,e.VertexElementFormat.Vector2,0),20},r.canBatch=function(e,t){if(e.isAdd!==t.isAdd)return!1;var n=e.component.shaderData,r=t.component.shaderData,i=an._textureProperty,a=an._alphaCutoffProperty;return n.getTexture(i)===r.getTexture(i)&&n.getTexture(a)===r.getTexture(a)},r.updateVertices=function(e,t,n){for(var r=e.positions,i=e.uv,a=r.length,o=0;o<a;o++){var s=r[o],l=i[o];t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=l.x,t[n++]=l.y}return n},r.drawBatches=function(t){for(var n=this._meshes[this._flushId],r=n.subMeshes,i=this._batchedQueue,a=0,o=r.length;a<o;a++){var s=r[a],l=i[a];if(!s||!l)return;var u=l.component,c=l.material,d=it._compileMacros;he.unionCollection(u._globalShaderMacro,c.shaderData._macroCollection,d);var f=c.renderState.stencilState,h=l.isAdd?e.StencilOperation.IncrementSaturate:e.StencilOperation.DecrementSaturate;f.passOperationFront=h,f.passOperationBack=h;var p=c.shader._getShaderProgram(t,d);if(!p.isValid)return;var _=l.camera;p.bind(),p.groupingOtherUniformBlock(),p.uploadAll(p.sceneUniformBlock,_.scene.shaderData),p.uploadAll(p.cameraUniformBlock,_.shaderData),p.uploadAll(p.rendererUniformBlock,u.shaderData),p.uploadAll(p.materialUniformBlock,c.shaderData),c.renderState._apply(t),t._hardwareRenderer.drawPrimitive(n,s,p)}},n}(Yn),er=function(){function t(e){this._batcher=void 0,this._preMaskLayer=0,this._batcher=new Zn(e)}var n=t.prototype;return n.clear=function(){this._preMaskLayer=0,this._batcher.clear()},n.preRender=function(t,n){n.maskInteraction!==e.SpriteMaskInteraction.None&&(this._batcher.clear(),this._processMasksDiff(t,n),this._batcher.flush(t.engine))},n.postRender=function(t){t.maskInteraction!==e.SpriteMaskInteraction.None&&(this._preMaskLayer=t.maskLayer)},n.destroy=function(){this._batcher.destroy(),this._batcher=null},n._processMasksDiff=function(e,t){var n=this._preMaskLayer,r=t.maskLayer;if(n!==r)for(var i=e._renderPipeline._allSpriteMasks,a=n&r,o=r&~n,s=n&~r,l=i._elements,u=0,c=i.length;u<c;u++){var d=l[u],f=d.influenceLayers;if(!(f&a))if(f&o){var h=d._maskElement;h.isAdd=!0,this._batcher.drawElement(h)}else if(f&s){var p=d._maskElement;p.isAdd=!1,this._batcher.drawElement(p)}}},t}();e.BackgroundMode=void 0,($n=e.BackgroundMode||(e.BackgroundMode={}))[$n.SolidColor=0]="SolidColor",$n[$n.Sky=1]="Sky",$n[$n.Texture=2]="Texture",function(e){e[e.AspectFitWidth=0]="AspectFitWidth",e[e.AspectFitHeight=1]="AspectFitHeight",e[e.Fill=2]="Fill"}(Jn||(Jn={}));var tr,nr=function(){this.material=void 0,this.mesh=void 0,this._matrix=new f},rr=function(){function t(t){this._engine=t,this.mode=e.BackgroundMode.SolidColor,this.solidColor=new m(.25,.25,.25,1),this.sky=new nr,this._textureFillMode=Jn.AspectFitHeight,this._texture=null}return t.prototype._resizeBackgroundTexture=function(){if(this._texture){var e=this._engine.canvas,t=e.width,n=e.height,r=this._engine._backgroundTextureMesh,i=r.getPositions();switch(this._textureFillMode){case Jn.Fill:i[0].setValue(-1,-1,1),i[1].setValue(1,-1,1),i[2].setValue(-1,1,1),i[3].setValue(1,1,1);break;case Jn.AspectFitWidth:var a=this._texture.height*t/this.texture.width/n;i[0].setValue(-1,-a,1),i[1].setValue(1,-a,1),i[2].setValue(-1,a,1),i[3].setValue(1,a,1);break;case Jn.AspectFitHeight:var o=this._texture.width*n/this.texture.height/t;i[0].setValue(-o,-1,1),i[1].setValue(o,-1,1),i[2].setValue(-o,1,1),i[3].setValue(o,1,1)}r.setPositions(i),r.uploadData(!1)}},T(t,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._engine._backgroundTextureMaterial.shaderData.setTexture("u_baseTexture",e))}},{key:"textureFillMode",get:function(){return this._textureFillMode},set:function(e){e!==this._textureFillMode&&(this._textureFillMode=e,this._resizeBackgroundTexture())}}]),t}();e.DiffuseMode=void 0,(tr=e.DiffuseMode||(e.DiffuseMode={}))[tr.SolidColor=0]="SolidColor",tr[tr.SphericalHarmonics=1]="SphericalHarmonics";var ir=function(){function t(n){this._scene=void 0,this._diffuseSphericalHarmonics=void 0,this._diffuseSolidColor=new m(.212,.227,.259),this._diffuseIntensity=1,this._specularReflection=void 0,this._specularIntensity=1,this._diffuseMode=e.DiffuseMode.SolidColor,this._shArray=new Float32Array(27),this._scene=n;var r=this._scene.shaderData;r.setColor(t._diffuseColorProperty,this._diffuseSolidColor),r.setFloat(t._diffuseIntensityProperty,this._diffuseIntensity),r.setFloat(t._specularIntensityProperty,this._specularIntensity)}return t.prototype._preComputeSH=function(e,t){var n=e.coefficients;return t[0]=.886227*n[0],t[1]=.886227*n[1],t[2]=.886227*n[2],t[3]=-1.023327*n[3],t[4]=-1.023327*n[4],t[5]=-1.023327*n[5],t[6]=1.023327*n[6],t[7]=1.023327*n[7],t[8]=1.023327*n[8],t[9]=-1.023327*n[9],t[10]=-1.023327*n[10],t[11]=-1.023327*n[11],t[12]=.858086*n[12],t[13]=.858086*n[13],t[14]=.858086*n[14],t[15]=-.858086*n[15],t[16]=-.858086*n[16],t[17]=-.858086*n[17],t[18]=.247708*n[18],t[19]=.247708*n[19],t[20]=.247708*n[20],t[21]=-.858086*n[21],t[22]=-.858086*n[22],t[23]=-.858086*n[23],t[24]=.429042*n[24],t[25]=.429042*n[25],t[26]=.429042*n[26],t},T(t,[{key:"diffuseMode",get:function(){return this._diffuseMode},set:function(n){this._diffuseMode=n,n===e.DiffuseMode.SphericalHarmonics?this._scene.shaderData.enableMacro(t._shMacro):this._scene.shaderData.disableMacro(t._shMacro)}},{key:"diffuseSolidColor",get:function(){return this._diffuseSolidColor},set:function(e){e!==this._diffuseSolidColor&&e.cloneTo(this._diffuseSolidColor)}},{key:"diffuseSphericalHarmonics",get:function(){return this._diffuseSphericalHarmonics},set:function(e){this._diffuseSphericalHarmonics=e;var n=this._scene.shaderData;e&&n.setFloatArray(t._diffuseSHProperty,this._preComputeSH(e,this._shArray))}},{key:"diffuseIntensity",get:function(){return this._diffuseIntensity},set:function(e){this._diffuseIntensity=e,this._scene.shaderData.setFloat(t._diffuseIntensityProperty,e)}},{key:"specularTexture",get:function(){return this._specularReflection},set:function(e){this._specularReflection=e;var n=this._scene.shaderData;e?(n.setTexture(t._specularTextureProperty,e),n.setFloat(t._mipLevelProperty,this._specularReflection.mipmapCount),n.enableMacro(t._specularMacro)):n.disableMacro(t._specularMacro)}},{key:"specularIntensity",get:function(){return this._specularIntensity},set:function(e){this._specularIntensity=e,this._scene.shaderData.setFloat(t._specularIntensityProperty,e)}}]),t}();ir._shMacro=it.getMacroByName("O3_USE_SH"),ir._specularMacro=it.getMacroByName("O3_USE_SPECULAR_ENV"),ir._diffuseColorProperty=it.getPropertyByName("u_envMapLight.diffuse"),ir._diffuseSHProperty=it.getPropertyByName("u_env_sh"),ir._diffuseIntensityProperty=it.getPropertyByName("u_envMapLight.diffuseIntensity"),ir._specularTextureProperty=it.getPropertyByName("u_env_specularSampler"),ir._specularIntensityProperty=it.getPropertyByName("u_envMapLight.specularIntensity"),ir._mipLevelProperty=it.getPropertyByName("u_envMapLight.mipMapLevel");var ar=function(){function e(){}var t=e.prototype;return t.preUpdate=function(e){},t.postUpdate=function(e){},t.preRender=function(e,t){},t.postRender=function(e,t){},t.destroy=function(e){},e}(),or=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this)._viewMat=void 0,t._inverseViewMat=void 0,t}P(t,e);var n=t.prototype;return n._onEnable=function(){this.scene.findFeature(cr).attachRenderLight(this)},n._onDisable=function(){this.scene.findFeature(cr).detachRenderLight(this)},T(t,[{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new f),f.invert(this.entity.transform.worldMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._inverseViewMat||(this._inverseViewMat=new f),f.invert(this.viewMatrix,this._inverseViewMat),this._inverseViewMat}}]),t}(Ve);or._maxLight=10;var sr=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).color=new m(1,1,1,1),t.intensity=1,t._forward=new i,t._lightColor=new m(1,1,1,1),t._reverseDirection=new i,t}return P(t,e),t._updateShaderData=function(e){var n=t._combinedData;e.setFloatArray(t._colorProperty,n.color),e.setFloatArray(t._directionProperty,n.direction)},t.prototype._appendData=function(e){var n=3*e,r=3*e,i=this.lightColor,a=this.direction,o=t._combinedData;o.color[n]=i.r,o.color[n+1]=i.g,o.color[n+2]=i.b,o.direction[r]=a.x,o.direction[r+1]=a.y,o.direction[r+2]=a.z},T(t,[{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}},{key:"reverseDirection",get:function(){return i.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}}]),t}(or);sr._colorProperty=it.getPropertyByName("u_directLightColor"),sr._directionProperty=it.getPropertyByName("u_directLightDirection"),sr._combinedData={color:new Float32Array(3*or._maxLight),direction:new Float32Array(3*or._maxLight)};var lr=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).color=new m(1,1,1,1),t.intensity=1,t.distance=100,t._lightColor=new m(1,1,1,1),t}return P(t,e),t._updateShaderData=function(e){var n=t._combinedData;e.setFloatArray(t._colorProperty,n.color),e.setFloatArray(t._positionProperty,n.position),e.setFloatArray(t._distanceProperty,n.distance)},t.prototype._appendData=function(e){var n=3*e,r=3*e,i=e,a=this.lightColor,o=this.position,s=t._combinedData;s.color[n]=a.r,s.color[n+1]=a.g,s.color[n+2]=a.b,s.position[r]=o.x,s.position[r+1]=o.y,s.position[r+2]=o.z,s.distance[i]=this.distance},T(t,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),t}(or);lr._colorProperty=it.getPropertyByName("u_pointLightColor"),lr._positionProperty=it.getPropertyByName("u_pointLightPosition"),lr._distanceProperty=it.getPropertyByName("u_pointLightDistance"),lr._combinedData={color:new Float32Array(3*or._maxLight),position:new Float32Array(3*or._maxLight),distance:new Float32Array(or._maxLight)};var ur=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).color=new m(1,1,1,1),t.intensity=1,t.distance=100,t.angle=Math.PI/6,t.penumbra=Math.PI/12,t._forward=new i,t._lightColor=new m(1,1,1,1),t._inverseDirection=new i,t}return P(t,e),t._updateShaderData=function(e){var n=t._combinedData;e.setFloatArray(t._colorProperty,n.color),e.setFloatArray(t._positionProperty,n.position),e.setFloatArray(t._directionProperty,n.direction),e.setFloatArray(t._distanceProperty,n.distance),e.setFloatArray(t._angleCosProperty,n.angleCos),e.setFloatArray(t._penumbraCosProperty,n.penumbraCos)},t.prototype._appendData=function(e){var n=3*e,r=3*e,i=3*e,a=e,o=e,s=e,l=this.lightColor,u=this.position,c=this.direction,d=t._combinedData;d.color[n]=l.r,d.color[n+1]=l.g,d.color[n+2]=l.b,d.position[r]=u.x,d.position[r+1]=u.y,d.position[r+2]=u.z,d.direction[i]=c.x,d.direction[i+1]=c.y,d.direction[i+2]=c.z,d.distance[a]=this.distance,d.angleCos[s]=Math.cos(this.angle),d.penumbraCos[o]=Math.cos(this.angle+this.penumbra)},T(t,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"reverseDirection",get:function(){return i.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),t}(or);ur._colorProperty=it.getPropertyByName("u_spotLightColor"),ur._positionProperty=it.getPropertyByName("u_spotLightPosition"),ur._directionProperty=it.getPropertyByName("u_spotLightDirection"),ur._distanceProperty=it.getPropertyByName("u_spotLightDistance"),ur._angleCosProperty=it.getPropertyByName("u_spotLightAngleCos"),ur._penumbraCosProperty=it.getPropertyByName("u_spotLightPenumbraCos"),ur._combinedData={color:new Float32Array(3*or._maxLight),position:new Float32Array(3*or._maxLight),direction:new Float32Array(3*or._maxLight),distance:new Float32Array(or._maxLight),angleCos:new Float32Array(or._maxLight),penumbraCos:new Float32Array(or._maxLight)};var cr=function(e){function t(){var t;return(t=e.call(this)||this).visibleLights=void 0,t.visibleLights=[],t}P(t,e);var n=t.prototype;return n.attachRenderLight=function(e){-1==this.visibleLights.indexOf(e)?this.visibleLights.push(e):ce.warn("Light already attached.")},n.detachRenderLight=function(e){var t=this.visibleLights.indexOf(e);-1!=t&&this.visibleLights.splice(t,1)},n._updateShaderData=function(e){for(var t=0,n=0,r=0,i=this.visibleLights,a=0,o=i.length;a<o;a++){var s=i[a];s instanceof sr?s._appendData(t++):s instanceof lr?s._appendData(n++):s instanceof ur&&s._appendData(r++)}t?(sr._updateShaderData(e),e.enableMacro("O3_DIRECT_LIGHT_COUNT",t.toString())):e.disableMacro("O3_DIRECT_LIGHT_COUNT"),n?(lr._updateShaderData(e),e.enableMacro("O3_POINT_LIGHT_COUNT",n.toString())):e.disableMacro("O3_POINT_LIGHT_COUNT"),r?(ur._updateShaderData(e),e.enableMacro("O3_SPOT_LIGHT_COUNT",r.toString())):e.disableMacro("O3_SPOT_LIGHT_COUNT")},t}(ar),dr=function(e){function t(n,r){var i;(i=e.call(this,n)||this).name=void 0,i.background=new rr(i._engine),i.ambientLight=void 0,i.shaderData=new lt(qe.Scene),i._activeCameras=[],i._isActiveInEngine=!1,i._destroyed=!1,i._rootEntities=[],i.features=[],i.name=r||"";var a=i.shaderData;return t.sceneFeatureManager.addObject(L(i)),a._addRefCount(1),i.ambientLight=new ir(L(i)),i}P(t,e);var n=t.prototype;return n.createRootEntity=function(e){var t=new Xe(this._engine,e);return this.addRootEntity(t),t},n.addRootEntity=function(e){var t=e._isRoot;t||(e._isRoot=!0,e._removeFromParent());var n=e._scene;n!==this?(n&&t&&n._removeEntity(e),this._rootEntities.push(e),Xe._traverseSetOwnerScene(e,this)):t||this._rootEntities.push(e),this._isActiveInEngine?!e._isActiveInHierarchy&&e._isActive&&e._processActive():e._isActiveInHierarchy&&e._processInActive()},n.removeRootEntity=function(e){e._isRoot&&e._scene==this&&(this._removeEntity(e),this._isActiveInEngine&&e._processInActive(),Xe._traverseSetOwnerScene(e,null))},n.getRootEntity=function(e){return void 0===e&&(e=0),this._rootEntities[e]},n.findEntityByName=function(e){for(var t=this._rootEntities,n=t.length-1;n>=0;n--){var r=t[n];if(r.name===e)return r}for(var i=t.length-1;i>=0;i--){var a=t[i].findByName(e);if(a)return a}return null},n.findEntityByPath=function(e){for(var t=e.split("/").filter(Boolean),n=0,r=this.rootEntitiesCount;n<r;n++){var i=this.getRootEntity(n);if(i.name==t[0]){for(var a=1,o=t.length;a<o&&(i=Xe._findChildByName(i,t[a]));++a);return i}}return null},n.destroy=function(){if(!this._destroyed){this._isActiveInEngine&&(this._engine.sceneManager.activeScene=null),t.sceneFeatureManager.callFeatureMethod(this,"destroy",[this]);for(var e=0,n=this.rootEntitiesCount;e<n;e++)this._rootEntities[e].destroy();this._rootEntities.length=0,this._activeCameras.length=0,t.sceneFeatureManager._objects=[],this.shaderData._addRefCount(-1),this._destroyed=!0}},n._attachRenderCamera=function(e){-1===this._activeCameras.indexOf(e)?this._activeCameras.push(e):ce.warn("Camera already attached.")},n._detachRenderCamera=function(e){var t=this._activeCameras.indexOf(e);-1!==t&&this._activeCameras.splice(t,1)},n._processActive=function(e){this._isActiveInEngine=e;for(var t=this._rootEntities,n=t.length-1;n>=0;n--){var r=t[n];r._isActive&&(e?r._processActive():r._processInActive())}},n._updateShaderData=function(){this.findFeature(cr)._updateShaderData(this.shaderData)},n._removeEntity=function(e){var t=this._rootEntities;t.splice(t.indexOf(e),1)},t.registerFeature=function(e){t.sceneFeatureManager.registerFeature(e)},n.findFeature=function(e){return t.sceneFeatureManager.findFeature(this,e)},n.raycast=function(e,t,n){},T(t,[{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}},{key:"destroyed",get:function(){return this._destroyed}}]),t}(re);dr.sceneFeatureManager=new Ke;var fr=function(){function e(e){this.engine=e,this._activeScene=void 0}var t=e.prototype;return t.loadScene=function(e,t){var n=this;void 0===t&&(t=!0);var r=this.engine.resourceManager.load(e);return r.then((function(e){var r=n._activeScene;n.activeScene=e,r&&t&&r.destroy()})),r},t.mergeScenes=function(e,t){for(var n=e.rootEntities,r=0,i=n.length;r<i;r++)t.addRootEntity(n[r])},T(e,[{key:"activeScene",get:function(){return this._activeScene},set:function(e){var t=this._activeScene;t!==e&&(t&&t._processActive(!1),e&&e._processActive(!0),this._activeScene=e)}}]),e}(),hr="#define GLSLIFY 1\n#include <common_vert>\n#include <blendShape_input>\n#include <normal_share>\n#include <shadow_share>\nvoid main(){\n#include <begin_position_vert>\n#include <begin_normal_vert>\n#include <blendShape_vert>\n#include <skinning_vert>\n#include <shadow_vert>\n#include <position_vert>\n}",pr=function(){function e(){}return e.init=function(){it.create("blinn-phong","#define GLSLIFY 1\n#include <common>\n#include <common_vert>\n#include <blendShape_input>\n#include <uv_share>\n#include <color_share>\n#include <normal_share>\n#include <worldpos_share>\n#include <shadow_share>\n#include <fog_share>\nvoid main(){\n#include <begin_position_vert>\n#include <begin_normal_vert>\n#include <blendShape_vert>\n#include <skinning_vert>\n#include <uv_vert>\n#include <color_vert>\n#include <normal_vert>\n#include <worldpos_vert>\n#include <shadow_vert>\n#include <position_vert>\n#include <fog_vert>\n}","#define GLSLIFY 1\n#include <common>\n#include <common_frag>\n#include <uv_share>\n#include <normal_share>\n#include <color_share>\n#include <worldpos_share>\n#include <pbr_envmap_light_frag_define>\n#include <direct_light_frag>\n#include <point_light_frag>\n#include <spot_light_frag>\n#include <mobile_material_frag>\n#include <fog_share>\n#include <normal_get>\nvoid main(){\n#include <begin_mobile_frag>\n#include <begin_viewdir_frag>\n#include <mobile_blinnphong_frag>\ngl_FragColor=emission+ambient+diffuse+specular;gl_FragColor.a=diffuse.a;\n#include <fog_frag>\n}"),it.create("pbr","#define GLSLIFY 1\n#include <common>\n#include <common_vert>\n#include <blendShape_input>\n#include <uv_share>\n#include <color_share>\n#include <normal_share>\n#include <worldpos_share>\n#include <shadow_share>\n#include <fog_share>\nvoid main(){\n#include <begin_position_vert>\n#include <begin_normal_vert>\n#include <blendShape_vert>\n#include <skinning_vert>\n#include <uv_vert>\n#include <color_vert>\n#include <normal_vert>\n#include <worldpos_vert>\n#include <shadow_vert>\n#include <position_vert>\n#include <fog_vert>\n}","#define GLSLIFY 1\n#include <common>\n#include <common_frag>\n#include <pbr_common_frag_define>\n#include <pbr_util_frag_define>\n#include <fog_share>\n#include <uv_share>\n#include <normal_share>\n#include <color_share>\n#include <worldpos_share>\n#include <direct_light_frag>\n#include <point_light_frag>\n#include <spot_light_frag>\n#include <pbr_envmap_light_frag_define>\n#include <pbr_base_frag_define>\n#include <pbr_texture_frag_define>\n#include <pbr_runtime_frag_define>\n#include <normal_get>\n#include <pbr_brdf_cook_torrance_frag_define>\n#include <pbr_direct_irradiance_frag_define>\n#include <pbr_ibl_diffuse_frag_define>\n#include <pbr_ibl_specular_frag_define>\nvoid main(){\n#include <pbr_begin_frag>\n#include <pbr_direct_irradiance_frag>\n#include <pbr_ibl_diffuse_frag>\n#include <pbr_ibl_specular_frag>\n#include <pbr_end_frag>\n#include <gamma_frag>\n#include <fog_frag>\n}"),it.create("unlit","#define GLSLIFY 1\n#include <common_vert>\n#include <blendShape_input>\n#include <uv_share>\n#include <fog_share>\nvoid main(){\n#include <begin_position_vert>\n#include <blendShape_vert>\n#include <skinning_vert>\n#include <uv_vert>\n#include <position_vert>\n#include <fog_vert>\n}","#define GLSLIFY 1\n#include <uv_share>\n#include <fog_share>\nuniform vec4 u_baseColor;uniform float u_alphaCutoff;\n#ifdef O3_BASE_TEXTURE\nuniform sampler2D u_baseTexture;\n#endif\nvoid main(){vec4 baseColor=u_baseColor;\n#ifdef O3_BASE_TEXTURE\nbaseColor*=texture2D(u_baseTexture,v_uv);\n#endif\n#ifdef ALPHA_CUTOFF\nif(baseColor.a<u_alphaCutoff){discard;}\n#endif\ngl_FragColor=baseColor;\n#include <fog_frag>\n}"),it.create("shadow-map",hr,"#define GLSLIFY 1\n/***Decompose and save depth value.*/vec4 pack(float depth){const vec4 bitShift=vec4(1.0,256.0,256.0*256.0,256.0*256.0*256.0);const vec4 bitMask=vec4(1.0/256.0,1.0/256.0,1.0/256.0,0.0);vec4 rgbaDepth=fract(depth*bitShift);rgbaDepth-=rgbaDepth.gbaa*bitMask;return rgbaDepth;}void main(){gl_FragColor=pack(gl_FragCoord.z);}"),it.create("shadow",hr,"#define GLSLIFY 1\n#ifdef O3_SHADOW_MAP_COUNT\nuniform float u_shadowBias[O3_SHADOW_MAP_COUNT];uniform float u_shadowIntensity[O3_SHADOW_MAP_COUNT];uniform float u_shadowRadius[O3_SHADOW_MAP_COUNT];uniform vec2 u_shadowMapSize[O3_SHADOW_MAP_COUNT];uniform sampler2D u_shadowMaps[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];const vec4 bitShift=vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0));/***Unpack depth value.*/float unpack(const in vec4 rgbaDepth){return dot(rgbaDepth,bitShift);}/***Degree of shadow.*/float getVisibility(vec4 positionFromLight,const in sampler2D shadowMap,vec2 mapSize,float intensity,float bias,float radius){vec3 shadowCoord=(positionFromLight.xyz/positionFromLight.w)/2.0+0.5;float filterX=step(0.0,shadowCoord.x)*(1.0-step(1.0,shadowCoord.x));float filterY=step(0.0,shadowCoord.y)*(1.0-step(1.0,shadowCoord.y));shadowCoord.z-=bias;vec2 texelSize=vec2(1.0)/mapSize;float visibility=0.0;for(float y=-1.0;y<=1.0;y+=1.0){for(float x=-1.0;x<=1.0;x+=1.0){vec2 uv=shadowCoord.xy+texelSize*vec2(x,y)*radius;vec4 rgbaDepth=texture2D(shadowMap,uv);float depth=unpack(rgbaDepth);visibility+=step(depth,shadowCoord.z)*intensity;}}visibility*=(1.0/9.0);return visibility*filterX*filterY;}\n#endif\nvoid main(){vec4 shadowColor=vec4(1.0,1.0,1.0,1.0);\n#ifdef O3_SHADOW_MAP_COUNT\nfloat visibility=1.0;\n#if (O3_SHADOW_MAP_COUNT == 1)\nvisibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);\n#elif (O3_SHADOW_MAP_COUNT == 2)\nvisibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);\n#elif (O3_SHADOW_MAP_COUNT == 3)\nvisibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);visibility-=getVisibility(v_PositionFromLight[2],u_shadowMaps[2],u_shadowMapSize[2],u_shadowIntensity[2],u_shadowBias[2],u_shadowRadius[2]);\n#endif\nvisibility=clamp(visibility,0.0,1.0);shadowColor=vec4(visibility,visibility,visibility,1.0);\n#endif\ngl_FragColor=shadowColor;}"),it.create("skybox","#define GLSLIFY 1\n#include <common_vert>\nuniform mat4 u_mvpNoscale;varying vec3 v_cubeUV;void main(){v_cubeUV=POSITION.xyz;gl_Position=u_mvpNoscale*vec4(POSITION,1.0);gl_Position.z=gl_Position.w;}","#define GLSLIFY 1\nuniform samplerCube u_cube;varying vec3 v_cubeUV;void main(){gl_FragColor=textureCube(u_cube,v_cubeUV);}"),it.create("particle-shader","#define GLSLIFY 1\nattribute vec3 a_position;attribute vec3 a_velocity;attribute vec3 a_acceleration;attribute vec4 a_color;attribute vec4 a_lifeAndSize;attribute vec2 a_rotation;attribute vec3 a_uv;attribute vec2 a_normalizedUv;uniform float u_time;uniform bool u_once;uniform mat4 u_MVPMat;varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;\n#ifdef is2d\nuniform mat4 u_viewInvMat;uniform mat4 u_projMat;uniform mat4 u_viewMat;uniform mat4 u_modelMat;\n#endif\nmat2 rotation2d(float angle){float s=sin(angle);float c=cos(angle);return mat2(c,-s,s,c);}void main(){v_color=a_color;v_uv=a_uv.xy;float life=a_lifeAndSize.y;float startTime=a_lifeAndSize.x;float deltaTime=max(mod(u_time-startTime,life),0.0);if((u_once&&u_time>life+startTime)){deltaTime=0.0;}v_lifeLeft=1.0-deltaTime/life;float scale=a_lifeAndSize.z;vec3 position=a_position+(a_velocity+a_acceleration*deltaTime*0.5)*deltaTime;\n#ifdef isScaleByLifetime\nscale*=v_lifeLeft;\n#else\nscale*=pow(a_lifeAndSize.w,deltaTime);\n#endif\n#ifdef rotateToVelocity\nvec3 v=a_velocity+a_acceleration*deltaTime;float angle=atan(v.z,v.x)*2.0;\n#else\nfloat deltaAngle=deltaTime*a_rotation.y;float angle=a_rotation.x+deltaAngle;\n#endif\n#ifdef is2d\nvec2 rotatedPoint=rotation2d(angle)*vec2(a_normalizedUv.x,a_normalizedUv.y*a_uv.z);vec3 basisX=u_viewInvMat[0].xyz;vec3 basisZ=u_viewInvMat[1].xyz;vec3 localPosition=vec3(basisX*rotatedPoint.x+basisZ*rotatedPoint.y)*scale+position;gl_Position=u_projMat*u_viewMat*vec4(localPosition+u_modelMat[3].xyz,1.);\n#else\n#ifdef rotateToVelocity\nfloat s=sin(angle);float c=cos(angle);\n#else\nfloat s=sin(angle);float c=cos(angle);\n#endif\nvec4 rotatedPoint=vec4((a_normalizedUv.x*c+a_normalizedUv.y*a_uv.z*s)*scale,0.,(a_normalizedUv.x*s-a_normalizedUv.y*a_uv.z*c)*scale,1.);vec4 orientation=vec4(0,0,0,1);vec4 q2=orientation+orientation;vec4 qx=orientation.xxxw*q2.xyzx;vec4 qy=orientation.xyyw*q2.xyzy;vec4 qz=orientation.xxzw*q2.xxzz;mat4 localMatrix=mat4((1.0-qy.y)-qz.z,qx.y+qz.w,qx.z-qy.w,0,qx.y-qz.w,(1.0-qx.x)-qz.z,qy.z+qx.w,0,qx.z+qy.w,qy.z-qx.w,(1.0-qx.x)-qy.y,0,position.x,position.y,position.z,1);rotatedPoint=localMatrix*rotatedPoint;gl_Position=u_MVPMat*rotatedPoint;\n#endif\n}","#define GLSLIFY 1\nvarying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;uniform sampler2D u_texture;void main(){if(v_lifeLeft==1.0){discard;}float alphaFactor=1.0;\n#ifdef fadeIn\nfloat fadeInFactor=step(0.5,v_lifeLeft);alphaFactor=2.0*fadeInFactor*(1.0-v_lifeLeft)+(1.0-fadeInFactor);\n#endif\n#ifdef fadeOut\nfloat fadeOutFactor=step(0.5,v_lifeLeft);alphaFactor=alphaFactor*2.0*(1.0-fadeOutFactor)*v_lifeLeft+alphaFactor*fadeOutFactor;\n#endif\n#ifdef particleTexture\nvec4 tex=texture2D(u_texture,v_uv);\n#ifdef useOriginColor\ngl_FragColor=vec4(tex.rgb,alphaFactor*tex.a*v_color.w);\n#else\ngl_FragColor=vec4(v_color.xyz*tex.rgb,alphaFactor*tex.a*v_color.w);\n#endif\n#else\ngl_FragColor=vec4(v_color.xyz,alphaFactor*v_color.w);\n#endif\n}"),it.create("SpriteMask","precision highp float;\n#define GLSLIFY 1\nuniform mat4 u_VPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=u_VPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}","precision mediump float;precision mediump int;\n#define GLSLIFY 1\nuniform sampler2D u_maskTexture;uniform float u_maskAlphaCutoff;varying vec2 v_uv;void main(){vec4 color=texture2D(u_maskTexture,v_uv);if(color.a<u_maskAlphaCutoff){discard;}gl_FragColor=color;}"),it.create("Sprite","precision highp float;\n#define GLSLIFY 1\n#ifdef USE_MODEL_MATRIX\nuniform mat4 u_MVPMat;\n#else\nuniform mat4 u_VPMat;\n#endif\nattribute vec3 POSITION;attribute vec2 TEXCOORD_0;attribute vec4 COLOR_0;varying vec2 v_uv;varying vec4 v_color;void main(){\n#ifdef USE_MODEL_MATRIX\ngl_Position=u_MVPMat*vec4(POSITION,1.0);\n#else\ngl_Position=u_VPMat*vec4(POSITION,1.0);\n#endif\nv_uv=TEXCOORD_0;v_color=COLOR_0;}","precision mediump float;precision mediump int;\n#define GLSLIFY 1\n#ifdef USE_CUSTOM_TEXTURE\nuniform sampler2D u_cusTomTexture;\n#else\nuniform sampler2D u_spriteTexture;\n#endif\nvarying vec2 v_uv;varying vec4 v_color;void main(){\n#ifdef USE_CUSTOM_TEXTURE\nvec4 baseColor=texture2D(u_cusTomTexture,v_uv);\n#else\nvec4 baseColor=texture2D(u_spriteTexture,v_uv);\n#endif\ngl_FragColor=baseColor*v_color;}"),it.create("background-texture","#define GLSLIFY 1\nattribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION,1.0);v_uv=TEXCOORD_0;}","#define GLSLIFY 1\nuniform sampler2D u_baseTexture;varying vec2 v_uv;void main(){gl_FragColor=texture2D(u_baseTexture,v_uv);}")},e}(),_r=function(){function e(){this._cacheHierarchy=1,this._cacheMap=Object.create(null),this._lastQueryMap=void 0,this._lastQueryKey=void 0}var t=e.prototype;return t.get=function(e){var t=this._cacheMap,n=e._length;n>this._cacheHierarchy&&this._resizeCacheMapHierarchy(t,0,n);for(var r=e._mask,i=e._length-1,a=this._cacheHierarchy-1,o=0;o<a;o++){var s=i<o?0:r[o],l=t[s];l||(t[s]=l=Object.create(null)),t=l}var u=i<a?0:r[a],c=t[u];return c||(this._lastQueryKey=u,this._lastQueryMap=t),c},t.cache=function(e){this._lastQueryMap[this._lastQueryKey]=e},t._resizeCacheMapHierarchy=function(e,t,n){var r=this._cacheHierarchy-1;if(t==r){for(var i in e)for(var a=e[i],o=0,s=n-r;o<s;o++)o==s-1?e[0]=a:e=e[0==o?i:0]=Object.create(null);this._cacheHierarchy=n}else for(var l in e)this._resizeCacheMapHierarchy(e[l],++t,n)},e}(),vr=function(e){function t(){var t;return(t=e.call(this)||this).colliders=void 0,t.colliders=[],t}P(t,e);var n=t.prototype;return n.attachCollider=function(e){this.colliders.push(e)},n.detachCollider=function(e){var t=this.colliders.indexOf(e);-1!=t&&this.colliders.splice(t,1)},t}(ar),mr=function(e){function t(t){return e.call(this,t)||this}P(t,e);var n=t.prototype;return n._onEnable=function(){this.scene.findFeature(vr).attachCollider(this)},n._onDisable=function(){this.scene.findFeature(vr).detachCollider(this)},n._updateHitResult=function(e,t,n,r,a){void 0===a&&(a=!1),e.getPoint(t,n.point),a||i.transformCoordinate(n.point,this.entity.transform.worldMatrix,n.point),n.distance=i.distance(r,n.point),n.collider=this},n._getLocalRay=function(e){var n=this.entity.getInvModelMatrix(),r=t._ray;return i.transformCoordinate(e.origin,n,r.origin),i.transformNormal(e.direction,n,r.direction),r.direction.normalize(),r},n._raycast=function(e,t){throw"Error: use concrete type instead!"},t}(Ve);mr._ray=new h;var gr=function(e){function t(t){var n;return(n=e.call(this,t)||this).boxMin=void 0,n.boxMax=void 0,n._corners=[],n._cornerFlag=!1,n.boxMin=new i(-.5,-.5,-.5),n.boxMax=new i(.5,.5,.5),n}P(t,e);var n=t.prototype;return n.setBoxMinMax=function(e,t){this.boxMin=e,this.boxMax=t,this._cornerFlag=!0},n.setBoxCenterSize=function(e,n){var r=t._tempVec3;i.scale(n,.5,r),i.add(e,r,this.boxMax),i.subtract(e,r,this.boxMin),this._cornerFlag=!0},n.getCorners=function(){if(this._cornerFlag){var e=this.boxMin.x,t=this.boxMin.y,n=this.boxMin.z,r=this.boxMax.x-e,a=this.boxMax.y-t,o=this.boxMax.z-n;if(0===this._corners.length)for(var s=0;s<8;++s)this._corners.push(new i);this._corners[0].setValue(e+r,t+a,n+o),this._corners[1].setValue(e,t+a,n+o),this._corners[2].setValue(e,t,n+o),this._corners[3].setValue(e+r,t,n+o),this._corners[4].setValue(e+r,t+a,n),this._corners[5].setValue(e,t+a,n),this._corners[6].setValue(e,t,n),this._corners[7].setValue(e+r,t,n),this._cornerFlag=!1}return this._corners},n._raycast=function(e,n){var r=this._getLocalRay(e),i=t._tempBox;this.boxMin.cloneTo(i.min),this.boxMax.cloneTo(i.max);var a=r.intersectBox(i);return-1!==a&&(this._updateHitResult(r,a,n,e.origin),!0)},t}(mr);gr._tempVec3=new i,gr._tempBox=new o;var yr=function(e){function t(t){var n;return(n=e.call(this,t)||this).planePoint=void 0,n.normal=void 0,n.planePoint=new i,n.normal=new i(0,1,0),n}P(t,e);var n=t.prototype;return n.setPlane=function(e,t){this.planePoint=e,this.normal=t},n._raycast=function(e,n){var r=this._getLocalRay(e),a=t._tempPlane;this.normal.cloneTo(a.normal),a.distance=-i.dot(this.planePoint,a.normal);var o=r.intersectPlane(a);return-1!==o&&(this._updateHitResult(r,o,n,e.origin),!0)},t}(mr);yr._tempPlane=new l;var xr=function(e){function t(t){var n;return(n=e.call(this,t)||this).center=void 0,n.radius=void 0,n.center=new i,n.radius=1,n}P(t,e);var n=t.prototype;return n.setSphere=function(e,t){this.center=e,this.radius=t},n._raycast=function(e,n){var r=this.entity.transform,a=t._tempSphere;i.transformCoordinate(this.center,r.worldMatrix,a.center);var o=r.lossyWorldScale;a.radius=this.radius*Math.max(o.x,o.y,o.z);var s=e.intersectSphere(a);return-1!==s&&(this._updateHitResult(e,s,n,e.origin,!0),!0)},t}(mr);xr._tempSphere=new a;var br=function(e){function t(t){var n;return(n=e.call(this,t)||this)._center=new i,n._size=new i,n.isShowCollider=!0,n.center=n.center,n.size=n.size,n.isShowCollider=n.isShowCollider,n}return P(t,e),T(t,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,this.setBoxCenterSize(this._center,this._size)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,this.setBoxCenterSize(this._center,this._size)}}]),t}(gr),wr=function(e){function t(t){var n;return(n=e.call(this,t)||this).__center=new i,n.__radius=1,n.isShowCollider=!0,n._center=n._center,n._radius=n._radius,n.isShowCollider=n.isShowCollider,n}return P(t,e),T(t,[{key:"_center",get:function(){return this.__center},set:function(e){this.__center=e,this.setSphere(this.__center,this.__radius)}},{key:"_radius",get:function(){return this.__radius},set:function(e){this.__radius=e,this.setSphere(this.__center,this.__radius)}}]),t}(xr);dr.registerFeature(vr);var Tr=function(){this.collider=null,this.distance=0,this.point=new i,this.normal=new i},Sr=function(){function t(e){this._engine=void 0,this._engine=e}return t.prototype.raycast=function(n,r,i,a){var o,s=this._engine.sceneManager.activeScene.findFeature(vr).colliders,l=Number.MAX_VALUE;"number"==typeof r?l=r:null!=r&&(o=r);var u=e.Layer.Everything;"number"==typeof i?u=i:null!=i&&(o=i),a&&(o=a);for(var c=!1,d=t._currentHit,f=0,h=s.length;f<h;f++){var p=s[f];if(p.entity.layer&u&&p._raycast(n,d)&&(c=!0,d.distance<l)){if(!o)return!0;d.normal.cloneTo(o.normal),d.point.cloneTo(o.point),o.distance=d.distance,o.collider=d.collider,l=d.distance}}return!c&&o&&(o.collider=null,o.distance=0,o.point.setValue(0,0,0),o.normal.setValue(0,0,0)),c},t}();Sr._currentHit=new Tr;var Cr=new Ke;pr.init();var Pr,Mr,Ar,Er,Rr,Fr,Lr,Br,Ir,Or=function(t){function n(n,r){var i;(i=t.call(this,null)||this).physicsManager=new Sr(L(i)),i._componentsManager=new pe,i._hardwareRenderer=void 0,i._lastRenderState=new Dt,i._renderElementPool=new Nt(Vt),i._spriteElementPool=new Nt(Gt),i._spriteMaskElementPool=new Nt(Ht),i._spriteDefaultMaterial=void 0,i._spriteMaskDefaultMaterial=void 0,i._renderContext=new Ut,i._whiteTexture2D=void 0,i._whiteTextureCube=void 0,i._backgroundTextureMaterial=void 0,i._backgroundTextureMesh=void 0,i._renderCount=0,i._shaderProgramPools=[],i._spriteMaskManager=void 0,i._canvas=void 0,i._resourceManager=new N(L(i)),i._sceneManager=new fr(L(i)),i._vSyncCount=1,i._targetFrameRate=60,i._time=new de,i._isPaused=!0,i._requestId=void 0,i._timeoutId=void 0,i._vSyncCounter=1,i._targetFrameInterval=1e3/60,i._animate=function(){i._vSyncCount?(i._requestId=requestAnimationFrame(i._animate),i._vSyncCounter++%i._vSyncCount==0&&(i.update(),i._vSyncCounter=1)):(i._timeoutId=window.setTimeout(i._animate,i._targetFrameInterval),i.update())},i.features=[],i._hardwareRenderer=r,i._hardwareRenderer.init(n),i._canvas=n,Cr.addObject(L(i)),i._sceneManager.activeScene=new dr(L(i),"DefaultScene"),i._spriteMaskManager=new er(L(i)),i._spriteDefaultMaterial=i._createSpriteMaterial(),i._spriteMaskDefaultMaterial=i._createSpriteMaskMaterial();var a=new Uint8Array([255,255,255,255]),o=new bn(L(i),1,1,e.TextureFormat.R8G8B8A8,!1);o.setPixelBuffer(a),o.isGCIgnored=!0;var s=new Tn(L(i),1,e.TextureFormat.R8G8B8A8,!1);return s.setPixelBuffer(e.TextureCubeFace.PositiveX,a),s.setPixelBuffer(e.TextureCubeFace.NegativeX,a),s.setPixelBuffer(e.TextureCubeFace.PositiveY,a),s.setPixelBuffer(e.TextureCubeFace.NegativeY,a),s.setPixelBuffer(e.TextureCubeFace.PositiveZ,a),s.setPixelBuffer(e.TextureCubeFace.NegativeZ,a),s.isGCIgnored=!0,i._whiteTexture2D=o,i._whiteTextureCube=s,i._backgroundTextureMaterial=new kt(L(i),it.find("background-texture")),i._backgroundTextureMaterial.isGCIgnored=!0,i._backgroundTextureMaterial.renderState.depthState.compareFunction=e.CompareFunction.LessEqual,i._backgroundTextureMesh=Xn.createPlane(L(i),2,2,1,1,!1),i._backgroundTextureMesh.isGCIgnored=!0,i}P(n,t);var r=n.prototype;return r.createEntity=function(e){return new Xe(this,e)},r.pause=function(){this._isPaused=!0,cancelAnimationFrame(this._requestId),clearTimeout(this._timeoutId)},r.resume=function(){this._isPaused&&(this._isPaused=!1,this.time.reset(),requestAnimationFrame(this._animate))},r.update=function(){var e=this._time,t=e.deltaTime;e.tick(),this._renderElementPool.resetPool(),this._spriteElementPool.resetPool(),this._spriteMaskElementPool.resetPool(),Cr.callFeatureMethod(this,"preTick",[this,this._sceneManager._activeScene]);var n=this._sceneManager._activeScene,r=this._componentsManager;n&&(r.callScriptOnStart(),r.callScriptOnUpdate(t),r.callAnimationUpdate(t),r.callScriptOnLateUpdate(t),this._render(n)),this._componentsManager.callComponentDestroy(),Cr.callFeatureMethod(this,"postTick",[this,this._sceneManager._activeScene])},r.run=function(){Cr.callFeatureMethod(this,"preLoad",[this]),this.resume(),this.trigger(new G("run",this))},r.destroy=function(){this._sceneManager&&(this._whiteTexture2D.destroy(!0),this._whiteTextureCube.destroy(!0),this.trigger(new G("shutdown",this)),Cr.callFeatureMethod(this,"shutdown",[this]),this.pause(),this._animate=null,this._sceneManager._activeScene.destroy(),this._resourceManager.gc(),this._componentsManager.callComponentDestroy(),this._sceneManager=null,this._resourceManager=null,this._canvas=null,this.features=[],this._time=null,this._spriteMaskManager.destroy(),Cr._objects=[],this.removeAllEventListeners())},r._getShaderProgramPool=function(e){var t=e._shaderId,n=this._shaderProgramPools,r=n[t];if(!r){var i=t+1;i<n.length&&(n.length=i),n[t]=r=new _r}return r},r._render=function(e){var t=e._activeCameras,n=this._componentsManager,r=this.time.deltaTime;if(n.callRendererOnUpdate(r),e._updateShaderData(),t.length>0){t.sort((function(e,t){return e.priority-t.priority}));for(var i=0,a=t.length;i<a;i++){var o=t[i],s=o.entity;o.enabled&&s.isActiveInHierarchy&&(n.callCameraOnBeginRender(o),dr.sceneFeatureManager.callFeatureMethod(e,"preRender",[e,o]),o.render(),dr.sceneFeatureManager.callFeatureMethod(e,"postRender",[e,o]),n.callCameraOnEndRender(o))}}else ce.debug("NO active camera.")},r._createSpriteMaterial=function(){var t=new kt(this,it.find("Sprite")),n=t.renderState,r=n.blendState.targetBlendState;return r.enabled=!0,r.sourceColorBlendFactor=e.BlendFactor.SourceAlpha,r.destinationColorBlendFactor=e.BlendFactor.OneMinusSourceAlpha,r.sourceAlphaBlendFactor=e.BlendFactor.One,r.destinationAlphaBlendFactor=e.BlendFactor.OneMinusSourceAlpha,r.colorBlendOperation=r.alphaBlendOperation=e.BlendOperation.Add,n.depthState.writeEnabled=!1,n.rasterState.cullMode=e.CullMode.Off,t.renderQueueType=e.RenderQueueType.Transparent,t.isGCIgnored=!0,t},r._createSpriteMaskMaterial=function(){var t=new kt(this,it.find("SpriteMask")),n=t.renderState;return n.blendState.targetBlendState.colorWriteMask=e.ColorWriteMask.None,n.rasterState.cullMode=e.CullMode.Off,n.stencilState.enabled=!0,n.depthState.enabled=!1,t.isGCIgnored=!0,t},r.findFeature=function(e){return Cr.findFeature(this,e)},n.registerFeature=function(e){Cr.registerFeature(e)},T(n,[{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}}]),n}(ie),zr=function(){function e(){}return e._isIos=function(){if(!window)return!1;var e=window.navigator.userAgent.toLocaleLowerCase();return/iphone|ipad|ipod/.test(e)},T(e,null,[{key:"devicePixelRatio",get:function(){return window.devicePixelRatio}}]),e}(),Dr=function(){function e(){}var t=e.prototype;return t.preLoad=function(e){},t.preTick=function(e,t){},t.postTick=function(e,t){},t.shutdown=function(e){},e}(),kr=(Mr=O((Pr=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return I(t=e.call.apply(e,[this].concat(r))||this,"_started",Mr,L(t)),I(t,"_onStartIndex",Ar,L(t)),I(t,"_onUpdateIndex",Er,L(t)),I(t,"_onLateUpdateIndex",Rr,L(t)),I(t,"_onPreRenderIndex",Fr,L(t)),I(t,"_onPostRenderIndex",Lr,L(t)),I(t,"_entityCacheIndex",Br,L(t)),t}P(t,e);var n=t.prototype;return n.onAwake=function(){},n.onEnable=function(){},n.onStart=function(){},n.onUpdate=function(e){},n.onLateUpdate=function(e){},n.onBeginRender=function(e){},n.onEndRender=function(e){},n.onTriggerEnter=function(e){},n.onTriggerStay=function(e){},n.onTriggerExit=function(e){},n.onPointerDown=function(){},n.onPointerUp=function(){},n.onPointerClick=function(){},n.onPointerEnter=function(){},n.onPointerExit=function(){},n.onPointerDrag=function(){},n.onDisable=function(){},n.onDestroy=function(){},n._onAwake=function(){this.onAwake()},n._onEnable=function(){var e=this.engine._componentsManager,n=t.prototype;this._started||e.addOnStartScript(this),this.onUpdate!==n.onUpdate&&e.addOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.addOnLateUpdateScript(this),this._entity._addScript(this),this.onEnable()},n._onDisable=function(){var e=this.engine._componentsManager;-1!==this._onStartIndex&&e.removeOnStartScript(this),-1!==this._onUpdateIndex&&e.removeOnUpdateScript(this),-1!==this._onLateUpdateIndex&&e.removeOnLateUpdateScript(this),-1!==this._entityCacheIndex&&this._entity._removeScript(this),this.onDisable()},n._onDestroy=function(){this.engine._componentsManager.addDestroyComponent(this)},t}(Ve)).prototype,"_started",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ar=O(Pr.prototype,"_onStartIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Er=O(Pr.prototype,"_onUpdateIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Rr=O(Pr.prototype,"_onLateUpdateIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Fr=O(Pr.prototype,"_onPreRenderIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Lr=O(Pr.prototype,"_onPostRenderIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Br=O(Pr.prototype,"_entityCacheIndex",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Pr);e.CameraClearFlags=void 0,(Ir=e.CameraClearFlags||(e.CameraClearFlags={}))[Ir.DepthColor=0]="DepthColor",Ir[Ir.Depth=1]="Depth",Ir[Ir.None=2]="None";var Nr=0,Ur=function(){function t(t,n,r,i,a){void 0===t&&(t="RENDER_PASS"+Nr++),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=null),this.name=void 0,this.enabled=void 0,this.priority=void 0,this.renderTarget=void 0,this.replaceMaterial=void 0,this.mask=void 0,this.renderOverride=void 0,this.clearFlags=void 0,this.clearColor=void 0,this.name=t,this.enabled=!0,this.priority=n,this.renderTarget=r,this.replaceMaterial=i,this.mask=a||e.Layer.Everything,this.renderOverride=!1}var n=t.prototype;return n.render=function(e,t,n,r){},n.preRender=function(e,t,n,r){},n.postRender=function(e,t,n,r){},t}(),Vr=function(t){function n(){return t.apply(this,arguments)||this}P(n,t);var r=n.prototype;return r.createVertexElements=function(t){return t[0]=new un("POSITION",0,e.VertexElementFormat.Vector3,0),t[1]=new un("TEXCOORD_0",12,e.VertexElementFormat.Vector2,0),t[2]=new un("COLOR_0",20,e.VertexElementFormat.Vector4,0),36},r.canBatch=function(e,t){var r=e.component,i=t.component;if(!this.checkBatchWithMask(r,i))return!1;var a=n._textureProperty;return r.shaderData.getTexture(a)===i.shaderData.getTexture(a)&&e.material===t.material},r.checkBatchWithMask=function(t,n){var r=t.maskInteraction;return r===n.maskInteraction&&(r===e.SpriteMaskInteraction.None||t.maskLayer===n.maskLayer)},r.updateVertices=function(e,t,n){for(var r=e.positions,i=e.uv,a=e.color,o=r.length,s=0;s<o;s++){var l=r[s],u=i[s];t[n++]=l.x,t[n++]=l.y,t[n++]=l.z,t[n++]=u.x,t[n++]=u.y,t[n++]=a.r,t[n++]=a.g,t[n++]=a.b,t[n++]=a.a}return n},r.drawBatches=function(e){for(var t=this._meshes[this._flushId],n=t.subMeshes,r=this._batchedQueue,i=e._spriteMaskManager,a=0,o=n.length;a<o;a++){var s=n[a],l=r[a];if(!s||!l)return;var u=l.component,c=l.camera,d=l.material;i.preRender(c,u);var f=it._compileMacros;he.unionCollection(u._globalShaderMacro,d.shaderData._macroCollection,f);var h=d.shader._getShaderProgram(e,f);if(!h.isValid)return;h.bind(),h.groupingOtherUniformBlock(),h.uploadAll(h.sceneUniformBlock,c.scene.shaderData),h.uploadAll(h.cameraUniformBlock,c.shaderData),h.uploadAll(h.rendererUniformBlock,u.shaderData),h.uploadAll(h.materialUniformBlock,d.shaderData),d.renderState._apply(e),e._hardwareRenderer.drawPrimitive(t,s,h),i.postRender(u)}},r.destroy=function(){this._batchedQueue=null;for(var e=this._meshes,t=this._vertexBuffers,n=this._indiceBuffers,r=0,i=e.length;r<i;++r)e[r].destroy();this._meshes=null;for(var a=0,o=t.length;a<o;++a)t[a].destroy();this._vertexBuffers=null;for(var s=0,l=n.length;s<l;++s)n[s].destroy();this._indiceBuffers=null},n}(Yn);Vr._textureProperty=it.getPropertyByName("u_spriteTexture");var Gr,Hr,Wr,jr,Xr,Kr,qr,Qr,Yr,$r,Jr,Zr,ei,ti,ni,ri,ii=function(){function e(e){this.items=[],this._spriteBatcher=void 0,this._spriteBatcher=new Vr(e)}e._compareFromNearToFar=function(e,t){return e.material.renderQueueType-t.material.renderQueueType||e.component._distanceForSort-t.component._distanceForSort||t.component._renderSortId-e.component._renderSortId},e._compareFromFarToNear=function(e,t){return e.material.renderQueueType-t.material.renderQueueType||t.component._distanceForSort-e.component._distanceForSort||t.component._renderSortId-e.component._renderSortId};var t=e.prototype;return t.pushPrimitive=function(e){this.items.push(e)},t.render=function(e,t,n){var r=this.items;if(0!==r.length){for(var i=e.engine,a=e.scene,o=i._renderCount,s=i._hardwareRenderer,l=a.shaderData,u=e.shaderData,c=0,d=r.length;c<d;c++){var f=r[c];if(f.component.entity.layer&n)if(f.mesh){this._spriteBatcher.flush(i);var h=it._compileMacros,p=f,_=p.component,v=t||p.material,m=_.shaderData,g=v.shaderData;v._preRender(p),he.unionCollection(_._globalShaderMacro,g._macroCollection,h);var y=v.shader._getShaderProgram(i,h);if(!y.isValid)continue;var x=y.bind();o!==y._uploadRenderCount?(y.groupingOtherUniformBlock(),y.uploadAll(y.sceneUniformBlock,l),y.uploadAll(y.cameraUniformBlock,u),y.uploadAll(y.rendererUniformBlock,m),y.uploadAll(y.materialUniformBlock,g),y.uploadUngroupTextures(),y._uploadCamera=e,y._uploadRenderer=_,y._uploadMaterial=v,y._uploadRenderCount=o):(y._uploadCamera!==e?(y.uploadAll(y.cameraUniformBlock,u),y._uploadCamera=e):x&&y.uploadTextures(y.cameraUniformBlock,u),y._uploadRenderer!==_?(y.uploadAll(y.rendererUniformBlock,m),y._uploadRenderer=_):x&&y.uploadTextures(y.rendererUniformBlock,m),y._uploadMaterial!==v?(y.uploadAll(y.materialUniformBlock,g),y._uploadMaterial=v):x&&y.uploadTextures(y.materialUniformBlock,g),x&&y.uploadUngroupTextures()),v.renderState._apply(e.engine),s.drawPrimitive(p.mesh,p.subMesh,y)}else{var b=f;this._spriteBatcher.drawElement(b)}}this._spriteBatcher.flush(i)}},t.clear=function(){this.items.length=0,this._spriteBatcher.clear()},t.destroy=function(){this._spriteBatcher.destroy(),this._spriteBatcher=null},t.sort=function(e){this._quickSort(this.items,0,this.items.length,e)},t._quickSort=function(e,t,n,r){for(;;){if(n-t<=10)return void this._insertionSort(e,t,n,r);var i=t+n>>1,a=e[t],o=e[n-1],s=e[i];if(r(a,o)>0){var l=a;a=o,o=l}if(r(a,s)>=0){var u=a;a=s,s=o,o=u}else if(r(o,s)>0){var c=o;o=s,s=c}e[t]=a,e[n-1]=s;var d=o,f=t+1,h=n-1;e[i]=e[f],e[f]=d;e:for(var p=f+1;p<h;p++){var _=e[p],v=r(_,d);if(v<0)e[p]=e[f],e[f]=_,f++;else if(v>0){do{if(--h==p)break e;v=r(e[h],d)}while(v>0);e[p]=e[h],e[h]=_,v<0&&(_=e[p],e[p]=e[f],e[f]=_,f++)}}n-h<f-t?(this._quickSort(e,h,n,r),n=f):(this._quickSort(e,t,f,r),t=h)}},t._insertionSort=function(e,t,n,r){for(var i=t+1;i<n;i++){var a=void 0,o=e[i];for(a=i-1;a>=t;a--){var s=e[a];if(!(r(s,o)>0))break;e[a+1]=s}e[a+1]=o}},e}(),ai=function(){function t(e){this._opaqueQueue=void 0,this._transparentQueue=void 0,this._alphaTestQueue=void 0,this._allSpriteMasks=new fe,this._camera=void 0,this._defaultPass=void 0,this._renderPassArray=void 0,this._lastCanvasSize=new p,this._camera=e;var t=e.engine;this._opaqueQueue=new ii(t),this._alphaTestQueue=new ii(t),this._transparentQueue=new ii(t),this._renderPassArray=[],this._defaultPass=new Ur("default",0,null,null,0),this.addRenderPass(this._defaultPass)}var n=t.prototype;return n.addRenderPass=function(e,t,n,r,i){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),"string"==typeof e){var a=new Ur(e,t,n,r,i);this._renderPassArray.push(a)}else e instanceof Ur&&this._renderPassArray.push(e);this._renderPassArray.sort((function(e,t){return e.priority-t.priority}))},n.removeRenderPass=function(e){var t;if("string"==typeof e?t=this.getRenderPass(e):e instanceof Ur&&(t=e),t){var n=this._renderPassArray.indexOf(t);this._renderPassArray.splice(n,1)}},n.getRenderPass=function(e){for(var t=0,n=this._renderPassArray.length;t<n;t++){var r=this._renderPassArray[t];if(r.name===e)return r}return null},n.destroy=function(){this._opaqueQueue.destroy(),this._alphaTestQueue.destroy(),this._transparentQueue.destroy(),this._allSpriteMasks=null,this._renderPassArray=null,this._defaultPass=null,this._camera=null},n.render=function(e,t){var n=this._camera,r=this._opaqueQueue,i=this._alphaTestQueue,a=this._transparentQueue;n.engine._spriteMaskManager.clear(),r.clear(),i.clear(),a.clear(),this._allSpriteMasks.length=0,n.engine._componentsManager.callRender(e),r.sort(ii._compareFromNearToFar),i.sort(ii._compareFromNearToFar),a.sort(ii._compareFromFarToNear);for(var o=0,s=this._renderPassArray.length;o<s;o++)this._drawRenderPass(this._renderPassArray[o],n,t)},n._drawRenderPass=function(t,n,r){if(t.preRender(n,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue),t.enabled){var i,a,o=n.engine,s=n.scene.background,l=o._hardwareRenderer,u=n.renderTarget||t.renderTarget;l.activeRenderTarget(u,n),null==u||u._setRenderTargetFace(r);var c=null!=(i=t.clearFlags)?i:n.clearFlags,d=null!=(a=t.clearColor)?a:s.solidColor;c!==e.CameraClearFlags.None&&l.clearRenderTarget(n.engine,c,d),t.renderOverride?t.render(n,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue):(this._opaqueQueue.render(n,t.replaceMaterial,t.mask),this._alphaTestQueue.render(n,t.replaceMaterial,t.mask),s.mode===e.BackgroundMode.Sky?this._drawSky(o,n,s.sky):s.mode===e.BackgroundMode.Texture&&s.texture&&this._drawBackgroundTexture(o,s),this._transparentQueue.render(n,t.replaceMaterial,t.mask)),null==u||u._blitRenderTarget(),null==u||u.generateMipmaps()}t.postRender(n,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue)},n.pushPrimitive=function(t){var n=t.material.renderQueueType;n>e.RenderQueueType.Transparent+e.RenderQueueType.AlphaTest>>1?this._transparentQueue.pushPrimitive(t):n>e.RenderQueueType.AlphaTest+e.RenderQueueType.Opaque>>1?this._alphaTestQueue.pushPrimitive(t):this._opaqueQueue.pushPrimitive(t)},n._drawBackgroundTexture=function(e,t){var n=e._hardwareRenderer,r=e._backgroundTextureMaterial,i=e._backgroundTextureMesh,a=e.canvas;this._lastCanvasSize.x===a.width&&this._lastCanvasSize.y===a.height||t._textureFillMode===Jn.Fill||(this._lastCanvasSize.setValue(a.width,a.height),t._resizeBackgroundTexture());var o=r.shader._getShaderProgram(e,it._compileMacros);o.bind(),o.uploadAll(o.materialUniformBlock,r.shaderData),o.uploadUngroupTextures(),r.renderState._apply(e),n.drawPrimitive(i,i.subMesh,o)},n._drawSky=function(e,t,n){var r=n.material,i=n.mesh,a=n._matrix;if(r)if(i){var o=e._hardwareRenderer,s=r.shaderData,l=r.shader,u=r.renderState,c=it._compileMacros;he.unionCollection(t._globalShaderMacro,s._macroCollection,c);var d=t.viewMatrix,h=t.projectionMatrix;d.cloneTo(a);var p=a.elements;p[12]=p[13]=p[14]=0,f.multiply(h,a,a),s.setMatrix("u_mvpNoscale",a);var _=l._getShaderProgram(e,c);_.bind(),_.uploadAll(_.materialUniformBlock,s),_.uploadUngroupTextures(),u._apply(e),o.drawPrimitive(i,i.subMesh,_)}else ce.warn("The mesh of sky is not defined.");else ce.warn("The material of sky is not defined.")},T(t,[{key:"defaultRenderPass",get:function(){return this._defaultPass}}]),t}(),oi=function(){};oi.tempMat4=new f,oi.tempVec4=new _,oi.tempVec3=new i,oi.tempVec2=new p;var si=Te(We)((ri=ni=function(t){function n(n){var r;(r=t.call(this,n)||this).shaderData=new lt(qe.Camera),r.priority=0,r.enableFrustumCulling=!0,r.clearFlags=e.CameraClearFlags.DepthColor,r.cullingMask=e.Layer.Everything,r._globalShaderMacro=new he,I(r,"_frustum",Wr,L(r)),I(r,"_renderPipeline",jr,L(r)),r._isOrthographic=!1,r._isProjMatSetting=!1,r._nearClipPlane=.1,r._farClipPlane=100,r._fieldOfView=45,r._orthographicSize=10,r._isProjectionDirty=!0,r._isInvProjMatDirty=!0,r._isFrustumProjectDirty=!0,r._customAspectRatio=void 0,r._renderTarget=null,I(r,"_frustumViewChangeFlag",Xr,L(r)),I(r,"_transform",Kr,L(r)),I(r,"_isViewMatrixDirty",qr,L(r)),I(r,"_isInvViewProjDirty",Qr,L(r)),I(r,"_projectionMatrix",Yr,L(r)),I(r,"_viewMatrix",$r,L(r)),I(r,"_viewport",Jr,L(r)),I(r,"_inverseProjectionMatrix",Zr,L(r)),I(r,"_lastAspectSize",ei,L(r)),I(r,"_invViewProjMat",ti,L(r));var i=r.entity.transform;return r._transform=i,r._isViewMatrixDirty=i.registerWorldChangeFlag(),r._isInvViewProjDirty=i.registerWorldChangeFlag(),r._frustumViewChangeFlag=i.registerWorldChangeFlag(),r._renderPipeline=new ai(L(r)),r.shaderData._addRefCount(1),r}P(n,t);var a=n.prototype;return a.resetProjectionMatrix=function(){this._isProjMatSetting=!1,this._projMatChange()},a.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projMatChange()},a.worldToViewportPoint=function(e,t){f.multiply(this.projectionMatrix,this.viewMatrix,oi.tempMat4),oi.tempVec4.setValue(e.x,e.y,e.z,1),_.transform(oi.tempVec4,oi.tempMat4,oi.tempVec4);var n=oi.tempVec4.w,r=oi.tempVec4.x/n,i=oi.tempVec4.y/n,a=oi.tempVec4.z/n;return t.x=.5*(r+1),t.y=.5*(1-i),t.z=a,t.w=n,t},a.viewportToWorldPoint=function(e,t){var n=this.invViewProjMat;return this._innerViewportToWorldPoint(e,n,t)},a.viewportPointToRay=function(e,t){var n=oi.tempVec3;n.setValue(e.x,e.y,0);var r=this.viewportToWorldPoint(n,t.origin);n.z=1;var a=this._innerViewportToWorldPoint(n,this._invViewProjMat,n);return i.subtract(a,r,t.direction),t.direction.normalize(),t},a.screenToViewportPoint=function(e,t){var n=this.engine.canvas,r=this.viewport;return t.x=(e.x/n.width-r.x)/r.z,t.y=(e.y/n.height-r.y)/r.w,t},a.viewportToScreenPoint=function(e,t){var n=this.engine.canvas,r=this.viewport;return t.x=(r.x+e.x*r.z)*n.width,t.y=(r.y+e.y*r.w)*n.height,t},a.worldToScreenPoint=function(e,t){return this.worldToViewportPoint(e,t),this.viewportToScreenPoint(t,t)},a.screenToWorldPoint=function(e,t){return this.screenToViewportPoint(e,t),this.viewportToWorldPoint(t,t)},a.screenPointToRay=function(e,t){var n=oi.tempVec2;return this.screenToViewportPoint(e,n),this.viewportPointToRay(n,t)},a.render=function(e){var t=this.engine._renderContext;t._setContext(this),this.enableFrustumCulling&&(this._frustumViewChangeFlag.flag||this._isFrustumProjectDirty)&&(this._frustum.calculateFromMatrix(t._viewProjectMatrix),this._frustumViewChangeFlag.flag=!1,this._isFrustumProjectDirty=!1),this._updateShaderData(t),he.unionCollection(this.scene.shaderData._macroCollection,this.shaderData._macroCollection,this._globalShaderMacro),this._renderPipeline.render(t,e),this._engine._renderCount++},a._onActive=function(){this.entity.scene._attachRenderCamera(this)},a._onInActive=function(){this.entity.scene._detachRenderCamera(this)},a._onDestroy=function(){var e;null===(e=this._renderPipeline)||void 0===e||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy(),this.shaderData._addRefCount(-1)},a._projMatChange=function(){this._isFrustumProjectDirty=!0,this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0},a._innerViewportToWorldPoint=function(e,t,n){var r=2*e.z-1,i=oi.tempVec4;i.setValue(2*e.x-1,1-2*e.y,r,1),_.transform(i,t,i);var a=1/i.w;return n.x=i.x*a,n.y=i.y*a,n.z=i.z*a,n},a._updateShaderData=function(e){var t=this.shaderData;t.setMatrix(n._viewMatrixProperty,this.viewMatrix),t.setMatrix(n._projectionMatrixProperty,this.projectionMatrix),t.setMatrix(n._vpMatrixProperty,e._viewProjectMatrix),t.setMatrix(n._inverseViewMatrixProperty,this._transform.worldMatrix),t.setMatrix(n._inverseProjectionMatrixProperty,this.inverseProjectionMatrix),t.setVector3(n._cameraPositionProperty,this._transform.worldPosition)},T(n,[{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projMatChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projMatChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projMatChange()}},{key:"aspectRatio",get:function(){var e,t=this._entity.engine.canvas;return null!=(e=this._customAspectRatio)?e:t.width*this._viewport.z/(t.height*this._viewport.w)},set:function(e){this._customAspectRatio=e,this._projMatChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&e.cloneTo(this._viewport),this._projMatChange()}},{key:"isOrthographic",get:function(){return this._isOrthographic},set:function(e){this._isOrthographic=e,this._projMatChange()}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projMatChange()}},{key:"viewMatrix",get:function(){return this._isViewMatrixDirty.flag&&(this._isViewMatrixDirty.flag=!1,f.invert(this._transform.worldMatrix,this._viewMatrix)),this._viewMatrix}},{key:"projectionMatrix",get:function(){var e=this._entity.engine.canvas;if((!this._isProjectionDirty||this._isProjMatSetting)&&this._lastAspectSize.x===e.width&&this._lastAspectSize.y===e.height)return this._projectionMatrix;this._isProjectionDirty=!1,this._lastAspectSize.x=e.width,this._lastAspectSize.y=e.height;var t=this.aspectRatio;if(this._isOrthographic){var n=this._orthographicSize*t,i=this._orthographicSize;f.ortho(-n,n,-i,i,this._nearClipPlane,this._farClipPlane,this._projectionMatrix)}else f.perspective(r.degreeToRadian(this._fieldOfView),t,this._nearClipPlane,this._farClipPlane,this._projectionMatrix);return this._projectionMatrix},set:function(e){this._projectionMatrix=e,this._isProjMatSetting=!0,this._projMatChange()}},{key:"enableHDR",get:function(){return console.log("not implementation"),!1},set:function(e){console.log("not implementation")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget=e}},{key:"invViewProjMat",get:function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,f.multiply(this._transform.worldMatrix,this.inverseProjectionMatrix,this._invViewProjMat)),this._invViewProjMat}},{key:"inverseProjectionMatrix",get:function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,f.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix}}]),n}(Ve),ni._viewMatrixProperty=it.getPropertyByName("u_viewMat"),ni._projectionMatrixProperty=it.getPropertyByName("u_projMat"),ni._vpMatrixProperty=it.getPropertyByName("u_VPMat"),ni._inverseViewMatrixProperty=it.getPropertyByName("u_viewInvMat"),ni._inverseProjectionMatrixProperty=it.getPropertyByName("u_projInvMat"),ni._cameraPositionProperty=it.getPropertyByName("u_cameraPos"),Wr=O((Hr=ri).prototype,"_frustum",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u}}),jr=O(Hr.prototype,"_renderPipeline",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xr=O(Hr.prototype,"_frustumViewChangeFlag",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kr=O(Hr.prototype,"_transform",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qr=O(Hr.prototype,"_isViewMatrixDirty",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qr=O(Hr.prototype,"_isInvViewProjDirty",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yr=O(Hr.prototype,"_projectionMatrix",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),$r=O(Hr.prototype,"_viewMatrix",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Jr=O(Hr.prototype,"_viewport",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _(0,0,1,1)}}),Zr=O(Hr.prototype,"_inverseProjectionMatrix",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),ei=O(Hr.prototype,"_lastAspectSize",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(0,0)}}),ti=O(Hr.prototype,"_invViewProjMat",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),Gr=Hr))||Gr,li={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"};function ui(e,t){return void 0===t&&(t={}),new z((function(n,r,i){var a,o,s,l,u=null!=(a=t.retryCount)?a:4,c=null!=(o=t.retryInterval)?o:500;t.timeout=null!=(s=t.timeout)?s:15e3,t.type=null!=(l=t.type)?l:function(e){var t=e.substring(e.lastIndexOf(".")+1);return li[t]}(e);var d,f="image"===t.type?ci:di,h=new _i((function(){return f(e,t).onProgress(i).then((function(e){n(e),h.stop()})).catch((function(e){return d=e}))}),u,c);h.start((function(){r(d)}))}))}function ci(e,t){return new z((function(n,r){var i=t.timeout,a=new Image,o=function(){r(new Error("request "+e+" fail"))};a.onerror=o,a.onabort=o;var s=setTimeout((function(){r(new Error("request "+e+" timeout"))}),i);a.onload=function(e){return function(){requestAnimationFrame((function(){n(a),a.onload=null,a.onerror=null,a.onabort=null})),clearTimeout(e)}}(s),a.crossOrigin="anonymous",a.src=e}))}function di(e,t){return new z((function(n,r,i){var a,o=new XMLHttpRequest;o.timeout=t.timeout,t.method=null!=(a=t.method)?a:"get",o.onload=function(){var t;if(o.status<200||o.status>=300)r(new Error("request failed from: "+e));else{var i=null!=(t=o.response)?t:o.responseText;n(i)}},o.onerror=function(){r(new Error("request failed from: "+e))},o.ontimeout=function(){r(new Error("request timeout from: "+e))},o.onprogress=function(e){i(e.loaded/e.total)},o.open(t.method,e,!0),o.withCredentials="include"===t.credentials,o.responseType=t.type;var s=t.headers;s&&Object.keys(s).forEach((function(e){o.setRequestHeader(e,s[e])})),o.send(t.body)}))}var fi,hi,pi,_i=function(){function e(e,t,n){this.execFunc=e,this.totalCount=t,this.interval=n,this._timeoutId=-100,this._currentCount=0,this.done=void 0,this.exec=this.exec.bind(this)}var t=e.prototype;return t.start=function(e){this.done=e,this.exec()},t.stop=function(){clearTimeout(this._timeoutId)},t.exec=function(){var e=this;this._currentCount>=this.totalCount?this.done&&this.done():(this._currentCount++,this.execFunc(this._currentCount).then((function(){e._timeoutId=setTimeout(e.exec,e.interval)})))},e}(),vi=function(e){this.useCache=e,this.request=ui};e.AssetType=void 0,(fi=e.AssetType||(e.AssetType={})).Text="text",fi.JSON="json",fi.Buffer="buffer",fi.Texture2D="texture2d",fi.TextureCube="texture-cube",fi.Material="material",fi.Mesh="mesh",fi.AnimationClip="animation-clip",fi.Prefab="prefab",fi.KTX="ktx",fi.KTXCube="ktx-cube",fi.SpriteAtlas="sprite-atlas",e.RenderFace=void 0,(hi=e.RenderFace||(e.RenderFace={}))[hi.Front=0]="Front",hi[hi.Back=1]="Back",hi[hi.Double=2]="Double",e.BlendMode=void 0,(pi=e.BlendMode||(e.BlendMode={}))[pi.Normal=0]="Normal",pi[pi.Additive=1]="Additive";var mi=function(t){function n(r,i){var a;return(a=t.call(this,r,i)||this)._renderFace=e.RenderFace.Front,a._isTransparent=!1,a._blendMode=void 0,a.blendMode=e.BlendMode.Normal,a.shaderData.setFloat(n._alphaCutoffProp,0),a}P(n,t);var r=n.prototype;return r.clone=function(){var e=new n(this._engine,this.shader);return this.cloneTo(e),e},r.cloneTo=function(e){t.prototype.cloneTo.call(this,e),e._renderFace=this._renderFace,e._isTransparent=this._isTransparent,e._blendMode=this._blendMode},T(n,[{key:"isTransparent",get:function(){return this._isTransparent},set:function(t){if(t!==this._isTransparent){this._isTransparent=t;var r=this.renderState,i=r.depthState,a=r.blendState.targetBlendState;t?(a.enabled=!0,i.writeEnabled=!1,this.renderQueueType=e.RenderQueueType.Transparent):(a.enabled=!1,i.writeEnabled=!0,this.renderQueueType=this.shaderData.getFloat(n._alphaCutoffProp)?e.RenderQueueType.AlphaTest:e.RenderQueueType.Opaque)}}},{key:"alphaCutoff",get:function(){return this.shaderData.getFloat(n._alphaCutoffProp)},set:function(t){this.shaderData.setFloat(n._alphaCutoffProp,t),t>0?(this.shaderData.enableMacro(n._alphaCutoffMacro),this.renderQueueType=this._isTransparent?e.RenderQueueType.Transparent:e.RenderQueueType.AlphaTest):(this.shaderData.disableMacro(n._alphaCutoffMacro),this.renderQueueType=this._isTransparent?e.RenderQueueType.Transparent:e.RenderQueueType.Opaque)}},{key:"renderFace",get:function(){return this._renderFace},set:function(t){if(t!==this._renderFace)switch(this._renderFace=t,t){case e.RenderFace.Front:this.renderState.rasterState.cullMode=e.CullMode.Back;break;case e.RenderFace.Back:this.renderState.rasterState.cullMode=e.CullMode.Front;break;case e.RenderFace.Double:this.renderState.rasterState.cullMode=e.CullMode.Off}}},{key:"blendMode",get:function(){return this._blendMode},set:function(t){if(t!==this._blendMode){this._blendMode=t;var n=this.renderState.blendState.targetBlendState;switch(t){case e.BlendMode.Normal:n.sourceColorBlendFactor=e.BlendFactor.SourceAlpha,n.destinationColorBlendFactor=e.BlendFactor.OneMinusSourceAlpha,n.sourceAlphaBlendFactor=e.BlendFactor.One,n.destinationAlphaBlendFactor=e.BlendFactor.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=e.BlendOperation.Add;break;case e.BlendMode.Additive:n.sourceColorBlendFactor=e.BlendFactor.SourceAlpha,n.destinationColorBlendFactor=e.BlendFactor.One,n.sourceAlphaBlendFactor=e.BlendFactor.One,n.destinationAlphaBlendFactor=e.BlendFactor.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=e.BlendOperation.Add}}}}]),n}(kt);mi._alphaCutoffMacro=it.getMacroByName("ALPHA_CUTOFF"),mi._alphaCutoffProp=it.getPropertyByName("u_alphaCutoff");var gi=function(e){function t(n){var r,i=(r=e.call(this,n,it.find("blinn-phong"))||this).shaderData;return i.enableMacro("O3_NEED_WORLDPOS"),i.enableMacro("O3_NEED_TILINGOFFSET"),i.setColor(t._diffuseColorProp,new m(1,1,1,1)),i.setColor(t._specularColorProp,new m(1,1,1,1)),i.setColor(t._emissiveColorProp,new m(0,0,0,1)),i.setVector4(t._tilingOffsetProp,new _(1,1,0,0)),i.setFloat(t._shininessProp,16),i.setFloat(t._normalIntensityProp,1),r}return P(t,e),t.prototype.clone=function(){var e=new t(this._engine);return this.cloneTo(e),e},T(t,[{key:"baseColor",get:function(){return this.shaderData.getColor(t._diffuseColorProp)},set:function(e){var n=this.shaderData.getColor(t._diffuseColorProp);e!==n&&e.cloneTo(n)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(t._baseTextureProp)},set:function(e){this.shaderData.setTexture(t._baseTextureProp,e),e?this.shaderData.enableMacro("O3_DIFFUSE_TEXTURE"):this.shaderData.disableMacro("O3_DIFFUSE_TEXTURE")}},{key:"specularColor",get:function(){return this.shaderData.getColor(t._specularColorProp)},set:function(e){var n=this.shaderData.getColor(t._specularColorProp);e!==n&&e.cloneTo(n)}},{key:"specularTexture",get:function(){return this.shaderData.getTexture(t._specularTextureProp)},set:function(e){this.shaderData.setTexture(t._specularTextureProp,e),e?this.shaderData.enableMacro("O3_SPECULAR_TEXTURE"):this.shaderData.disableMacro("O3_SPECULAR_TEXTURE")}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(t._emissiveColorProp)},set:function(e){var n=this.shaderData.getColor(t._emissiveColorProp);e!==n&&e.cloneTo(n)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(t._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(t._emissiveTextureProp,e),e?this.shaderData.enableMacro("O3_EMISSIVE_TEXTURE"):this.shaderData.disableMacro("O3_EMISSIVE_TEXTURE")}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(t._normalTextureProp)},set:function(e){this.shaderData.setTexture(t._normalTextureProp,e),e?this.shaderData.enableMacro("O3_NORMAL_TEXTURE"):this.shaderData.disableMacro("O3_NORMAL_TEXTURE")}},{key:"normalIntensity",get:function(){return this.shaderData.getFloat(t._normalIntensityProp)},set:function(e){this.shaderData.setFloat(t._normalIntensityProp,e)}},{key:"shininess",get:function(){return this.shaderData.getFloat(t._shininessProp)},set:function(e){this.shaderData.setFloat(t._shininessProp,e)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(t._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(t._tilingOffsetProp);e!==n&&e.cloneTo(n)}}]),t}(mi);gi._diffuseColorProp=it.getPropertyByName("u_diffuseColor"),gi._specularColorProp=it.getPropertyByName("u_specularColor"),gi._emissiveColorProp=it.getPropertyByName("u_emissiveColor"),gi._tilingOffsetProp=it.getPropertyByName("u_tilingOffset"),gi._shininessProp=it.getPropertyByName("u_shininess"),gi._normalIntensityProp=it.getPropertyByName("u_normalIntensity"),gi._baseTextureProp=it.getPropertyByName("u_diffuseTexture"),gi._specularTextureProp=it.getPropertyByName("u_specularTexture"),gi._emissiveTextureProp=it.getPropertyByName("u_emissiveTexture"),gi._normalTextureProp=it.getPropertyByName("u_normalTexture");var yi=function(e){function t(n){var r,i=(r=e.call(this,n,it.find("pbr"))||this).shaderData;return i.enableMacro("O3_NEED_WORLDPOS"),i.enableMacro("O3_NEED_TILINGOFFSET"),i.setColor(t._baseColorProp,new m(1,1,1,1)),i.setColor(t._emissiveColorProp,new m(0,0,0,1)),i.setVector4(t._tilingOffsetProp,new _(1,1,0,0)),i.setFloat(t._normalTextureIntensityProp,1),i.setFloat(t._occlusionTextureIntensityProp,1),r}return P(t,e),T(t,[{key:"baseColor",get:function(){return this.shaderData.getColor(t._baseColorProp)},set:function(e){var n=this.shaderData.getColor(t._baseColorProp);e!==n&&e.cloneTo(n)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(t._baseTextureProp)},set:function(e){this.shaderData.setTexture(t._baseTextureProp,e),e?this.shaderData.enableMacro("HAS_BASECOLORMAP"):this.shaderData.disableMacro("HAS_BASECOLORMAP")}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(t._normalTextureProp)},set:function(e){this.shaderData.setTexture(t._normalTextureProp,e),e?this.shaderData.enableMacro("O3_NORMAL_TEXTURE"):this.shaderData.disableMacro("O3_NORMAL_TEXTURE")}},{key:"normalTextureIntensity",get:function(){return this.shaderData.getFloat(t._normalTextureIntensityProp)},set:function(e){this.shaderData.setFloat(t._normalTextureIntensityProp,e),this.shaderData.setFloat("u_normalIntensity",e)}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(t._emissiveColorProp)},set:function(e){var n=this.shaderData.getColor(t._emissiveColorProp);e!==n&&e.cloneTo(n)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(t._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(t._emissiveTextureProp,e),e?this.shaderData.enableMacro("HAS_EMISSIVEMAP"):this.shaderData.disableMacro("HAS_EMISSIVEMAP")}},{key:"occlusionTexture",get:function(){return this.shaderData.getTexture(t._occlusionTextureProp)},set:function(e){this.shaderData.setTexture(t._occlusionTextureProp,e),e?this.shaderData.enableMacro("HAS_OCCLUSIONMAP"):this.shaderData.disableMacro("HAS_OCCLUSIONMAP")}},{key:"occlusionTextureIntensity",get:function(){return this.shaderData.getFloat(t._occlusionTextureIntensityProp)},set:function(e){this.shaderData.setFloat(t._occlusionTextureIntensityProp,e)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(t._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(t._tilingOffsetProp);e!==n&&e.cloneTo(n)}}]),t}(mi);yi._baseColorProp=it.getPropertyByName("u_baseColor"),yi._emissiveColorProp=it.getPropertyByName("u_emissiveColor"),yi._tilingOffsetProp=it.getPropertyByName("u_tilingOffset"),yi._baseTextureProp=it.getPropertyByName("u_baseColorSampler"),yi._normalTextureProp=it.getPropertyByName("u_normalTexture"),yi._normalTextureIntensityProp=it.getPropertyByName("u_normalIntensity"),yi._occlusionTextureIntensityProp=it.getPropertyByName("u_occlusionStrength"),yi._emissiveTextureProp=it.getPropertyByName("u_emissiveSampler"),yi._occlusionTextureProp=it.getPropertyByName("u_occlusionSampler");var xi=function(e){function t(n){var r;return(r=e.call(this,n)||this).shaderData.enableMacro("IS_METALLIC_WORKFLOW"),r.shaderData.setFloat(t._metallicProp,1),r.shaderData.setFloat(t._roughnessProp,1),r}return P(t,e),t.prototype.clone=function(){var e=new t(this._engine);return this.cloneTo(e),e},T(t,[{key:"metallic",get:function(){return this.shaderData.getFloat(t._metallicProp)},set:function(e){this.shaderData.setFloat(t._metallicProp,e)}},{key:"roughness",get:function(){return this.shaderData.getFloat(t._roughnessProp)},set:function(e){this.shaderData.setFloat(t._roughnessProp,e)}},{key:"roughnessMetallicTexture",get:function(){return this.shaderData.getTexture(t._metallicRoughnessTextureProp)},set:function(e){this.shaderData.setTexture(t._metallicRoughnessTextureProp,e),e?this.shaderData.enableMacro("HAS_METALROUGHNESSMAP"):this.shaderData.disableMacro("HAS_METALROUGHNESSMAP")}}]),t}(yi);xi._metallicProp=it.getPropertyByName("u_metal"),xi._roughnessProp=it.getPropertyByName("u_roughness"),xi._metallicRoughnessTextureProp=it.getPropertyByName("u_metallicRoughnessSampler");var bi=function(e){function t(n){var r;return(r=e.call(this,n)||this).shaderData.setColor(t._specularColorProp,new m(1,1,1,1)),r.shaderData.setFloat(t._glossinessProp,1),r}return P(t,e),t.prototype.clone=function(){var e=new t(this._engine);return this.cloneTo(e),e},T(t,[{key:"specularColor",get:function(){return this.shaderData.getColor(t._specularColorProp)},set:function(e){var n=this.shaderData.getColor(t._specularColorProp);e!==n&&e.cloneTo(n)}},{key:"glossiness",get:function(){return this.shaderData.getFloat(t._glossinessProp)},set:function(e){this.shaderData.setFloat(t._glossinessProp,e)}},{key:"specularGlossinessTexture",get:function(){return this.shaderData.getTexture(t._specularGlossinessTextureProp)},set:function(e){this.shaderData.setTexture(t._specularGlossinessTextureProp,e),e?this.shaderData.enableMacro("HAS_SPECULARGLOSSINESSMAP"):this.shaderData.disableMacro("HAS_SPECULARGLOSSINESSMAP")}}]),t}(yi);bi._specularColorProp=it.getPropertyByName("u_specularColor"),bi._glossinessProp=it.getPropertyByName("u_glossinessFactor"),bi._specularGlossinessTextureProp=it.getPropertyByName("u_specularGlossinessSampler");var wi=function(e){function t(n){var r,i=(r=e.call(this,n,it.find("unlit"))||this).shaderData;return i.enableMacro("OMIT_NORMAL"),i.enableMacro("O3_NEED_TILINGOFFSET"),i.setColor(t._baseColorProp,new m(1,1,1,1)),i.setVector4(t._tilingOffsetProp,new _(1,1,0,0)),r}return P(t,e),t.prototype.clone=function(){var e=new t(this._engine);return this.cloneTo(e),e},T(t,[{key:"baseColor",get:function(){return this.shaderData.getColor(t._baseColorProp)},set:function(e){var n=this.shaderData.getColor(t._baseColorProp);e!==n&&e.cloneTo(n)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(t._baseTextureProp)},set:function(e){this.shaderData.setTexture(t._baseTextureProp,e),e?this.shaderData.enableMacro("O3_BASE_TEXTURE"):this.shaderData.disableMacro("O3_BASE_TEXTURE")}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(t._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(t._tilingOffsetProp);e!==n&&e.cloneTo(n)}}]),t}(mi);wi._baseColorProp=it.getPropertyByName("u_baseColor"),wi._baseTextureProp=it.getPropertyByName("u_baseTexture"),wi._tilingOffsetProp=it.getPropertyByName("u_tilingOffset");var Ti,Si,Ci,Pi,Mi,Ai,Ei,Ri,Fi,Li,Bi,Ii,Oi,zi,Di,ki,Ni,Ui=function(e){P(n,e);var t=n.prototype;function n(t){var n;return(n=e.call(this,t)||this)._sprites=new Array,n._spriteNamesToIndex={},n}return t.getSprite=function(e){var t=this._sprites[this._spriteNamesToIndex[e]];return t||console.warn("There is no sprite named "+e+" in the atlas."),t},t.getSprites=function(e,t){t.length=0;var n=this._spriteNamesToIndex[e];if(void 0!==n)for(var r=this._sprites;n>=0;n--){var i=r[n];i.name===e&&t.push(i)}else console.warn("The name of the sprite you want to find is not exit in SpriteAtlas.");return t},t._addSprite=function(e){this._spriteNamesToIndex[e.name]=this._sprites.push(e)-1},t._onDestroy=function(){this._sprites=null,this._spriteNamesToIndex=null},T(n,[{key:"sprites",get:function(){return this._sprites}}]),n}(Qe),Vi=function(e){function t(n,r,i,a,s,l){var u;return void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===s&&(s=128),void 0===l&&(l=null),(u=e.call(this,n)||this).name=void 0,u._uv=[new p,new p,new p,new p],u._positions=[new p,new p,new p,new p],u._bounds=new o,u._triangles=void 0,u._assetID=void 0,u._pixelsPerUnit=void 0,u._texture=null,u._atlasRotated=!1,u._region=new g(0,0,1,1),u._pivot=new p(.5,.5),u._atlasRegion=new g(0,0,1,1),u._atlasRegionOffset=new _(0,0,0,0),u._dirtyFlag=Ti.all,u.name=l,u._texture=r,u._pixelsPerUnit=s,i&&i.cloneTo(u._region),a&&a.cloneTo(u._pivot),u._triangles=t._rectangleTriangles,u}P(t,e);var n=t.prototype;return n._onDestroy=function(){this._texture&&(this._texture=null)},n._updatePositionsAndBounds=function(){var e=this._texture,t=this._bounds;if(e){var n,r,i,a,o,s,l=this._atlasRegion,u=this._pivot,c=this._atlasRegionOffset,d=this._region,f=d.x,h=d.y,p=d.width,_=d.height,v=1/this._pixelsPerUnit;if(this._atlasRotated?(o=e.height*l.height*v,s=e.width*l.width*v):(o=e.width*l.width*v,s=e.height*l.height*v),0==c.x&&0==c.y&&0==c.z&&0==c.w){var m=o*p,g=s*_;i=m+(n=-u.x*m),r=g+(a=-u.y*g)}else{var y=c.x,x=c.y,b=c.z,w=c.w,T=o/(1-b-y),S=s/(1-w-x);n=(-u.x*p+Math.max(y,f)-f)*T,r=(u.y*_-Math.max(x,h)+h)*S,i=(-u.x*p+Math.min(1-b,f+p)-f)*T,a=(u.y*_-Math.min(1-w,h+_)+h)*S}var C=this._positions;C[0].setValue(n,r),C[1].setValue(i,r),C[2].setValue(i,a),C[3].setValue(n,a),t.min.setValue(n,a,0),t.max.setValue(i,r,0)}else t.min.setValue(0,0,0),t.max.setValue(0,0,0)},n._updateMesh=function(){if(this._isContainDirtyFlag(Ti.positions)&&this._updatePositionsAndBounds(),this._isContainDirtyFlag(Ti.uv)){var e,t,n,r,i=this._atlasRegion,a=this._uv,o=this._region,s=this._atlasRotated,l=this._atlasRegionOffset;if(0==l.x&&0==l.y&&0==l.z&&0==l.w){var u=i.width,c=i.height;s?(e=u*(1-o.y-o.height)+i.x,t=c*o.x+i.y,n=u*o.height+e,r=c*o.width+t):(e=u*o.x+i.x,t=c*o.y+i.y,n=u*o.width+e,r=c*o.height+t)}else{var d=o.x,f=o.y,h=i.x,p=i.y,_=l.x,v=l.y,m=l.z,g=l.w;if(s){var y=i.width/(1-g-v),x=i.height/(1-m-_);e=(Math.max(g,1-f-o.height)-g)*y+h,t=(Math.max(_,d)-_)*x+p,n=(Math.min(1-v,1-f)-g)*y+h,r=(Math.min(1-m,d+o.width)-_)*x+p}else{var b=i.width/(1-m-_),w=i.height/(1-g-v);e=(Math.max(_,d)-_)*b+h,t=(Math.max(v,f)-v)*w+p,n=(Math.min(1-m,d+o.width)-_)*b+h,r=(Math.min(1-g,f+o.height)-v)*w+p}}s?(a[0].setValue(n,t),a[1].setValue(n,r),a[2].setValue(e,r),a[3].setValue(e,t)):(a[0].setValue(e,t),a[1].setValue(n,t),a[2].setValue(n,r),a[3].setValue(e,r))}},n._updateMeshData=function(){return!!this._isContainDirtyFlag(Ti.all)&&(this._updateMesh(),this._setDirtyFlagFalse(Ti.all),!0)},n._isContainDirtyFlag=function(e){return 0!=(this._dirtyFlag&e)},n._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},n._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},T(t,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._setDirtyFlagTrue(Ti.positions))}},{key:"bounds",get:function(){return this._isContainDirtyFlag(Ti.positions)&&this._texture&&(this._updatePositionsAndBounds(),this._setDirtyFlagFalse(Ti.positions)),this._bounds}},{key:"atlasRotated",get:function(){return this._atlasRotated},set:function(e){this._atlasRotated!=e&&(this._atlasRotated=e,this._setDirtyFlagTrue(Ti.positions|Ti.uv))}},{key:"atlasRegion",get:function(){return this._atlasRegion},set:function(e){var t=r.clamp(e.x,0,1),n=r.clamp(e.y,0,1);this._atlasRegion.setValue(t,n,r.clamp(e.width,0,1-t),r.clamp(e.height,0,1-n)),this._setDirtyFlagTrue(Ti.positions|Ti.uv)}},{key:"atlasRegionOffset",get:function(){return this._atlasRegionOffset},set:function(e){var t=r.clamp(e.x,0,1),n=r.clamp(e.y,0,1);this._atlasRegionOffset.setValue(t,n,r.clamp(e.z,0,1-t),r.clamp(e.w,0,1-n)),this._setDirtyFlagTrue(Ti.positions|Ti.uv)}},{key:"pivot",get:function(){return this._pivot},set:function(e){this._pivot.setValue(r.clamp(e.x,0,1),r.clamp(e.y,0,1)),this._setDirtyFlagTrue(Ti.positions)}},{key:"region",get:function(){return this._region},set:function(e){var t=this._region,n=r.clamp(e.x,0,1),i=r.clamp(e.y,0,1);t.setValue(n,i,r.clamp(e.width,0,1-n),r.clamp(e.height,0,1-i)),this._setDirtyFlagTrue(Ti.positions|Ti.uv)}},{key:"pixelsPerUnit",get:function(){return this._pixelsPerUnit},set:function(e){this._pixelsPerUnit!==e&&(this._pixelsPerUnit=e,this._setDirtyFlagTrue(Ti.positions))}}]),t}(Qe);Vi._rectangleTriangles=[0,2,1,2,0,3],function(e){e[e.positions=1]="positions",e[e.uv=2]="uv",e[e.all=3]="all"}(Ti||(Ti={}));var Gi,Hi=(Ni=ki=function(t){function n(e){var n;return I(n=t.call(this,e)||this,"_customLocalBounds",Ci,L(n)),I(n,"_customRootEntity",Pi,L(n)),I(n,"_positions",Mi,L(n)),I(n,"_sprite",Ai,L(n)),I(n,"_color",Ei,L(n)),I(n,"_flipX",Ri,L(n)),I(n,"_flipY",Fi,L(n)),I(n,"_cacheFlipX",Li,L(n)),I(n,"_cacheFlipY",Bi,L(n)),I(n,"_dirtyFlag",Ii,L(n)),I(n,"_isWorldMatrixDirty",Oi,L(n)),I(n,"_maskInteraction",zi,L(n)),I(n,"_maskLayer",Di,L(n)),n._isWorldMatrixDirty=e.transform.registerWorldChangeFlag(),n.setMaterial(n._engine._spriteDefaultMaterial),n}P(n,t);var r=n.prototype;return r._render=function(e){var t=this.sprite;if(t){var r=t.texture;if(r){var a=this._positions,o=this.entity.transform,s=t._updateMeshData();if(this._isWorldMatrixDirty.flag||s||this._isContainDirtyFlag(Gi.Sprite)){for(var l=t._positions,u=n._tempVec3,c=o.worldMatrix,d=this.flipX,f=this.flipY,h=0,p=a.length;h<p;h++){var _=l[h];u.setValue(d?-_.x:_.x,f?-_.y:_.y,0),i.transformToVec3(u,c,a[h])}this._setDirtyFlagFalse(Gi.Flip),this._setDirtyFlagFalse(Gi.Sprite),this._isWorldMatrixDirty.flag=!1,this._cacheFlipX=d,this._cacheFlipY=f}else if(this._isContainDirtyFlag(Gi.Flip)){var v=this.flipX,m=this.flipY,g=this._cacheFlipX!==v,y=this._cacheFlipY!==m;if(g||y)for(var x=o.worldPosition,b=x.x,w=x.y,T=0,S=a.length;T<S;T++){var C=a[T];g&&(C.x=2*b-C.x),y&&(C.y=2*w-C.y)}this._setDirtyFlagFalse(Gi.Flip),this._cacheFlipX=v,this._cacheFlipY=m}this._isContainDirtyFlag(Gi.MaskInteraction)&&(this._updateStencilState(),this._setDirtyFlagFalse(Gi.MaskInteraction)),this.shaderData.setTexture(n._textureProperty,r);var P=this.getMaterial(),M=this._engine._spriteElementPool.getFromPool();M.setValue(this,a,t._uv,t._triangles,this.color,P,e),e._renderPipeline.pushPrimitive(M)}}},r._onDestroy=function(){this._isWorldMatrixDirty.destroy(),t.prototype._onDestroy.call(this)},r._isContainDirtyFlag=function(e){return 0!=(this._dirtyFlag&e)},r._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},r._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},r._updateBounds=function(e){var t=this._sprite;if(t)if(this._customLocalBounds&&this._customRootEntity){var n=this._customRootEntity.transform.worldMatrix;o.transform(this._customLocalBounds,n,e)}else{var r=t.bounds,i=this._entity.transform.worldMatrix;o.transform(r,i,e)}else e.min.setValue(0,0,0),e.max.setValue(0,0,0)},r._updateStencilState=function(){var t=this.getInstanceMaterial().renderState.stencilState,n=this._maskInteraction;if(n===e.SpriteMaskInteraction.None)t.enabled=!1,t.writeMask=255,t.referenceValue=0,t.compareFunctionFront=t.compareFunctionBack=e.CompareFunction.Always;else{t.enabled=!0,t.writeMask=0,t.referenceValue=1;var r=n===e.SpriteMaskInteraction.VisibleInsideMask?e.CompareFunction.LessEqual:e.CompareFunction.Greater;t.compareFunctionFront=r,t.compareFunctionBack=r}},T(n,[{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._setDirtyFlagTrue(Gi.Sprite))}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&e.cloneTo(this._color)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._setDirtyFlagTrue(Gi.Flip))}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._setDirtyFlagTrue(Gi.Flip))}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._setDirtyFlagTrue(Gi.MaskInteraction))}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}}]),n}(en),ki._textureProperty=it.getPropertyByName("u_spriteTexture"),ki._tempVec3=new i,Ci=O((Si=Ni).prototype,"_customLocalBounds",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pi=O(Si.prototype,"_customRootEntity",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mi=O(Si.prototype,"_positions",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new i,new i,new i,new i]}}),Ai=O(Si.prototype,"_sprite",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ei=O(Si.prototype,"_color",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m(1,1,1,1)}}),Ri=O(Si.prototype,"_flipX",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fi=O(Si.prototype,"_flipY",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Li=O(Si.prototype,"_cacheFlipX",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bi=O(Si.prototype,"_cacheFlipY",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ii=O(Si.prototype,"_dirtyFlag",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gi.All}}),Oi=O(Si.prototype,"_isWorldMatrixDirty",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi=O(Si.prototype,"_maskInteraction",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e.SpriteMaskInteraction.None}}),Di=O(Si.prototype,"_maskLayer",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e.SpriteMaskLayer.Layer0}}),Si);!function(e){e[e.Flip=1]="Flip",e[e.Sprite=2]="Sprite",e[e.All=3]="All",e[e.MaskInteraction=4]="MaskInteraction"}(Gi||(Gi={}));var Wi,ji=function(){this.relativePath=void 0,this.type=void 0,this.property=void 0,this.curve=void 0};e.AnimationProperty=void 0,(Wi=e.AnimationProperty||(e.AnimationProperty={}))[Wi.Position=0]="Position",Wi[Wi.Rotation=1]="Rotation",Wi[Wi.Scale=2]="Scale",Wi[Wi.BlendShapeWeights=3]="BlendShapeWeights";var Xi,Ki,qi=function(t){function n(e){var n;return(n=t.call(this)||this).name=e,n._curveBindings=[],n._length=0,n._events=[],n}P(n,t);var r=n.prototype;return r.addEvent=function(e){this._events.push(e),this._events.sort((function(e,t){return e.time-t.time}))},r.clearEvents=function(){this._events.length=0},r.addCurveBinding=function(t,n,r,i){var a;switch(r){case"position":a=e.AnimationProperty.Position;break;case"rotation":a=e.AnimationProperty.Rotation;break;case"scale":a=e.AnimationProperty.Scale;break;case"blendShapeWeights":a=e.AnimationProperty.BlendShapeWeights}var o=new ji;o.relativePath=t,o.type=n,o.property=a,o.curve=i,i.length>this._length&&(this._length=i.length),this._curveBindings.push(o)},r.clearCurveBindings=function(){this._curveBindings.length=0,this._length=0},r._sampleAnimation=function(t,n){for(var r=this._curveBindings.length-1;r>=0;r--){var i=this._curveBindings[r],a=i.curve,o=i.property,s=i.relativePath,l=i.type,u=a.evaluate(n),c=t.findByName(s).transform;if(l===We)switch(o){case e.AnimationProperty.Position:c.position=u;break;case e.AnimationProperty.Rotation:c.rotationQuaternion=u;break;case e.AnimationProperty.Scale:c.scale=u}}},T(n,[{key:"events",get:function(){return this._events}},{key:"curveBindings",get:function(){return this._curveBindings}},{key:"length",get:function(){return this._length}}]),n}((function(){})),Qi=function(){function e(){}return e.scaleWeight=function(e,t,n){var r=e.x,i=e.y,a=e.z;n.x=r>0?Math.pow(Math.abs(r),t):-Math.pow(Math.abs(r),t),n.y=i>0?Math.pow(Math.abs(i),t):-Math.pow(Math.abs(i),t),n.z=a>0?Math.pow(Math.abs(a),t):-Math.pow(Math.abs(a),t)},e.scaleBlend=function(t,n,r,i){var a=e._tempVector30,o=e._tempVector31;e.scaleWeight(t,1-r,a),e.scaleWeight(n,r,o);var s=r>.5?n:t;i.x=s.x>0?Math.abs(a.x*o.x):-Math.abs(a.x*o.x),i.y=s.y>0?Math.abs(a.y*o.y):-Math.abs(a.y*o.y),i.z=s.z>0?Math.abs(a.z*o.z):-Math.abs(a.z*o.z)},e.quaternionWeight=function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w},e}();Qi._tempVector30=new i,Qi._tempVector31=new i,e.AnimatorLayerBlendingMode=void 0,(Xi=e.AnimatorLayerBlendingMode||(e.AnimatorLayerBlendingMode={}))[Xi.Override=0]="Override",Xi[Xi.Additive=1]="Additive",function(e){e[e.Standby=0]="Standby",e[e.Playing=1]="Playing",e[e.CrossFading=2]="CrossFading",e[e.FixedCrossFading=3]="FixedCrossFading"}(Ki||(Ki={}));var Yi,$i=function(){function t(t,n,r){switch(this.crossCurveMark=0,this.crossCurveIndex=void 0,this.target=void 0,this.type=void 0,this.property=void 0,this.component=void 0,this.defaultValue=void 0,this.fixedPoseValue=void 0,this.target=t,this.type=n,this.property=r,r){case e.AnimationProperty.Position:this.defaultValue=new i,this.fixedPoseValue=new i,this.component=t.transform;break;case e.AnimationProperty.Rotation:this.defaultValue=new d,this.fixedPoseValue=new d,this.component=t.transform;break;case e.AnimationProperty.Scale:this.defaultValue=new i,this.fixedPoseValue=new i,this.component=t.transform;break;case e.AnimationProperty.BlendShapeWeights:this.defaultValue=new Float32Array(4),this.fixedPoseValue=new Float32Array(4),this.component=t.getComponent(jn)}}var n=t.prototype;return n.saveDefaultValue=function(){switch(this.property){case e.AnimationProperty.Position:this.target.transform.position.cloneTo(this.defaultValue);break;case e.AnimationProperty.Rotation:this.target.transform.rotationQuaternion.cloneTo(this.defaultValue);break;case e.AnimationProperty.Scale:this.target.transform.scale.cloneTo(this.defaultValue)}},n.saveFixedPoseValue=function(){switch(this.property){case e.AnimationProperty.Position:this.target.transform.position.cloneTo(this.fixedPoseValue);break;case e.AnimationProperty.Rotation:this.target.transform.rotationQuaternion.cloneTo(this.fixedPoseValue);break;case e.AnimationProperty.Scale:this.target.transform.scale.cloneTo(this.fixedPoseValue)}},t}(),Ji=function(){this.event=void 0,this.handlers=[]},Zi=function(){this.duration=0,this.offset=0,this.exitTime=1,this.destinationState=void 0};e.WrapMode=void 0,(Yi=e.WrapMode||(e.WrapMode={}))[Yi.Once=0]="Once",Yi[Yi.Loop=1]="Loop";var ea,ta,na,ra,ia,aa,oa,sa,la,ua,ca,da,fa=function(){function t(){this.state=void 0,this.stateData=void 0,this.frameTime=void 0,this.finished=void 0,this.clipTime=void 0,this.currentEventIndex=void 0}var n=t.prototype;return n.reset=function(e,t,n){this.state=e,this.frameTime=n,this.stateData=t,this.finished=!1,this.currentEventIndex=0},n.update=function(){var t=this.state,n=this.frameTime,r=t.clipEndTime-t.clipStartTime;n>r&&(t.wrapMode===e.WrapMode.Loop?n%=r:(n=r,this.finished=!0)),this.clipTime=n+this.state.clipStartTime},t}(),ha=function(){function e(){this.animatorStateDataMap={},this.srcPlayData=new fa,this.destPlayData=new fa,this.layerState=Ki.Standby,this.crossCurveMark=0,this.manuallyTransition=new Zi,this.crossFadeTransition=void 0}return e.prototype.switchPlayData=function(){var e=this.destPlayData,t=this.srcPlayData;this.srcPlayData=e,this.destPlayData=t},e}(),pa=function(){this.curveOwners=[],this.eventHandlers=[]},_a=function(){this.curveOwner=void 0,this.srcCurveIndex=void 0,this.destCurveIndex=void 0},va=(ua=la=function(t){function n(e){var n;return(n=t.call(this,e)||this)._animatorController=void 0,I(n,"_speed",ta,L(n)),I(n,"_controllerUpdateFlag",na,L(n)),I(n,"_animatorLayersData",ra,L(n)),I(n,"_crossCurveDataCollection",ia,L(n)),I(n,"_animationCurveOwners",aa,L(n)),I(n,"_crossCurveDataPool",oa,L(n)),I(n,"_animationEventHandlerPool",sa,L(n)),n}P(n,t);var r=n.prototype;return r.play=function(e,t,r){var i;void 0===t&&(t=-1),void 0===r&&(r=0),null!==(i=this._controllerUpdateFlag)&&void 0!==i&&i.flag&&this._clearPlayData();var a=this._getAnimatorStateInfo(e,t,n._animatorInfo),o=a.state;if(o)if(o.clip){var s=this._getAnimatorLayerData(a.layerIndex),l=s.srcPlayData,u=l.state;u&&u!==o&&this._revertDefaultValue(l);var c=this._getAnimatorStateData(e,o,s);s.layerState=Ki.Playing,l.reset(o,c,o._getDuration()*r),this._saveDefaultValues(c)}else console.warn("The state named "+e+" has no AnimationClip data.")},r.crossFade=function(e,t,r,i){var a;void 0===r&&(r=-1),void 0===i&&(i=0),null!==(a=this._controllerUpdateFlag)&&void 0!==a&&a.flag&&this._clearPlayData();var o=this._getAnimatorStateInfo(e,r,n._animatorInfo).state,s=this._getAnimatorLayerData(r).manuallyTransition;s.duration=t,s.offset=i,s.destinationState=o,this._crossFadeByTransition(s,r)},r.update=function(e){var t;if(0!==this.speed){var n=this._animatorController;if(n&&(null===(t=this._controllerUpdateFlag)||void 0===t||!t.flag)){e*=this.speed;for(var r=0,i=n.layers.length;r<i;r++)this._getAnimatorLayerData(r).layerState!==Ki.Standby&&this._updateLayer(r,0===r,e/1e3)}}},r._onEnable=function(){this.engine._componentsManager.addOnUpdateAnimations(this)},r._onDisable=function(){this.engine._componentsManager.removeOnUpdateAnimations(this)},r._getAnimatorStateInfo=function(e,t,n){var r=null,i=this._animatorController;if(i){var a=i.layers;if(-1===t){for(var o=0,s=a.length;o<s;o--)if(r=a[o].stateMachine.findStateByName(e)){t=o;break}}else r=a[t].stateMachine.findStateByName(e)}return n.layerIndex=t,n.state=r,n},r._saveDefaultValues=function(e){for(var t=e.curveOwners,n=t.length-1;n>=0;n--)t[n].saveDefaultValue()},r._getAnimatorStateData=function(e,t,n){var r=n.animatorStateDataMap,i=r[e];return i||(i=new pa,r[e]=i,this._saveAnimatorStateData(t,i),this._saveAnimatorEventHandlers(t,i)),i},r._saveAnimatorStateData=function(e,t){for(var n=this.entity,r=this._animationCurveOwners,i=t.curveOwners,a=e.clip._curveBindings,o=a.length-1;o>=0;o--){var s=a[o],l=""===s.relativePath?n:n.findByPath(s.relativePath),u=s.property,c=l.instanceId,d=r[c]||(r[c]=[]);i[o]=d[u]||(d[u]=new $i(l,s.type,u))}},r._saveAnimatorEventHandlers=function(e,t){var n=this._animationEventHandlerPool,r=this._entity._scripts,i=r.length,a=t.eventHandlers,o=e.clip.events;n.resetPool(),a.length=0;for(var s=0,l=o.length;s<l;s++){var u=o[s],c=n.getFromPool(),d=u.functionName,f=c.handlers;c.event=u,f.length=0;for(var h=i-1;h>=0;h--){var p=r.get(h)[d];p&&f.push(p)}a.push(c)}},r._clearCrossData=function(e){e.crossCurveMark++,this._crossCurveDataCollection.length=0,this._crossCurveDataPool.resetPool()},r._addCrossCurveData=function(e,t,n,r){var i=this._crossCurveDataPool.getFromPool();i.curveOwner=t,i.srcCurveIndex=n,i.destCurveIndex=r,e.push(i)},r._prepareCrossFading=function(e){var t=this._crossCurveDataCollection,n=e.crossCurveMark;this._prepareSrcCrossData(t,e.srcPlayData,n,!1),this._prepareDestCrossData(t,e.destPlayData,n,!1)},r._prepareStandbyCrossFading=function(e){var t=this._crossCurveDataCollection,n=e.srcPlayData,r=e.crossCurveMark;n&&this._prepareSrcCrossData(t,n,r,!0),this._prepareDestCrossData(t,e.destPlayData,r,!0)},r._prepareFixedPoseCrossFading=function(e){for(var t=this._crossCurveDataCollection,n=t.length-1;n>=0;n--)t[n].curveOwner.saveFixedPoseValue();this._prepareDestCrossData(t,e.destPlayData,e.crossCurveMark,!0)},r._prepareSrcCrossData=function(e,t,n,r){for(var i=t.stateData.curveOwners,a=i.length-1;a>=0;a--){var o=i[a];o.crossCurveMark=n,o.crossCurveIndex=e.length,r&&o.saveFixedPoseValue(),this._addCrossCurveData(e,o,a,null)}},r._prepareDestCrossData=function(e,t,n,r){for(var i=t.stateData.curveOwners,a=i.length-1;a>=0;a--){var o=i[a];o.crossCurveMark===n?e[o.crossCurveIndex].destCurveIndex=a:(r&&o.saveFixedPoseValue(),o.crossCurveMark=n,this._addCrossCurveData(e,o,null,a))}},r._evaluateCurve=function(t,r,a,o){var s=r.evaluate(a);if(o){var l=r.keys[0].value;switch(t){case e.AnimationProperty.Position:var u=n._tempVector3;return i.subtract(s,l,u),u;case e.AnimationProperty.Rotation:var c=n._tempQuaternion;return d.conjugate(l,c),d.multiply(c,s,c),c;case e.AnimationProperty.Scale:var f=n._tempVector3;return i.divide(s,l,f),f}}return s},r._getAnimatorLayerData=function(e){var t=this._animatorLayersData[e];return t||(this._animatorLayersData[e]=t=new ha),t},r._updateLayer=function(t,n,r){var i=this._animatorController.layers[t],a=i.blendingMode,o=i.weight,s=this._animatorLayersData[t],l=s.srcPlayData,u=s.destPlayData,c=s.crossFadeTransition,d=a===e.AnimatorLayerBlendingMode.Additive,f=n?1:o;switch(this._checkTransition(l,c,t),s.layerState){case Ki.Playing:this._updatePlayingState(l,s,f,r,d);break;case Ki.FixedCrossFading:this._updateCrossFadeFromPose(u,s,f,r,d);break;case Ki.CrossFading:this._updateCrossFade(l,u,s,f,r,d)}},r._updatePlayingState=function(e,t,n,r,i){var a=e.stateData,o=a.curveOwners,s=a.eventHandlers,l=e.state,u=l.clip._curveBindings,c=e.clipTime;e.update();var d=e.clipTime;s.length&&this._fireAnimationEvents(e,s,c,d);for(var f=u.length-1;f>=0;f--){var h=o[f],p=this._evaluateCurve(h.property,u[f].curve,d,i);i?this._applyClipValueAdditive(h,p,n):this._applyClipValue(h,p,n)}e.frameTime+=l.speed*r,e.finished&&(t.layerState=Ki.Standby)},r._updateCrossFade=function(e,t,n,r,i,a){var o=this._crossCurveDataCollection,s=e.state.clip._curveBindings,l=t.state,u=l.clip._curveBindings,c=t.frameTime/(l._getDuration()*n.crossFadeTransition.duration);c>=1&&(c=1),e.update(),t.update();for(var d=e.clipTime,f=t.clipTime,h=o.length-1;h>=0;h--){var p=o[h],_=p.curveOwner,v=p.srcCurveIndex,m=p.destCurveIndex,g=_.property,y=_.defaultValue,x=s[v].curve,b=u[m].curve,w=v>=0?this._evaluateCurve(g,x,d,a):y,T=m>=0?this._evaluateCurve(g,b,f,a):y;this._applyCrossClipValue(_,w,T,c,r,a)}this._updateCrossFadeData(n,c,i,!1)},r._updateCrossFadeFromPose=function(e,t,n,r,i){var a=this._crossCurveDataCollection,o=e.state,s=o.clip._curveBindings,l=e.frameTime/(o._getDuration()*t.crossFadeTransition.duration);l>=1&&(l=1),e.update();for(var u=e.clipTime,c=a.length-1;c>=0;c--){var d=a[c],f=d.curveOwner,h=d.destCurveIndex,p=s[h].curve,_=h>=0?this._evaluateCurve(f.property,p,u,i):f.defaultValue;this._applyCrossClipValue(f,f.fixedPoseValue,_,l,n,i)}this._updateCrossFadeData(t,l,r,!0)},r._updateCrossFadeData=function(e,t,n,r){var i=e.destPlayData;i.frameTime+=i.state.speed*n,1===t?(i.finished?e.layerState=Ki.Standby:e.layerState=Ki.Playing,e.switchPlayData()):r||(e.srcPlayData.frameTime+=e.srcPlayData.state.speed*n)},r._applyCrossClipValue=function(t,r,a,o,s,l){var u;if(t.type===We){var c=t.target.transform;switch(t.property){case e.AnimationProperty.Position:i.lerp(r,a,o,n._tempVector3),u=n._tempVector3;break;case e.AnimationProperty.Rotation:d.slerp(r,a,o,n._tempQuaternion),u=n._tempQuaternion;break;case e.AnimationProperty.Scale:var f=c.scale;i.lerp(r,a,o,n._tempVector3),c.scale=f,u=n._tempVector3}}l?this._applyClipValueAdditive(t,u,s):this._applyClipValue(t,u,s)},r._applyClipValue=function(t,n,r){if(t.type===We){var a=t.target.transform;switch(t.property){case e.AnimationProperty.Position:if(1===r)a.position=n;else{var o=a.position;i.lerp(o,n,r,o),a.position=o}break;case e.AnimationProperty.Rotation:if(1===r)a.rotationQuaternion=n;else{var s=a.rotationQuaternion;d.slerp(s,n,r,s),a.rotationQuaternion=s}break;case e.AnimationProperty.Scale:if(1===r)a.scale=n;else{var l=a.scale;i.lerp(l,n,r,l),a.scale=l}}}else t.type===jn&&t.property===e.AnimationProperty.BlendShapeWeights&&(t.component.blendShapeWeights=n)},r._applyClipValueAdditive=function(t,n,r){if(t.type===We){var a=t.target.transform;switch(t.property){case e.AnimationProperty.Position:var o=a.position;o.x+=n.x*r,o.y+=n.y*r,o.z+=n.z*r,a.position=o;break;case e.AnimationProperty.Rotation:var s=a.rotationQuaternion;Qi.quaternionWeight(n,r,n),n.normalize(),s.multiply(n),a.rotationQuaternion=s;break;case e.AnimationProperty.Scale:var l=a.scale;Qi.scaleWeight(l,r,l),i.multiply(l,n,l),a.scale=l}}},r._revertDefaultValue=function(t){var n=t.state.clip;if(n)for(var r=n._curveBindings,i=t.stateData.curveOwners,a=r.length-1;a>=0;a--){var o=i[a],s=o.target.transform;switch(o.property){case e.AnimationProperty.Position:s.position=o.defaultValue;break;case e.AnimationProperty.Rotation:s.rotationQuaternion=o.defaultValue;break;case e.AnimationProperty.Scale:s.scale=o.defaultValue}}},r._checkTransition=function(e,t,n){for(var r=e.state,i=e.clipTime,a=r._getDuration(),o=r.transitions,s=0,l=o.length;s<l;++s){var u=o[s];a*u.exitTime<=i&&t!==u&&this._crossFadeByTransition(u,n)}},r._crossFadeByTransition=function(e,t){var r=e.destinationState.name,i=this._getAnimatorStateInfo(r,t,n._animatorInfo),a=i.state;if(a)if(a.clip){var o=this._getAnimatorLayerData(i.layerIndex),s=o.layerState,l=o.destPlayData,u=this._getAnimatorStateData(r,a,o),c=a._getDuration()*e.offset;switch(l.reset(a,u,c),this._saveDefaultValues(u),s){case Ki.Standby:o.layerState=Ki.FixedCrossFading,this._clearCrossData(o),this._prepareStandbyCrossFading(o);break;case Ki.Playing:o.layerState=Ki.CrossFading,this._clearCrossData(o),this._prepareCrossFading(o);break;case Ki.CrossFading:o.layerState=Ki.FixedCrossFading,this._prepareFixedPoseCrossFading(o);break;case Ki.FixedCrossFading:this._prepareFixedPoseCrossFading(o)}o.crossFadeTransition=e}else console.warn("The state named "+r+" has no AnimationClip data.")},r._fireAnimationEvents=function(e,t,n,r){r<n?(this._fireSubAnimationEvents(e,t,n,e.state.clipEndTime),e.currentEventIndex=0,this._fireSubAnimationEvents(e,t,e.state.clipStartTime,r)):this._fireSubAnimationEvents(e,t,n,r)},r._fireSubAnimationEvents=function(e,t,n,r){for(var i=e.currentEventIndex,a=t.length;i<a;i++){var o=t[i],s=o.event,l=s.time,u=s.parameter;if(l>r)break;var c=o.handlers;if(l>=n){for(var d=c.length-1;d>=0;d--)c[d](u);e.currentEventIndex=i+1}}},r._clearPlayData=function(){this._animatorLayersData.length=0,this._crossCurveDataCollection.length=0,this._animationCurveOwners.length=0,this._controllerUpdateFlag.flag=!1},T(n,[{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e}},{key:"animatorController",get:function(){return this._animatorController},set:function(e){e!==this._animatorController&&(this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e)}}]),n}(Ve),la._tempVector3=new i,la._tempQuaternion=new d,la._animatorInfo=new function(){this.layerIndex=void 0,this.state=void 0},ta=O((ea=ua).prototype,"_speed",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),na=O(ea.prototype,"_controllerUpdateFlag",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ra=O(ea.prototype,"_animatorLayersData",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ia=O(ea.prototype,"_crossCurveDataCollection",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aa=O(ea.prototype,"_animationCurveOwners",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oa=O(ea.prototype,"_crossCurveDataPool",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Nt(_a)}}),sa=O(ea.prototype,"_animationEventHandlerPool",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Nt(Ji)}}),ea),ma=function(){function e(){this._updateFlagManager=new He,this._layers=[],this._layersMap={}}var t=e.prototype;return t.findLayerByName=function(e){return this._layersMap[e]},t.addLayer=function(e){this._layers.push(e),this._layersMap[e.name]=e,this._distributeUpdateFlag()},t.removeLayer=function(e){var t=this.layers[e];this._layers.splice(e,1),delete this._layersMap[t.name],this._distributeUpdateFlag()},t.clearLayers=function(){for(var e in this._layers.length=0,this._layersMap)delete this._layersMap[e];this._distributeUpdateFlag()},t._registerChangeFlag=function(){return this._updateFlagManager.register()},t._distributeUpdateFlag=function(){this._updateFlagManager.distribute()},T(e,[{key:"layers",get:function(){return this._layers}}]),e}(),ga=function(t){this.name=t,this.weight=1,this.blendingMode=e.AnimatorLayerBlendingMode.Override,this.stateMachine=void 0},ya=function(){function t(t){this.name=t,this.speed=1,this.wrapMode=e.WrapMode.Loop,this._clipStartTime=0,this._clipEndTime=1/0,this._clip=void 0,this._transitions=[]}var n=t.prototype;return n.addTransition=function(e){this._transitions.push(e)},n.removeTransition=function(e){var t=this._transitions.indexOf(e);-1!==t&&this._transitions.splice(t,1)},n.clearTransitions=function(){this._transitions.length=0},n._getDuration=function(){return this._clipEndTime-this._clipStartTime},T(t,[{key:"transitions",get:function(){return this._transitions}},{key:"clip",get:function(){return this._clip},set:function(e){this._clip=e,this._clipEndTime=Math.min(this._clipEndTime,e.length)}},{key:"clipStartTime",get:function(){return this._clipStartTime},set:function(e){this._clipStartTime=e<0?0:e}},{key:"clipEndTime",get:function(){return this._clipEndTime},set:function(e){var t=this._clip;t&&(this._clipEndTime=Math.min(e,t.length))}}]),t}(),xa=function(){function e(){this.states=[],this._statesMap={}}var t=e.prototype;return t.addState=function(e){var t=this.findStateByName(e);return t?console.warn("The state named "+e+" has existed."):(t=new ya(e),this.states.push(t),this._statesMap[e]=t),t},t.removeState=function(e){var t=e.name,n=this.states.indexOf(e);n>-1&&this.states.splice(n,1),delete this._statesMap[t]},t.findStateByName=function(e){return this._statesMap[e]},t.makeUniqueStateName=function(e){for(var t=this._statesMap,n=e,r=0;t[e];)e=n+" "+r,r++;return e},e}();e.InterpolableValueType=void 0,(ca=e.InterpolableValueType||(e.InterpolableValueType={}))[ca.Float=0]="Float",ca[ca.FloatArray=1]="FloatArray",ca[ca.Vector2=2]="Vector2",ca[ca.Vector3=3]="Vector3",ca[ca.Vector4=4]="Vector4",ca[ca.Quaternion=5]="Quaternion",e.InterpolationType=void 0,(da=e.InterpolationType||(e.InterpolationType={}))[da.Linear=0]="Linear",da[da.CubicSpine=1]="CubicSpine",da[da.Step=2]="Step",da[da.Hermite=3]="Hermite";var ba,wa=function(){function t(){this.keys=[],this.interpolation=void 0,this._valueSize=void 0,this._valueType=void 0,this._currentValue=void 0,this._length=0,this._currentIndex=0}var n=t.prototype;return n.addKey=function(t){var n=t.time;if(this.keys.push(t),n>this._length&&(this._length=n),!this._valueSize&&("number"==typeof t.value&&(this._valueSize=1,this._valueType=e.InterpolableValueType.Float,this._currentValue=0),t.value instanceof p&&(this._valueSize=2,this._valueType=e.InterpolableValueType.Vector2,this._currentValue=new p),t.value instanceof i&&(this._valueSize=3,this._valueType=e.InterpolableValueType.Vector3,this._currentValue=new i),t.value instanceof _&&(this._valueSize=4,this._valueType=e.InterpolableValueType.Vector4,this._currentValue=new _),t.value instanceof d&&(this._valueSize=4,this._valueType=e.InterpolableValueType.Quaternion,this._currentValue=new d),t.value instanceof Float32Array)){var r=t.value.length;this._valueSize=r,this._valueType=e.InterpolableValueType.FloatArray,this._currentValue=new Float32Array(r)}this.keys.sort((function(e,t){return e.time-t.time}))},n.evaluate=function(t){var n=this.keys,r=this.interpolation,i=this.keys.length,a=this._currentIndex;-1!==a&&t<n[a].time&&(a=-1);for(var o,s=a+1;s<i&&!(t<n[s].time);)a++,s++;if(this._currentIndex=a,-1===a)o=n[0].value;else if(s===i)o=n[a].value;else{var l=n[a].time,u=n[s].time-l,c=(t-l)/u,d=u;switch(r){case e.InterpolationType.Linear:o=this._evaluateLinear(a,s,c);break;case e.InterpolationType.CubicSpine:o=this._evaluateCubicSpline(a,s,c);break;case e.InterpolationType.Step:o=this._evaluateStep(s);break;case e.InterpolationType.Hermite:o=this._evaluateHermite(a,s,c,d)}}return o},n.moveKey=function(e,t){this.keys[e]=t},n.removeKey=function(e){this.keys.splice(e,1);for(var t=this.keys,n=0,r=this.keys.length-1;r>=0;r--)t[r].time>length&&(n=t[r].time);this._length=n},n._evaluateLinear=function(t,n,r){var a=this._valueType,o=this.keys;switch(a){case e.InterpolableValueType.Float:return o[t].value*(1-r)+o[n].value*r;case e.InterpolableValueType.FloatArray:for(var s=this._currentValue,l=o[t].value,u=o[n].value,c=0,f=l.length;c<f;c++)s[c]=l[c]*(1-r)+u[c]*r;return s;case e.InterpolableValueType.Vector2:return p.lerp(o[t].value,o[n].value,r,this._currentValue),this._currentValue;case e.InterpolableValueType.Vector3:return i.lerp(o[t].value,o[n].value,r,this._currentValue),this._currentValue;case e.InterpolableValueType.Quaternion:return d.slerp(o[t].value,o[n].value,r,this._currentValue),this._currentValue}},n._evaluateCubicSpline=function(e,t,n){var r=this.keys,i=n*n,a=n*i,o=2*a-3*i+1,s=-2*a+3*i,l=a-2*i+n,u=a-i,c=r[e].value,d=r[e+1].value,f=r[e+2].value,h=r[t+1].value;return d.scale(o).add(h.scale(s)).add(c.scale(l)).add(f.scale(u)).clone()},n._evaluateStep=function(e){return this._valueSize,this.keys[e].value},n._evaluateHermite=function(e,t,n,r){var i=this._valueSize,a=this.keys,o=a[e],s=a[t];switch(i){case 1:var l=o.outTangent,u=s.inTangent,c=o.value,d=s.value;if(Number.isFinite(l)&&Number.isFinite(u)){var f=n*n,h=f*n;return(2*h-3*f+1)*c+(h-2*f+n)*l*r+(h-f)*u*r+(-2*h+3*f)*d}return o.value;case 2:var p=o.value,_=o.outTangent,v=s.value,m=s.inTangent,g=n*n,y=g*n,x=2*y-3*g+1,b=y-2*g+n,w=y-g,T=-2*y+3*g,S=_.x,C=m.x;return Number.isFinite(S)&&Number.isFinite(C)?this._currentValue.x=x*p.x+b*S*r+w*C*r+T*v.x:this._currentValue.x=p.x,S=_.y,C=m.y,Number.isFinite(S)&&Number.isFinite(C)?this._currentValue.y=x*p.y+b*S*r+w*C*r+T*v.y:this._currentValue.y=p.y,this._currentValue;case 3:var P=o.value,M=o.outTangent,A=s.value,E=s.inTangent,R=n*n,F=R*n,L=2*F-3*R+1,B=F-2*R+n,I=F-R,O=-2*F+3*R,z=M.x,D=E.x;return Number.isFinite(z)&&Number.isFinite(D)?this._currentValue.x=L*P.x+B*z*r+I*D*r+O*A.x:this._currentValue.x=P.x,z=M.y,D=E.y,Number.isFinite(z)&&Number.isFinite(D)?this._currentValue.y=L*P.y+B*z*r+I*D*r+O*A.y:this._currentValue.y=P.y,z=M.z,D=E.z,Number.isFinite(z)&&Number.isFinite(D)?this._currentValue.z=L*P.z+B*z*r+I*D*r+O*A.z:this._currentValue.z=P.z,this._currentValue;case 4:var k=o.value,N=o.outTangent,U=s.value,V=s.inTangent,G=n*n,H=G*n,W=2*H-3*G+1,j=H-2*G+n,X=H-G,K=-2*H+3*G,q=N.x,Q=V.x;return Number.isFinite(q)&&Number.isFinite(Q)?this._currentValue.x=W*k.x+j*q*r+X*Q*r+K*U.x:this._currentValue.x=k.x,q=N.y,Q=V.y,Number.isFinite(q)&&Number.isFinite(Q)?this._currentValue.y=W*k.y+j*q*r+X*Q*r+K*U.y:this._currentValue.y=k.y,q=N.z,Q=V.z,Number.isFinite(q)&&Number.isFinite(Q)?this._currentValue.z=W*k.z+j*q*r+X*Q*r+K*U.z:this._currentValue.z=k.z,q=N.w,Q=V.w,Number.isFinite(q)&&Number.isFinite(Q)?this._currentValue.w=W*k.w+j*q*r+X*Q*r+K*U.w:this._currentValue.w=k.w,this._currentValue}},T(t,[{key:"length",get:function(){return this._length}}]),t}(),Ta=function(){this.time=void 0,this.value=void 0},Sa=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).inTangent=void 0,t.outTangent=void 0,t}return P(t,e),t}(Ta);e.AnimatorConditionMode=void 0,(ba=e.AnimatorConditionMode||(e.AnimatorConditionMode={}))[ba.If=0]="If",ba[ba.IfNot=1]="IfNot",ba[ba.Greater=2]="Greater",ba[ba.Less=3]="Less",ba[ba.Equals=4]="Equals",ba[ba.NotEquals=5]="NotEquals";var Ca,Pa,Ma=function(t){function n(n){var r;return(r=t.call(this,n,it.find("skybox"))||this).renderState.rasterState.cullMode=e.CullMode.Off,r.renderState.depthState.compareFunction=e.CompareFunction.LessEqual,r}return P(n,t),T(n,[{key:"textureCubeMap",get:function(){return this.shaderData.getTexture("u_cube")},set:function(e){this.shaderData.setTexture("u_cube",e)}}]),n}(kt);!function(e){e[e.Position=1]="Position",e[e.Velocity=2]="Velocity",e[e.Acceleration=4]="Acceleration",e[e.Color=8]="Color",e[e.Alpha=16]="Alpha",e[e.Size=32]="Size",e[e.StartAngle=64]="StartAngle",e[e.StartTime=128]="StartTime",e[e.LifeTime=256]="LifeTime",e[e.RotateVelocity=512]="RotateVelocity",e[e.Scale=1024]="Scale",e[e.Everything=4294967295]="Everything"}(Ca||(Ca={})),e.ParticleRendererBlendMode=void 0,(Pa=e.ParticleRendererBlendMode||(e.ParticleRendererBlendMode={}))[Pa.Transparent=0]="Transparent",Pa[Pa.Additive=1]="Additive";var Aa=function(t){function n(n){var r;return(r=t.call(this,n)||this)._vertexStride=void 0,r._vertices=void 0,r._vertexBuffer=void 0,r._maxCount=1e3,r._position=new i,r._positionRandomness=new i,r._positionArray=void 0,r._velocity=new i,r._velocityRandomness=new i,r._acceleration=new i,r._accelerationRandomness=new i,r._color=new m(1,1,1,1),r._colorRandomness=0,r._size=1,r._sizeRandomness=0,r._alpha=1,r._alphaRandomness=0,r._startAngle=0,r._startAngleRandomness=0,r._rotateVelocity=0,r._rotateVelocityRandomness=0,r._lifetime=5,r._startTimeRandomness=0,r._scale=1,r._isOnce=!1,r._onceTime=0,r._time=0,r._isInit=!1,r._isStart=!1,r._updateDirtyFlag=Ca.Everything,r._isRotateToVelocity=!1,r._isUseOriginColor=!1,r._isScaleByLifetime=!1,r._is2d=!0,r._isFadeIn=!1,r._isFadeOut=!1,r._playOnEnable=!0,r._blendMode=e.ParticleRendererBlendMode.Transparent,r.spriteSheet=void 0,r.setMaterial(r._createMaterial()),r}P(n,t),n._getRandom=function(){return Math.random()-.5};var a=n.prototype;return a.update=function(e){if(this._isInit&&this._isStart){if(this._isOnce&&this._time>this._onceTime)return this.stop();this._updateDirtyFlag&&(this._updateBuffer(),this._updateDirtyFlag=0),this._time+=e/1e3,this.shaderData.setFloat("u_time",this._time)}},a._onEnable=function(){t.prototype._onEnable.call(this),this._playOnEnable&&this.start()},a.start=function(){this._isStart=!0,this._time=0},a.stop=function(){this._isStart=!1},a._createMaterial=function(){var t=new kt(this.engine,it.find("particle-shader")),n=t.renderState,r=n.blendState.targetBlendState;return r.enabled=!0,r.sourceColorBlendFactor=e.BlendFactor.SourceAlpha,r.destinationColorBlendFactor=e.BlendFactor.OneMinusSourceAlpha,r.sourceAlphaBlendFactor=e.BlendFactor.One,r.destinationAlphaBlendFactor=e.BlendFactor.OneMinusSourceAlpha,n.depthState.writeEnabled=!1,t.renderQueueType=e.RenderQueueType.Transparent,this.isUseOriginColor=!0,this.is2d=!0,this.isFadeOut=!0,t},a._createMesh=function(){var t=new Kn(this._entity.engine,"particleMesh"),r=4*this._maxCount,i=96*r,a=new Float32Array(i),o=null,s=!1;if(r>n._uint16VertexLimit){if(!this.engine._hardwareRenderer.canIUse(e.GLCapabilityType.elementIndexUint))throw Error("The vertex count is over limit.");s=!0,o=new Uint32Array(6*this._maxCount)}else o=new Uint16Array(6*this._maxCount);for(var l=0,u=0;l<this._maxCount;++l){var c=4*l;o[u++]=c,o[u++]=c+1,o[u++]=c+2,o[u++]=c,o[u++]=c+2,o[u++]=c+3}var d=[new un("a_position",0,e.VertexElementFormat.Vector3,0),new un("a_velocity",12,e.VertexElementFormat.Vector3,0),new un("a_acceleration",24,e.VertexElementFormat.Vector3,0),new un("a_color",36,e.VertexElementFormat.Vector4,0),new un("a_lifeAndSize",52,e.VertexElementFormat.Vector4,0),new un("a_rotation",68,e.VertexElementFormat.Vector2,0),new un("a_uv",76,e.VertexElementFormat.Vector3,0),new un("a_normalizedUv",88,e.VertexElementFormat.Vector2,0)],f=new dn(this.engine,e.BufferBindFlag.VertexBuffer,4*i,e.BufferUsage.Dynamic),h=new dn(this.engine,e.BufferBindFlag.IndexBuffer,o,e.BufferUsage.Dynamic);return t.setVertexBufferBinding(f,96),t.setIndexBufferBinding(h,s?e.IndexFormat.UInt32:e.IndexFormat.UInt16),t.setVertexElements(d),t.addSubMesh(0,o.length),this._vertexBuffer=f,this._vertexStride=24,this._vertices=a,t},a._updateBuffer=function(){for(var e=0;e<this._maxCount;e++)this._updateSingleBuffer(e);this._vertexBuffer.setData(this._vertices)},a._updateSingleBuffer=function(e){var t=this._updateDirtyFlag,i=this._vertices,a=this._vertexStride,o=n._getRandom,s=4*e,l=s*a,u=(s+1)*a,c=(s+2)*a,d=(s+3)*a;if(t&Ca.Position){var f=this._position,h=f.x,p=f.y,_=f.z,v=this._positionArray,m=this._positionRandomness;if(v){if(v.length!==this._maxCount)throw Error("The length of positionArray must be equal to maxCount.");var g=v[e];h+=g.x,p+=g.y,_+=g.z}else h+=o()*m.x,p+=o()*m.y,_+=o()*m.z;i[l]=i[u]=i[c]=i[d]=h,i[l+1]=i[u+1]=i[c+1]=i[d+1]=p,i[l+2]=i[u+2]=i[c+2]=i[d+2]=_}if(t&Ca.Velocity){var y=this._velocity,x=this._velocityRandomness;i[l+3]=i[u+3]=i[c+3]=i[d+3]=y.x+o()*x.x,i[l+4]=i[u+4]=i[c+4]=i[d+4]=y.y+o()*x.y,i[l+5]=i[u+5]=i[c+5]=i[d+5]=y.z+o()*x.z}if(t&Ca.Acceleration){var b=this._acceleration,w=this._accelerationRandomness;i[l+6]=i[u+6]=i[c+6]=i[d+6]=b.x+o()*w.x,i[l+7]=i[u+7]=i[c+7]=i[d+7]=b.y+o()*w.y,i[l+8]=i[u+8]=i[c+8]=i[d+8]=b.z+o()*w.z}if(t&Ca.Color){var T=this._color,S=this._colorRandomness;i[l+9]=i[u+9]=i[c+9]=i[d+9]=r.clamp(T.r+o()*S,0,1),i[l+10]=i[u+10]=i[c+10]=i[d+10]=r.clamp(T.g+o()*S,0,1),i[l+11]=i[u+11]=i[c+11]=i[d+11]=r.clamp(T.b+o()*S,0,1)}if(t&Ca.Alpha&&(i[l+12]=i[u+12]=i[c+12]=i[d+12]=r.clamp(this._alpha+o()*this._alphaRandomness,0,1)),t&Ca.StartTime&&(i[l+13]=i[u+13]=i[c+13]=i[d+13]=Math.random()*this._startTimeRandomness),t&Ca.LifeTime){var C=this._lifetime;i[l+14]=i[u+14]=i[c+14]=i[d+14]=C+o()*C}if((t&Ca.StartTime||t&Ca.LifeTime)&&(this._onceTime=Math.max(this._onceTime,i[l+13]+i[l+14])),t&Ca.Size){var P=this._size;i[l+15]=i[u+15]=i[c+15]=i[d+15]=Math.max(P+o()*this._sizeRandomness*P*2,0)}t&Ca.Scale&&(i[l+16]=i[u+16]=i[c+16]=i[d+16]=this._scale),t&Ca.StartAngle&&(i[l+17]=i[u+17]=i[c+17]=i[d+17]=this._startAngle+o()*Math.PI*this._startAngleRandomness*2),t&Ca.RotateVelocity&&(i[l+18]=i[u+18]=i[c+18]=i[d+18]=this._rotateVelocity+o()*this._rotateVelocityRandomness),this._updateSingleUv(e,l,u,c,d)},a._updateSingleUv=function(e,t,n,r,i){var a=this.spriteSheet,o=this.getMaterial().shaderData.getTexture("u_texture"),s=this._vertices;if(o){var l=o.width,u=o.height;if(a){var c=a[e%a.length],d=c.x,f=c.y,h=c.w,p=c.h,_=d/l,v=f/u,m=_+h/l,g=v+p/u,y=p/h;s[t+19]=_,s[t+20]=g,s[t+21]=y,s[n+19]=m,s[n+20]=g,s[n+21]=y,s[r+19]=m,s[r+20]=v,s[r+21]=y,s[i+19]=_,s[i+20]=v,s[i+21]=y}else{var x=u/l;s[t+19]=0,s[t+20]=1,s[t+21]=x,s[n+19]=1,s[n+20]=1,s[n+21]=x,s[r+19]=1,s[r+20]=0,s[r+21]=x,s[i+19]=0,s[i+20]=0,s[i+21]=x}}else s[t+19]=0,s[t+20]=0,s[t+21]=1,s[n+19]=1,s[n+20]=0,s[n+21]=1,s[r+19]=1,s[r+20]=1,s[r+21]=1,s[i+19]=0,s[i+20]=1,s[i+21]=1;s[t+22]=-.5,s[t+23]=-.5,s[n+22]=.5,s[n+23]=-.5,s[r+22]=.5,s[r+23]=.5,s[i+22]=-.5,s[i+23]=.5},T(n,[{key:"texture",get:function(){return this.getMaterial().shaderData.getTexture("u_texture")},set:function(e){e?(this.shaderData.enableMacro("particleTexture"),this.getMaterial().shaderData.setTexture("u_texture",e)):this.shaderData.disableMacro("particleTexture")}},{key:"position",get:function(){return this._position},set:function(e){this._updateDirtyFlag|=Ca.Position,this._position=e}},{key:"positionRandomness",get:function(){return this._positionRandomness},set:function(e){this._updateDirtyFlag|=Ca.Position,this._positionRandomness=e}},{key:"positionArray",get:function(){return this._positionArray},set:function(e){this._updateDirtyFlag|=Ca.Position,this._positionArray=e}},{key:"velocity",get:function(){return this._velocity},set:function(e){this._updateDirtyFlag|=Ca.Velocity,this._velocity=e}},{key:"velocityRandomness",get:function(){return this._velocityRandomness},set:function(e){this._updateDirtyFlag|=Ca.Velocity,this._velocityRandomness=e}},{key:"acceleration",get:function(){return this._acceleration},set:function(e){this._updateDirtyFlag|=Ca.Acceleration,this._acceleration=e}},{key:"accelerationRandomness",get:function(){return this._accelerationRandomness},set:function(e){this._updateDirtyFlag|=Ca.Acceleration,this._accelerationRandomness=e}},{key:"color",get:function(){return this._color},set:function(e){this._updateDirtyFlag|=Ca.Color,this._color=e}},{key:"colorRandomness",get:function(){return this._colorRandomness},set:function(e){this._updateDirtyFlag|=Ca.Color,this._colorRandomness=e}},{key:"size",get:function(){return this._size},set:function(e){this._updateDirtyFlag|=Ca.Size,this._size=e}},{key:"sizeRandomness",get:function(){return this._sizeRandomness},set:function(e){this._updateDirtyFlag|=Ca.Size,this._sizeRandomness=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._updateDirtyFlag|=Ca.Alpha,this._alpha=e}},{key:"alphaRandomness",get:function(){return this._alphaRandomness},set:function(e){this._updateDirtyFlag|=Ca.Alpha,this._alphaRandomness=e}},{key:"angle",get:function(){return this._startAngle},set:function(e){this._updateDirtyFlag|=Ca.StartAngle,this._startAngle=e}},{key:"angleRandomness",get:function(){return this._startAngleRandomness},set:function(e){this._updateDirtyFlag|=Ca.StartAngle,this._startAngleRandomness=e}},{key:"rotateVelocity",get:function(){return this._rotateVelocity},set:function(e){this._updateDirtyFlag|=Ca.RotateVelocity,this._rotateVelocity=e}},{key:"rotateVelocityRandomness",get:function(){return this._rotateVelocityRandomness},set:function(e){this._updateDirtyFlag|=Ca.RotateVelocity,this._rotateVelocityRandomness=e}},{key:"lifetime",get:function(){return this._lifetime},set:function(e){this._updateDirtyFlag|=Ca.LifeTime,this._lifetime=e,this._onceTime=0}},{key:"startTimeRandomness",get:function(){return this._startTimeRandomness},set:function(e){this._updateDirtyFlag|=Ca.StartTime,this._startTimeRandomness=e,this._onceTime=0}},{key:"scale",get:function(){return this._scale},set:function(e){this._updateDirtyFlag|=Ca.Scale,this._scale=e}},{key:"maxCount",get:function(){return this._maxCount},set:function(e){this._isStart=!1,this._isInit=!1,this._maxCount=e,this._updateDirtyFlag=Ca.Everything,this.mesh=this._createMesh(),this._updateBuffer(),this._isInit=!0,this.shaderData.setFloat("u_time",0)}},{key:"isOnce",get:function(){return this._isOnce},set:function(e){this._time=0,this.shaderData.setInt("u_once",e?1:0),this._isOnce=e}},{key:"isRotateToVelocity",get:function(){return this._isRotateToVelocity},set:function(e){e?this.shaderData.enableMacro("rotateToVelocity"):this.shaderData.disableMacro("rotateToVelocity"),this._isRotateToVelocity=e}},{key:"isUseOriginColor",get:function(){return this._isUseOriginColor},set:function(e){e?this.shaderData.enableMacro("useOriginColor"):this.shaderData.disableMacro("useOriginColor"),this._isUseOriginColor=e}},{key:"isScaleByLifetime",get:function(){return this._isScaleByLifetime},set:function(e){e?this.shaderData.enableMacro("isScaleByLifetime"):this.shaderData.disableMacro("isScaleByLifetime"),this._isScaleByLifetime=e}},{key:"is2d",get:function(){return this._is2d},set:function(t){t?this.shaderData.enableMacro("is2d"):(this.shaderData.disableMacro("is2d"),this.getMaterial().renderState.rasterState.cullMode=e.CullMode.Off),this._is2d=t}},{key:"isFadeIn",get:function(){return this._isFadeIn},set:function(e){e?this.shaderData.enableMacro("fadeIn"):this.shaderData.disableMacro("fadeIn"),this._isFadeIn=e}},{key:"isFadeOut",get:function(){return this._isFadeOut},set:function(e){e?this.shaderData.enableMacro("fadeOut"):this.shaderData.disableMacro("fadeOut"),this._isFadeOut=e}},{key:"playOnEnable",get:function(){return this._playOnEnable},set:function(e){this._playOnEnable=e,e?this.start():this.stop()}},{key:"blendMode",get:function(){return this._blendMode},set:function(t){var n=this.getMaterial().renderState.blendState.targetBlendState;t===e.ParticleRendererBlendMode.Transparent?(n.enabled=!0,n.sourceColorBlendFactor=e.BlendFactor.SourceAlpha,n.destinationColorBlendFactor=e.BlendFactor.OneMinusSourceAlpha,n.sourceAlphaBlendFactor=e.BlendFactor.One,n.destinationAlphaBlendFactor=e.BlendFactor.OneMinusSourceAlpha):t===e.ParticleRendererBlendMode.Additive&&(n.enabled=!0,n.sourceColorBlendFactor=e.BlendFactor.SourceAlpha,n.destinationColorBlendFactor=e.BlendFactor.One,n.sourceAlphaBlendFactor=e.BlendFactor.One,n.destinationAlphaBlendFactor=e.BlendFactor.OneMinusSourceAlpha),this._blendMode=t}}]),n}(Wn);Aa._uint16VertexLimit=65535,it.create("trail","#define GLSLIFY 1\nattribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;uniform mat4 u_projMat;uniform mat4 u_viewMat;void main(){gl_Position=u_projMat*u_viewMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}","#define GLSLIFY 1\nvarying vec2 v_uv;uniform sampler2D u_texture;void main(void){gl_FragColor=texture2D(u_texture,v_uv);}");var Ea=function(t){function n(n){var r,i=(r=t.call(this,n,it.find("trail"))||this).renderState.blendState.targetBlendState;return i.enabled=!0,i.sourceColorBlendFactor=i.sourceAlphaBlendFactor=e.BlendFactor.SourceAlpha,i.destinationColorBlendFactor=i.destinationAlphaBlendFactor=e.BlendFactor.One,r.renderState.depthState.writeEnabled=!1,r}return P(n,t),n}(kt),Ra=new i,Fa=function(t){function n(e,n){var r;(r=t.call(this,e)||this)._vertexStride=void 0,r._vertices=void 0,r._vertexBuffer=void 0,r._stroke=void 0,r._minSeg=void 0,r._lifetime=void 0,r._maxPointNum=void 0,r._points=void 0,r._pointStates=void 0,r._strapPoints=void 0,r._curPointNum=void 0,r._prePointsNum=void 0,r._stroke=n.stroke||.2,r._minSeg=n.minSeg||.02,r._lifetime=n.lifetime||1e3,r._maxPointNum=r._lifetime/1e3*e.engine.targetFrameRate,r._points=[],r._pointStates=[],r._strapPoints=[];for(var a=0;a<r._maxPointNum;a++)r._points.push(new i),r._pointStates.push(r._lifetime),r._strapPoints.push(new i),r._strapPoints.push(new i);r._curPointNum=0;var o=n.material||new Ea(r.engine);return r.setMaterial(o),r.setTexture(n.texture),r._initGeometry(),r}P(n,t);var r=n.prototype;return r.update=function(e){for(var t=0,n=0,r=0;r<this._curPointNum;r++)this._pointStates[r]-=e,this._pointStates[r]<0?t++:t>0&&(n=r-t,this._pointStates[n]=this._pointStates[r],this._points[r].cloneTo(this._points[n]));this._curPointNum-=t;var a=!0;if(this._curPointNum===this._maxPointNum)a=!1;else if(this._curPointNum>0){var o=this._points[this._points.length-1];i.distance(this.entity.worldPosition,o)<this._minSeg&&(a=!1)}a&&(this._pointStates[this._curPointNum]=this._lifetime,this.entity.worldPosition.cloneTo(this._points[this._curPointNum]),this._curPointNum++)},r._render=function(e){this._updateStrapVertices(e,this._points),this._updateStrapCoords(),this._vertexBuffer.setData(this._vertices),t.prototype._render.call(this,e)},r.setTexture=function(e){e&&this.getMaterial().shaderData.setTexture("u_texture",e)},r._initGeometry=function(){var t=new Kn(this._entity.engine),n=2*this._maxPointNum,r=20*n,i=new Float32Array(r),a=[new un("POSITION",0,e.VertexElementFormat.Vector3,0),new un("TEXCOORD_0",12,e.VertexElementFormat.Vector2,0)],o=new dn(this.engine,4*r,e.BufferUsage.Dynamic);t.setVertexBufferBinding(o,20),t.setVertexElements(a),t.addSubMesh(0,n,e.MeshTopology.TriangleStrip),this._vertexBuffer=o,this._vertexStride=20,this._vertices=i,this.mesh=t},r._updateStrapVertices=function(e,t){var n=e.viewMatrix.elements,r=new i(n[0],n[4],n[8]),a=new i(n[1],n[5],n[9]),o=new i(n[2],n[6],n[10]),s=this._stroke;a.scale(s);var l=new i,u=new i,c=new d;i.transformByQuat(r,c,r),i.transformByQuat(a,c,a);var f=new i,h=new i,p=new i;r.normalize();for(var _=this._vertices,v=0;v<this._maxPointNum;v++){if(v<this._curPointNum){var m=t[v];v===this._curPointNum-1&&0!==v?i.subtract(m,t[v-1],p):i.subtract(t[v+1],m,p),this._projectOnPlane(p,o,p),p.normalize();var g=Math.acos(i.dot(r,p));i.cross(r,p,h),i.dot(h,o)<=0&&(g=2*Math.PI-g),d.rotationAxisAngle(o,g,c),i.transformByQuat(a,c,f),i.add(m,f,l),i.subtract(m,f,u)}var y=2*v*this._vertexStride/4,x=(2*v+1)*this._vertexStride/4;_[y]=l.x,_[y+1]=l.y,_[y+2]=l.z,_[x]=u.x,_[x+1]=u.y,_[x+2]=u.z}},r._updateStrapCoords=function(){if(this._prePointsNum!==this._curPointNum){this._prePointsNum=this._curPointNum;for(var e=this._curPointNum,t=1/e,n=this._vertices,r=0;r<e;r++){var i=1-r*t,a=2*r*this._vertexStride/4,o=(2*r+1)*this._vertexStride/4;n[a]=0,n[a+1]=i,n[o]=1,n[o+1]=i}}},r._projectOnVector=function(e,t,n){var r=t.clone();i.normalize(r,r);var a=i.dot(e,r);n.x=r.x*a,n.y=r.y*a,n.z=r.z*a},r._projectOnPlane=function(e,t,n){this._projectOnVector(e,t,Ra),i.subtract(e,Ra,n)},n}(Wn);function La(e,t){var n=e.center,r=new i(Math.max(t.min.x,Math.min(n.x,t.max.x)),Math.max(t.min.y,Math.min(n.y,t.max.y)),Math.max(t.min.z,Math.min(n.z,t.max.z)));return i.distance(n,r)<e.radius}var Ba=function(e){function t(t){var n;return(n=e.call(this,t)||this)._colliderManager=void 0,n._myCollider=void 0,n._overlappedCollider=void 0,n._sphere=void 0,n._box=new o,n}P(t,e);var n=t.prototype;return n.onUpdate=function(t){e.prototype.onUpdate.call(this,t);var n=null;if(this._colliderManager&&this._myCollider){var r=this._colliderManager.colliders;if(this._myCollider instanceof gr){this._updateWorldBox(this._myCollider,this._box);for(var i=0,a=r.length;i<a;i++){var o=r[i];if(o!=this._myCollider&&this._boxCollision(o)){n=o;for(var s=this.entity._scripts,l=0,u=s.length;l<u;l++)s.get(l).onTriggerStay(o)}}}else if(this._myCollider instanceof xr){this._sphere=this._getWorldSphere(this._myCollider);for(var c=0,d=r.length;c<d;c++){var f=r[c];if(f!=this._myCollider&&this._sphereCollision(f)){n=f;for(var h=this.entity._scripts,p=0,_=h.length;p<_;p++)h.get(p).onTriggerStay(f)}}}}if(null!=n&&this._overlappedCollider!=n)for(var v=this.entity._scripts,m=0,g=v.length;m<g;m++)v.get(m).onTriggerEnter(n);if(null!=this._overlappedCollider&&this._overlappedCollider!=n)for(var y=this.entity._scripts,x=0,b=y.length;x<b;x++)y.get(x).onTriggerExit(this._overlappedCollider);this._overlappedCollider=n},n._updateWorldBox=function(e,n){var r=e.entity.transform.worldMatrix,i=t._tempBox1;e.boxMax.cloneTo(i.max),e.boxMin.cloneTo(i.min),o.transform(i,r,n)},n._getWorldSphere=function(e){var t=new i;return i.transformCoordinate(e.center,e.entity.transform.worldMatrix,t),{radius:e.radius,center:t}},n._boxCollision=function(e){if(e instanceof gr){var n=t._tempBox2;return this._updateWorldBox(e,n),r=n,i=this._box,r.min.x<=i.max.x&&r.max.x>=i.min.x&&r.min.y<=i.max.y&&r.max.y>=i.min.y&&r.min.z<=i.max.z&&r.max.z>=i.min.z}var r,i;return e instanceof xr&&La(this._getWorldSphere(e),this._box)},n._sphereCollision=function(e){if(e instanceof gr){var n=t._tempBox2;return this._updateWorldBox(e,n),La(this._sphere,n)}var r,a;return e instanceof xr&&(r=this._getWorldSphere(e),a=this._sphere,i.distance(r.center,a.center)<r.radius+r.radius)},n.onAwake=function(){this._colliderManager=this.scene.findFeature(vr),this._myCollider=this.entity.getComponent(mr)},T(t,[{key:"overlappedCollider",get:function(){return this._overlappedCollider}}]),t}(kr);Ba._tempBox1=new o,Ba._tempBox2=new o;var Ia=function(e){function t(t){var n;return(n=e.call(this,t)||this)._color=new m(1,0,0,1),n.color=n._color,n}P(t,e);var n=t.prototype;return n._onEnable=function(){this.scene.shaderData.enableMacro("O3_HAS_FOG")},n._onDisable=function(){this.scene.shaderData.disableMacro("O3_HAS_FOG")},T(t,[{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.scene.shaderData.setColor(t._colorProperty,e)}}]),t}(Ve);Ia._colorProperty=it.getPropertyByName("u_fogColor");var Oa=function(e){function t(t){var n;return(n=e.call(this,t)||this)._density=.0025,n.density=n._density,n}P(t,e);var n=t.prototype;return n._onEnable=function(){this.scene.shaderData.enableMacro("O3_FOG_EXP2")},n._onDisable=function(){this.scene.shaderData.disableMacro("O3_FOG_EXP2")},T(t,[{key:"density",get:function(){return this._density},set:function(e){this._density=e,this.scene.shaderData.setFloat(t._densityProperty,e)}}]),t}(Ia);Oa._densityProperty=it.getPropertyByName("u_fogDensity");var za=function(e){function t(t){var n;return(n=e.call(this,t)||this)._near=1,n._far=1e3,n.near=n._near,n.far=n._far,n}return P(t,e),T(t,[{key:"near",get:function(){return this._near},set:function(e){this._near=e,this.scene.shaderData.setFloat(t._nearProperty,e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this.scene.shaderData.setFloat(t._farProperty,e)}}]),t}(Ia);za._nearProperty=it.getPropertyByName("u_fogNear"),za._farProperty=it.getPropertyByName("u_fogFar");var Da=function(t){function n(){for(var n,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=t.call.apply(t,[this].concat(i))||this).probeLayer=e.Layer.Everything,n.width=1024,n.height=1024,n.antiAliasing=1,n._isCube=!1,n._oriCameraRenderTarget=void 0,n._renderTarget=void 0,n._renderTargetSwap=void 0,n._activeRenderTarget=void 0,n._camera=void 0,n._oriCameraCullingMask=void 0,n}P(n,t);var r=n.prototype;return r.onTextureChange=function(e){},r.onBeginRender=function(t){this.enabled&&(this._camera=t,this._oriCameraCullingMask=t.cullingMask,t.cullingMask=this.probeLayer,this._activeRenderTarget&&this._activeRenderTarget.width===this.width&&this._activeRenderTarget.height===this.height&&this._activeRenderTarget.antiAliasing===this.antiAliasing||(this._renderTarget=new Cn(this.engine,this.width,this.height,new Pn(this.engine,this.width,this.height,void 0,void 0,this._isCube),e.RenderBufferDepthFormat.Depth,this.antiAliasing),this._renderTargetSwap=new Cn(this.engine,this.width,this.height,new Pn(this.engine,this.width,this.height,void 0,void 0,this._isCube),e.RenderBufferDepthFormat.Depth,this.antiAliasing),this._activeRenderTarget=this._renderTarget),this._oriCameraRenderTarget=t.renderTarget,t.renderTarget=this._activeRenderTarget)},r.onEndRender=function(e){this.enabled&&(this.onTextureChange&&this.onTextureChange(this._texture),this._activeRenderTarget=this._activeRenderTarget===this._renderTarget?this._renderTargetSwap:this._renderTarget)},r._reset=function(){this.enabled&&(this._camera.renderTarget=this._oriCameraRenderTarget,this._camera.cullingMask=this._oriCameraCullingMask)},T(n,[{key:"_texture",get:function(){var e;return null===(e=this._activeRenderTarget)||void 0===e?void 0:e.getColorTexture()}}]),n}(kr),ka=new i,Na=new i,Ua=new i,Va=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).position=new i(0,0,0),e._isCube=!0,e.oriViewMatrix=new f,e._oriFieldOfView=void 0,e}P(n,t);var r=n.prototype;return r.onBeginRender=function(n){if(this.enabled){t.prototype.onBeginRender.call(this,n),this._storeCamera(n);for(var r=0;r<6;r++)this._setCamera(r,n),n.render(e.TextureCubeFace.PositiveX+r);this._restoreCamera(n),t.prototype._reset.call(this)}},r._storeCamera=function(e){e.viewMatrix.cloneTo(this.oriViewMatrix),this._oriFieldOfView=e.fieldOfView},r._restoreCamera=function(e){this.oriViewMatrix.cloneTo(e.viewMatrix),e.fieldOfView=this._oriFieldOfView},r._setCamera=function(e,t){switch(e){case 0:Na.setValue(0,-1,0),Ua.setValue(1,0,0);break;case 1:Na.setValue(0,-1,0),Ua.setValue(-1,0,0);break;case 2:Na.setValue(0,0,1),Ua.setValue(0,1,0);break;case 3:Na.setValue(0,0,-1),Ua.setValue(0,-1,0);break;case 4:Na.setValue(0,-1,0),Ua.setValue(0,0,1);break;case 5:Na.setValue(0,-1,0),Ua.setValue(0,0,-1)}i.add(this.position,Ua,ka),f.lookAt(this.position,ka,Na,t.viewMatrix),t.fieldOfView=90},n}(Da),Ga=function(){function e(e,t){void 0===t&&(t={engine:null,width:512,height:512}),this._mapSize=void 0,this._renderTarget=void 0,this.light=void 0,this.bias=.005,this.intensity=.2,this.radius=1,this.projectionMatrix=new f,this.light=e;var n=t,r=n.engine,i=n.width,a=n.height;this._mapSize=new p(i,a),this._renderTarget=new Cn(r,i,a,new Pn(r,i,a))}e._updateShaderData=function(t){var n=e._combinedData;t.setFloatArray(e._viewMatFromLightProperty,n.viewMatrix),t.setFloatArray(e._projMatFromLightProperty,n.projectionMatrix),t.setFloatArray(e._shadowBiasProperty,n.bias),t.setFloatArray(e._shadowIntensityProperty,n.intensity),t.setFloatArray(e._shadowRadiusProperty,n.radius),t.setFloatArray(e._shadowMapSizeProperty,n.mapSize),t.setTextureArray(e._shadowMapsProperty,n.map)},e.clearMap=function(){e._combinedData.map.length=0};var t=e.prototype;return t.initShadowProjectionMatrix=function(e){if(e instanceof sr&&f.ortho(-5,5,-5,5,.1,50,this.projectionMatrix),e instanceof lr&&f.perspective(r.degreeToRadian(50),1,.5,50,this.projectionMatrix),e instanceof ur){var t=Math.min(Math.PI/2,2*e.angle*Math.sqrt(2));f.perspective(t,1,.1,e.distance+5,this.projectionMatrix)}},t.appendData=function(t){var n=16*t,r=16*t,i=t,a=t,o=t,s=2*t,l=t,u=e._combinedData;u.viewMatrix.set(this.light.viewMatrix.elements,n),u.projectionMatrix.set(this.projectionMatrix.elements,r),u.bias[i]=this.bias,u.intensity[a]=this.intensity,u.radius[o]=this.radius,u.mapSize[s]=this.mapSize.x,u.mapSize[s+1]=this.mapSize.y,u.map[l]=this.map},T(e,[{key:"renderTarget",get:function(){return this._renderTarget}},{key:"map",get:function(){return this._renderTarget.getColorTexture()}},{key:"mapSize",get:function(){return this._mapSize}}]),e}();Ga._viewMatFromLightProperty=it.getPropertyByName("u_viewMatFromLight"),Ga._projMatFromLightProperty=it.getPropertyByName("u_projMatFromLight"),Ga._shadowBiasProperty=it.getPropertyByName("u_shadowBias"),Ga._shadowIntensityProperty=it.getPropertyByName("u_shadowIntensity"),Ga._shadowRadiusProperty=it.getPropertyByName("u_shadowRadius"),Ga._shadowMapSizeProperty=it.getPropertyByName("u_shadowMapSize"),Ga._shadowMapsProperty=it.getPropertyByName("u_shadowMaps"),Ga._maxLight=3,Ga._combinedData={viewMatrix:new Float32Array(16*Ga._maxLight),projectionMatrix:new Float32Array(16*Ga._maxLight),bias:new Float32Array(Ga._maxLight),intensity:new Float32Array(Ga._maxLight),radius:new Float32Array(Ga._maxLight),mapSize:new Float32Array(2*Ga._maxLight),map:[]},Object.defineProperty(or.prototype,"enableShadow",{get:function(){return this._enableShadow},set:function(e){if(this._enableShadow=e,this._enableShadow){if(this instanceof ir)return this._enableShadow=!1,void ce.warn("Has no shadow!");this.shadow=this.shadow||new Ga(this,{engine:this.engine,width:512,height:512}),this.shadow.initShadowProjectionMatrix(this)}}}),Object.defineProperty(Ve.prototype,"receiveShadow",{get:function(){return this._recieveShadow},set:function(e){this._recieveShadow=e}}),Object.defineProperty(Ve.prototype,"castShadow",{get:function(){return this._castShadow},set:function(e){this._castShadow=e}});var Ha=function(e){function t(t){var n;return(n=e.call(this,t,it.find("shadow-map"))||this).shaderData.enableMacro("O3_GENERATE_SHADOW_MAP"),n}return P(t,e),t}(kt),Wa=function(e){function t(t,n,r,i,a,o){var s;return(s=e.call(this,t,n,r,i,a)||this).light=void 0,s.light=o,s.clearColor=new m(1,1,1,1),s}return P(t,e),t.prototype.preRender=function(e,n){var r=this.replaceMaterial.shaderData;r.setMatrix(t._viewMatFromLightProperty,this.light.viewMatrix),r.setMatrix(t._projMatFromLightProperty,this.light.shadow.projectionMatrix)},t}(Ur);Wa._viewMatFromLightProperty=it.getPropertyByName("u_viewMatFromLight"),Wa._projMatFromLightProperty=it.getPropertyByName("u_projMatFromLight");var ja,Xa=function(t){function n(n){var r,i=(r=t.call(this,n,it.find("shadow"))||this).renderState.blendState.targetBlendState;return i.enabled=!0,i.sourceColorBlendFactor=i.sourceAlphaBlendFactor=e.BlendFactor.DestinationColor,i.destinationColorBlendFactor=i.destinationAlphaBlendFactor=e.BlendFactor.Zero,r.renderState.depthState.compareFunction=e.CompareFunction.LessEqual,r.renderQueueType=e.RenderQueueType.Transparent,r}return P(n,t),n}(kt),Ka=function(t){function n(){for(var n,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=t.call.apply(t,[this].concat(i))||this).clearFlags=e.CameraClearFlags.None,n}return P(n,t),n.prototype.preRender=function(e,t){this.enabled=!1;var n=e.scene.findFeature(cr).visibleLights,r=this.replaceMaterial.shaderData,i=e._renderPipeline.defaultRenderPass;this.renderTarget=i.renderTarget;var a=0;Ga.clearMap();for(var o=0,s=n.length;o<s;o++){var l=n[o];l.enableShadow&&l.shadow.appendData(a++)}a?(this.enabled=!0,Ga._updateShaderData(r),r.enableMacro("O3_SHADOW_MAP_COUNT",a.toString())):r.disableMacro("O3_SHADOW_MAP_COUNT")},n}(Ur),qa=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._shadowPass=void 0,e._shadowMapMaterial=void 0,e}P(n,t);var r=n.prototype;return r.preRender=function(e,t){var n=e.findFeature(cr).visibleLights;if(n.length>0){this._shadowPass||this.addShadowPass(t);for(var r=t._renderPipeline,i=0,a=n.length;i<a;i++){var o=n[i];o.enableShadow&&!o.shadowMapPass?o.shadowMapPass=this.addShadowMapPass(t,o):!o.enableShadow&&o.shadowMapPass&&(r.removeRenderPass(o.shadowMapPass),o.shadowMapPass=null)}this.updatePassRenderFlag(r._opaqueQueue),this.updatePassRenderFlag(r._alphaTestQueue),this.updatePassRenderFlag(r._transparentQueue)}},r.addShadowPass=function(t){var n=new Xa(t.engine);this._shadowPass=new Ka("ShadowPass",1,null,n,e.Layer.Layer30),t._renderPipeline.addRenderPass(this._shadowPass)},r.addShadowMapPass=function(t,n){this._shadowMapMaterial=this._shadowMapMaterial||new Ha(t.engine);var r=new Wa("ShadowMapPass",-1,n.shadow.renderTarget,this._shadowMapMaterial,e.Layer.Layer31,n);return t._renderPipeline.addRenderPass(r),r},r.updatePassRenderFlag=function(t){for(var n=t.items,r=0,i=n.length;r<i;r++){var a=n[r].component,o=a.recieveShadow,s=a.castShadow;!0===o?a.entity.layer|=e.Layer.Layer30:!1===o&&(a.entity.layer&=~e.Layer.Layer30),!0===s?a.entity.layer|=e.Layer.Layer31:!1===s&&(a.entity.layer&=~e.Layer.Layer31)}},n}(ar);function Qa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ya(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $a(e,t,n){return t&&Ya(e.prototype,t),n&&Ya(e,n),e}function Ja(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Za(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,eo(e,t)}function eo(e,t){return(eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}dr.registerFeature(qa),dr.registerFeature(cr),dr.prototype.hasLight=function(){return this.findFeature(cr).visibleLights.length>0},e.GLCompressedTextureInternalFormat=void 0,(ja=e.GLCompressedTextureInternalFormat||(e.GLCompressedTextureInternalFormat={}))[ja.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",ja[ja.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",ja[ja.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",ja[ja.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",ja[ja.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",ja[ja.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",ja[ja.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",ja[ja.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",ja[ja.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",ja[ja.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",ja[ja.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",ja[ja.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",ja[ja.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",ja[ja.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",ja[ja.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",ja[ja.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",ja[ja.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",ja[ja.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",ja[ja.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",ja[ja.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",ja[ja.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",ja[ja.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",ja[ja.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",ja[ja.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",ja[ja.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",ja[ja.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",ja[ja.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",ja[ja.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",ja[ja.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",ja[ja.R11_EAC=37488]="R11_EAC",ja[ja.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",ja[ja.RG11_EAC=37490]="RG11_EAC",ja[ja.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",ja[ja.RGB8_ETC2=37492]="RGB8_ETC2",ja[ja.SRGB8_ETC2=37493]="SRGB8_ETC2",ja[ja.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",ja[ja.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",ja[ja.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",ja[ja.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",ja[ja.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",ja[ja.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",ja[ja.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",ja[ja.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",ja[ja.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",ja[ja.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",ja[ja.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",ja[ja.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT";var to=function(){var e=t.prototype;function t(e){this._webCanvas=void 0,this._width=void 0,this._height=void 0,this._scale=new p;var t=e.width,n=e.height;this._webCanvas=e,this._width=t,this._height=n}return e.resizeByClientSize=function(e){void 0===e&&(e=window.devicePixelRatio);var t=this._webCanvas;if(t instanceof HTMLCanvasElement){var n=t.clientWidth,r=t.clientHeight;this.width=n*e,this.height=r*e}},e.setScale=function(e,t){this._scale.setValue(e,t),this.scale=this._scale},$a(t,[{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._webCanvas.width=e,this._width=e)}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._webCanvas.height=e,this._height=e)}},{key:"scale",get:function(){var e=this._webCanvas;return e instanceof HTMLCanvasElement&&this._scale.setValue(e.clientWidth*devicePixelRatio/e.width,e.clientHeight*devicePixelRatio/e.height),this._scale},set:function(e){var t=this._webCanvas;t instanceof HTMLCanvasElement&&(t.style.transformOrigin="left top",t.style.transform="scale("+e.x+", "+e.y+")")}}]),t}(),no=function(){function t(e){this._maxDrawBuffers=void 0,this._maxAnisoLevel=void 0,this._maxAntiAliasing=void 0,this._rhi=void 0,this.capabilityList=void 0,this._rhi=e,this.capabilityList=new Map,this._init(),this._compatibleAllInterface()}var n=t.prototype;return n.canIUse=function(e){return this.capabilityList.get(e)},n.canIUseCompressedTextureInternalFormat=function(t){var n=e.GLCompressedTextureInternalFormat.RGBA_ASTC_4X4_KHR,r=e.GLCompressedTextureInternalFormat.RGBA_ASTC_12X12_KHR,i=e.GLCompressedTextureInternalFormat.SRGB8_ALPHA8_ASTC_4X4_KHR,a=e.GLCompressedTextureInternalFormat.SRGB8_ALPHA8_ASTC_12X12_KHR,o=e.GLCompressedTextureInternalFormat.RGB_ETC1_WEBGL,s=e.GLCompressedTextureInternalFormat.R11_EAC,l=e.GLCompressedTextureInternalFormat.SRGB8_ALPHA8_ETC2_EAC,u=e.GLCompressedTextureInternalFormat.RGB_PVRTC_4BPPV1_IMG,c=e.GLCompressedTextureInternalFormat.RGBA_PVRTC_2BPPV1_IMG,d=e.GLCompressedTextureInternalFormat.RGB_S3TC_DXT1_EXT,f=e.GLCompressedTextureInternalFormat.RGBA_S3TC_DXT5_EXT;return t>=n&&r<=r||t>=i&&t<=a?this.canIUse(e.GLCapabilityType.astc):t===o?this.canIUse(e.GLCapabilityType.etc1):t>=s&&t<=l?this.canIUse(e.GLCapabilityType.etc):t>=u&&t<=c?this.canIUse(e.GLCapabilityType.pvrtc):t>=d&&t<=f&&this.canIUse(e.GLCapabilityType.s3tc)},n._init=function(){var t=this.capabilityList,n=this.rhi.isWebGL2,r=this.rhi.requireExtension.bind(this.rhi),i=e.GLCapabilityType.shaderVertexID,a=e.GLCapabilityType.standardDerivatives,o=e.GLCapabilityType.shaderTextureLod,s=e.GLCapabilityType.elementIndexUint,l=e.GLCapabilityType.depthTexture,u=e.GLCapabilityType.vertexArrayObject,c=e.GLCapabilityType.instancedArrays,d=e.GLCapabilityType.multipleSample,f=e.GLCapabilityType.drawBuffers,h=e.GLCapabilityType.astc,p=e.GLCapabilityType.astc_webkit,_=e.GLCapabilityType.etc,v=e.GLCapabilityType.etc_webkit,m=e.GLCapabilityType.etc1,g=e.GLCapabilityType.etc1_webkit,y=e.GLCapabilityType.pvrtc,x=e.GLCapabilityType.pvrtc_webkit,b=e.GLCapabilityType.s3tc,w=e.GLCapabilityType.s3tc_webkit,T=e.GLCapabilityType.textureFloat,S=e.GLCapabilityType.textureHalfFloat,C=e.GLCapabilityType.textureFloatLinear,P=e.GLCapabilityType.textureHalfFloatLinear,M=e.GLCapabilityType.WEBGL_colorBufferFloat,A=e.GLCapabilityType.colorBufferFloat,E=e.GLCapabilityType.colorBufferHalfFloat,R=e.GLCapabilityType.textureFilterAnisotropic;t.set(i,n),t.set(a,n||!!r(a)),t.set(o,n||!!r(o)),t.set(s,n||!!r(s)),t.set(l,n||!!r(l)),t.set(u,n||!!r(u)),t.set(c,n||!!r(c)),t.set(d,n),t.set(f,n||!!r(f)),t.set(T,n||!!r(T)),t.set(S,n||!!r(S)),t.set(C,!!r(C)),t.set(P,n||!!r(P)),t.set(A,n&&!!r(A)||!!r(M)),t.set(E,n&&!!r(A)||!!r(E)),t.set(R,!!r(R)),t.set(h,!(!r(h)&&!r(p))),t.set(_,!(!r(_)&&!r(v))),t.set(m,!(!r(m)&&!r(g))),t.set(y,!(!r(y)&&!r(x))),t.set(b,!(!r(b)&&!r(w)))},n._compatibleInterface=function(e,t){var n,r=this.rhi,i=r.gl;if(n=r.requireExtension(e))for(var a in t){var o=n[t[a]];null!=o&&o.bind?i[a]=o.bind(n):i[a]=o}},n._compatibleAllInterface=function(){var t=e.GLCapabilityType.depthTexture,n=e.GLCapabilityType.vertexArrayObject,r=e.GLCapabilityType.instancedArrays,i=e.GLCapabilityType.drawBuffers,a=e.GLCapabilityType.textureFilterAnisotropic,o=e.GLCapabilityType.textureHalfFloat,s=e.GLCapabilityType.colorBufferHalfFloat,l=e.GLCapabilityType.WEBGL_colorBufferFloat;if(!this.rhi.isWebGL2){this._compatibleInterface(t,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this._compatibleInterface(n,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this._compatibleInterface(r,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this._compatibleInterface(i,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var u={};if(this.canIUse(e.GLCapabilityType.drawBuffers)){for(var c=this.maxDrawBuffers,d=0;d<c;d++)0!=d&&(u["COLOR_ATTACHMENT"+d]="COLOR_ATTACHMENT"+d+"_WEBGL"),u["DRAW_BUFFER"+d]="DRAW_BUFFER"+d+"_WEBGL";this._compatibleInterface(i,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qa(Object(n),!0).forEach((function(t){Ja(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({drawBuffers:"drawBuffersWEBGL"},u))}this._compatibleInterface(o,{HAFL_FLOAT:"HALF_FLOAT_OES"}),this._compatibleInterface(s,{RGBA16F:"RBGA16F_EXT"}),this._compatibleInterface(l,{RGBA32F:"RBGA32F_EXT"})}this._compatibleInterface(a,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},$a(t,[{key:"canUseFloatTextureBlendShape",get:function(){return this.canIUse(e.GLCapabilityType.shaderVertexID)&&this.canIUse(e.GLCapabilityType.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(e.GLCapabilityType.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(e.GLCapabilityType.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var t=this._rhi.requireExtension(e.GLCapabilityType.textureFilterAnisotropic);this._maxAnisoLevel=t?this._rhi.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var t=this._rhi.gl,n=this.canIUse(e.GLCapabilityType.multipleSample);this._maxAntiAliasing=n?t.getParameter(t.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}}]),t}(),ro=function(){function e(e){this.rhi=void 0,this._requireResult=void 0,this.rhi=e,this._requireResult={}}return e.prototype.requireExtension=function(e){return void 0!==this._requireResult[e]||(this._requireResult[e]=this.rhi.gl.getExtension(e)),this._requireResult[e]},e}(),io=function(){function t(t,n){this.attribLocArray=void 0,this._primitive=void 0,this.canUseInstancedArrays=void 0,this.gl=void 0,this.vao=new Map,this._useVao=void 0,this._primitive=n,this.canUseInstancedArrays=t.canIUse(e.GLCapabilityType.instancedArrays),this._useVao=t.canIUse(e.GLCapabilityType.vertexArrayObject),this.gl=t.gl}var n=t.prototype;return n.draw=function(e,t){var n=this.gl,r=this._primitive;if(this._useVao){this.vao.has(e.id)||this.registerVAO(e);var i=this.vao.get(e.id);n.bindVertexArray(i)}else this.bindBufferAndAttrib(e);var a=r._indexBufferBinding,o=r._instanceCount,s=r._glIndexType,l=r._glIndexByteCount,u=t.topology,c=t.start,d=t.count;if(o)if(this.canUseInstancedArrays)if(a)if(this._useVao)n.drawElementsInstanced(u,d,s,c*l,o);else{var f=a.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,f),n.drawElementsInstanced(u,d,s,c*l,o),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArraysInstanced(u,c,d,o);else ce.error("ANGLE_instanced_arrays extension is not supported");else if(a)if(this._useVao)n.drawElements(u,d,s,c*l);else{var h=a.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,h),n.drawElements(u,d,s,c*l),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArrays(u,c,d);this._useVao?n.bindVertexArray(null):this.disableAttrib()},n.destroy=function(){if(this._useVao){var e=this.gl;this.vao.forEach((function(t){e.deleteVertexArray(t)})),this.vao.clear()}},n.bindBufferAndAttrib=function(e){var t=this.gl,n=this._primitive,r=n._vertexBufferBindings;this.attribLocArray=[];var i,a,o=e.attributeLocation,s=n._vertexElementMap;for(var l in o){var u=o[l];if(-1!==u){var c=s[l];if(c){var d=r[c.bindingIndex],f=d.buffer,h=d.stride;a!==(i=f._nativeBuffer)&&(a=i,t.bindBuffer(t.ARRAY_BUFFER,i)),t.enableVertexAttribArray(u);var p=c._glElementInfo,_=p.size,v=p.type,m=p.normalized;t.vertexAttribPointer(u,_,v,m,h,c.offset),this.canUseInstancedArrays&&t.vertexAttribDivisor(u,c.instanceStepRate),this.attribLocArray.push(u)}else ce.warn("vertex attribute not found: "+l)}}t.bindBuffer(t.ARRAY_BUFFER,null)},n.disableAttrib=function(){for(var e=this.gl,t=0,n=this.attribLocArray.length;t<n;t++)e.disableVertexAttribArray(this.attribLocArray[t])},n.registerVAO=function(e){var t=this.gl,n=t.createVertexArray();t.bindVertexArray(n);var r=this._primitive._indexBufferBinding;r&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.buffer._nativeBuffer),this.bindBufferAndAttrib(e),t.bindVertexArray(null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.disableAttrib(),this.vao.set(e.id,n)},t}(),ao=function(){function t(e,t,n){this._texture=void 0,this._glTexture=void 0,this._rhi=void 0,this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._formatDetail=void 0,this._texture=t,this._rhi=e,this._gl=e.gl,this._isWebGL2=e.isWebGL2,this._target=n,this._glTexture=this._gl.createTexture()}t._isPowerOf2=function(e){return 0==(e&e-1)},t._getFormatDetail=function(t,n,r){switch(t){case e.TextureFormat.R8G8B8:return{internalFormat:r?n.RGB8:n.RGB,baseFormat:n.RGB,dataType:n.UNSIGNED_BYTE,isCompressed:!1};case e.TextureFormat.R8G8B8A8:return{internalFormat:r?n.RGBA8:n.RGBA,baseFormat:n.RGBA,dataType:n.UNSIGNED_BYTE,isCompressed:!1};case e.TextureFormat.R4G4B4A4:return{internalFormat:r?n.RGBA4:n.RGBA,baseFormat:n.RGBA,dataType:n.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case e.TextureFormat.R5G5B5A1:return{internalFormat:r?n.RGB5_A1:n.RGBA,baseFormat:n.RGBA,dataType:n.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case e.TextureFormat.R5G6B5:return{internalFormat:r?n.RGB565:n.RGB,baseFormat:n.RGB,dataType:n.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case e.TextureFormat.Alpha8:return{internalFormat:n.ALPHA,baseFormat:n.ALPHA,dataType:n.UNSIGNED_BYTE,isCompressed:!1};case e.TextureFormat.LuminanceAlpha:return{internalFormat:n.LUMINANCE_ALPHA,baseFormat:n.LUMINANCE_ALPHA,dataType:n.UNSIGNED_BYTE,isCompressed:!1};case e.TextureFormat.R32G32B32A32:return{internalFormat:n.RGBA32F,baseFormat:n.RGBA,dataType:n.FLOAT,isCompressed:!1};case e.TextureFormat.DXT1:return{internalFormat:e.GLCompressedTextureInternalFormat.RGB_S3TC_DXT1_EXT,isCompressed:!0};case e.TextureFormat.DXT5:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case e.TextureFormat.ETC1_RGB:return{internalFormat:e.GLCompressedTextureInternalFormat.RGB_ETC1_WEBGL,isCompressed:!0};case e.TextureFormat.ETC2_RGB:return{internalFormat:e.GLCompressedTextureInternalFormat.RGB8_ETC2,isCompressed:!0};case e.TextureFormat.ETC2_RGBA5:return{internalFormat:e.GLCompressedTextureInternalFormat.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case e.TextureFormat.ETC2_RGBA8:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA8_ETC2_EAC,isCompressed:!0};case e.TextureFormat.PVRTC_RGB2:return{internalFormat:e.GLCompressedTextureInternalFormat.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case e.TextureFormat.PVRTC_RGBA2:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case e.TextureFormat.PVRTC_RGB4:return{internalFormat:e.GLCompressedTextureInternalFormat.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case e.TextureFormat.PVRTC_RGBA4:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case e.TextureFormat.ASTC_4x4:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_ASTC_4X4_KHR,isCompressed:!0};case e.TextureFormat.ASTC_5x5:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_ASTC_5X5_KHR,isCompressed:!0};case e.TextureFormat.ASTC_6x6:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_ASTC_6X6_KHR,isCompressed:!0};case e.TextureFormat.ASTC_8x8:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_ASTC_8X8_KHR,isCompressed:!0};case e.TextureFormat.ASTC_10x10:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_ASTC_10X10_KHR,isCompressed:!0};case e.TextureFormat.ASTC_12x12:return{internalFormat:e.GLCompressedTextureInternalFormat.RGBA_ASTC_12X12_KHR,isCompressed:!0};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+t)}},t._getRenderBufferColorFormatDetail=function(t,n,r){switch(t){case e.RenderBufferColorFormat.R8G8B8:return{internalFormat:r?n.RGB8:n.RGB,baseFormat:n.RGB,dataType:n.UNSIGNED_BYTE,isCompressed:!1};case e.RenderBufferColorFormat.R8G8B8A8:return{internalFormat:r?n.RGBA8:n.RGBA,baseFormat:n.RGBA,dataType:n.UNSIGNED_BYTE,isCompressed:!1};case e.RenderBufferColorFormat.R4G4B4A4:return{internalFormat:r?n.RGBA4:n.RGBA,baseFormat:n.RGBA,dataType:n.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case e.RenderBufferColorFormat.R5G5B5A1:return{internalFormat:r?n.RGB5_A1:n.RGBA,baseFormat:n.RGBA,dataType:n.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case e.RenderBufferColorFormat.R5G6B5:return{internalFormat:r?n.RGB565:n.RGB,baseFormat:n.RGB,dataType:n.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case e.RenderBufferColorFormat.Alpha8:return{internalFormat:n.ALPHA,baseFormat:n.ALPHA,dataType:n.UNSIGNED_BYTE,isCompressed:!1};case e.RenderBufferColorFormat.R16G16B16A16:return{internalFormat:n.RGBA16F,baseFormat:n.RGBA,dataType:n.HALF_FLOAT,isCompressed:!1};case e.RenderBufferColorFormat.R32G32B32A32:return{internalFormat:n.RGBA32F,baseFormat:n.RGBA,dataType:n.FLOAT,isCompressed:!1};default:throw new Error("this RenderBufferColorFormat is not supported in Oasis Engine: "+t)}},t._getRenderBufferDepthFormatDetail=function(t,n,r){switch(t){case e.RenderBufferDepthFormat.Depth:return{internalFormat:r?n.DEPTH_COMPONENT32F:n.DEPTH_COMPONENT16,baseFormat:n.DEPTH_COMPONENT,dataType:r?n.FLOAT:n.UNSIGNED_INT,isCompressed:!1,attachment:n.DEPTH_ATTACHMENT};case e.RenderBufferDepthFormat.DepthStencil:return{internalFormat:r?n.DEPTH24_STENCIL8:n.DEPTH_STENCIL,baseFormat:n.DEPTH_STENCIL,dataType:n.UNSIGNED_INT_24_8,isCompressed:!1,attachment:n.DEPTH_STENCIL_ATTACHMENT};case e.RenderBufferDepthFormat.Stencil:return{internalFormat:n.STENCIL_INDEX8,baseFormat:n.STENCIL_ATTACHMENT,dataType:n.UNSIGNED_BYTE,isCompressed:!1,attachment:n.STENCIL_ATTACHMENT};case e.RenderBufferDepthFormat.Depth16:return{internalFormat:n.DEPTH_COMPONENT16,baseFormat:n.DEPTH_COMPONENT,dataType:n.UNSIGNED_INT,isCompressed:!1,attachment:n.DEPTH_ATTACHMENT};case e.RenderBufferDepthFormat.Depth24:return{internalFormat:n.DEPTH_COMPONENT24,baseFormat:n.DEPTH_COMPONENT,dataType:n.UNSIGNED_INT,isCompressed:!1,attachment:n.DEPTH_ATTACHMENT};case e.RenderBufferDepthFormat.Depth32:return{internalFormat:n.DEPTH_COMPONENT32F,baseFormat:n.DEPTH_COMPONENT,dataType:n.FLOAT,isCompressed:!1,attachment:n.DEPTH_ATTACHMENT};case e.RenderBufferDepthFormat.Depth24Stencil8:return{internalFormat:r?n.DEPTH24_STENCIL8:n.DEPTH_STENCIL,baseFormat:n.DEPTH_STENCIL,dataType:n.UNSIGNED_INT_24_8,isCompressed:!1,attachment:n.DEPTH_STENCIL_ATTACHMENT};case e.RenderBufferDepthFormat.Depth32Stencil8:return{internalFormat:n.DEPTH32F_STENCIL8,baseFormat:n.DEPTH_STENCIL,dataType:n.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:n.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this RenderBufferDepthFormat is not supported in Oasis Engine: "+t)}},t._supportTextureFormat=function(t,n){var r=!0;return t===e.TextureFormat.R32G32B32A32&&(n.canIUse(e.GLCapabilityType.textureFloat)||(r=!1)),r},t._supportRenderBufferColorFormat=function(t,n){var r=!0;switch(t){case e.RenderBufferColorFormat.R32G32B32A32:n.canIUse(e.GLCapabilityType.colorBufferFloat)&&n.canIUse(e.GLCapabilityType.textureFloat)||(r=!1);break;case e.RenderBufferColorFormat.R16G16B16A16:n.canIUse(e.GLCapabilityType.colorBufferHalfFloat)&&n.canIUse(e.GLCapabilityType.textureHalfFloat)||(r=!1)}return r},t._supportRenderBufferDepthFormat=function(t,n,r){var i=n.isWebGL2,a=!0;if(r&&!n.canIUse(e.GLCapabilityType.depthTexture))return!1;switch(t){case e.RenderBufferDepthFormat.Stencil:a=!1;break;case e.RenderBufferDepthFormat.Depth24:case e.RenderBufferDepthFormat.Depth32:case e.RenderBufferDepthFormat.Depth32Stencil8:i||(a=!1)}return a};var n=t.prototype;return n.destroy=function(){this._gl.deleteTexture(this._glTexture),this._texture=null,this._glTexture=null,this._formatDetail=null},n.generateMipmaps=function(){this._bind(),this._gl.generateMipmap(this._target)},n._bind=function(){this._rhi.bindTexture(this)},n._initMipmap=function(e){var t=this._gl,n=this._isWebGL2,r=this._formatDetail,i=r.internalFormat,a=r.baseFormat,o=r.dataType,s=this._texture,l=s.mipmapCount,u=s.width,c=s.height;if(this._bind(),n&&a!==t.LUMINANCE_ALPHA&&a!==t.ALPHA)t.texStorage2D(this._target,l,i,u,c);else if(a!==i&&(i=a),e)for(var d=0;d<l;d++)for(var f=Math.max(1,u>>d),h=0;h<6;h++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+h,d,i,f,f,0,a,o,null);else for(var p=0;p<l;p++){var _=Math.max(1,u>>p),v=Math.max(1,c>>p);t.texImage2D(this._target,p,i,_,v,0,a,o,null)}},n._getPixelBuffer=function(e,n,r,i,a,o){var s=this._gl,l=this._formatDetail,u=l.baseFormat,c=l.dataType;t._readFrameBuffer||(t._readFrameBuffer=s.createFramebuffer()),s.bindFramebuffer(s.FRAMEBUFFER,t._readFrameBuffer),null!=e?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+e,this._glTexture,0):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this._glTexture,0),s.readPixels(n,r,i,a,u,c,o),s.bindFramebuffer(s.FRAMEBUFFER,null)},n._setWrapMode=function(n,r){var i=this._gl,a=this._isWebGL2,o=this._target,s=this._texture,l=s.width,u=s.height;switch(a||n===e.TextureWrapMode.Clamp||t._isPowerOf2(l)&&t._isPowerOf2(u)||(ce.warn("non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE"),n=e.TextureWrapMode.Clamp),n){case e.TextureWrapMode.Clamp:i.texParameteri(o,r,i.CLAMP_TO_EDGE);break;case e.TextureWrapMode.Repeat:i.texParameteri(o,r,i.REPEAT);break;case e.TextureWrapMode.Mirror:i.texParameteri(o,r,i.MIRRORED_REPEAT)}},$a(t,[{key:"wrapModeU",set:function(e){this._bind(),this._setWrapMode(e,this._gl.TEXTURE_WRAP_S)}},{key:"wrapModeV",set:function(e){this._bind(),this._setWrapMode(e,this._gl.TEXTURE_WRAP_T)}},{key:"filterMode",set:function(t){var n=this._gl,r=this._target,i=this._texture._mipmap;switch(this._bind(),t){case e.TextureFilterMode.Point:n.texParameteri(r,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(r,n.TEXTURE_MIN_FILTER,i?n.NEAREST_MIPMAP_NEAREST:n.NEAREST);break;case e.TextureFilterMode.Bilinear:n.texParameteri(r,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(r,n.TEXTURE_MIN_FILTER,i?n.LINEAR_MIPMAP_NEAREST:n.LINEAR);break;case e.TextureFilterMode.Trilinear:n.texParameteri(r,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(r,n.TEXTURE_MIN_FILTER,i?n.LINEAR_MIPMAP_LINEAR:n.LINEAR)}}},{key:"anisoLevel",set:function(e){var t=this._gl;this._bind(),t.texParameterf(this._target,t.TEXTURE_MAX_ANISOTROPY_EXT,e)}}]),t}();ao._readFrameBuffer=null;var oo,so=function(t){function n(n,r){var i;i=t.call(this,n,r,r.isCube?n.gl.TEXTURE_CUBE_MAP:n.gl.TEXTURE_2D)||this;var a=r.format,o=r._mipmap,s=r.width,l=r.height,u=r.isCube,c=i._isWebGL2;if(!ao._supportRenderBufferColorFormat(a,n))throw new Error("RenderBufferColorFormat is not supported:"+e.RenderBufferColorFormat[a]);if(u&&s!==l)throw new Error("The cube texture must have the same width and height");return!o||c||ao._isPowerOf2(s)&&ao._isPowerOf2(l)||(ce.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),r._mipmap=!1,r._mipmapCount=r._getMipmapCount()),i._formatDetail=ao._getRenderBufferColorFormatDetail(a,i._gl,c),i._initMipmap(u),i}return Za(n,t),n.prototype.getPixelBuffer=function(e,n,r,i,a,o){t.prototype._getPixelBuffer.call(this,e,n,r,i,a,o)},n}(ao),lo=function(t){function n(n,r){var i;i=t.call(this,n,r,r.isCube?n.gl.TEXTURE_CUBE_MAP:n.gl.TEXTURE_2D)||this;var a=r.format,o=r._mipmap,s=r.width,l=r.height,u=r.isCube,c=i._isWebGL2;if(!ao._supportRenderBufferDepthFormat(a,n,!0))throw new Error("RenderBufferDepthFormat is not supported:"+e.RenderBufferDepthFormat[a]);if(u&&s!==l)throw new Error("The cube texture must have the same width and height");return!o||c||ao._isPowerOf2(s)&&ao._isPowerOf2(l)||(ce.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),r._mipmap=!1,r._mipmapCount=r._getMipmapCount()),i._formatDetail=ao._getRenderBufferDepthFormatDetail(a,i._gl,c),i._initMipmap(u),i}return Za(n,t),n}(ao),uo=function(){function e(e){this._gl=void 0,this._parameters={},this._gl=e,this._parameters={},this._parameters[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[e.MAX_VERTEX_UNIFORM_VECTORS]=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[e.MAX_VERTEX_ATTRIBS]=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._parameters[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[e.MAX_TEXTURE_SIZE]=e.getParameter(e.MAX_TEXTURE_SIZE),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.colorMask(!0,!0,!0,!0),e.blendColor(0,0,0,0),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0),e.disable(e.STENCIL_TEST),e.stencilFuncSeparate(e.FRONT,e.ALWAYS,0,255),e.stencilFuncSeparate(e.BACK,e.ALWAYS,0,255),e.stencilOpSeparate(e.FRONT,e.KEEP,e.KEEP,e.KEEP),e.stencilOpSeparate(e.BACK,e.KEEP,e.KEEP,e.KEEP),e.stencilMask(255),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.disable(e.POLYGON_OFFSET_FILL),e.polygonOffset(0,0)}return e.prototype.getParameter=function(e){return this._parameters[e]},e}(),co=function(){function t(t,n){this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._frameBuffer=void 0,this._MSAAFrameBuffer=void 0,this._depthRenderBuffer=void 0,this._MSAAColorRenderBuffers=[],this._MSAADepthRenderBuffer=void 0,this._oriDrawBuffers=void 0,this._blitDrawBuffers=void 0,this._gl=t.gl,this._isWebGL2=t.isWebGL2,this._target=n;var r=n._colorTextures,i=n._depth,a=n.width,o=n.height;if(!(i instanceof Sn||ao._supportRenderBufferDepthFormat(i,t,!1)))throw new Error("RenderBufferDepthFormat is not supported:"+e.RenderBufferDepthFormat[i]);if(r.length>1&&!t.canIUse(e.GLCapabilityType.drawBuffers))throw new Error("MRT is not supported");if(r.some((function(e){return e.width!==a||e.height!==o})))throw new Error("RenderColorTexture's size must as same as RenderTarget");if(i instanceof Sn&&(i.width!==a||i.height!==o))throw new Error("RenderDepthTexture's size must as same as RenderTarget");if(r.length>1&&r.some((function(e){return e.isCube})))throw new Error("MRT+Cube+[,MSAA] is not supported");var s=t.capability.maxAntiAliasing;n.antiAliasing>s&&(ce.warn("MSAA antiAliasing exceeds the limit and is automatically downgraded to:"+s),n._antiAliasing=s),this._frameBuffer=this._gl.createFramebuffer(),this._bindMainFBO(),n.antiAliasing>1&&(this._MSAAFrameBuffer=this._gl.createFramebuffer(),this._bindMSAAFBO())}var n=t.prototype;return n.setRenderTargetFace=function(e){var t=this._gl,n=this._target.getColorTexture(0),r=this._target.depthTexture;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),null!=n&&n.isCube&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n._platformTexture._glTexture,0),null!=r&&r.isCube&&t.framebufferTexture2D(t.FRAMEBUFFER,r._platformTexture._formatDetail.attachment,t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r._platformTexture._glTexture,0),this._activeRenderTarget()},n.blitRenderTarget=function(){if(this._MSAAFrameBuffer){var e=this._gl,t=e.COLOR_BUFFER_BIT|(this._target.depthTexture?e.DEPTH_BUFFER_BIT:0),n=this._target,r=n.colorTextureCount,i=n.width,a=n.height;e.bindFramebuffer(e.READ_FRAMEBUFFER,this._MSAAFrameBuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this._frameBuffer);for(var o=0;o<r;o++){var s=e.COLOR_ATTACHMENT0+o;this._blitDrawBuffers[o]=s,e.readBuffer(s),e.drawBuffers(this._blitDrawBuffers),e.blitFramebuffer(0,0,i,a,0,0,i,a,t,e.NEAREST),this._blitDrawBuffers[o]=e.NONE}e.bindFramebuffer(e.FRAMEBUFFER,null)}},n.destroy=function(){var e=this._gl;this._frameBuffer&&e.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&e.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&e.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&e.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var t=0;t<this._MSAAColorRenderBuffers.length;t++)e.deleteRenderbuffer(this._MSAAColorRenderBuffers[t]);this._frameBuffer=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},n._activeRenderTarget=function(){var e=this._gl;this._MSAAFrameBuffer?e.bindFramebuffer(e.FRAMEBUFFER,this._MSAAFrameBuffer):e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer)},n._bindMainFBO=function(){var e=this._gl,t=this._isWebGL2,n=this._target,r=n._depth,i=n.colorTextureCount,a=n.width,o=n.height,s=new Array(i);e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer);for(var l=0;l<i;l++){var u=this._target.getColorTexture(l),c=e.COLOR_ATTACHMENT0+l;s[l]=c,u.isCube||e.framebufferTexture2D(e.FRAMEBUFFER,c,e.TEXTURE_2D,u._platformTexture._glTexture,0)}if(i>1&&e.drawBuffers(s),this._oriDrawBuffers=s,null!==r)if(r instanceof Sn)r.isCube||e.framebufferTexture2D(e.FRAMEBUFFER,r._platformTexture._formatDetail.attachment,e.TEXTURE_2D,r._platformTexture._glTexture,0);else if(this._target.antiAliasing<=1){var d=ao._getRenderBufferDepthFormatDetail(r,e,t),f=d.internalFormat,h=d.attachment,p=e.createRenderbuffer();this._depthRenderBuffer=p,e.bindRenderbuffer(e.RENDERBUFFER,p),e.renderbufferStorage(e.RENDERBUFFER,f,a,o),e.framebufferRenderbuffer(e.FRAMEBUFFER,h,e.RENDERBUFFER,p)}e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null)},n._bindMSAAFBO=function(){var e=this._gl,t=this._isWebGL2,n=e.createRenderbuffer(),r=this._target,i=r._depth,a=r.colorTextureCount,o=r.antiAliasing,s=r.width,l=r.height;this._blitDrawBuffers=new Array(a),this._MSAADepthRenderBuffer=n,e.bindFramebuffer(e.FRAMEBUFFER,this._MSAAFrameBuffer);for(var u=0;u<a;u++){var c=e.createRenderbuffer();this._MSAAColorRenderBuffers[u]=c,this._blitDrawBuffers[u]=e.NONE,e.bindRenderbuffer(e.RENDERBUFFER,c),e.renderbufferStorageMultisample(e.RENDERBUFFER,o,this._target.getColorTexture(u)._platformTexture._formatDetail.internalFormat,s,l),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+u,e.RENDERBUFFER,c)}if(e.drawBuffers(this._oriDrawBuffers),null!==i){var d=i instanceof Sn?i._platformTexture._formatDetail:ao._getRenderBufferDepthFormatDetail(i,e,t),f=d.internalFormat,h=d.attachment;e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorageMultisample(e.RENDERBUFFER,o,f,s,l),e.framebufferRenderbuffer(e.FRAMEBUFFER,h,e.RENDERBUFFER,n)}this._checkFrameBuffer(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null)},n._checkFrameBuffer=function(){var e=this._gl,t=this._isWebGL2,n=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(n){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case e.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(t&&n===e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},t}(),fo=function(t){function n(n,r){var i;(i=t.call(this,n,r,n.gl.TEXTURE_2D)||this)._compressedMipFilled=0;var a=r.format,o=r._mipmap,s=r.width,l=r.height,u=i._isWebGL2;if(!ao._supportTextureFormat(a,n))throw new Error("Texture format is not supported:"+e.TextureFormat[a]);return!o||u||ao._isPowerOf2(s)&&ao._isPowerOf2(l)||(ce.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),r._mipmap=!1,r._mipmapCount=r._getMipmapCount()),i._formatDetail=ao._getFormatDetail(a,i._gl,u),i._formatDetail.isCompressed&&!u||i._initMipmap(!1),i}Za(n,t);var r=n.prototype;return r.setPixelBuffer=function(e,t,n,r,i,a){void 0===t&&(t=0);var o=this._gl,s=this._isWebGL2,l=this._formatDetail,u=l.internalFormat,c=l.baseFormat,d=l.dataType,f=l.isCompressed,h=Math.max(1,this._texture.width>>t),p=Math.max(1,this._texture.height>>t);if(n=n||0,r=r||0,i=i||h-n,a=a||p-r,this._bind(),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),f){var _=1<<t;s||this._compressedMipFilled&_?o.compressedTexSubImage2D(this._target,t,n,r,i,a,u,e):(o.compressedTexImage2D(this._target,t,u,i,a,0,e),this._compressedMipFilled|=_)}else o.texSubImage2D(this._target,t,n,r,i,a,c,d,e)},r.setImageSource=function(e,t,n,r,i,a){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=this._gl,s=this._formatDetail,l=s.baseFormat,u=s.dataType;this._bind(),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,+n),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+r),o.texSubImage2D(this._target,t,i||0,a||0,l,u,e)},r.getPixelBuffer=function(e,n,r,i,a){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");t.prototype._getPixelBuffer.call(this,null,e,n,r,i,a)},n}(ao),ho=function(t){function n(n,r){var i;(i=t.call(this,n,r,n.gl.TEXTURE_CUBE_MAP)||this)._compressedFaceFilled=[0,0,0,0,0,0];var a=r.format,o=r._mipmap,s=r.width,l=i._isWebGL2;if(!ao._supportTextureFormat(a,n))throw new Error("Texture format is not supported:"+e.TextureFormat[a]);return!o||l||ao._isPowerOf2(s)||(ce.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),r._mipmap=!1,r._mipmapCount=r._getMipmapCount()),i._formatDetail=ao._getFormatDetail(a,i._gl,l),i._formatDetail.isCompressed&&!l||i._initMipmap(!0),i}Za(n,t);var r=n.prototype;return r.setPixelBuffer=function(e,t,n,r,i,a,o){void 0===n&&(n=0);var s=this._gl,l=this._isWebGL2,u=this._formatDetail,c=u.internalFormat,d=u.baseFormat,f=u.dataType,h=u.isCompressed,p=Math.max(1,this._texture.width>>n);if(r=r||0,i=i||0,a=a||p-r,o=o||p-i,this._bind(),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),h){var _=1<<n;l||this._compressedFaceFilled[e]&_?s.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,r,i,a,o,c,t):(s.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,c,a,o,0,t),this._compressedFaceFilled[e]|=_)}else s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,r,i,a,o,d,f,t)},r.setImageSource=function(e,t,n,r,i,a,o){void 0===n&&(n=0),void 0===r&&(r=!1),void 0===i&&(i=!1);var s=this._gl,l=this._formatDetail,u=l.baseFormat,c=l.dataType;this._bind(),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,+r),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+i),s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,a||0,o||0,u,c,t)},r.getPixelBuffer=function(e,n,r,i,a,o){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");t.prototype._getPixelBuffer.call(this,e,n,r,i,a,o)},n}(ao);e.WebGLMode=void 0,(oo=e.WebGLMode||(e.WebGLMode={}))[oo.Auto=0]="Auto",oo[oo.WebGL2=1]="WebGL2",oo[oo.WebGL1=2]="WebGL1";var po=function(){function t(e){void 0===e&&(e={}),this._currentBind=void 0,this._options=void 0,this._gl=void 0,this._renderStates=void 0,this._extensions=void 0,this._capability=void 0,this._isWebGL2=void 0,this._activeTextureID=WebGLRenderingContext.TEXTURE0,this._activeTextures=new Array(32),this._options=e}var n=t.prototype;return n.init=function(t){var n=this._options;void 0===n.alpha&&(n.alpha=!1),void 0===n.stencil&&(n.stencil=!0);var r,i=t._webCanvas,a=n.webGLMode||e.WebGLMode.Auto;if(a!=e.WebGLMode.Auto&&a!=e.WebGLMode.WebGL2||(!(r=i.getContext("webgl2",n))&&i instanceof HTMLCanvasElement&&(r=i.getContext("experimental-webgl2",n)),this._isWebGL2=!0,r&&!r.deleteQuery&&(this._isWebGL2=!1)),r||a!=e.WebGLMode.Auto&&a!=e.WebGLMode.WebGL1||(!(r=i.getContext("webgl",n))&&i instanceof HTMLCanvasElement&&(r=i.getContext("experimental-webgl",n)),this._isWebGL2=!1),!r)throw new Error("Get GL Context FAILED.");this._gl=r,this._renderStates=new uo(r),this._extensions=new ro(this),this._capability=new no(this),r.activeTexture(WebGLRenderingContext.TEXTURE0),this._options=null},n.createPlatformPrimitive=function(e){return new io(this,e)},n.createPlatformTexture2D=function(e){return new fo(this,e)},n.createPlatformTextureCubeMap=function(e){return new ho(this,e)},n.createPlatformRenderColorTexture=function(e){return new so(this,e)},n.createPlatformRenderDepthTexture=function(e){return new lo(this,e)},n.createPlatformRenderTarget=function(e){return new co(this,e)},n.requireExtension=function(e){return this._extensions.requireExtension(e)},n.canIUse=function(e){return this.capability.canIUse(e)},n.canIUseCompressedTextureInternalFormat=function(e){return this.capability.canIUseCompressedTextureInternalFormat(e)},n.viewport=function(e,t,n,r){var i=this._gl;i.viewport(e,i.drawingBufferHeight-t-r,n,r)},n.colorMask=function(e,t,n,r){this._gl.colorMask(e,t,n,r)},n.clearRenderTarget=function(t,n,r){var i=this._gl,a=t._lastRenderState,o=a.blendState.targetBlendState,s=a.depthState,l=a.stencilState,u=i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT;n===e.CameraClearFlags.DepthColor&&(u|=i.COLOR_BUFFER_BIT,r&&i.clearColor(r.r,r.g,r.b,r.a),o.colorWriteMask!==e.ColorWriteMask.All&&(i.colorMask(!0,!0,!0,!0),o.colorWriteMask=e.ColorWriteMask.All)),!0!==s.writeEnabled&&(i.depthMask(!0),s.writeEnabled=!0),255!==l.writeMask&&(i.stencilMask(255),l.writeMask=255),i.clear(u)},n.drawPrimitive=function(e,t,n){e?e._draw(n,t):ce.error("draw primitive failed.")},n.activeRenderTarget=function(e,t){var n=this._gl;if(e){var r;null===(r=e._platformRenderTarget)||void 0===r||r._activeRenderTarget();var i=e.width,a=e.height;n.viewport(0,0,i,a)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);var o=t.viewport,s=n.drawingBufferWidth,l=n.drawingBufferHeight;this.viewport(o.x*s,o.y*l,o.z*s,o.w*l)}},n.destroy=function(){},n.activeTexture=function(e){this._activeTextureID!==e&&(this._gl.activeTexture(e),this._activeTextureID=e)},n.bindTexture=function(e){var t=this._activeTextureID-this._gl.TEXTURE0;this._activeTextures[t]!==e&&(this._gl.bindTexture(e._target,e._glTexture),this._activeTextures[t]=e)},$a(t,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"gl",get:function(){return this._gl}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),t}(),_o=function(e){function t(t,n){var r=new to("string"==typeof t?document.getElementById(t):t),i=new po(n);return e.call(this,r,i)||this}return Za(t,e),$a(t,[{key:"canvas",get:function(){return this._canvas}}]),t}(Or);function vo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mo,go,yo,xo,bo,wo,To,So,Co,Po,Mo=function(){function e(e,t){var n=this;this._worker=void 0,this._costs={},this._currentLoad=0,this._callbacks={},this._worker=new Worker(e),this._worker.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t.geometry);break;case"error":n._callbacks[t.id].reject(t);break;default:ce.error('DRACOWorker: Unexpected message, "'+t.type+'"')}},t?this._worker.postMessage({type:"init",decoderConfig:{wasmBinary:t}}):this._worker.postMessage({type:"init",decoderConfig:{}})}var t,n,r=e.prototype;return r.setCosts=function(e,t){this._costs[e]=t},r.addCurrentLoad=function(e){this._currentLoad+=e},r.setCallback=function(e,t,n){this._callbacks[e]={resolve:t,reject:n}},r.decode=function(e,t,n){this._worker.postMessage({type:"decode",id:e,taskConfig:t,buffer:n},[n])},r.releaseTask=function(e){this._currentLoad-=this._costs[e],delete this._callbacks[e],delete this._costs[e]},t=e,(n=[{key:"currentLoad",get:function(){return this._currentLoad}}])&&vo(t.prototype,n),e}(),Ao='let decoderPending;\nlet decoderConfig;\n\nonmessage = function(e) {\n  const message = e.data;\n\n  switch (message.type) {\n    case "init":\n      decoderConfig = message.decoderConfig;\n      decoderPending = new Promise(function(resolve /*, reject*/) {\n        decoderConfig.onModuleLoaded = function(draco) {\n          // Module is Promise-like. Wrap before resolving to avoid loop.\n          resolve({ draco: draco });\n        };\n        DracoDecoderModule(decoderConfig);\n      });\n      break;\n\n    case "decode":\n      const buffer = message.buffer;\n      const taskConfig = message.taskConfig;\n      decoderPending.then(module => {\n        const draco = module.draco;\n        const decoder = new draco.Decoder();\n        const decoderBuffer = new draco.DecoderBuffer();\n        decoderBuffer.Init(new Int8Array(buffer), buffer.byteLength);\n        try {\n          const geometry = decodeGeometry(draco, decoder, decoderBuffer, taskConfig);\n          const buffers = geometry.attributes.map(attr => attr.array.buffer);\n          if (geometry.index) buffers.push(geometry.index.array.buffer);\n          self.postMessage({ type: "decode", id: message.id, geometry }, buffers);\n        } catch (error) {\n          console.error(error);\n          self.postMessage({ type: "error", id: message.id, error: error.message });\n        } finally {\n          draco.destroy(decoderBuffer);\n          draco.destroy(decoder);\n        }\n      });\n      break;\n  }\n};\n\nfunction decodeGeometry(draco, decoder, decoderBuffer, taskConfig) {\n  const attributeIDs = taskConfig.attributeIDs;\n  const attributeTypes = taskConfig.attributeTypes;\n\n  let dracoGeometry;\n  let decodingStatus;\n\n  const geometryType = decoder.GetEncodedGeometryType(decoderBuffer);\n  if (geometryType === draco.TRIANGULAR_MESH) {\n    dracoGeometry = new draco.Mesh();\n    decodingStatus = decoder.DecodeBufferToMesh(decoderBuffer, dracoGeometry);\n  } else {\n    throw new Error("DRACODecoder worker: Unexpected geometry type.");\n  }\n\n  if (!decodingStatus.ok() || dracoGeometry.ptr === 0) {\n    throw new Error("DRACODecoder worker: Decoding failed: " + decodingStatus.error_msg());\n  }\n\n  const geometry = { index: null, attributes: [] };\n\n  // Gather all vertex attributes.\n  for (let attributeName in attributeIDs) {\n    const attributeType = self[attributeTypes[attributeName]];\n\n    let attribute;\n    let attributeID;\n\n    // A Draco file may be created with default vertex attributes, whose attribute IDs\n    // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\n    // a Draco file may contain a custom set of attributes, identified by known unique\n    // IDs. glTF files always do the latter, and .drc files typically do the former.\n    if (taskConfig.useUniqueIDs) {\n      attributeID = attributeIDs[attributeName];\n      attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeID);\n    } else {\n      attributeID = decoder.GetAttributeId(dracoGeometry, draco[attributeIDs[attributeName]]);\n      if (attributeID === -1) continue;\n      attribute = decoder.GetAttribute(dracoGeometry, attributeID);\n    }\n    geometry.attributes.push(decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute));\n  }\n  // Add index.\n  if (geometryType === draco.TRIANGULAR_MESH) {\n    // Generate mesh faces.\n    const numFaces = dracoGeometry.num_faces();\n    const numIndices = numFaces * 3;\n    let dataSize;\n    let ptr;\n    let index;\n    const indexType = self[taskConfig.indexType];\n\n    switch (indexType) {\n      case Uint16Array:\n        dataSize = numIndices * 2;\n        ptr = draco._malloc(dataSize);\n        decoder.GetTrianglesUInt16Array(dracoGeometry, dataSize, ptr);\n        index = new Uint16Array(draco.HEAPU16.buffer, ptr, numIndices).slice();\n        draco._free(ptr);\n        break;\n      case Uint32Array:\n        dataSize = numIndices * 4;\n        ptr = draco._malloc(dataSize);\n        decoder.GetTrianglesUInt32Array(dracoGeometry, dataSize, ptr);\n        index = new Uint32Array(draco.HEAPU32.buffer, ptr, numIndices).slice();\n        draco._free(ptr);\n        break;\n      default:\n        throw new Error("DRACODecoder: Unexpected index type.");\n    }\n    geometry.index = { array: index, itemSize: 1 };\n  }\n  draco.destroy(dracoGeometry);\n  return geometry;\n}\n\nfunction decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute) {\n  const numComponents = attribute.num_components();\n  const numPoints = dracoGeometry.num_points();\n  const numValues = numPoints * numComponents;\n  let ptr;\n  let array;\n  let dataSize;\n  switch (attributeType) {\n    case Float32Array:\n      dataSize = numValues * 4;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_FLOAT32, dataSize, ptr);\n      array = new Float32Array(draco.HEAPF32.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Int8Array:\n      ptr = draco._malloc(numValues);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT8, numValues, ptr);\n      array = new Int8Array(draco.HEAP8.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Int16Array:\n      dataSize = numValues * 2;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT16, dataSize, ptr);\n      array = new Int16Array(draco.HEAP16.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Int32Array:\n      dataSize = numValues * 4;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT32, dataSize, ptr);\n      array = new Int32Array(draco.HEAP32.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Uint8Array:\n      ptr = draco._malloc(numValues);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT8, numValues, ptr);\n      array = new Uint8Array(draco.HEAPU8.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Uint16Array:\n      dataSize = numValues * 2;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT16, dataSize, ptr);\n      array = new Uint16Array(draco.HEAPU16.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Uint32Array:\n      dataSize = numValues * 4;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT32, dataSize, ptr);\n      array = new Uint32Array(draco.HEAPU32.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    default:\n      throw new Error("DRACODecoder: Unexpected attribute type.");\n  }\n\n  return {\n    name: attributeName,\n    array: array,\n    itemSize: numComponents\n  };\n}\n',Eo="https://gw.alipayobjects.com/os/lib/alipay/draco-javascript/1.3.6/lib/",Ro=function(){function e(e){var t;void 0===e&&(e={type:"wasm",workerLimit:4}),this.pool=[],this.workerLimit=Math.min(navigator.hardwareConcurrency||4,4),this.useJS=void 0,this.currentTaskId=1,this.taskCache=new WeakMap,this.loadLibPromise=void 0,e.workerLimit>this.workerLimit?ce.warn("DRACOWorkerPool: Can not initialize worker pool with limit:"+e.workerLimit):this.workerLimit=null!=(t=e.workerLimit)?t:4,this.useJS="object"!=typeof WebAssembly||"js"===e.type,this.loadLibPromise=this.preloadLib()}var t=e.prototype;return t.preloadLib=function(){var e=this;return this.loadLibPromise?this.loadLibPromise:new Promise((function(t,n){e.useJS?ui(Eo+"draco_decoder_gltf.js",{type:"text"}).then((function(e){var n=[e,Ao].join("\n"),r=URL.createObjectURL(new Blob([n]));t({workerSourceURL:r,decoderWASMBinary:null})})).catch((function(e){n(e)})):Promise.all([ui(Eo+"draco_wasm_wrapper_gltf.js",{type:"text"}),ui(Eo+"draco_decoder_gltf.r3bin",{type:"arraybuffer"})]).then((function(e){var n=e[0],r=e[1],i=[n,Ao].join("\n"),a=URL.createObjectURL(new Blob([i]));t({workerSourceURL:a,decoderWASMBinary:r})})).catch((function(e){n(e)}))}))},t.getWorker=function(){var e=this;return this.preloadLib().then((function(t){if(e.pool.length<e.workerLimit){var n=new Mo(t.workerSourceURL,t.decoderWASMBinary);e.pool.push(n)}else e.pool.sort((function(e,t){return e.currentLoad>t.currentLoad?-1:1}));return e.pool[e.pool.length-1]}))},t.decode=function(e,t){var n=this,r=JSON.stringify(t);if(this.taskCache.has(e)){var i=this.taskCache.get(e);if(i.key===r)return i.promise;if(0===e.byteLength)throw new Error("DRACODecoder: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var a,o=this.currentTaskId++,s=e.byteLength,l=new Promise((function(r,i){n.getWorker().then((function(n){a=n,n.setCosts(o,s),n.addCurrentLoad(s),n.setCallback(o,r,i),n.decode(o,t,e)})).catch((function(e){i(e)}))}));return l.finally((function(){a&&o&&a.releaseTask(o)})),this.taskCache.set(e,{key:r,promise:l}),l},e}();function Fo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(n),!0).forEach((function(t){Oo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Io(e,t,n){return t&&Bo(e.prototype,t),n&&Bo(e,n),e}function Oo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zo(){return(zo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Do(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ko(e,t)}function ko(e,t){return(ko=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function No(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Uo(e,t,n){return(Uo=No()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&ko(i,n.prototype),i}).apply(null,arguments)}function Vo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Go(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ho(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}U(e.AssetType.Buffer,["bin","r3bin"],!1)(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.load=function(e){var t=e.url;return function(e){return/^data:(.+?);base64,/.test(e)}(t)?new z((function(e){var n=t.slice(13+RegExp.$1.length);e(Uint8Array.from(atob(n),(function(e){return e.charCodeAt(0)})).buffer)})):this.request(t,Lo(Lo({},e),{},{type:"arraybuffer"}))},t}(vi)),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(mo||(mo={})),function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"}(go||(go={})),function(e){e.TRANSLATION="translation",e.ROTATION="rotation",e.SCALE="scale",e.WEIGHTS="weights"}(yo||(yo={})),function(e){e.Linear="LINEAR",e.Step="STEP",e.CubicSpine="CUBICSPLINE"}(xo||(xo={})),function(e){e.PERSPECTIVE="perspective",e.ORTHOGRAPHIC="orthographic"}(bo||(bo={})),function(e){e.JPEG="image/jpeg",e.PNG="image/png"}(wo||(wo={})),function(e){e.OPAQUE="OPAQUE",e.MASK="MASK",e.BLEND="BLEND"}(To||(To={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR"}(So||(So={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Co||(Co={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"}(Po||(Po={}));var Wo=function(){function t(){}return t.floatBufferToVector2Array=function(e){for(var t=e.length,n=new Array(t/2),r=0;r<t;r+=2)n[r/2]=new p(e[r],e[r+1]);return n},t.floatBufferToVector3Array=function(e){for(var t=e.length,n=new Array(t/3),r=0;r<t;r+=3)n[r/3]=new i(e[r],e[r+1],e[r+2]);return n},t.floatBufferToVector4Array=function(e){for(var t=e.length,n=new Array(t/4),r=0;r<t;r+=4)n[r/4]=new _(e[r],e[r+1],e[r+2],e[r+3]);return n},t.decodeText=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(encodeURIComponent(t))},t.getAccessorTypeSize=function(e){switch(e){case go.SCALAR:return 1;case go.VEC2:return 2;case go.VEC3:return 3;case go.VEC4:case go.MAT2:return 4;case go.MAT3:return 9;case go.MAT4:return 16}},t.getComponentType=function(e){switch(e){case mo.BYTE:return Int8Array;case mo.UNSIGNED_BYTE:return Uint8Array;case mo.SHORT:return Int16Array;case mo.UNSIGNED_SHORT:return Uint16Array;case mo.UNSIGNED_INT:return Uint32Array;case mo.FLOAT:return Float32Array}},t.getAccessorData=function(e,n,r){var i,a,o=e.bufferViews,s=o[n.bufferView],l=r[s.buffer],u=n.hasOwnProperty("byteOffset")?n.byteOffset:0,c=s.hasOwnProperty("byteOffset")?s.byteOffset:0,d=u+c,f=t.getAccessorTypeSize(n.type),h=f*n.count,p=null!=(i=s.byteStride)?i:0,_=t.getComponentType(n.componentType);if(p){var v=f*_.BYTES_PER_ELEMENT;a=new Uint8Array(n.count*v);for(var m=new Uint8Array(l,c,s.byteLength),g=0;g<n.count;g++)for(var y=0;y<v;y++)a[g*v+y]=m[g*p+u+y]}else a=new Uint8Array(l.slice(d,d+h*_.BYTES_PER_ELEMENT));var x=new _(a.buffer);if(n.sparse)for(var b,w,T,S,C=n.sparse,P=C.count,M=C.indices,A=C.values,E=o[M.bufferView],R=o[A.bufferView],F=r[E.buffer],L=r[R.buffer],B=(null!=(b=M.byteOffset)?b:0)+(null!=(w=E.byteOffset)?w:0),I=E.byteLength,O=(null!=(T=A.byteOffset)?T:0)+(null!=(S=R.byteOffset)?S:0),z=R.byteLength,D=t.getComponentType(M.componentType),k=new D(F,B,I/D.BYTES_PER_ELEMENT),N=new _(L,O,z/_.BYTES_PER_ELEMENT),U=0;U<P;U++)for(var V=k[U],G=0;G<f;G++)x[V*f+G]=N[U*f+G];return x},t.getBufferViewData=function(e,t){var n=e.buffer,r=e.byteOffset,i=void 0===r?0:r,a=e.byteLength;return t[n].slice(i,i+a)},t.getVertexStride=function(e,n){var r;return e.bufferViews[null!=(r=n.bufferView)?r:0].byteStride||t.getAccessorTypeSize(n.type)*t.getComponentType(n.componentType).BYTES_PER_ELEMENT},t.createVertexElement=function(e,n,r){var i=t.getAccessorTypeSize(n.type);return new un(e,0,t.getElementFormat(n.componentType,i,n.normalized),r)},t.getIndexFormat=function(t){switch(t){case mo.UNSIGNED_BYTE:return e.IndexFormat.UInt8;case mo.UNSIGNED_SHORT:return e.IndexFormat.UInt16;case mo.UNSIGNED_INT:return e.IndexFormat.UInt32}},t.getElementFormat=function(t,n,r){if(void 0===r&&(r=!1),t==mo.FLOAT)switch(n){case 1:return e.VertexElementFormat.Float;case 2:return e.VertexElementFormat.Vector2;case 3:return e.VertexElementFormat.Vector3;case 4:return e.VertexElementFormat.Vector4}if(t==mo.SHORT)switch(n){case 2:return r?e.VertexElementFormat.NormalizedShort2:e.VertexElementFormat.Short2;case 3:case 4:return r?e.VertexElementFormat.NormalizedShort4:e.VertexElementFormat.Short4}if(t==mo.UNSIGNED_SHORT)switch(n){case 2:return r?e.VertexElementFormat.NormalizedUShort2:e.VertexElementFormat.UShort2;case 3:case 4:return r?e.VertexElementFormat.NormalizedUShort4:e.VertexElementFormat.UShort4}if(t==mo.BYTE)switch(n){case 2:case 3:case 4:return r?e.VertexElementFormat.NormalizedByte4:e.VertexElementFormat.Byte4}if(t==mo.UNSIGNED_BYTE)switch(n){case 2:case 3:case 4:return r?e.VertexElementFormat.NormalizedUByte4:e.VertexElementFormat.UByte4}},t.loadImageBuffer=function(e,t){return new Promise((function(n,r){var i=new window.Blob([e],{type:t}),a=new Image;a.src=URL.createObjectURL(i),a.crossOrigin="anonymous",a.onerror=function(){r(new Error("Failed to load image buffer"))},a.onload=function(){requestAnimationFrame((function(){n(a),a.onload=null,a.onerror=null,a.onabort=null}))}}))},t.isAbsoluteUrl=function(e){return/^(?:http|blob|data:|\/)/.test(e)},t.parseRelativeUrl=function(e,n){return t.isAbsoluteUrl(n)?n:"."===n.charAt(0)?t._formatRelativePath(n+n):e.substring(0,e.lastIndexOf("/")+1)+n},t.parseGLB=function(e){var n=new DataView(e),r={magic:n.getUint32(0,!0),version:n.getUint32(4,!0),length:n.getUint32(8,!0)};if(1179937895!==r.magic)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+r.magic.toString(16)),null;var i=n.getUint32(12,!0),a=n.getUint32(16,!0);if(1313821514!==a)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+a.toString(16)),null;for(var o=new Uint8Array(e,20,i),s=JSON.parse(t.decodeText(o)),l=[],u=20+i;u<r.length;){if(i=n.getUint32(u,!0),5130562!==(a=n.getUint32(u+4,!0)))return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+a.toString(16)),null;var c=u+8,d=e.slice(c,c+i);l.push(d),u+=i+8}return{gltf:s,buffers:l}},t._formatRelativePath=function(e){for(var t=e.split("/"),n=0,r=t.length;n<r;n++)".."==t[n]&&(t.splice(n-1,2),n-=2);return t.join("/")},t}(),jo=function(){function e(){}return e.parseEngineResource=function(t,n,r,i){var a=e._extensionParsers[t];if(null!=a&&a.length){for(var o=arguments.length,s=new Array(o>4?o-4:0),l=4;l<o;l++)s[l-4]=arguments[l];for(var u=0;u<a.length;u++){var c;(c=a[u]).parseEngineResource.apply(c,[n,r,i].concat(s))}}},e.createEngineResource=function(t,n,r){var i=e._extensionParsers[t];if(null!=i&&i.length){for(var a,o=arguments.length,s=new Array(o>3?o-3:0),l=3;l<o;l++)s[l-3]=arguments[l];return(a=i[0]).createEngineResource.apply(a,[n,r].concat(s))}},e.hasExtensionParser=function(t){var n=e._extensionParsers[t];return!(null==n||!n.length)},e.initialize=function(t){var n=e._extensionParsers[t];if(null!=n&&n.length)for(var r=0;r<n.length;r++)n[r].initialize()},e._addExtensionParser=function(t,n){e._extensionParsers[t]||(e._extensionParsers[t]=[]),e._extensionParsers[t].push(n)},e}();function Xo(e){return function(t){var n=new t;jo._addExtensionParser(e,n)}}jo._extensionParsers={};var Ko=function(t){function n(){return t.apply(this,arguments)||this}Do(n,t);var r=n.prototype;return r.parse=function(t){var n=t.gltf,r=t.buffers,i=t.entities,a=n.animations,o=n.accessors;if(a){for(var s=a.length,l=new Array(s),u=new Array(s),c=0;c<s;c++){for(var d=a[c],f=d.channels,h=d.samplers,p=d.name,_=void 0===p?"AnimationClip"+c:p,v=new qi(_),m=new Array,g=0;g<h.length;g++){var y,x=h[g],b=o[x.input],w=o[x.output],T=Wo.getAccessorData(n,b,r),S=Wo.getAccessorData(n,w,r),C=S.length/T.length,P=void 0;switch(null!=(y=x.interpolation)?y:xo.Linear){case xo.CubicSpine:P=e.InterpolationType.CubicSpine;break;case xo.Step:P=e.InterpolationType.Step;break;case xo.Linear:P=e.InterpolationType.Linear}T[T.length-1],m.push({type:w.type,interpolation:P,input:T,output:S,outputSize:C})}for(var M=0;M<f.length;M++){for(var A=f[M],E=A.target,R="",F=i[E.node];F.parent;)R=""===R?""+F.name:F.name+"/"+R,F=F.parent;var L=void 0,B=void 0;switch(E.path){case yo.TRANSLATION:L=We,B="position";break;case yo.ROTATION:L=We,B="rotation";break;case yo.SCALE:L=We,B="scale";break;case yo.WEIGHTS:L=jn,B="blendShapeWeights"}var I=this._addCurve(A,m);v.addCurveBinding(R,L,B,I)}l[c]=v,u[c]={name:_,index:c}}t.animations=l,t._animationsIndices=u}},r._addCurve=function(e,t){var n=new wa,r=t[e.sampler],a=r.type,o=r.input,s=r.output,l=r.outputSize;n.interpolation=r.interpolation;for(var u=0,c=o.length;u<c;u++){var f=u*l;if(a===go.SCALAR){var h=new Sa;h.time=o[u],h.inTangent=0,h.outTangent=0,h.value=l>1?s.subarray(f,f+l):s[f],n.addKey(h)}if(a===go.VEC2){var v=new Sa;v.time=o[u],v.value=new p(s[f],s[f+1]),v.inTangent=new p,v.outTangent=new p,n.addKey(v)}if(a===go.VEC3){var m=new Sa;m.time=o[u],m.value=new i(s[f],s[f+1],s[f+2]),m.inTangent=new i,m.outTangent=new i,n.addKey(m)}if(a===go.VEC4){var g=new Sa;g.time=o[u],g.value=new d(s[f],s[f+1],s[f+2],s[f+3]),g.inTangent=new _,g.outTangent=new _,n.addKey(g)}}return n},n}(jo),qo=function(t){function n(){return t.apply(this,arguments)||this}Do(n,t);var r=n.prototype;return r.parse=function(t){var n=t.url,r=t.engine;return this._isGLB(n)?r.resourceManager.load({url:n,type:e.AssetType.Buffer}).then(Wo.parseGLB).then((function(e){var n=e.gltf,r=e.buffers;t.gltf=n,t.buffers=r})):r.resourceManager.load({url:n,type:e.AssetType.JSON}).then((function(i){return t.gltf=i,Promise.all(i.buffers.map((function(t){return r.resourceManager.load({type:e.AssetType.Buffer,url:Wo.parseRelativeUrl(n,t.uri)})}))).then((function(e){t.buffers=e}))}))},r._isGLB=function(e){return"glb"===e.substring(e.lastIndexOf(".")+1)},n}(jo),Qo=function(e){function t(){return e.apply(this,arguments)||this}Do(t,e);var n=t.prototype;return n.parse=function(e){var n=e.engine,r=e.gltf.nodes;if(r){for(var i=[],a=0;a<r.length;a++){var o=r[a],s=o.matrix,l=o.translation,u=o.rotation,c=o.scale,d=new Xe(n,o.name||""+t._defaultName+a),f=d.transform;if(s){var h=f.localMatrix;h.setValueByArray(s),f.localMatrix=h}else l&&f.setPosition(l[0],l[1],l[2]),u&&f.setRotationQuaternion(u[0],u[1],u[2],u[3]),c&&f.setScale(c[0],c[1],c[2]);i[a]=d}e.entities=i,this._buildEntityTree(e),this._createSceneRoots(e)}},n._buildEntityTree=function(e){for(var t=e.gltf.nodes,n=e.entities,r=0;r<t.length;r++){var i=t[r].children,a=n[r];if(i)for(var o=0;o<i.length;o++){var s=n[i[o]];a.addChild(s)}}},n._createSceneRoots=function(e){var t=e.engine,n=e.gltf,r=n.scene,i=void 0===r?0:r,a=n.scenes,o=e.entities;if(a){for(var s=[],l=0;l<a.length;l++){var u=a[l].nodes;if(u)if(1===u.length)s[l]=o[u[0]];else{for(var c=new Xe(t,"GLTF_ROOT"),d=0;d<u.length;d++)c.addChild(o[u[d]]);s[l]=c}}e.sceneRoots=s,e.defaultSceneRoot=s[i]}},t}(jo);Qo._defaultName="_GLTF_ENTITY_";var Yo=function(t){function n(){return t.apply(this,arguments)||this}return Do(n,t),n._parseTextureTransform=function(e,t,n){void 0===t&&(t={});var r=t.KHR_texture_transform;r&&jo.parseEngineResource("KHR_texture_transform",r,e,n)},n.prototype.parse=function(t){var r=t.gltf,i=t.engine,a=t.textures;if(r.materials){for(var o=[],s=0;s<r.materials.length;s++){var l=r.materials[s],u=l.extensions,c=void 0===u?{}:u,d=l.pbrMetallicRoughness,f=l.normalTexture,h=l.occlusionTexture,p=l.emissiveTexture,_=l.emissiveFactor,v=l.alphaMode,g=l.alphaCutoff,y=l.doubleSided,x=l.name,b=void 0===x?"":x,w=c.KHR_materials_unlit,T=c.KHR_materials_pbrSpecularGlossiness,S=null;if((S=w?jo.createEngineResource("KHR_materials_unlit",w,t):T?jo.createEngineResource("KHR_materials_pbrSpecularGlossiness",T,t):new xi(i)).name=b,d){var C=d.baseColorFactor,P=d.baseColorTexture,M=d.metallicFactor,A=d.roughnessFactor,E=d.metallicRoughnessTexture;if(C&&(S.baseColor=Uo(m,C)),P&&(S.baseTexture=a[P.index],n._parseTextureTransform(S,P.extensions,t)),!w&&!T){var R=S;R.metallic=null!=M?M:1,R.roughness=null!=A?A:1,E&&(R.roughnessMetallicTexture=a[E.index],n._parseTextureTransform(S,E.extensions,t))}}if(!w){var F=S;if(p&&(F.emissiveTexture=a[p.index],n._parseTextureTransform(S,p.extensions,t)),_&&(F.emissiveColor=Uo(m,_)),f){var L=f.index,B=f.scale;F.normalTexture=a[L],n._parseTextureTransform(S,f.extensions,t),void 0!==B&&(F.normalTextureIntensity=B)}if(h){var I=h.index,O=h.strength;F.occlusionTexture=a[I],n._parseTextureTransform(S,h.extensions,t),void 0!==O&&(F.occlusionTextureIntensity=O)}}switch(S.renderFace=y?e.RenderFace.Double:e.RenderFace.Front,v){case To.OPAQUE:S.isTransparent=!1;break;case To.BLEND:S.isTransparent=!0;break;case To.MASK:S.alphaCutoff=null!=g?g:.5}o[s]=S}t.materials=o}},n}(jo),$o=function(e){function t(){return e.apply(this,arguments)||this}Do(t,e);var n=t.prototype;return n.parse=function(e){var t=this,n=e.engine,r=e.gltf,i=e.buffers;if(r.meshes){for(var a=[],o=function(o){for(var s=r.meshes[o],l=[],u=function(a){var o=s.primitives[a],u=o.extensions,c=(void 0===u?{}:u).KHR_draco_mesh_compression;l.push(new Promise((function(l){var u=new Mn(n,s.name||a+"");c?jo.createEngineResource("KHR_draco_mesh_compression",c,e,o).then((function(e){return t._parseMeshFromGLTFPrimitive(u,s,o,r,(function(t){for(var n=0;n<e.attributes.length;n++)if(e.attributes[n].name===t)return e.attributes[n].array;return null}),(function(e,t){throw"BlendShape animation is not supported when using draco."}),(function(){return e.index.array}),n)})).then(l):t._parseMeshFromGLTFPrimitive(u,s,o,r,(function(e){var t=o.attributes[e],n=r.accessors[t];return Wo.getAccessorData(r,n,i)}),(function(e,t){var n=o.targets[t][e];if(n){var a=r.accessors[n];return Wo.getAccessorData(r,a,i)}return null}),(function(){var e=r.accessors[o.indices];return Wo.getAccessorData(r,e,i)}),n).then(l)})))},c=0;c<s.primitives.length;c++)u(c);a.push(Promise.all(l))},s=0;s<r.meshes.length;s++)o(s);return Promise.all(a).then((function(t){e.meshes=t}))}},n._parseMeshFromGLTFPrimitive=function(e,n,r,a,o,s,l,u){var c,d=r.attributes,f=r.targets,h=r.indices,p=r.mode,_=a.accessors[d.POSITION],v=o("POSITION"),m=Wo.floatBufferToVector3Array(v);e.setPositions(m);var g=e.bounds;if(c=_.count,_.min&&_.max)g.min.setValueByArray(_.min),g.max.setValueByArray(_.max);else{var y=t._tempVector3,x=g.min,b=g.max;x.setValue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b.setValue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var w=v.length/c,T=0;T<c;T++){var S=T*w;y.setValueByArray(v,S),i.min(x,y,x),i.max(b,y,b)}}for(var C in d)if("POSITION"!==C){var P=o(C);switch(C){case"NORMAL":var M=Wo.floatBufferToVector3Array(P);e.setNormals(M);break;case"TANGENT":var A=Wo.floatBufferToVector4Array(P);e.setTangents(A);break;case"TEXCOORD_0":var E=Wo.floatBufferToVector2Array(P);e.setUVs(E,0);break;case"JOINTS_0":var R=Wo.floatBufferToVector4Array(P);e.setBoneIndices(R);break;case"WEIGHTS_0":var F=Wo.floatBufferToVector4Array(P);e.setBoneWeights(F)}}if(void 0!==h){var L=a.accessors[h],B=l();e.setIndices(B),e.addSubMesh(0,L.count,p)}else e.addSubMesh(0,c,p);return f&&this._createBlendShape(e,n,f,s),e.uploadData(!0),Promise.resolve(e)},n._createBlendShape=function(e,t,n,r){for(var i=t.extras?t.extras.targetNames:null,a=0,o=n.length;a<o;a++){var s=i?i[a]:"blendShape"+a,l=r("POSITION",a),u=r("NORMAL",a),c=r("TANGENT",a),d=l?Wo.floatBufferToVector3Array(l):null,f=u?Wo.floatBufferToVector3Array(u):null,h=c?Wo.floatBufferToVector3Array(c):null,p=new Qn(s);p.addFrame(1,d,f,h),e.addBlendShape(p)}},t}(jo);$o._tempVector3=new i;var Jo=function(e){function t(){return e.apply(this,arguments)||this}Do(t,e),t._getDefaultMaterial=function(e){return t._defaultMaterial||(t._defaultMaterial=new gi(e)),t._defaultMaterial};var n=t.prototype;return n.parse=function(e){var t=e.gltf,n=t.nodes,r=t.cameras,i=e.entities;if(n){for(var a=0;a<n.length;a++){var o=n[a],s=o.camera,l=o.mesh,u=o.extensions,c=(void 0===u?{}:u).KHR_lights_punctual,d=i[a];if(void 0!==s&&this._createCamera(e,r[s],d),void 0!==l&&this._createRenderer(e,o,d),c){var f=c.light,h=e.gltf.extensions.KHR_lights_punctual.lights;jo.parseEngineResource("KHR_lights_punctual",h[f],d,e)}}e.defaultSceneRoot&&this._createAnimator(e)}},n._createCamera=function(e,t,n){var r=t.orthographic,i=t.perspective,a=t.type,o=n.addComponent(si);if(a===bo.ORTHOGRAPHIC){var s=r.xmag,l=r.ymag,u=r.zfar,c=r.znear;o.isOrthographic=!0,void 0!==c&&(o.nearClipPlane=c),void 0!==u&&(o.farClipPlane=u),o.orthographicSize=Math.max(null!=l?l:0,null!=s?s:0)/2}else if(a===bo.PERSPECTIVE){var d=i.aspectRatio,f=i.yfov,h=i.zfar,p=i.znear;void 0!==d&&(o.aspectRatio=d),void 0!==f&&(o.fieldOfView=180*f/Math.PI),void 0!==h&&(o.farClipPlane=h),void 0!==p&&(o.nearClipPlane=p)}e.cameras||(e.cameras=[]),e.cameras.push(o),o.enabled=!1},n._createRenderer=function(e,n,r){for(var i=e.engine,a=e.gltf.meshes,o=e.meshes,s=e.materials,l=e.skins,u=n.mesh,c=n.skin,d=a[u],f=d.primitives,h=n.weights||d.weights,p=0;p<f.length;p++){var _=o[u][p],v=void 0;if(void 0!==c||h){var m=r.addComponent(jn);m.mesh=_,void 0!==c&&(m.skin=l[c]),h&&(m.blendShapeWeights=new Float32Array(h)),v=m}else(v=r.addComponent(Wn)).mesh=_;var g=f[p].material,y=(null==s?void 0:s[g])||t._getDefaultMaterial(i);v.setMaterial(y);var x=f[p].extensions,b=(void 0===x?{}:x).KHR_materials_variants;b&&jo.parseEngineResource("KHR_materials_variants",b,v,e)}},n._createAnimator=function(e){var t=e.defaultSceneRoot,n=e.animations;if(n){var r=t.addComponent(va),i=new ma,a=new ga("layer"),o=new xa;if(i.addLayer(a),r.animatorController=i,a.stateMachine=o,n)for(var s=0;s<n.length;s++){var l=n[s],u=l.name,c=o.makeUniqueStateName(u);c!==u&&console.warn("AnimatorState name is existed, name: "+u+" reset to "+c),o.addState(c).clip=l}}},t}(jo);Jo._defaultMaterial=void 0;var Zo=function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.parse=function(e){var t=e.gltf,n=e.buffers,r=e.entities,i=e.defaultSceneRoot,a=t.skins;if(a){for(var o=[],s=0;s<a.length;s++){var l=a[s],u=l.inverseBindMatrices,c=l.skeleton,d=l.joints,h=l.name,p=void 0===h?"SKIN_"+s:h,_=d.length,v=new Hn(p);v.inverseBindMatrices.length=_;for(var m=t.accessors[u],g=Wo.getAccessorData(t,m,n),y=0;y<_;y++){var x=new f;x.setValueByArray(g,16*y),v.inverseBindMatrices[y]=x}for(var b=0;b<_;b++)v.joints[b]=r[d[b]].name;v.skeleton=void 0!==c?r[c].name:i.name,o[s]=v}e.skins=o}},t}(jo),es=function(t){function n(){return t.apply(this,arguments)||this}Do(n,t);var r=n.prototype;return r.parse=function(t){var n=this,r=t.gltf,i=t.buffers,a=t.engine,o=t.url;if(r.textures)return Promise.all(r.textures.map((function(t,s){var l=t.sampler,u=t.source,c=void 0===u?0:u,d=t.name,f=r.images[c],h=f.uri,p=f.bufferView,_=f.mimeType,v=f.name;if(h)return a.resourceManager.load({url:Wo.parseRelativeUrl(o,h),type:e.AssetType.Texture2D}).then((function(e){return e.name||(e.name=d||v||"texture_"+s),void 0!==l&&n._parseSampler(e,r.samplers[l]),e}));var m=r.bufferViews[p],g=Wo.getBufferViewData(m,i);return Wo.loadImageBuffer(g,_).then((function(e){var t=new bn(a,e.width,e.height);return t.setImageSource(e),t.generateMipmaps(),t.name=d||v||"texture_"+s,void 0!==l&&n._parseSampler(t,r.samplers[l]),t}))}))).then((function(e){t.textures=e}))},r._parseSampler=function(e,t){var r=t.magFilter,i=t.minFilter,a=t.wrapS,o=t.wrapT;(r||i)&&ce.warn("texture use filterMode in engine"),a&&(e.wrapModeU=n._wrapMap[a]),o&&(e.wrapModeV=n._wrapMap[o])},n}(jo);es._wrapMap={33071:e.TextureWrapMode.Clamp,33648:e.TextureWrapMode.Mirror,10497:e.TextureWrapMode.Repeat};var ts=function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.parse=function(e){var t=e.gltf,n=t.asset.version,r=t.extensionsUsed,i=t.extensionsRequired,a=Number(n);if(!(a>=2&&a<3))throw"Only support gltf 2.x.";if(r){ce.info("extensionsUsed: ",r);for(var o=0;o<r.length;o++)jo.hasExtensionParser(r[o])||ce.warn("Extension "+r[o]+" is not implemented, you can customize this extension in gltf.")}if(i){ce.info("extensionsRequired: "+i);for(var s=0;s<i.length;s++){var l=i[s];jo.hasExtensionParser(l)?jo.initialize(l):ce.error("GLTF parser has not supported required extension "+l+".")}}},t}(jo),ns=function(){function e(e){var t=this;this._pipes=[],e.forEach((function(e,n){t._pipes[n]=new e}))}return e.prototype.parse=function(e){var t,n=this;return new Promise((function(r,i){n._pipes.forEach((function(n){t=t?t.then((function(){return n.parse(e)})):n.parse(e)})),t?t.then((function(){r(e)})).catch(i):r(e)}))},e}();ns.instance=new ns([qo,ts,es,Yo,$o,Qo,Zo,Ko,Jo]);var rs=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).url=void 0,t.gltf=void 0,t.buffers=void 0,t.textures=void 0,t.materials=void 0,t.meshes=void 0,t.skins=void 0,t.animations=void 0,t.entities=void 0,t.cameras=void 0,t.lights=void 0,t.sceneRoots=void 0,t.defaultSceneRoot=void 0,t.variants=void 0,t}return Do(t,e),t}(re);U(e.AssetType.Prefab,["gltf","glb"])(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.load=function(e,t){var n=e.url;return new z((function(e,r){var i=new rs(t.engine);i.url=n,ns.instance.parse(i).then(e).catch((function(e){console.error(e),r("Error loading glTF model from "+n+" .")}))}))},t}(vi)),U(e.AssetType.JSON,["json"],!1)(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.load=function(e){return this.request(e.url,Lo(Lo({},e),{},{type:"json"}))},t}(vi));var is=function(t,n,r,i){if(void 0===i&&(i=!1),!function(e){if(e.byteLength>=12){var t=new Uint8Array(e,0,12);if(171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&49===t[5]&&49===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11])return!0}return!1}(t))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var a=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(t,12,13*a),s=67305985===o.getUint32(0,!0),l={buffer:t,glType:o.getUint32(1*a,s),glTypeSize:o.getUint32(2*a,s),glFormat:o.getUint32(3*a,s),glInternalFormat:o.getUint32(4*a,s),glBaseInternalFormat:o.getUint32(5*a,s),pixelWidth:o.getUint32(6*a,s),pixelHeight:o.getUint32(7*a,s),pixelDepth:o.getUint32(8*a,s),numberOfArrayElements:o.getUint32(9*a,s),numberOfFaces:o.getUint32(10*a,s),numberOfMipmapLevels:o.getUint32(11*a,s),bytesOfKeyValueData:o.getUint32(12*a,s),loadType:0};if(0!==l.glType)throw new Error("only compressed formats currently supported");if(l.numberOfMipmapLevels=Math.max(1,l.numberOfMipmapLevels),0===l.pixelHeight||0!==l.pixelDepth)throw new Error("only 2D textures currently supported");if(0!==l.numberOfArrayElements)throw new Error("texture arrays not currently supported");if(l.numberOfFaces!==n)throw new Error("number of faces expected"+n+", but found "+l.numberOfFaces);return r&&(l.mipmaps=function(e,t){for(var n=[],r=64+e.bytesOfKeyValueData,i=e.pixelWidth,a=e.pixelHeight,o=e.numberOfMipmapLevels,s=0;s<o;s++){var l=new Int32Array(e.buffer,r,1)[0];r+=4;for(var u=0;u<e.numberOfFaces;u++){var c=new Uint8Array(e.buffer,r,l);n.push({data:c,width:i,height:a}),r+=l,r+=3-(l+3)%4}i=Math.max(1,.5*i),a=Math.max(1,.5*a)}return n}(l)),i&&(l.engineFormat=function(t){switch(t){case e.GLCompressedTextureInternalFormat.RGB_S3TC_DXT1_EXT:return e.TextureFormat.DXT1;case e.GLCompressedTextureInternalFormat.RGBA_S3TC_DXT5_EXT:return e.TextureFormat.DXT5;case e.GLCompressedTextureInternalFormat.RGB_ETC1_WEBGL:return e.TextureFormat.ETC1_RGB;case e.GLCompressedTextureInternalFormat.RGB8_ETC2:return e.TextureFormat.ETC2_RGB;case e.GLCompressedTextureInternalFormat.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return e.TextureFormat.ETC2_RGBA5;case e.GLCompressedTextureInternalFormat.RGBA8_ETC2_EAC:return e.TextureFormat.ETC2_RGBA8;case e.GLCompressedTextureInternalFormat.RGB_PVRTC_2BPPV1_IMG:return e.TextureFormat.PVRTC_RGB2;case e.GLCompressedTextureInternalFormat.RGBA_PVRTC_2BPPV1_IMG:return e.TextureFormat.PVRTC_RGBA2;case e.GLCompressedTextureInternalFormat.RGB_PVRTC_4BPPV1_IMG:return e.TextureFormat.PVRTC_RGB4;case e.GLCompressedTextureInternalFormat.RGBA_PVRTC_4BPPV1_IMG:return e.TextureFormat.PVRTC_RGBA4;case e.GLCompressedTextureInternalFormat.RGBA_ASTC_4X4_KHR:return e.TextureFormat.ASTC_4x4;case e.GLCompressedTextureInternalFormat.RGBA_ASTC_5X5_KHR:return e.TextureFormat.ASTC_5x5;case e.GLCompressedTextureInternalFormat.RGBA_ASTC_6X6_KHR:return e.TextureFormat.ASTC_6x6;case e.GLCompressedTextureInternalFormat.RGBA_ASTC_8X8_KHR:return e.TextureFormat.ASTC_8x8;case e.GLCompressedTextureInternalFormat.RGBA_ASTC_10X10_KHR:return e.TextureFormat.ASTC_10x10;case e.GLCompressedTextureInternalFormat.RGBA_ASTC_12X12_KHR:return e.TextureFormat.ASTC_12x12;default:var n=e.GLCompressedTextureInternalFormat[t];throw new Error("this format is not supported in Oasis Engine: "+n)}}(l.glInternalFormat)),l};function as(e){var t=is(e,1,!0,!0);return{mipmaps:t.mipmaps,engineFormat:t.engineFormat,internalFormat:t.glInternalFormat,width:t.pixelWidth,height:t.pixelHeight}}U(e.AssetType.KTXCube,[])(function(t){function n(){return t.apply(this,arguments)||this}return Do(n,t),n.prototype.load=function(t,n){var r=this;return new z((function(i,a){Promise.all(t.urls.map((function(e){return r.request(e,Lo(Lo({},t),{},{type:"arraybuffer"}))}))).then((function(t){for(var r=function(e){for(var t,n,r,i,a=[],o=0;o<e.length;o++){var s=is(e[o],1,!0,!0);a.push(s.mipmaps),0===o&&(r=s.pixelWidth,i=s.pixelHeight,t=s.glInternalFormat,n=s.engineFormat)}return{mipmapsFaces:a,engineFormat:n,internalFormat:t,width:r,height:i}}(t),a=r.width,o=r.mipmapsFaces,s=r.engineFormat,l=o[0].length>1,u=new Tn(n.engine,a,s,l),c=0;c<6;c++)for(var d=o[c].length,f=0;f<d;f++){var h=o[c][f],p=h.data,_=h.width,v=h.height;u.setPixelBuffer(e.TextureCubeFace.PositiveX+c,p,f,0,0,_,v)}i(u)})).catch((function(e){a(e)}))}))},n}(vi)),U(e.AssetType.KTX,["ktx"])(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.load=function(e,t){var n=this;return new z((function(r,i){n.request(e.url,Lo(Lo({},e),{},{type:"arraybuffer"})).then((function(e){for(var n=as(e),i=n.width,a=n.height,o=n.mipmaps,s=n.engineFormat,l=o.length>1,u=new bn(t.engine,i,a,s,l),c=0;c<o.length;c++){var d=o[c],f=d.width,h=d.height,p=d.data;u.setPixelBuffer(p,c,0,0,f,h)}r(u)})).catch((function(e){i(e)}))}))},t}(vi)),U(e.AssetType.Texture2D,["png","jpg","webp","jpeg"])(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.load=function(e,t){var n=this;return new z((function(r,i){n.request(e.url,Lo(Lo({},e),{},{type:"image"})).then((function(n){var i=new bn(t.engine,n.width,n.height);if(i._platformTexture){if(i.setImageSource(n),i.generateMipmaps(),0!==e.url.indexOf("data:")){var a=e.url.split("/");i.name=a[a.length-1]}r(i)}})).catch((function(e){i(e)}))}))},t}(vi)),U(e.AssetType.TextureCube,[""])(function(t){function n(){return t.apply(this,arguments)||this}return Do(n,t),n.prototype.load=function(t,n){var r=this;return new z((function(i,a){Promise.all(t.urls.map((function(e){return r.request(e,Lo(Lo({},t),{},{type:"image"}))}))).then((function(t){var r=t[0],a=r.width;if(a===r.height){var o=new Tn(n.engine,a);if(o._platformTexture){for(var s=0;s<6;s++)o.setImageSource(e.TextureCubeFace.PositiveX+s,t[s],0);o.generateMipmaps(),i(o)}}else console.error("The cube texture must have the same width and height")})).catch((function(e){a(e)}))}))},n}(vi)),U(e.AssetType.SpriteAtlas,["atlas"],!1)(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.load=function(e,t){var n=this;return new z((function(r,i){n.request(e.url,Lo(Lo({},e),{},{type:"json"})).then((function(i){var a=i.atlasItems,o=i.format,s=a.length;Promise.all(a.map((function(t){var r=t.img;return n.request(Wo.parseRelativeUrl(e.url,r),Lo(Lo({},e),{},{type:"image"}))}))).then((function(e){for(var n=t.engine,i=new g,l=new p,u=new Ui(n),c=0;c<s;c++){var d=e[c],f=d.width,h=d.height,_=new bn(n,f,h,o);_.setImageSource(d),_.generateMipmaps();for(var v=a[c].sprites,m=1/f,y=1/h,x=v.length-1;x>=0;x--){var b=v[x],w=b.region,T=b.pivot,S=b.atlasRegionOffset,C=b.atlasRegion,P=b.id,M=new Vi(n,_,w?i.setValue(w.x,w.y,w.w,w.h):void 0,T?l.setValue(T.x,T.y):void 0,b.pixelsPerUnit||void 0,b.name);if(M.atlasRegion.setValue(C.x*m,C.y*y,C.w*m,C.h*y),b.atlasRotated&&(M.atlasRotated=!0),S){var A=S.x,E=S.y,R=S.z,F=S.w,L=void 0,B=void 0;b.atlasRotated?(L=1/(A+C.h+R),B=1/(E+C.w+F)):(L=1/(A+C.w+R),B=1/(E+C.h+F)),M.atlasRegionOffset.setValue(A*L,E*B,R*L,F*B)}void 0!==P&&(M._assetID=P),u._addSprite(M)}}r(u)}))})).catch((function(e){i(e)}))}))},t}(vi));var os,ss,ls=function(){function e(){}var t=e.prototype;return t.initialize=function(){},t.parseEngineResource=function(e,t,n){},t.createEngineResource=function(e,t){return null},e}();Xo("KHR_draco_mesh_compression")((ss=os=function(e){function t(){return e.apply(this,arguments)||this}Do(t,e);var n=t.prototype;return n.initialize=function(){t._decoder||(t._decoder=new Ro)},n.createEngineResource=function(e,n,r){var i=n.gltf,a=n.buffers,o=i.bufferViews,s=i.accessors,l=e.bufferView,u=e.attributes,c={},d={};for(var f in u)c[f]=u[f];for(var h in r.attributes)if(void 0!==u[h]){var p=s[r.attributes[h]];d[h]=Wo.getComponentType(p.componentType).name}var _=s[r.indices],v={attributeIDs:c,attributeTypes:d,useUniqueIDs:!0,indexType:Wo.getComponentType(_.componentType).name},m=Wo.getBufferViewData(o[l],a);return t._decoder.decode(m,v).then((function(e){return e}))},t}(ls),os._decoder=void 0,ss)),Xo("KHR_lights_punctual")(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.parseEngineResource=function(e,t,n){var r,i=e.color,a=e.intensity,o=void 0===a?1:a,s=e.type,l=e.range,u=e.spot;if("directional"===s?r=t.addComponent(sr):"point"===s?r=t.addComponent(lr):"spot"===s&&(r=t.addComponent(ur)),i&&r.color.setValue(i[0],i[1],i[2],1),r.intensity=o,!l||r instanceof sr||(r.distance=l),u&&r instanceof ur){var c=u.innerConeAngle,d=void 0===c?0:c,f=u.outerConeAngle,h=void 0===f?Math.PI/4:f;r.angle=d,r.penumbra=h-d}n.lights||(n.lights=[]),n.lights.push(r)},t}(ls)),Xo("KHR_materials_pbrSpecularGlossiness")(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.createEngineResource=function(e,t){var n=t.engine,r=t.textures,i=new bi(n),a=e.diffuseFactor,o=e.diffuseTexture,s=e.specularFactor,l=e.glossinessFactor,u=e.specularGlossinessTexture;return a&&(i.baseColor=Uo(m,a)),o&&(i.baseTexture=r[o.index],Yo._parseTextureTransform(i,o.extensions,t)),s&&(i.specularColor=Uo(m,s)),void 0!==l&&(i.glossiness=l),u&&(i.specularGlossinessTexture=r[u.index],Yo._parseTextureTransform(i,u.extensions,t)),i},t}(ls)),Xo("KHR_materials_unlit")(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.createEngineResource=function(e,t){var n=t.engine;return new wi(n)},t}(ls)),Xo("KHR_materials_variants")(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.parseEngineResource=function(e,t,n){for(var r=n.gltf.extensions.KHR_materials_variants.variants,i=n.materials,a=e.mappings,o=0;o<a.length;o++){var s=a[o],l=s.material,u=s.variants;n.variants||(n.variants=[]),n.variants.push({renderer:t,material:i[l],variants:u.map((function(e){return r[e].name}))})}},t}(ls)),Xo("KHR_mesh_quantization")(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t}(ls)),Xo("KHR_texture_transform")(function(e){function t(){return e.apply(this,arguments)||this}return Do(t,e),t.prototype.parseEngineResource=function(e,t,n){var r=e.offset,i=e.rotation,a=e.scale,o=e.texCoord;r&&(t.tilingOffset.z=r[0],t.tilingOffset.w=r[1]),a&&(t.tilingOffset.x=a[0],t.tilingOffset.y=a[1]),i&&ce.warn("rotation in KHR_texture_transform is not supported now"),o&&ce.warn("texCoord in KHR_texture_transform is not supported now")},t}(ls));var us=function(e){function t(t){var n;return(n=e.call(this,t)||this)._animatorController=void 0,n._speed=1,n._animator=void 0,n._asset=void 0,n._glTFEntity=void 0,n._clipPreview=void 0,n._hasBuiltNode=!1,n._controllerUpdateFlag=void 0,n}Do(t,e);var n=t.prototype;return n.init=function(e){var t=e.asset,n=void 0===t?null:t,r=e.speed,i=e.animatorController,a=e.clipPreview;if(e.isClone){var o=e.gltfRootName;o&&(this._glTFEntity=this.entity.findByName(o))}if(this._glTFEntity)this._hasBuiltNode=!0;else{var s="GLTF-"+Date.now();e.gltfRootName=s,this._glTFEntity=this.entity.createChild(s),this._hasBuiltNode=!1}this.asset=n,this.animatorController=i,this.speed=r,this.clipPreview=a},n.update=function(){var e;this._animator&&null!==(e=this._controllerUpdateFlag)&&void 0!==e&&e.flag&&this._playState()},n._onEnable=function(){this._glTFEntity&&(this._glTFEntity.isActive=!0),this.engine._componentsManager.addOnUpdateAnimations(this)},n._onDisable=function(){this._glTFEntity&&(this._glTFEntity.isActive=!1),this.engine._componentsManager.removeOnUpdateAnimations(this)},n._playState=function(){var e,t=this._clipPreview;t?(this._animator.play(t,0),null!==(e=this._controllerUpdateFlag)&&void 0!==e&&e.flag&&(this._controllerUpdateFlag.flag=!1)):this._playDefaultState()},n._playDefaultState=function(){var e=this._animatorController,t=this._animator;if(t&&e)for(var n=e.layers,r=0,i=n.length;r<i;++r){var a,o,s,l,u,c,d=null!=(a=null===(o=n[r])||void 0===o||null===(s=o.stateMachine)||void 0===s?void 0:s._defaultState)?a:null===(l=n[r])||void 0===l||null===(u=l.stateMachine)||void 0===u?void 0:u.states[0],f=null==d?void 0:d.name;f&&(t.play(f,r),null!==(c=this._controllerUpdateFlag)&&void 0!==c&&c.flag&&(this._controllerUpdateFlag.flag=!1))}},Io(t,[{key:"asset",get:function(){return this._asset},set:function(e){var t=this._animatorController,n=this._speed,r=this._glTFEntity;if(!e||e.defaultSceneRoot!==this._glTFEntity){if(!this._hasBuiltNode&&(r.clearChildren(),null!==e)){null==r||r.destroy();var i=e.defaultSceneRoot.clone();this._animator=i.getComponent(va),this.entity.addChild(i),i.isActive=this.enabled,this._glTFEntity=i}t&&(this._animator.animatorController=t,this._animator.speed=n,this._playState()),this._asset=e}}},{key:"animatorController",get:function(){return this._animatorController},set:function(e){var t=this._animator;e!==this._animatorController&&(this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e,t&&(t.animatorController=e,this._playState()))}},{key:"speed",get:function(){return this._speed},set:function(e){var t=this._animator;this._speed=e,t&&(t.speed=e,this._playState())}},{key:"animator",get:function(){return this._animator}},{key:"clipPreview",get:function(){return this._clipPreview},set:function(e){this._animator&&(e?this._animator.play(e,0):this._playDefaultState()),this._clipPreview=e}}]),t}(Ve),cs=function(e){function t(t){var n;return(n=e.call(this,t)||this)._props=null,n.setMaterial(new gi(n.engine)),n}Do(t,e);var n=t.prototype;return n.setProps=function(e){switch(void 0===e&&(e={}),this._props!==e&&(this._props=e),e.geometryType){case"Sphere":this.mesh=Xn.createSphere(this._engine,e.sphereRadius,e.sphereSegments);break;case"Cylinder":this.mesh=Xn.createCylinder(this._engine,e.cylinderRadiusTop,e.cylinderRadiusBottom,e.cylinderHeight,e.cylinderRadialSegments,e.cylinderHeightSegments);break;case"Plane":this.mesh=Xn.createPlane(this._engine,e.planeWidth,e.planeHeight,e.planeHorizontalSegments,e.planeVerticalSegments);break;case"Box":this.mesh=Xn.createCuboid(this._engine,e.boxWidth,e.boxHeight,e.boxDepth)}},n.updateProp=function(e,t){var n=this._props;n[e]=t,this.setProps(n)},Io(t,[{key:"material",get:function(){return this.getMaterial()},set:function(e){this.setMaterial(e)}}]),t}(Wn),ds=function(){function e(){this.registeredPlugins=new Set,this.plugins=[]}var t=e.prototype;return t.register=function(e){this.registeredPlugins.add(e)},t.boot=function(e){for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Go(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Go(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.registeredPlugins.values());!(t=n()).done;){var r=t.value;"function"==typeof r&&(r=r(e)),this.plugins.push(r)}},t.reset=function(){this.registeredPlugins.clear(),this.plugins=[]},t.nodeAdded=function(e){this.delegateMethod("nodeAdded",e)},t.delegateMethod=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.plugins.forEach((function(t){return t[e]&&t[e].apply(t,n)}))},e}();function fs(e){return function(t,n,r){var i=r.value;r.value=function(){for(var t,n=this,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e.before&&(t=this.oasis.pluginManager).delegateMethod.apply(t,[e.before].concat(a)),Promise.resolve(i.apply(this,arguments)).then((function(t){return e.after&&n.oasis.pluginManager.delegateMethod(e.after,t),t}))}}}function hs(e){for(var t=Object.keys(e),n=0,r=t.length;n<r;++n){var a=t[n],o=e[a];Array.isArray(o)&&"object"!=typeof o[0]&&(-1!==["color","diffuseColor","specularColor"].indexOf(a)?e[a]=new m(o[0],o[1],o[2],o[3]):4===o.length?e[a]=new _(o[0],o[1],o[2],o[3]):3===o.length?e[a]=new i(o[0],o[1],o[2]):2===o.length&&(e[a]=new p(o[0],o[1])))}}var ps=new y;function _s(e){for(var t=Object.keys(e),n=0,r=t.length;n<r;++n){var a=t[n],o=e[a];Array.isArray(o)&&"object"!=typeof o[0]?/color/i.test(a)?e[a]=new m(o[0],o[1],o[2],o[3]):4===o.length?e[a]=new _(o[0],o[1],o[2],o[3]):3===o.length?e[a]=new i(o[0],o[1],o[2]):2===o.length&&(e[a]=new p(o[0],o[1])):o&&"diffuseSphericalHarmonics"===a&&(ps.setValueByArray(JSON.parse(o)),e[a]=ps)}}function vs(e){if(void 0===e&&(e={}),e)for(var t=Object.keys(e),n=0,r=t.length;n<r;n++){var a=t[n],o=e[a];"newMaterial"!==a&&"scripts"!==a&&Array.isArray(o)&&"object"!=typeof o[0]&&(-1!==["emissiveColor","diffuseColor","specularColor","baseColor"].indexOf(a)?e[a]=new m(o[0],o[1],o[2],o[3]):4===o.length?e[a]=new _(o[0],o[1],o[2],o[3]):3===o.length?e[a]=new i(o[0],o[1],o[2]):2===o.length&&(e[a]=new p(o[0],o[1])))}}var ms=function(){var e=t.prototype;function t(){this.pluginManager=new ds}return e.parse=function(e){var t,n;return 3!==(null==e||null===(t=e.config)||void 0===t?void 0:t.version)&&console.warn('schema-parser: schema version "'+(null==e||null===(n=e.config)||void 0===n?void 0:n.version)+'" is out of date, please re-pull the latest version (version 3) of the schema'),function(e){for(var t=e.abilities,n=void 0===t?{}:t,r=e.assets,i=void 0===r?{}:r,a=e.scene,o=void 0===a?{}:a,s=Object.keys(n),l=Object.keys(i),u=Object.keys(o||{}),c=0,d=s.length;c<d;++c)hs(n[s[c]].props);for(var f=0,h=l.length;f<h;++f)vs(i[l[f]].props);for(var p=0,_=u.length;p<_;++p)_s(o[u[p]].props)}(e.config),dl.create(e,this.pluginManager)},e.register=function(e){this.pluginManager.register(e)},e.resetPlugins=function(){this.pluginManager.reset()},t.create=function(){return new t},t.registerComponents=function(e,t){this._components[e]||(this._components[e]={}),zo(this._components[e],t)},t}();ms._components={};var gs=ms.create();function ys(e,t,n){if(t!==n&&null!=n){var r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}}function xs(e){return e&&"asset"===e.type}function bs(e){for(var t=[],n=Object.getPrototypeOf(e),r=Object.getOwnPropertyDescriptors(n),i=0,a=Object.entries(r);i<a.length;i++){var o=a[i],s=o[0];"function"==typeof o[1].get&&t.push(s)}return t}var ws,Ts=function(){var e=t.prototype;function t(e,t){this.resourceManager=e,this._resource=t,this._meta={},this._attachedResources=[],this.setMeta()}return e.setMeta=function(){},e.loadWithAttachedResources=function(e,t,n){var r=this;return new Promise((function(i,a){r.load(e,t,n).then((function(){i({resources:[r],structure:{index:0,props:{}}})})).catch((function(e){a(e)}))}))},e.getProps=function(){return{}},e.bind=function(){},e.attach=function(){},e.update=function(e,t){if(xs(t)){var n=this.resourceManager.get(t.id);n?this._resource[e]=n.resource:ce.warn("SchemaResource: "+this.meta.name+" can't find asset, which id is: "+t.id)}else this._resource[e]=t},e.updateMeta=function(e,t){this._meta[e]=t},e.onDestroy=function(){},Io(t,[{key:"resource",get:function(){return this._resource}},{key:"meta",get:function(){return this._meta}},{key:"attachedResources",get:function(){return this._attachedResources}}]),t}(),Ss=function(e){function t(){return e.apply(this,arguments)||this}Do(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(e){n._resource=t.props||{},n.setMeta(),e(n)}))},n.loadWithAttachedResources=function(e,t){var n=this;return new Promise((function(r,i){var a;t.props?a=n.load(e,t):i("Load AnimationClip Error"),a&&a.then((function(){r({resources:[n],structure:{index:0,props:{}}})}))}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},n.getProps=function(){return this._resource},t}(Ts),Cs=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).gltf=void 0,t.animatorControllerData=void 0,t.animationClipAssets=void 0,t.animationsIndices=void 0,t}Do(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(e){var r=t.props||{},i=r.animatorController,a=r.animationClips,o=r.animationsIndices,s=r.gltf;n._resource=new ma,n.animatorControllerData=i,n.animationsIndices=o||[],n.animationClipAssets=a||[],n.gltf=s,!i&&n._setDefaultDataByAnimationClip(),n.setMetaData("name",t.name),e(n)}))},n.loadWithAttachedResources=function(e,t){var n=this;return new Promise((function(r,i){var a=[];n.load(e,t).then((function(){for(var t={resources:[n],structure:{index:0,props:{animationClips:[]}}},i=n.animationsIndices,o=0,s=i.length;o<s;++o){var l=i[o],u=new Ss(n.resourceManager);n.attachedResources.push(u),a.push(u.loadWithAttachedResources(e,{type:"animationClip",name:l.name,props:l}))}Promise.all(a).then((function(e){var n=t.structure.props.animationClips;e.forEach((function(e){var r=e.structure,i=e.resources[r.index];t.resources.push(i),r.index=t.resources.length-1,n.push(r)})),r(t)}))}))}))},n.setMetaData=function(e,t){this._meta[e]=t},n.update=function(e,t){this._initAnimatorController(t)},n.bind=function(){var e=this.animatorControllerData,t=this.animationClipAssets;this._bindClips(t),e?this._initAnimatorController(e):this._setDefaultDataByAnimationClipAsset()},n._initAnimatorController=function(e){var t=(this.gltf||{}).animations,n=e.layers;if(t&&n){this._resource.clearLayers();for(var r=0,i=n.length;r<i;++r){var a=n[r],o=a.name,s=a.blending,l=a.weight,u=a.stateMachine;if(u){var c=new ga(o);c.blendingMode=s,c.weight=l;for(var d=u.states,f=new xa,h=[],p=0,_=d.length;p<_;++p){var v=d[p],m=v.name,g=v.transitions,y=v.clip,x=v.speed,b=v.wrapMode,w=v.clipStartNormalizedTime,T=v.clipEndNormalizedTime,S=v.isDefaultState,C=(y||{}).id;if(C){var P=f.makeUniqueStateName(m);P!==m&&console.warn("AnimatorState name is existed, name: "+m+" reset to "+P);var M=f.addState(P);M.speed=x,M.wrapMode=b;var A=t[this.resourceManager.get(C).resource.index];if(A){M.clip=A,M.clipStartTime=A.length*w,M.clipEndTime=A.length*T;for(var E=0,R=g.length;E<R;++E){var F=g[E];g[E].srcState=M,h.push(F)}S&&(f._defaultState=M)}}}for(var L=0,B=h.length;L<B;++L){var I=h[L],O=new Zi;O.duration=I.duration,O.offset=I.offset,O.exitTime=I.exitTime,O.destinationState=f.findStateByName(I.targetStateName),I.srcState.addTransition(O),delete I.srcState}c.stateMachine=f,this._resource.addLayer(c)}}}},n._bindClips=function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t],i=this.resourceManager.get(r.id);i?this._attachedResources.push(i):(this.meta.name,r.id)}},n._setDefaultDataByAnimationClipAsset=function(){var e=this.animationClipAssets;if(e.length){for(var t=[],n=0,r=e.length;n<r;n++){var i=this.resourceManager.get(e[n].id);t.push(i.resource)}this.animationsIndices=t,this._setDefaultDataByAnimationClip()}},n._setDefaultDataByAnimationClip=function(){var e=this.animationsIndices,t=this._resource,n=this.gltf;if(e.length&&n){var r=n.animations,i=new ga("layer"),a=new xa;t.addLayer(i),i.stateMachine=a;for(var o=0,s=e.length;o<s;o++){var l=e[o],u=l.name,c=l.index,d=a.makeUniqueStateName(u);d!==u&&console.warn("AnimatorState name is existed, name: "+u+" reset to "+d),a.addState(d).clip=r[c]}}},t}(Ts),Ps=function(t){function n(){return t.apply(this,arguments)||this}Do(n,t);var r=n.prototype;return r.load=function(t,n,r){var i=this;return new Promise((function(a,o){var s,l,u,c,d=e.AssetType.Texture2D;if(i.resourceManager.useCompressedTexture&&null!=n&&null!==(s=n.props)&&void 0!==s&&null!==(l=s.compression)&&void 0!==l&&l.compressions.length)for(var f=r.engine._hardwareRenderer,h=n.props.compression.compressions,p=0;p<h.length;p++){var _=h[p];if("ktx"===_.container&&f.canIUse(e.GLCapabilityType[_.type])){c=_.url,d=e.AssetType.KTX;break}}c=null!=(u=c)?u:n.url,t.load({url:c,type:d}).then((function(e){i._resource=e,a(i)})).catch((function(e){o(e)}))}))},r.setMeta=function(){this.resource&&(this._meta.name=this.resource.name)},n}(Ts),Ms=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).configProps=void 0,t}Do(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(r){var i=new gi(e.engine);for(var a in n.configProps=t.props,n._resource=i,n.configProps)xs(n.configProps[a])||(i[a]=n.configProps[a]);n.setMeta(),r(n)}))},n.loadWithAttachedResources=function(e,t){var n=this;return new Promise((function(r,i){var a;t.resource instanceof gi?a=new Promise((function(e){n._resource=t.resource,n.setMeta(),e(n)})):t.props?a=n.load(e,t):i("Load BlinnPhongMaterial Error"),a&&a.then((function(){var e={resources:[n],structure:{index:0,props:{}}},t=n._resource;bs(n._resource).forEach((function(r){if(t[r]instanceof Ye){var i=new Ps(n.resourceManager,t[r]);n.attachedResources.push(i),e.resources.push(i),e.structure.props[r]={index:e.resources.length-1}}})),r(e)}))}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},n.bind=function(){var e=this,t=this._resource;Object.keys(this.configProps).forEach((function(n){var r=e.configProps[n];if(xs(r)){var i=e.resourceManager.get(r.id);i&&i instanceof Ps?(t[n]=i.resource,e._attachedResources.push(i)):(t[n]=null,ce.warn("BlinnPhongMaterialResource: "+e.meta.name+" can't find asset \""+n+'", which id is: '+r.id))}else t[n]=r}))},t}(Ts),As=["metallic","roughness","roughnessMetallicTexture","tilingOffset","baseColor","normalTextureIntensity","emissiveColor","occlusionTextureIntensity","baseTexture","normalTexture","emissiveTexture","occlusionTexture","isTransparent","alphaCutoff","renderFace","blendMode"],Es=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).configProps=void 0,t}Do(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(r){var i=new xi(e.engine);for(var a in n.configProps=t.props,n.configProps)xs(n.configProps[a])||(i[a]=n.configProps[a]);n._resource=i,n.setMeta(),r(n)}))},n.loadWithAttachedResources=function(e,t){var n=this;return new Promise((function(r,i){var a;t.resource instanceof xi?a=new Promise((function(e){n._resource=t.resource,n.setMeta(),e(n)})):t.props?a=n.load(e,t):i("Load PBRMaterial Error"),a&&a.then((function(){var e={resources:[n],structure:{index:0,props:{}}},t=n._resource;As.forEach((function(r){if(t[r]instanceof Ye){var i=new Ps(n.resourceManager,t[r]);n.attachedResources.push(i),e.resources.push(i),e.structure.props[r]={index:e.resources.length-1}}})),r(e)}))}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},n.getProps=function(){var e=this,t={};return As.forEach((function(n){return t[n]=e.resource[n]})),t},n.bind=function(){var e=this,t=this._resource;Object.keys(this.configProps).forEach((function(n){var r=e.configProps[n];if(xs(r)){var i=e.resourceManager.get(r.id);i&&i instanceof Ps?(t[n]=i.resource,e._attachedResources.push(i)):(t[n]=null,ce.warn("PBRMaterialResource: "+e.meta.name+" can't find asset \""+n+'", which id is: '+r.id))}else t[n]=r}))},t}(Ts),Rs=["specularColor","glossiness","specularGlossinessTexture","tilingOffset","baseColor","normalTextureIntensity","emissiveColor","occlusionTextureIntensity","baseTexture","normalTexture","emissiveTexture","occlusionTexture","isTransparent","alphaCutoff","renderFace","blendMode"],Fs=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).configProps=void 0,t}Do(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(r){var i=new bi(e.engine);for(var a in n.configProps=t.props,n._resource=i,n.configProps)xs(n.configProps[a])||(i[a]=n.configProps[a]);n.setMeta(),r(n)}))},n.loadWithAttachedResources=function(e,t){var n=this;return new Promise((function(r,i){var a;t.resource instanceof bi?a=new Promise((function(e){n._resource=t.resource,n.setMeta(),e(n)})):t.props?a=n.load(e,t):i("Load PBRSpecularMaterial Error"),a&&a.then((function(){var e={resources:[n],structure:{index:0,props:{}}},t=n._resource;Object.keys(n._resource).forEach((function(r){if(t[r]instanceof Ye){var i=new Ps(n.resourceManager,t[r]);n.attachedResources.push(i),e.resources.push(i),e.structure.props[r]={index:e.resources.length-1}}})),r(e)}))}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},n.getProps=function(){var e=this,t={};return Rs.forEach((function(n){return t[n]=e.resource[n]})),t},n.bind=function(){var e=this,t=this._resource;Object.keys(this.configProps).forEach((function(n){var r=e.configProps[n];if(xs(r)){var i=e.resourceManager.get(r.id);i&&i instanceof Ps?(t[n]=i.resource,e._attachedResources.push(i)):(t[n]=null,ce.warn("PBRSpecularMaterialResource: "+e.meta.name+" can't find asset \""+n+'", which id is: '+r.id))}else t[n]=r}))},t}(Ts),Ls=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).configProps=void 0,t}Do(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(r){var i=new wi(e.engine);for(var a in n.configProps=t.props,n.configProps)xs(n.configProps[a])||(i[a]=n.configProps[a]);n._resource=i,n.setMeta(),r(n)}))},n.loadWithAttachedResources=function(e,t){var n=this;return new Promise((function(r,i){var a;t.resource instanceof wi?a=new Promise((function(e){n._resource=t.resource,n.setMeta(),e(n)})):t.props?a=n.load(e,t):i("Load PBRMaterial Error"),a&&a.then((function(){var e={resources:[n],structure:{index:0,props:{}}},t=n._resource;bs(n._resource).forEach((function(r){if(t[r]instanceof Ye){var i=new Ps(n.resourceManager,t[r]);n.attachedResources.push(i),e.resources.push(i),e.structure.props[r]={index:e.resources.length-1}}})),r(e)}))}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},n.getProps=function(){var e=this,t={};return bs(this.resource).forEach((function(n){return t[n]=e.resource[n]})),t},n.bind=function(){var e=this,t=this._resource;Object.keys(this.configProps).forEach((function(n){var r=e.configProps[n];if(xs(r)){var i=e.resourceManager.get(r.id);i&&i instanceof Ps?(t[n]=i.resource,e._attachedResources.push(i)):(t[n]=null,ce.warn("PBRMaterialResource: "+e.meta.name+" can't find asset \""+n+'", which id is: '+r.id))}else t[n]=r}))},t}(Ts),Bs=function(t){function n(){return t.apply(this,arguments)||this}Do(n,t);var r=n.prototype;return r.load=function(t,n,r){var i=this;return t.load({url:n.url,type:e.AssetType.Prefab}).then((function(e){var t=e;n.props&&(t.newMaterial=n.props.newMaterial,t.animatorControllers=n.props.animatorControllers),i._resource=t}))},r.loadWithAttachedResources=function(e,t,n){var r=this;return new Promise((function(i){r.load(e,t,n).then((function(){var t,n=r.resource,a=n.materials,o=void 0===a?[]:a,s=n._animationsIndices,l=void 0===s?[]:s,u=[],c={resources:[r],structure:{index:0,props:{newMaterial:[],animatorControllers:[]}}};if(null!=o&&o.length)for(var d=0;d<o.length;d++){var f=o[d],h=null,p="";f instanceof xi?(h=new Es(r.resourceManager),p="PBRMaterial"):f instanceof wi?(h=new Ls(r.resourceManager),p="UnlitMaterial"):f instanceof bi?(h=new Fs(r.resourceManager),p="PBRSpecularMaterial"):(h=new Ms(r.resourceManager),p="BlinnPhongMaterial"),r._attachedResources.push(h),u.push(h.loadWithAttachedResources(e,{type:p,name:f.name,resource:f}))}if(l.length){var _=new Cs(r.resourceManager);r._attachedResources.push(_),t=_.loadWithAttachedResources(e,{type:"animatorController",name:"AnimatorController",props:{animationsIndices:l,gltf:r._resource}})}var v=Promise.all(u).then((function(e){var t=c.structure.props.newMaterial;e.forEach((function(e){var n=e.structure,r=e.resources[n.index];for(var i in c.resources.push(r),n.index=c.resources.length-1,n.props)if(n.props.hasOwnProperty(i)){var a=n.props[i],o=e.resources[a.index];c.resources.push(o),a.index=c.resources.length-1}t.push(n)}))})),m=t?t.then((function(e){var t=c.structure.props.animatorControllers,n=e.structure,r=e.resources[n.index];c.resources.push(r),n.index=c.resources.length-1;var i=n.props.animationClips;if(i)for(var a=0,o=i.length;a<o;++a){var s=i[a],l=e.resources[s.index];c.resources.push(l),s.index=c.resources.length-1}t.push(n)})):Promise.resolve();Promise.all([v,m]).then((function(){i(c)}))}))}))},r.setMeta=function(e){e&&(this.meta.name=e.name)},r.bind=function(){var e=this._resource;this.bindMaterials(e.newMaterial),this.bindAnimatorControllers(e.animatorControllers)},r.update=function(e,t){"newMaterial"===e?this.bindMaterials(t):this._resource[e]=t},r.bindMaterials=function(e){var t=e.length;if(e&&e.length){var n=this._resource,r=new Array(t);n.newMaterial=r;for(var i=0;i<e.length;i++){var a=this.resourceManager.get(e[i].id);a?(this._attachedResources.push(a),r[i]=a.resource):ce.warn("GLTFResource: "+this.meta.name+' can\'t find asset "material", which id is: '+e[i].id)}for(var o=n.defaultSceneRoot,s=n.materials,l=o.getComponentsIncludeChildren(Wn,[]),u=0;u<t;u++)for(var c=r[u],d=s[u],f=0;f<l.length;f++)for(var h=l[f],p=h.getMaterials(),_=0;_<p.length;_++)d===p[_]&&h.setMaterial(_,c)}},r.bindAnimatorControllers=function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t],i=this.resourceManager.get(r.id);i.gltf=this._resource,i?this._attachedResources.push(i):(this.meta.name,r.id)}},n}(Ts),Is={},Os=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).isInit=!1,t}Do(t,e);var n=t.prototype;return n.initScriptContext=function(){this.isInit||(this.isInit=!0,window.__o3_script_context__={o3:ms._components.o3,script:function(e){return function(t){Is[e]=t}}})},n.load=function(e,t,n){var r=this;return this.initScriptContext(),new Promise((function(e){var i=t.props.scripts;if(r.resourceManager.isLocal){for(var a=0;a<i.length;a++){var o,s=i[a].name;Is[s]=null===(o=n.options)||void 0===o?void 0:o.scripts[s]}e(r)}else{var l=document.createElement("script");l.crossOrigin="anonymous",r.setMeta(t),l.onload=function(){for(var t=window.o3Scripts,n=0;n<i.length;n++){var a=i[n].name;r._resource=t&&t[a],Is[a]=r._resource}e(r)},l.src=t.url,document.body.appendChild(l)}}))},n.setMeta=function(e){e&&(this._meta.name=e.name,this._meta.url=e.url,this._meta.source=e.source)},t}(Ts),zs=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).configProps=void 0,e}Do(n,t);var r=n.prototype;return r.load=function(t,n){var r=this;return new Promise((function(i){var a=new Vi(t.engine);r.configProps=n.props;var o=r.configProps,s=o.pivotType,l=o.pivot;if(void 0!==l&&void 0!==s&&s!==e.SpritePivotType.Custom)switch(s){case e.SpritePivotType.Center:l.x=.5,l.y=.5;break;case e.SpritePivotType.TopLeft:l.x=0,l.y=1;break;case e.SpritePivotType.Top:l.x=.5,l.y=1;break;case e.SpritePivotType.TopRight:l.x=1,l.y=1;break;case e.SpritePivotType.Left:l.x=0,l.y=.5;break;case e.SpritePivotType.Right:l.x=1,l.y=.5;break;case e.SpritePivotType.BottomLeft:l.x=0,l.y=0;break;case e.SpritePivotType.Bottom:l.x=.5,l.y=0;break;case e.SpritePivotType.BottomRight:l.x=1,l.y=0}for(var u in o)xs(o[u])||void 0===o[u]||(a[u]=o[u]);r._resource=a,r.setMeta(),i(r)}))},r.loadWithAttachedResources=function(e,t){var r=this;return new Promise((function(i,a){var o;t.resource instanceof n?o=new Promise((function(e){r._resource=t.resource,r.setMeta(),e(r)})):t.props?o=r.load(e,t):a("Load Sprite Error"),o&&o.then((function(){var e={resources:[r],structure:{index:0,props:{}}},t=r._resource;bs(r._resource).forEach((function(n){if(t[n]instanceof Ye){var i=new Ps(r.resourceManager,t[n]);r.attachedResources.push(i),e.resources.push(i),e.structure.props[n]={index:e.resources.length-1}}})),i(e)}))}))},r.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},r.getProps=function(){var e=this,t={};return bs(this.resource).forEach((function(n){return t[n]=e.resource[n]})),t},r.bind=function(){var e=this,t=this._resource;this.configProps&&Object.keys(this.configProps).forEach((function(n){var r=e.configProps[n];if(xs(r)){var i=e.resourceManager.get(r.id);i&&i instanceof Ps?(t[n]=i.resource,e._attachedResources.push(i)):(t[n]=null,ce.warn("SpriteResource: "+e.meta.name+" can't find asset \""+n+'", which id is: '+r.id))}else t[n]=r}))},n}(Ts);e.SpritePivotType=void 0,(ws=e.SpritePivotType||(e.SpritePivotType={}))[ws.Center=0]="Center",ws[ws.TopLeft=1]="TopLeft",ws[ws.Top=2]="Top",ws[ws.TopRight=3]="TopRight",ws[ws.Left=4]="Left",ws[ws.Right=5]="Right",ws[ws.BottomLeft=6]="BottomLeft",ws[ws.Bottom=7]="Bottom",ws[ws.BottomRight=8]="BottomRight",ws[ws.Custom=9]="Custom";var Ds,ks,Ns,Us,Vs,Gs,Hs,Ws,js,Xs,Ks,qs,Qs,Ys={px:0,nx:1,py:2,ny:3,pz:4,nz:5},$s=function(t){function n(){return t.apply(this,arguments)||this}Do(n,t);var r=n.prototype;return r.load=function(t,n,r){var i=this;return new Promise((function(a,o){var s,l,u=[],c=e.AssetType.TextureCube;if(i.resourceManager.useCompressedTexture&&null!=n&&null!==(s=n.props)&&void 0!==s&&null!==(l=s.compression)&&void 0!==l&&l.compressions.length)for(var d=r.engine._hardwareRenderer,f=n.props.compression.compressions,h=0;h<f.length;h++){var p=f[h];if("ktx"===p.container&&d.canIUse(e.GLCapabilityType[p.type])){for(var _ in p.files)if(p.files.hasOwnProperty(_)){var v=p.files[_];u[Ys[_]]=v.url}console.warn(p.type),c=e.AssetType.KTXCube;break}}if(c===e.AssetType.TextureCube)for(var m in n.props.images)if(n.props.images.hasOwnProperty(m)){var g=n.props.images[m];u[Ys[m]]=g.url}t.load({urls:u,type:c}).then((function(e){i._resource=e,a(i)})).catch((function(e){o(e)}))}))},r.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},n}(Ts),Js=function(e){function t(){return e.apply(this,arguments)||this}Do(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(e){n._resource=t,n.setMetaData("name",n.resource.name),n.setMetaData("url",n.resource.url),e(n)}))},n.setMetaData=function(e,t){this._meta[e]=t},t}(Ts),Zs=(Ds=fs({after:"abilityAdded",before:"beforeAbilityAdded"}),ks=fs({before:"beforeAbilityUpdated",after:"abilityUpdated"}),Ns=fs({after:"abilityDeleted",before:"beforeAbilityDeleted"}),Ho((Us=function(){function e(e){this.oasis=e,this.abilityMap={}}var t=e.prototype;return t.add=function(e){var t=e.type,n=e.node,r=e.props,i=e.id,a=e.index,o=this.oasis.nodeManager.get(n),s=this.getCompConstructor(t);if(s){var l=this.mixPropsToExplicitProps(r),u=o.addComponent(s),c=l.enabled;if(void 0!==c&&(u.enabled=c),"GLTFModel"===t)u.init(l);else if("Model"===t)u.setProps(l),l.material&&(u.material=l.material);else for(var d in l)null!==l[d]&&(u[d]=l[d]);var f=o._components;return ys(f,f.length-1,a),u.id=i,this.abilityMap[i]=u,u}ce.error(t+" abiltiy is not defined")},t.update=function(e,t,n){return n&&this.checkIsAsset(n)?this.get(e)[t]=this.oasis.resourceManager.get(n.id).resource:this.get(e).constructor===cs?this.get(e).updateProp(t,n):this.get(e)[t]=n,{id:e,key:t,value:n}},t.addRuntimeComponent=function(e,t){return t.id=e,this.abilityMap[e]=t,t},t.get=function(e){return this.abilityMap[e]},t.delete=function(e){return this.abilityMap[e].destroy(),delete this.abilityMap[e],e},t.getCompConstructor=function(e){var t=e.split(".");if("script"===t[0])return Is[t[1]];var n=ms._components.o3[e];return n||console.warn(e+" is not defined"),n},t.mixPropsToExplicitProps=function(e){var t=Lo({},e);for(var n in e){var r=e[n];if(r&&this.checkIsAsset(r)){var i=this.oasis.resourceManager.get(r.id);i?t[n]=i.resource:(t[n]=null,ce.warn("AbilityManager: can't get asset \""+n+'", which id is '+r.id))}}return t},t.checkIsAsset=function(e){return"asset"===e.type},e}()).prototype,"add",[Ds],Object.getOwnPropertyDescriptor(Us.prototype,"add"),Us.prototype),Ho(Us.prototype,"update",[ks],Object.getOwnPropertyDescriptor(Us.prototype,"update"),Us.prototype),Ho(Us.prototype,"delete",[Ns],Object.getOwnPropertyDescriptor(Us.prototype,"delete"),Us.prototype),Us),el=(Vs=fs({after:"nodeAdded"}),Gs=fs({before:"beforeNodeUpdated",after:"nodeUpdated"}),Hs=fs({before:"beforeNodeDeleted"}),Ho((Ws=function(){function e(e){this.oasis=e,this.nodeMap={},this.root=void 0,this.root=new Xe(this.oasis.engine,"root")}var t=e.prototype;return t.addRootEntity=function(){this.oasis.engine.sceneManager.activeScene.addRootEntity(this.root)},t.add=function(e){return this.create(e),this.append(e.id,e.parent,e.index),this.get(e.id)},t.update=function(e,t,n){return this.get(e)[t]=n,{id:e,key:t,value:n}},t.get=function(e){return this.nodeMap[e]},t.reset=function(){this.nodeMap={}},t.delete=function(e){this.nodeMap[e].destroy(),delete this.nodeMap[e]},t.create=function(e){var t=e.isActive,n=e.position,r=e.rotation,a=e.scale,o=e.id,s=e.name,l=new Xe(this.oasis.engine,s);return l.isActive=t,l.transform.position=new i(n[0],n[1],n[2]),l.transform.rotation=new i(r[0],r[1],r[2]),l.transform.scale=new i(a[0],a[1],a[2]),l.id=o,this.nodeMap[o]=l,l},t.append=function(e,t,n){var r=this.nodeMap[e],i=this.nodeMap[t]||this.root;i.addChild(r);var a=i._children;ys(a,a.length-1,n)},e}()).prototype,"add",[Vs],Object.getOwnPropertyDescriptor(Ws.prototype,"add"),Ws.prototype),Ho(Ws.prototype,"update",[Gs],Object.getOwnPropertyDescriptor(Ws.prototype,"update"),Ws.prototype),Ho(Ws.prototype,"delete",[Hs],Object.getOwnPropertyDescriptor(Ws.prototype,"delete"),Ws.prototype),Ws),tl=(js=fs({before:"beforeSceneUpdated",after:"sceneUpdated"}),Ho((Xs=function(){function e(e){this.oasis=e}var t=e.prototype;return t.init=function(){var e=this,t=this.oasis.options.config.scene;t&&Object.keys(t).forEach((function(n){var r=t[n];Object.keys(r.props).forEach((function(t){var i=r.props[t];e.setProp(n,t,i)}))}))},t.update=function(e,t,n){return this.setProp(e,t,n),{field:e,key:t,value:n}},t.setProp=function(e,t,n){var r=this.oasis.engine.sceneManager.activeScene;if("background"===e&&"skyboxTexture"===t){var i=r.background.sky;if(n){i.mesh=Xn.createCuboid(r.engine,2,2,2);var a=new Ma(r.engine);a.textureCubeMap=this.oasis.resourceManager.get(n.id).resource,i.material=a}else i.mesh=null,i.material=null}else r[e]&&(n&&"asset"===n.type?r[e][t]=this.oasis.resourceManager.get(n.id).resource:r[e][t]=n)},e}()).prototype,"update",[js],Object.getOwnPropertyDescriptor(Xs.prototype,"update"),Xs.prototype),Xs),nl=function(t){function n(){return t.apply(this,arguments)||this}Do(n,t);var r=n.prototype;return r.load=function(t,r){var i=this;return new Promise((function(a){i.setMeta(),r.source?t.load({url:r.source,type:e.AssetType.SpriteAtlas}).then((function(e){i._resource=e;for(var t=e.sprites,n=i.resourceManager,r=t.length-1;r>=0;r--){var o=t[r],s=new zs(n,o),l=o._assetID;n.maxId=Math.max(l,n.maxId),n.resourceMap[l]=s,n.resourceIdMap.set(s,""+l)}a(i)})):(n.defaultAtlas||(n.defaultAtlas=new Ui(t.engine)),i._resource=n.defaultAtlas,a(i))}))},r.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},r.getProps=function(){var e=this,t={};return bs(this.resource).forEach((function(n){return t[n]=e.resource[n]})),t},r.update=function(){},n}(Ts);nl.defaultAtlas=void 0;var rl={script:Os,gltf:Bs,texture:Ps,cubeTexture:$s,PBRMaterial:Es,PBRSpecularMaterial:Fs,UnlitMaterial:Ls,BlinnPhongMaterial:Ms,base:Js,sprite:zs,SpriteAtlas:nl,animatorController:Cs,animationClip:Ss},il=new Map;for(var al in rl)if(rl.hasOwnProperty(al)){var ol=rl[al];il.set(ol,al)}var sl,ll,ul=function(e,t){return new rl[t](e)},cl=(Ks=fs({before:"beforeResourceRemove"}),qs=fs({after:"resourceUpdated",before:"beforeResourceUpdate"}),Ho((Qs=function(){function e(e){this.oasis=e,this.resourceMap={},this.resourceIdMap=new WeakMap,this.maxId=0,this.engineResourceManager=void 0,this.engineResourceManager=this.oasis.engine.resourceManager}var t=e.prototype;return t.load=function(e){var t=this,n=ul(this,e.type),r=n.load(this.oasis.engine.resourceManager,e,this.oasis);return this.maxId=Math.max(+e.id,this.maxId),r.then((function(){t.resourceMap[e.id]=n,t.resourceIdMap.set(n,e.id)})),r},t.add=function(e){var t=this,n=ul(this,e.type);return new Promise((function(r){n.loadWithAttachedResources(t.oasis.engine.resourceManager,e,t.oasis).then((function(e){r(t.getAddResourceResult(e.resources,e.structure))}))}))},t.remove=function(e){var t=this;return new Promise((function(n){var r=t.resourceMap[e],i=[e],a=!1;if(delete t.resourceMap[e],r)for(var o=r.attachedResources,s=0;s<o.length;s++){var l=o[s],u=t.resourceIdMap.get(l);u&&(a=!0,t.remove(u).then((function(e){i.push.apply(i,e),n(i)})))}a||n(i)}))},t.update=function(e,t,n){var r=this.get(e);return r&&r.update(t,n),{resource:r,id:e,key:t,value:n}},t.updateMeta=function(e,t,n){var r=this.get(e);r&&r.updateMeta(t,n)},t.get=function(e){return this.resourceMap[e]},t.getAll=function(){return k(this.resourceMap)},t.getAddResourceResult=function(e,t){var n=this,r={},i=e[t.index],a=""+ ++this.maxId;for(var o in this.resourceMap[a]=i,this.resourceIdMap.set(i,a),r.id=this.maxId,r.type=il.get(i.constructor),r.meta=i.meta,r.props={},t.props)if(t.props.hasOwnProperty(o)){var s=t.props[o];s&&(Array.isArray(s)?r.props[o]=s.map((function(t){return n.getAddResourceResult(e,t)})):r.props[o]=this.getAddResourceResult(e,s))}return r},Io(e,[{key:"isLocal",get:function(){return this.oasis.options.local}},{key:"useCompressedTexture",get:function(){var e;return null==(e=this.oasis.options.useCompressedTexture)||e}}]),e}()).prototype,"remove",[Ks],Object.getOwnPropertyDescriptor(Qs.prototype,"remove"),Qs.prototype),Ho(Qs.prototype,"update",[qs],Object.getOwnPropertyDescriptor(Qs.prototype,"update"),Qs.prototype),Qs),dl=(sl=fs({after:"schemaParsed"}),Ho((ll=function(e){function t(t,n){var r,i;return(i=e.call(this,t.engine)||this)._options=t,i.pluginManager=n,i.nodeManager=void 0,i.abilityManager=void 0,i.sceneManager=void 0,i.resourceManager=void 0,i._canvas=void 0,i.schema=void 0,i.timeout=void 0,i.oasis=Vo(i),i.schema=t.config,i.timeout=t.timeout,t.scripts=null!=(r=t.scripts)?r:{},i.nodeManager=new el(Vo(i)),i.abilityManager=new Zs(Vo(i)),i.nodeManager.add=i.nodeManager.add.bind(i.nodeManager),i.abilityManager.add=i.abilityManager.add.bind(i.abilityManager),i.resourceManager=new cl(Vo(i)),i.sceneManager=new tl(Vo(i)),t.fps&&(i.engine.targetFrameRate=t.fps,i.engine.vSyncCount=0),i}Do(t,e);var n=t.prototype;return n.updateConfig=function(e){this.schema=e,this.init()},n.init=function(){var e=this;return this.loadResources().then((function(){e.bindResources(),e.parseEntities(),e.attach(),e.nodeManager.addRootEntity(),e.sceneManager.init(),e.parseNodeAbilities(),e.pluginManager.boot(e)}))},n.loadResources=function(){var e=this,t=this.schema.assets,n=k(void 0===t?{}:t).filter((function(e){return!!rl[e.type]||(console.warn(e.type+" loader is not defined. the "+e.type+" type will be ignored."),!1)})).map((function(t){return e.resourceManager.load(t)}));return Promise.all(n)},n.bindResources=function(){this.resourceManager.getAll().forEach((function(e){e.bind()}))},n.parseEntities=function(){var e=this.schema.nodes;this.bfsNodes().map((function(t){return e[t]})).forEach(this.nodeManager.add)},n.parseNodeAbilities=function(){var e=this.schema.abilities;Object.keys(e).map((function(t){return Lo({id:t},e[t])})).forEach(this.abilityManager.add)},n.bfsNodes=function(){var e=this.schema.nodes,t=k(e).filter((function(t){return!e[t.parent]})).map((function(e){return e.id})),n=[];return function t(r){n=n.concat(r),r.forEach((function(n){var r=e[n].children;r&&t(r)}))}(t),n},n.attach=function(){this.resourceManager.getAll().forEach((function(e){e.attach()}))},t.create=function(e,n){var r=new t(e,n);return r.init().then((function(){return e.autoPlay&&r.engine.run(),r}))},Io(t,[{key:"canvas",get:function(){return this._options.canvas}},{key:"options",get:function(){return this._options}}]),t}(ie)).prototype,"init",[sl],Object.getOwnPropertyDescriptor(ll.prototype,"init"),ll.prototype),ll);ms.registerComponents("o3",{GLTFModel:us,SpriteRenderer:Hi,SpriteMask:an,PointLight:lr,AmbientLight:ir,DirectLight:sr,ParticleRenderer:Aa,BoxCollider:br,Camera:si,Model:cs,Component:Ve,SphereCollider:wr,Animator:va});console.log("oasis engine version: 0.5.2"),e.ABoxCollider=gr,e.ACollider=mr,e.ASphereCollider=xr,e.AmbientLight=ir,e.AnimationClip=qi,e.AnimationClipCurveBinding=ji,e.AnimationCurve=wa,e.AnimationEvent=function(){this.time=void 0,this.functionName=void 0,this.parameter=void 0},e.Animator=va,e.AnimatorController=ma,e.AnimatorControllerLayer=ga,e.AnimatorState=ya,e.AnimatorStateMachine=xa,e.AnimatorStateTransition=Zi,e.AssetPromise=z,e.Background=rr,e.BaseMaterial=mi,e.BasicRenderPipeline=ai,e.BlendShape=Qn,e.BlendShapeFrame=qn,e.BlinnPhongMaterial=gi,e.BoundingBox=o,e.BoundingFrustum=u,e.BoundingSphere=a,e.BoxCollider=br,e.Buffer=dn,e.BufferMesh=Kn,e.BufferUtil=ln,e.Camera=si,e.CloneManager=J,e.ColliderFeature=vr,e.CollisionDetection=Ba,e.CollisionUtil=s,e.Color=m,e.Component=Ve,e.CubeProbe=Va,e.DirectLight=sr,e.EXP2Fog=Oa,e.Engine=Or,e.EngineFeature=Dr,e.EngineObject=re,e.Entity=Xe,e.Event=G,e.EventDispatcher=ie,e.Fog=Ia,e.GLTFModel=us,e.GLTFResource=rs,e.HitResult=Tr,e.IndexBufferBinding=pn,e.InterpolableKeyframe=Sa,e.Keyframe=Ta,e.Light=or,e.LinearFog=za,e.Loader=vi,e.Logger=ce,e.Material=kt,e.MathUtil=r,e.Matrix=f,e.Matrix3x3=c,e.Mesh=vn,e.MeshRenderer=Wn,e.Model=cs,e.ModelMesh=Mn,e.Oasis=dl,e.ObjectValues=k,e.PBRBaseMaterial=yi,e.PBRMaterial=xi,e.PBRSpecularMaterial=bi,e.Parser=ms,e.ParticleRenderer=Aa,e.PhysicsManager=Sr,e.Plane=l,e.PlaneCollider=yr,e.PointLight=lr,e.PrimitiveMesh=Xn,e.Probe=Da,e.Quaternion=d,e.Ray=h,e.Rect=g,e.RefObject=Qe,e.RenderColorTexture=Pn,e.RenderDepthTexture=Sn,e.RenderElement=Vt,e.RenderPass=Ur,e.RenderQueue=ii,e.RenderTarget=Cn,e.Renderer=en,e.ResourceManager=N,e.Scene=dr,e.SceneFeature=ar,e.SceneManager=fr,e.SchemaResource=Ts,e.Script=kr,e.Shader=it,e.ShaderData=lt,e.ShaderFactory=Je,e.Skin=Hn,e.SkinnedMeshRenderer=jn,e.Sky=nr,e.SkyBoxMaterial=Ma,e.SphereCollider=wr,e.SphericalHarmonics3=y,e.SpotLight=ur,e.Sprite=Vi,e.SpriteAtlas=Ui,e.SpriteElement=Gt,e.SpriteMask=an,e.SpriteRenderer=Hi,e.SubMesh=_n,e.SystemInfo=zr,e.Texture=Ye,e.Texture2D=bn,e.TextureCubeMap=Tn,e.Time=de,e.TrailMaterial=Ea,e.TrailRenderer=Fa,e.Transform=We,e.UnlitMaterial=wi,e.UpdateFlag=Ge,e.Util=D,e.Vector2=p,e.Vector3=i,e.Vector4=_,e.VertexBufferBinding=mn,e.VertexElement=un,e.WebCanvas=to,e.WebGLEngine=_o,e.WebGLRenderer=po,e.assignmentClone=W,e.deepClone=X,e.dependencies=Te,e.ignoreClone=H,e.parseSingleKTX=as,e.parser=gs,e.registerResource=function(e,t){rl.hasOwnProperty(e)||(rl[e]=t,il.set(t,e))},e.request=ui,e.resourceLoader=U,e.script=function(e){return function(t){Is[e]=t}},e.shallowClone=j,e.version="0.5.2",Object.defineProperty(e,"__esModule",{value:!0})}(t)},461:e=>{"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,a){for(var o,s,l=i(e),u=1;u<arguments.length;u++){for(var c in o=Object(arguments[u]))n.call(o,c)&&(l[c]=o[c]);if(t){s=t(o);for(var d=0;d<s.length;d++)r.call(o,s[d])&&(l[s[d]]=o[s[d]])}}return l}},223:(e,t,n)=>{"use strict";var r=n(191),i=n(461),a=n(630);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));var s=new Set,l={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(l[e]=t,e=0;e<t.length;e++)s.add(t[e])}var d=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h=Object.prototype.hasOwnProperty,p={},_={};function v(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function x(e,t,n,r){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0===i.type:!r&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(_,e)||!h.call(p,e)&&(f.test(e)?_[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=60103,T=60106,S=60107,C=60108,P=60114,M=60109,A=60110,E=60112,R=60113,F=60120,L=60115,B=60116,I=60121,O=60128,z=60129,D=60130,k=60131;if("function"==typeof Symbol&&Symbol.for){var N=Symbol.for;w=N("react.element"),T=N("react.portal"),S=N("react.fragment"),C=N("react.strict_mode"),P=N("react.profiler"),M=N("react.provider"),A=N("react.context"),E=N("react.forward_ref"),R=N("react.suspense"),F=N("react.suspense_list"),L=N("react.memo"),B=N("react.lazy"),I=N("react.block"),N("react.scope"),O=N("react.opaque.id"),z=N("react.debug_trace_mode"),D=N("react.offscreen"),k=N("react.legacy_hidden")}var U,V="function"==typeof Symbol&&Symbol.iterator;function G(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=V&&e[V]||e["@@iterator"])?e:null}function H(e){if(void 0===U)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var W=!1;function j(e,t){if(!e||W)return"";W=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(e){if(e&&r&&"string"==typeof e.stack){for(var i=e.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s])return"\n"+i[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{W=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?H(e):""}function X(e){switch(e.tag){case 5:return H(e.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return j(e.type,!1);case 11:return j(e.type.render,!1);case 22:return j(e.type._render,!1);case 1:return j(e.type,!0);default:return""}}function K(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case S:return"Fragment";case T:return"Portal";case P:return"Profiler";case C:return"StrictMode";case R:return"Suspense";case F:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case M:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case L:return K(e.type);case I:return K(e._render);case B:t=e._payload,e=e._init;try{return K(e(t))}catch(e){}}return null}function q(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=Q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function $(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function J(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=q(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ae(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function oe(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function ue(e,t){var n=q(t.value),r=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ce(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml";function fe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function he(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?fe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var pe,_e,ve=(_e=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((pe=pe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=pe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return _e(e,t)}))}:_e);function me(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ge={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ye=["Webkit","ms","Moz","O"];function xe(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||ge.hasOwnProperty(e)&&ge[e]?(""+t).trim():t+"px"}function be(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=xe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(ge).forEach((function(e){ye.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ge[t]=ge[e]}))}));var we=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Te(e,t){if(t){if(we[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(o(62))}}function Se(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ce(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Pe=null,Me=null,Ae=null;function Ee(e){if(e=ni(e)){if("function"!=typeof Pe)throw Error(o(280));var t=e.stateNode;t&&(t=ii(t),Pe(e.stateNode,e.type,t))}}function Re(e){Me?Ae?Ae.push(e):Ae=[e]:Me=e}function Fe(){if(Me){var e=Me,t=Ae;if(Ae=Me=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Le(e,t){return e(t)}function Be(e,t,n,r,i){return e(t,n,r,i)}function Ie(){}var Oe=Le,ze=!1,De=!1;function ke(){null===Me&&null===Ae||(Ie(),Fe())}function Ne(e,t){var n=e.stateNode;if(null===n)return null;var r=ii(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(o(231,t,typeof n));return n}var Ue=!1;if(d)try{var Ve={};Object.defineProperty(Ve,"passive",{get:function(){Ue=!0}}),window.addEventListener("test",Ve,Ve),window.removeEventListener("test",Ve,Ve)}catch(_e){Ue=!1}function Ge(e,t,n,r,i,a,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}var He=!1,We=null,je=!1,Xe=null,Ke={onError:function(e){He=!0,We=e}};function qe(e,t,n,r,i,a,o,s,l){He=!1,We=null,Ge.apply(Ke,arguments)}function Qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ye(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function $e(e){if(Qe(e)!==e)throw Error(o(188))}function Je(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=Qe(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return $e(i),e;if(a===r)return $e(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,l=i.child;l;){if(l===n){s=!0,n=i,r=a;break}if(l===r){s=!0,r=i,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,r=i;break}if(l===r){s=!0,r=a,n=i;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function Ze(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var et,tt,nt,rt,it=!1,at=[],ot=null,st=null,lt=null,ut=new Map,ct=new Map,dt=[],ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ht(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function pt(e,t){switch(e){case"focusin":case"focusout":ot=null;break;case"dragenter":case"dragleave":st=null;break;case"mouseover":case"mouseout":lt=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ct.delete(t.pointerId)}}function _t(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e=ht(t,n,r,i,a),null!==t&&null!==(t=ni(t))&&tt(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function vt(e){var t=ti(e.target);if(null!==t){var n=Qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ye(n)))return e.blockedOn=t,void rt(e.lanePriority,(function(){a.unstable_runWithPriority(e.priority,(function(){nt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function mt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ni(n))&&tt(t),e.blockedOn=n,!1;t.shift()}return!0}function gt(e,t,n){mt(e)&&n.delete(t)}function yt(){for(it=!1;0<at.length;){var e=at[0];if(null!==e.blockedOn){null!==(e=ni(e.blockedOn))&&et(e);break}for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&at.shift()}null!==ot&&mt(ot)&&(ot=null),null!==st&&mt(st)&&(st=null),null!==lt&&mt(lt)&&(lt=null),ut.forEach(gt),ct.forEach(gt)}function xt(e,t){e.blockedOn===t&&(e.blockedOn=null,it||(it=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,yt)))}function bt(e){function t(t){return xt(t,e)}if(0<at.length){xt(at[0],e);for(var n=1;n<at.length;n++){var r=at[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==ot&&xt(ot,e),null!==st&&xt(st,e),null!==lt&&xt(lt,e),ut.forEach(t),ct.forEach(t),n=0;n<dt.length;n++)(r=dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<dt.length&&null===(n=dt[0]).blockedOn;)vt(n),null===n.blockedOn&&dt.shift()}function wt(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Tt={animationend:wt("Animation","AnimationEnd"),animationiteration:wt("Animation","AnimationIteration"),animationstart:wt("Animation","AnimationStart"),transitionend:wt("Transition","TransitionEnd")},St={},Ct={};function Pt(e){if(St[e])return St[e];if(!Tt[e])return e;var t,n=Tt[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ct)return St[e]=n[t];return e}d&&(Ct=document.createElement("div").style,"AnimationEvent"in window||(delete Tt.animationend.animation,delete Tt.animationiteration.animation,delete Tt.animationstart.animation),"TransitionEvent"in window||delete Tt.transitionend.transition);var Mt=Pt("animationend"),At=Pt("animationiteration"),Et=Pt("animationstart"),Rt=Pt("transitionend"),Ft=new Map,Lt=new Map,Bt=["abort","abort",Mt,"animationEnd",At,"animationIteration",Et,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Rt,"transitionEnd","waiting","waiting"];function It(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Lt.set(r,t),Ft.set(r,i),u(i,[r])}}(0,a.unstable_now)();var Ot=8;function zt(e){if(0!=(1&e))return Ot=15,1;if(0!=(2&e))return Ot=14,2;if(0!=(4&e))return Ot=13,4;var t=24&e;return 0!==t?(Ot=12,t):0!=(32&e)?(Ot=11,32):0!=(t=192&e)?(Ot=10,t):0!=(256&e)?(Ot=9,256):0!=(t=3584&e)?(Ot=8,t):0!=(4096&e)?(Ot=7,4096):0!=(t=4186112&e)?(Ot=6,t):0!=(t=62914560&e)?(Ot=5,t):67108864&e?(Ot=4,67108864):0!=(134217728&e)?(Ot=3,134217728):0!=(t=805306368&e)?(Ot=2,t):0!=(1073741824&e)?(Ot=1,1073741824):(Ot=8,e)}function Dt(e,t){var n=e.pendingLanes;if(0===n)return Ot=0;var r=0,i=0,a=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(0!==a)r=a,i=Ot=15;else if(0!=(a=134217727&n)){var l=a&~o;0!==l?(r=zt(l),i=Ot):0!=(s&=a)&&(r=zt(s),i=Ot)}else 0!=(a=n&~o)?(r=zt(a),i=Ot):0!==s&&(r=zt(s),i=Ot);if(0===r)return 0;if(r=n&((0>(r=31-Ht(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0==(t&o)){if(zt(t),i<=Ot)return t;Ot=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Ht(t)),r|=e[n],t&=~i;return r}function kt(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Nt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ut(24&~t))?Nt(10,t):e;case 10:return 0===(e=Ut(192&~t))?Nt(8,t):e;case 8:return 0===(e=Ut(3584&~t))&&0===(e=Ut(4186112&~t))&&(e=512),e;case 2:return 0===(t=Ut(805306368&~t))&&(t=268435456),t}throw Error(o(358,e))}function Ut(e){return e&-e}function Vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Gt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Ht(t)]=n}var Ht=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/jt|0)|0},Wt=Math.log,jt=Math.LN2,Xt=a.unstable_UserBlockingPriority,Kt=a.unstable_runWithPriority,qt=!0;function Qt(e,t,n,r){ze||Ie();var i=$t,a=ze;ze=!0;try{Be(i,e,t,n,r)}finally{(ze=a)||ke()}}function Yt(e,t,n,r){Kt(Xt,$t.bind(null,e,t,n,r))}function $t(e,t,n,r){var i;if(qt)if((i=0==(4&t))&&0<at.length&&-1<ft.indexOf(e))e=ht(null,e,t,n,r),at.push(e);else{var a=Jt(e,t,n,r);if(null===a)i&&pt(e,r);else{if(i){if(-1<ft.indexOf(e))return e=ht(a,e,t,n,r),void at.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return ot=_t(ot,e,t,n,r,i),!0;case"dragenter":return st=_t(st,e,t,n,r,i),!0;case"mouseover":return lt=_t(lt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return ut.set(a,_t(ut.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,ct.set(a,_t(ct.get(a)||null,e,t,n,r,i)),!0}return!1}(a,e,t,n,r))return;pt(e,r)}Ir(e,t,r,null,n)}}}function Jt(e,t,n,r){var i=Ce(r);if(null!==(i=ti(i))){var a=Qe(i);if(null===a)i=null;else{var o=a.tag;if(13===o){if(null!==(i=Ye(a)))return i;i=null}else if(3===o){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return Ir(e,t,r,i,n),null}var Zt=null,en=null,tn=null;function nn(){if(tn)return tn;var e,t,n=en,r=n.length,i="value"in Zt?Zt.value:Zt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return tn=i.slice(e,1<t?1-t:void 0)}function rn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function an(){return!0}function on(){return!1}function sn(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?an:on,this.isPropagationStopped=on,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=an)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=an)},persist:function(){},isPersistent:an}),t}var ln,un,cn,dn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fn=sn(dn),hn=i({},dn,{view:0,detail:0}),pn=sn(hn),_n=i({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(ln=e.screenX-cn.screenX,un=e.screenY-cn.screenY):un=ln=0,cn=e),ln)},movementY:function(e){return"movementY"in e?e.movementY:un}}),vn=sn(_n),mn=sn(i({},_n,{dataTransfer:0})),gn=sn(i({},hn,{relatedTarget:0})),yn=sn(i({},dn,{animationName:0,elapsedTime:0,pseudoElement:0})),xn=i({},dn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(xn),wn=sn(i({},dn,{data:0})),Tn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function Mn(){return Pn}var An=i({},hn,{key:function(e){if(e.key){var t=Tn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=rn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mn,charCode:function(e){return"keypress"===e.type?rn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?rn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),En=sn(An),Rn=sn(i({},_n,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Fn=sn(i({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mn})),Ln=sn(i({},dn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Bn=i({},_n,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),In=sn(Bn),On=[9,13,27,32],zn=d&&"CompositionEvent"in window,Dn=null;d&&"documentMode"in document&&(Dn=document.documentMode);var kn=d&&"TextEvent"in window&&!Dn,Nn=d&&(!zn||Dn&&8<Dn&&11>=Dn),Un=String.fromCharCode(32),Vn=!1;function Gn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1,jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!jn[e.type]:"textarea"===t}function Kn(e,t,n,r){Re(r),0<(t=zr(t,"onChange")).length&&(n=new fn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Qn=null;function Yn(e){Ar(e,0)}function $n(e){if($(ri(e)))return e}function Jn(e,t){if("change"===e)return t}var Zn=!1;if(d){var er;if(d){var tr="oninput"in document;if(!tr){var nr=document.createElement("div");nr.setAttribute("oninput","return;"),tr="function"==typeof nr.oninput}er=tr}else er=!1;Zn=er&&(!document.documentMode||9<document.documentMode)}function rr(){qn&&(qn.detachEvent("onpropertychange",ir),Qn=qn=null)}function ir(e){if("value"===e.propertyName&&$n(Qn)){var t=[];if(Kn(t,Qn,e,Ce(e)),e=Yn,ze)e(t);else{ze=!0;try{Le(e,t)}finally{ze=!1,ke()}}}}function ar(e,t,n){"focusin"===e?(rr(),Qn=n,(qn=t).attachEvent("onpropertychange",ir)):"focusout"===e&&rr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return $n(Qn)}function sr(e,t){if("click"===e)return $n(t)}function lr(e,t){if("input"===e||"change"===e)return $n(t)}var ur="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},cr=Object.prototype.hasOwnProperty;function dr(e,t){if(ur(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!cr.call(t,n[r])||!ur(e[n[r]],t[n[r]]))return!1;return!0}function fr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hr(e,t){var n,r=fr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=fr(r)}}function pr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function _r(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function vr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mr=d&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,xr=null,br=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==gr||gr!==J(r)||(r="selectionStart"in(r=gr)&&vr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},xr&&dr(xr,r)||(xr=r,0<(r=zr(yr,"onSelect")).length&&(t=new fn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}It("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),It("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),It(Bt,2);for(var Tr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Sr=0;Sr<Tr.length;Sr++)Lt.set(Tr[Sr],0);c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,s,l,u){if(qe.apply(this,arguments),He){if(!He)throw Error(o(198));var c=We;He=!1,We=null,je||(je=!0,Xe=c)}}(r,t,void 0,e),e.currentTarget=null}function Ar(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;Mr(i,s,u),a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,u=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;Mr(i,s,u),a=l}}}if(je)throw e=Xe,je=!1,Xe=null,e}function Er(e,t){var n=ai(t),r=e+"__bubble";n.has(r)||(Br(t,e,2,!1),n.add(r))}var Rr="_reactListening"+Math.random().toString(36).slice(2);function Fr(e){e[Rr]||(e[Rr]=!0,s.forEach((function(t){Pr.has(t)||Lr(t,!1,e,null),Lr(t,!0,e,null)})))}function Lr(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=n;if("selectionchange"===e&&9!==n.nodeType&&(a=n.ownerDocument),null!==r&&!t&&Pr.has(e)){if("scroll"!==e)return;i|=2,a=r}var o=ai(a),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(i|=4),Br(a,e,i,t),o.add(s))}function Br(e,t,n,r){var i=Lt.get(t);switch(void 0===i?2:i){case 0:i=Qt;break;case 1:i=Yt;break;default:i=$t}n=i.bind(null,t,n,e),i=void 0,!Ue||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Ir(e,t,n,r,i){var a=r;if(0==(1&t)&&0==(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=ti(s)))return;if(5===(l=o.tag)||6===l){r=a=o;continue e}s=s.parentNode}}r=r.return}!function(e,t,n){if(De)return e();De=!0;try{Oe(e,t,n)}finally{De=!1,ke()}}((function(){var r=a,i=Ce(n),o=[];e:{var s=Ft.get(e);if(void 0!==s){var l=fn,u=e;switch(e){case"keypress":if(0===rn(n))break e;case"keydown":case"keyup":l=En;break;case"focusin":u="focus",l=gn;break;case"focusout":u="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=vn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Fn;break;case Mt:case At:case Et:l=yn;break;case Rt:l=Ln;break;case"scroll":l=pn;break;case"wheel":l=In;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var c=0!=(4&t),d=!c&&"scroll"===e,f=c?null!==s?s+"Capture":null:s;c=[];for(var h,p=r;null!==p;){var _=(h=p).stateNode;if(5===h.tag&&null!==_&&(h=_,null!==f&&null!=(_=Ne(p,f))&&c.push(Or(p,_,h))),d)break;p=p.return}0<c.length&&(s=new l(s,u,null,n,i),o.push({event:s,listeners:c}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!=(16&t)||!(u=n.relatedTarget||n.fromElement)||!ti(u)&&!u[Zr])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(u=(u=n.relatedTarget||n.toElement)?ti(u):null)&&(u!==(d=Qe(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=r),l!==u)){if(c=vn,_="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=Rn,_="onPointerLeave",f="onPointerEnter",p="pointer"),d=null==l?s:ri(l),h=null==u?s:ri(u),(s=new c(_,p+"leave",l,n,i)).target=d,s.relatedTarget=h,_=null,ti(i)===r&&((c=new c(f,p+"enter",u,n,i)).target=h,c.relatedTarget=d,_=c),d=_,l&&u)e:{for(f=u,p=0,h=c=l;h;h=Dr(h))p++;for(h=0,_=f;_;_=Dr(_))h++;for(;0<p-h;)c=Dr(c),p--;for(;0<h-p;)f=Dr(f),h--;for(;p--;){if(c===f||null!==f&&c===f.alternate)break e;c=Dr(c),f=Dr(f)}c=null}else c=null;null!==l&&kr(o,s,l,c,!1),null!==u&&null!==d&&kr(o,d,u,c,!0)}if("select"===(l=(s=r?ri(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var v=Jn;else if(Xn(s))if(Zn)v=lr;else{v=or;var m=ar}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=sr);switch(v&&(v=v(e,r))?Kn(o,v,n,i):(m&&m(e,s,r),"focusout"===e&&(m=s._wrapperState)&&m.controlled&&"number"===s.type&&ie(s,"number",s.value)),m=r?ri(r):window,e){case"focusin":(Xn(m)||"true"===m.contentEditable)&&(gr=m,yr=r,xr=null);break;case"focusout":xr=yr=gr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":wr(o,n,i)}var g;if(zn)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Wn?Gn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Nn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Wn&&(g=nn()):(en="value"in(Zt=i)?Zt.value:Zt.textContent,Wn=!0)),0<(m=zr(r,y)).length&&(y=new wn(y,e,null,n,i),o.push({event:y,listeners:m}),(g||null!==(g=Hn(n)))&&(y.data=g))),(g=kn?function(e,t){switch(e){case"compositionend":return Hn(t);case"keypress":return 32!==t.which?null:(Vn=!0,Un);case"textInput":return(e=t.data)===Un&&Vn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!zn&&Gn(e,t)?(e=nn(),tn=en=Zt=null,Wn=!1,e):null;switch(e){default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Nn&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=zr(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=g)}Ar(o,t)}))}function Or(e,t,n){return{instance:e,listener:t,currentTarget:n}}function zr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Ne(e,n))&&r.unshift(Or(e,a,i)),null!=(a=Ne(e,t))&&r.push(Or(e,a,i))),e=e.return}return r}function Dr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function kr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,u=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==u&&(s=u,i?null!=(l=Ne(n,a))&&o.unshift(Or(n,l,s)):i||null!=(l=Ne(n,a))&&o.push(Or(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}function Nr(){}var Ur=null,Vr=null;function Gr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Hr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Wr="function"==typeof setTimeout?setTimeout:void 0,jr="function"==typeof clearTimeout?clearTimeout:void 0;function Xr(e){(1===e.nodeType||9===e.nodeType&&null!=(e=e.body))&&(e.textContent="")}function Kr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function qr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Qr=0,Yr=Math.random().toString(36).slice(2),$r="__reactFiber$"+Yr,Jr="__reactProps$"+Yr,Zr="__reactContainer$"+Yr,ei="__reactEvents$"+Yr;function ti(e){var t=e[$r];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Zr]||n[$r]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=qr(e);null!==e;){if(n=e[$r])return n;e=qr(e)}return t}n=(e=n).parentNode}return null}function ni(e){return!(e=e[$r]||e[Zr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ri(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function ii(e){return e[Jr]||null}function ai(e){var t=e[ei];return void 0===t&&(t=e[ei]=new Set),t}var oi=[],si=-1;function li(e){return{current:e}}function ui(e){0>si||(e.current=oi[si],oi[si]=null,si--)}function ci(e,t){si++,oi[si]=e.current,e.current=t}var di={},fi=li(di),hi=li(!1),pi=di;function _i(e,t){var n=e.type.contextTypes;if(!n)return di;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function vi(e){return null!=e.childContextTypes}function mi(){ui(hi),ui(fi)}function gi(e,t,n){if(fi.current!==di)throw Error(o(168));ci(fi,t),ci(hi,n)}function yi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(o(108,K(t)||"Unknown",a));return i({},n,r)}function xi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||di,pi=fi.current,ci(fi,e),ci(hi,hi.current),!0}function bi(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=yi(e,t,pi),r.__reactInternalMemoizedMergedChildContext=e,ui(hi),ui(fi),ci(fi,e)):ui(hi),ci(hi,n)}var wi=null,Ti=null,Si=a.unstable_runWithPriority,Ci=a.unstable_scheduleCallback,Pi=a.unstable_cancelCallback,Mi=a.unstable_shouldYield,Ai=a.unstable_requestPaint,Ei=a.unstable_now,Ri=a.unstable_getCurrentPriorityLevel,Fi=a.unstable_ImmediatePriority,Li=a.unstable_UserBlockingPriority,Bi=a.unstable_NormalPriority,Ii=a.unstable_LowPriority,Oi=a.unstable_IdlePriority,zi={},Di=void 0!==Ai?Ai:function(){},ki=null,Ni=null,Ui=!1,Vi=Ei(),Gi=1e4>Vi?Ei:function(){return Ei()-Vi};function Hi(){switch(Ri()){case Fi:return 99;case Li:return 98;case Bi:return 97;case Ii:return 96;case Oi:return 95;default:throw Error(o(332))}}function Wi(e){switch(e){case 99:return Fi;case 98:return Li;case 97:return Bi;case 96:return Ii;case 95:return Oi;default:throw Error(o(332))}}function ji(e,t){return e=Wi(e),Si(e,t)}function Xi(e,t,n){return e=Wi(e),Ci(e,t,n)}function Ki(){if(null!==Ni){var e=Ni;Ni=null,Pi(e)}qi()}function qi(){if(!Ui&&null!==ki){Ui=!0;var e=0;try{var t=ki;ji(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),ki=null}catch(t){throw null!==ki&&(ki=ki.slice(e+1)),Ci(Fi,Ki),t}finally{Ui=!1}}}var Qi=b.ReactCurrentBatchConfig;function Yi(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var $i=li(null),Ji=null,Zi=null,ea=null;function ta(){ea=Zi=Ji=null}function na(e){var t=$i.current;ui($i),e.type._context._currentValue=t}function ra(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function ia(e,t){Ji=e,ea=Zi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(zo=!0),e.firstContext=null)}function aa(e,t){if(ea!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(ea=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Zi){if(null===Ji)throw Error(o(308));Zi=t,Ji.dependencies={lanes:0,firstContext:t,responders:null}}else Zi=Zi.next=t;return e._currentValue}var oa=!1;function sa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function la(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ua(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ca(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function da(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function fa(e,t,n,r){var a=e.updateQueue;oa=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(null!==l){a.shared.pending=null;var u=l,c=u.next;u.next=null,null===s?o=c:s.next=c,s=u;var d=e.alternate;if(null!==d){var f=(d=d.updateQueue).lastBaseUpdate;f!==s&&(null===f?d.firstBaseUpdate=c:f.next=c,d.lastBaseUpdate=u)}}if(null!==o){for(f=a.baseState,s=0,d=c=u=null;;){l=o.lane;var h=o.eventTime;if((r&l)===l){null!==d&&(d=d.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,_=o;switch(l=t,h=n,_.tag){case 1:if("function"==typeof(p=_.payload)){f=p.call(h,f,l);break e}f=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null==(l="function"==typeof(p=_.payload)?p.call(h,f,l):p))break e;f=i({},f,l);break e;case 2:oa=!0}}null!==o.callback&&(e.flags|=32,null===(l=a.effects)?a.effects=[o]:l.push(o))}else h={eventTime:h,lane:l,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=h,u=f):d=d.next=h,s|=l;if(null===(o=o.next)){if(null===(l=a.shared.pending))break;o=l.next,l.next=null,a.lastBaseUpdate=l,a.shared.pending=null}}null===d&&(u=f),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=d,ks|=s,e.lanes=s,e.memoizedState=f}}function ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(o(191,i));i.call(r)}}}var pa=(new r.Component).refs;function _a(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var va={isMounted:function(e){return!!(e=e._reactInternals)&&Qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ul(),i=cl(e),a=ua(r,i);a.payload=t,null!=n&&(a.callback=n),ca(e,a),dl(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ul(),i=cl(e),a=ua(r,i);a.tag=1,a.payload=t,null!=n&&(a.callback=n),ca(e,a),dl(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ul(),r=cl(e),i=ua(n,r);i.tag=2,null!=t&&(i.callback=t),ca(e,i),dl(e,r,n)}};function ma(e,t,n,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!(t.prototype&&t.prototype.isPureReactComponent&&dr(n,r)&&dr(i,a))}function ga(e,t,n){var r=!1,i=di,a=t.contextType;return"object"==typeof a&&null!==a?a=aa(a):(i=vi(t)?pi:fi.current,a=(r=null!=(r=t.contextTypes))?_i(e,i):di),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=va,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ya(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&va.enqueueReplaceState(t,t.state,null)}function xa(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=pa,sa(e);var a=t.contextType;"object"==typeof a&&null!==a?i.context=aa(a):(a=vi(t)?pi:fi.current,i.context=_i(e,a)),fa(e,n,i,r),i.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(_a(e,t,a,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&va.enqueueReplaceState(i,i.state,null),fa(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4)}var ba=Array.isArray;function wa(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=r.refs;t===pa&&(t=r.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Ta(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Sa(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Hl(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Kl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=wa(e,t,n),r.return=e,r):((r=Wl(n.type,n.key,n.props,null,e.mode,r)).ref=wa(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=ql(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=jl(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Kl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Wl(t.type,t.key,t.props,null,e.mode,n)).ref=wa(e,null,t),n.return=e,n;case T:return(t=ql(t,e.mode,n)).return=e,t}if(ba(t)||G(t))return(t=jl(t,e.mode,n,null)).return=e,t;Ta(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?n.type===S?d(e,t,n.props.children,r,i):u(e,t,n,r):null;case T:return n.key===i?c(e,t,n,r):null}if(ba(n)||G(n))return null!==i?null:d(e,t,n,r,null);Ta(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return e=e.get(null===r.key?n:r.key)||null,r.type===S?d(t,e,r.props.children,i,r.key):u(t,e,r,i);case T:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(ba(r)||G(r))return d(t,e=e.get(n)||null,r,i,null);Ta(t,r)}return null}function _(i,o,s,l){for(var u=null,c=null,d=o,_=o=0,v=null;null!==d&&_<s.length;_++){d.index>_?(v=d,d=null):v=d.sibling;var m=h(i,d,s[_],l);if(null===m){null===d&&(d=v);break}e&&d&&null===m.alternate&&t(i,d),o=a(m,o,_),null===c?u=m:c.sibling=m,c=m,d=v}if(_===s.length)return n(i,d),u;if(null===d){for(;_<s.length;_++)null!==(d=f(i,s[_],l))&&(o=a(d,o,_),null===c?u=d:c.sibling=d,c=d);return u}for(d=r(i,d);_<s.length;_++)null!==(v=p(d,i,_,s[_],l))&&(e&&null!==v.alternate&&d.delete(null===v.key?_:v.key),o=a(v,o,_),null===c?u=v:c.sibling=v,c=v);return e&&d.forEach((function(e){return t(i,e)})),u}function v(i,s,l,u){var c=G(l);if("function"!=typeof c)throw Error(o(150));if(null==(l=c.call(l)))throw Error(o(151));for(var d=c=null,_=s,v=s=0,m=null,g=l.next();null!==_&&!g.done;v++,g=l.next()){_.index>v?(m=_,_=null):m=_.sibling;var y=h(i,_,g.value,u);if(null===y){null===_&&(_=m);break}e&&_&&null===y.alternate&&t(i,_),s=a(y,s,v),null===d?c=y:d.sibling=y,d=y,_=m}if(g.done)return n(i,_),c;if(null===_){for(;!g.done;v++,g=l.next())null!==(g=f(i,g.value,u))&&(s=a(g,s,v),null===d?c=g:d.sibling=g,d=g);return c}for(_=r(i,_);!g.done;v++,g=l.next())null!==(g=p(_,i,v,g.value,u))&&(e&&null!==g.alternate&&_.delete(null===g.key?v:g.key),s=a(g,s,v),null===d?c=g:d.sibling=g,d=g);return e&&_.forEach((function(e){return t(i,e)})),c}return function(e,r,a,l){var u="object"==typeof a&&null!==a&&a.type===S&&null===a.key;u&&(a=a.props.children);var c="object"==typeof a&&null!==a;if(c)switch(a.$$typeof){case w:e:{for(c=a.key,u=r;null!==u;){if(u.key===c){if(7===u.tag){if(a.type===S){n(e,u.sibling),(r=i(u,a.props.children)).return=e,e=r;break e}}else if(u.elementType===a.type){n(e,u.sibling),(r=i(u,a.props)).ref=wa(e,u,a),r.return=e,e=r;break e}n(e,u);break}t(e,u),u=u.sibling}a.type===S?((r=jl(a.props.children,e.mode,l,a.key)).return=e,e=r):((l=Wl(a.type,a.key,a.props,null,e.mode,l)).ref=wa(e,r,a),l.return=e,e=l)}return s(e);case T:e:{for(u=a.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=ql(a,e.mode,l)).return=e,e=r}return s(e)}if("string"==typeof a||"number"==typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=Kl(a,e.mode,l)).return=e,e=r),s(e);if(ba(a))return _(e,r,a,l);if(G(a))return v(e,r,a,l);if(c&&Ta(e,a),void 0===a&&!u)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,K(e.type)||"Component"))}return n(e,r)}}var Ca=Sa(!0),Pa=Sa(!1),Ma={},Aa=li(Ma),Ea=li(Ma),Ra=li(Ma);function Fa(e){if(e===Ma)throw Error(o(174));return e}function La(e,t){switch(ci(Ra,t),ci(Ea,e),ci(Aa,Ma),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:he(null,"");break;default:t=he(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ui(Aa),ci(Aa,t)}function Ba(){ui(Aa),ui(Ea),ui(Ra)}function Ia(e){Fa(Ra.current);var t=Fa(Aa.current),n=he(t,e.type);t!==n&&(ci(Ea,e),ci(Aa,n))}function Oa(e){Ea.current===e&&(ui(Aa),ui(Ea))}var za=li(0);function Da(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ka=null,Na=null,Ua=!1;function Va(e,t){var n=Vl(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ga(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Ha(e){if(Ua){var t=Na;if(t){var n=t;if(!Ga(e,t)){if(!(t=Kr(n.nextSibling))||!Ga(e,t))return e.flags=-1025&e.flags|2,Ua=!1,void(ka=e);Va(ka,n)}ka=e,Na=Kr(t.firstChild)}else e.flags=-1025&e.flags|2,Ua=!1,ka=e}}function Wa(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ka=e}function ja(e){if(e!==ka)return!1;if(!Ua)return Wa(e),Ua=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Hr(t,e.memoizedProps))for(t=Na;t;)Va(e,t),t=Kr(t.nextSibling);if(Wa(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Na=Kr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Na=null}}else Na=ka?Kr(e.stateNode.nextSibling):null;return!0}function Xa(){Na=ka=null,Ua=!1}var Ka=[];function qa(){for(var e=0;e<Ka.length;e++)Ka[e]._workInProgressVersionPrimary=null;Ka.length=0}var Qa=b.ReactCurrentDispatcher,Ya=b.ReactCurrentBatchConfig,$a=0,Ja=null,Za=null,eo=null,to=!1,no=!1;function ro(){throw Error(o(321))}function io(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ur(e[n],t[n]))return!1;return!0}function ao(e,t,n,r,i,a){if($a=a,Ja=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qa.current=null===e||null===e.memoizedState?Lo:Bo,e=n(r,i),no){a=0;do{if(no=!1,!(25>a))throw Error(o(301));a+=1,eo=Za=null,t.updateQueue=null,Qa.current=Io,e=n(r,i)}while(no)}if(Qa.current=Fo,t=null!==Za&&null!==Za.next,$a=0,eo=Za=Ja=null,to=!1,t)throw Error(o(300));return e}function oo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===eo?Ja.memoizedState=eo=e:eo=eo.next=e,eo}function so(){if(null===Za){var e=Ja.alternate;e=null!==e?e.memoizedState:null}else e=Za.next;var t=null===eo?Ja.memoizedState:eo.next;if(null!==t)eo=t,Za=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Za=e).memoizedState,baseState:Za.baseState,baseQueue:Za.baseQueue,queue:Za.queue,next:null},null===eo?Ja.memoizedState=eo=e:eo=eo.next=e}return eo}function lo(e,t){return"function"==typeof t?t(e):t}function uo(e){var t=so(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Za,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var l=s=a=null,u=i;do{var c=u.lane;if(($a&c)===c)null!==l&&(l=l.next={lane:0,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),r=u.eagerReducer===e?u.eagerState:e(r,u.action);else{var d={lane:c,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};null===l?(s=l=d,a=r):l=l.next=d,Ja.lanes|=c,ks|=c}u=u.next}while(null!==u&&u!==i);null===l?a=r:l.next=s,ur(r,t.memoizedState)||(zo=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function co(e){var t=so(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);ur(a,t.memoizedState)||(zo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function fo(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=($a&e)===e)&&(t._workInProgressVersionPrimary=r,Ka.push(t))),e)return n(t._source);throw Ka.push(t),Error(o(350))}function ho(e,t,n,r){var i=Rs;if(null===i)throw Error(o(349));var a=t._getVersion,s=a(t._source),l=Qa.current,u=l.useState((function(){return fo(i,t,n)})),c=u[1],d=u[0];u=eo;var f=e.memoizedState,h=f.refs,p=h.getSnapshot,_=f.source;f=f.subscribe;var v=Ja;return e.memoizedState={refs:h,source:t,subscribe:r},l.useEffect((function(){h.getSnapshot=n,h.setSnapshot=c;var e=a(t._source);if(!ur(s,e)){e=n(t._source),ur(d,e)||(c(e),e=cl(v),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,o=e;0<o;){var l=31-Ht(o),u=1<<l;r[l]|=e,o&=~u}}}),[n,t,r]),l.useEffect((function(){return r(t._source,(function(){var e=h.getSnapshot,n=h.setSnapshot;try{n(e(t._source));var r=cl(v);i.mutableReadLanes|=r&i.pendingLanes}catch(e){n((function(){throw e}))}}))}),[t,r]),ur(p,n)&&ur(_,t)&&ur(f,r)||((e={pending:null,dispatch:null,lastRenderedReducer:lo,lastRenderedState:d}).dispatch=c=Ro.bind(null,Ja,e),u.queue=e,u.baseQueue=null,d=fo(i,t,n),u.memoizedState=u.baseState=d),d}function po(e,t,n){return ho(so(),e,t,n)}function _o(e){var t=oo();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:lo,lastRenderedState:e}).dispatch=Ro.bind(null,Ja,e),[t.memoizedState,e]}function vo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Ja.updateQueue)?(t={lastEffect:null},Ja.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function mo(e){return e={current:e},oo().memoizedState=e}function go(){return so().memoizedState}function yo(e,t,n,r){var i=oo();Ja.flags|=e,i.memoizedState=vo(1|t,n,void 0,void 0===r?null:r)}function xo(e,t,n,r){var i=so();r=void 0===r?null:r;var a=void 0;if(null!==Za){var o=Za.memoizedState;if(a=o.destroy,null!==r&&io(r,o.deps))return void vo(t,n,a,r)}Ja.flags|=e,i.memoizedState=vo(1|t,n,a,r)}function bo(e,t){return yo(516,4,e,t)}function wo(e,t){return xo(516,4,e,t)}function To(e,t){return xo(4,2,e,t)}function So(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Co(e,t,n){return n=null!=n?n.concat([e]):null,xo(4,2,So.bind(null,t,e),n)}function Po(){}function Mo(e,t){var n=so();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&io(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ao(e,t){var n=so();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&io(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Eo(e,t){var n=Hi();ji(98>n?98:n,(function(){e(!0)})),ji(97<n?97:n,(function(){var n=Ya.transition;Ya.transition=1;try{e(!1),t()}finally{Ya.transition=n}}))}function Ro(e,t,n){var r=ul(),i=cl(e),a={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?a.next=a:(a.next=o.next,o.next=a),t.pending=a,o=e.alternate,e===Ja||null!==o&&o===Ja)no=to=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,l=o(s,n);if(a.eagerReducer=o,a.eagerState=l,ur(l,s))return}catch(e){}dl(e,i,r)}}var Fo={readContext:aa,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useLayoutEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useMutableSource:ro,useOpaqueIdentifier:ro,unstable_isNewReconciler:!1},Lo={readContext:aa,useCallback:function(e,t){return oo().memoizedState=[e,void 0===t?null:t],e},useContext:aa,useEffect:bo,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,yo(4,2,So.bind(null,t,e),n)},useLayoutEffect:function(e,t){return yo(4,2,e,t)},useMemo:function(e,t){var n=oo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=oo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ro.bind(null,Ja,e),[r.memoizedState,e]},useRef:mo,useState:_o,useDebugValue:Po,useDeferredValue:function(e){var t=_o(e),n=t[0],r=t[1];return bo((function(){var t=Ya.transition;Ya.transition=1;try{r(e)}finally{Ya.transition=t}}),[e]),n},useTransition:function(){var e=_o(!1),t=e[0];return mo(e=Eo.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=oo();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},ho(r,e,t,n)},useOpaqueIdentifier:function(){if(Ua){var e=!1,t=function(e){return{$$typeof:O,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Qr++).toString(36))),Error(o(355))})),n=_o(t)[1];return 0==(2&Ja.mode)&&(Ja.flags|=516,vo(5,(function(){n("r:"+(Qr++).toString(36))}),void 0,null)),t}return _o(t="r:"+(Qr++).toString(36)),t},unstable_isNewReconciler:!1},Bo={readContext:aa,useCallback:Mo,useContext:aa,useEffect:wo,useImperativeHandle:Co,useLayoutEffect:To,useMemo:Ao,useReducer:uo,useRef:go,useState:function(){return uo(lo)},useDebugValue:Po,useDeferredValue:function(e){var t=uo(lo),n=t[0],r=t[1];return wo((function(){var t=Ya.transition;Ya.transition=1;try{r(e)}finally{Ya.transition=t}}),[e]),n},useTransition:function(){var e=uo(lo)[0];return[go().current,e]},useMutableSource:po,useOpaqueIdentifier:function(){return uo(lo)[0]},unstable_isNewReconciler:!1},Io={readContext:aa,useCallback:Mo,useContext:aa,useEffect:wo,useImperativeHandle:Co,useLayoutEffect:To,useMemo:Ao,useReducer:co,useRef:go,useState:function(){return co(lo)},useDebugValue:Po,useDeferredValue:function(e){var t=co(lo),n=t[0],r=t[1];return wo((function(){var t=Ya.transition;Ya.transition=1;try{r(e)}finally{Ya.transition=t}}),[e]),n},useTransition:function(){var e=co(lo)[0];return[go().current,e]},useMutableSource:po,useOpaqueIdentifier:function(){return co(lo)[0]},unstable_isNewReconciler:!1},Oo=b.ReactCurrentOwner,zo=!1;function Do(e,t,n,r){t.child=null===e?Pa(t,null,n,r):Ca(t,e.child,n,r)}function ko(e,t,n,r,i){n=n.render;var a=t.ref;return ia(t,i),r=ao(e,t,n,r,a,i),null===e||zo?(t.flags|=1,Do(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function No(e,t,n,r,i,a){if(null===e){var o=n.type;return"function"!=typeof o||Gl(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Wl(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Uo(e,t,o,r,i,a))}return o=e.child,0==(i&a)&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:dr)(i,r)&&e.ref===t.ref)?ns(e,t,a):(t.flags|=1,(e=Hl(o,r)).ref=t.ref,e.return=t,t.child=e)}function Uo(e,t,n,r,i,a){if(null!==e&&dr(e.memoizedProps,r)&&e.ref===t.ref){if(zo=!1,0==(a&i))return t.lanes=e.lanes,ns(e,t,a);0!=(16384&e.flags)&&(zo=!0)}return Ho(e,t,n,r,a)}function Vo(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},yl(0,n);else{if(0==(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},yl(0,e),null;t.memoizedState={baseLanes:0},yl(0,null!==a?a.baseLanes:n)}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,yl(0,r);return Do(e,t,i,n),t.child}function Go(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Ho(e,t,n,r,i){var a=vi(n)?pi:fi.current;return a=_i(t,a),ia(t,i),n=ao(e,t,n,r,a,i),null===e||zo?(t.flags|=1,Do(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function Wo(e,t,n,r,i){if(vi(n)){var a=!0;xi(t)}else a=!1;if(ia(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),ga(t,n,r),xa(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,u=n.contextType;u="object"==typeof u&&null!==u?aa(u):_i(t,u=vi(n)?pi:fi.current);var c=n.getDerivedStateFromProps,d="function"==typeof c||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==r||l!==u)&&ya(t,o,r,u),oa=!1;var f=t.memoizedState;o.state=f,fa(t,r,o,i),l=t.memoizedState,s!==r||f!==l||hi.current||oa?("function"==typeof c&&(_a(t,n,c,r),l=t.memoizedState),(s=oa||ma(t,n,s,r,f,l,u))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4)):("function"==typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=u,r=s):("function"==typeof o.componentDidMount&&(t.flags|=4),r=!1)}else{o=t.stateNode,la(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:Yi(t.type,s),o.props=u,d=t.pendingProps,f=o.context,l="object"==typeof(l=n.contextType)&&null!==l?aa(l):_i(t,l=vi(n)?pi:fi.current);var h=n.getDerivedStateFromProps;(c="function"==typeof h||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==d||f!==l)&&ya(t,o,r,l),oa=!1,f=t.memoizedState,o.state=f,fa(t,r,o,i);var p=t.memoizedState;s!==d||f!==p||hi.current||oa?("function"==typeof h&&(_a(t,n,h,r),p=t.memoizedState),(u=oa||ma(t,n,u,r,f,p,l))?(c||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=l,r=u):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),r=!1)}return jo(e,t,n,r,a,i)}function jo(e,t,n,r,i,a){Go(e,t);var o=0!=(64&t.flags);if(!r&&!o)return i&&bi(t,n,!1),ns(e,t,a);r=t.stateNode,Oo.current=t;var s=o&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Ca(t,e.child,null,a),t.child=Ca(t,null,s,a)):Do(e,t,s,a),t.memoizedState=r.state,i&&bi(t,n,!0),t.child}function Xo(e){var t=e.stateNode;t.pendingContext?gi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gi(0,t.context,!1),La(e,t.containerInfo)}var Ko,qo,Qo,Yo={dehydrated:null,retryLane:0};function $o(e,t,n){var r,i=t.pendingProps,a=za.current,o=!1;return(r=0!=(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!=(2&a)),r?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(a|=1),ci(za,1&a),null===e?(void 0!==i.fallback&&Ha(t),e=i.children,a=i.fallback,o?(e=Jo(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Yo,e):"number"==typeof i.unstable_expectedLoadTime?(e=Jo(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Yo,t.lanes=33554432,e):((n=Xl({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,o?(i=function(e,t,n,r,i){var a=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:n};return 0==(2&a)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Hl(o,s),null!==e?r=Hl(e,r):(r=jl(r,a,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}(e,t,i.children,i.fallback,n),o=t.child,a=e.child.memoizedState,o.memoizedState=null===a?{baseLanes:n}:{baseLanes:a.baseLanes|n},o.childLanes=e.childLanes&~n,t.memoizedState=Yo,i):(n=function(e,t,n,r){var i=e.child;return e=i.sibling,n=Hl(i,{mode:"visible",children:n}),0==(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}(e,t,i.children,n),t.memoizedState=null,n))}function Jo(e,t,n,r){var i=e.mode,a=e.child;return t={mode:"hidden",children:t},0==(2&i)&&null!==a?(a.childLanes=0,a.pendingProps=t):a=Xl(t,i,0,null),n=jl(n,i,r,null),a.return=e,n.return=e,a.sibling=n,e.child=a,n}function Zo(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),ra(e.return,t)}function es(e,t,n,r,i,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.lastEffect=a)}function ts(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Do(e,t,r.children,n),0!=(2&(r=za.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Zo(e,n);else if(19===e.tag)Zo(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ci(za,r),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Da(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),es(t,!1,i,n,a,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Da(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}es(t,!0,n,null,a,t.lastEffect);break;case"together":es(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ns(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ks|=t.lanes,0!=(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Hl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Hl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function rs(e,t){if(!Ua)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function is(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return vi(t.type)&&mi(),null;case 3:return Ba(),ui(hi),ui(fi),qa(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ja(t)?t.flags|=4:r.hydrate||(t.flags|=256)),null;case 5:Oa(t);var a=Fa(Ra.current);if(n=t.type,null!==e&&null!=t.stateNode)qo(e,t,n,r),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=Fa(Aa.current),ja(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[$r]=t,r[Jr]=s,n){case"dialog":Er("cancel",r),Er("close",r);break;case"iframe":case"object":case"embed":Er("load",r);break;case"video":case"audio":for(e=0;e<Cr.length;e++)Er(Cr[e],r);break;case"source":Er("error",r);break;case"img":case"image":case"link":Er("error",r),Er("load",r);break;case"details":Er("toggle",r);break;case"input":ee(r,s),Er("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Er("invalid",r);break;case"textarea":le(r,s),Er("invalid",r)}for(var u in Te(n,s),e=null,s)s.hasOwnProperty(u)&&(a=s[u],"children"===u?"string"==typeof a?r.textContent!==a&&(e=["children",a]):"number"==typeof a&&r.textContent!==""+a&&(e=["children",""+a]):l.hasOwnProperty(u)&&null!=a&&"onScroll"===u&&Er("scroll",r));switch(n){case"input":Y(r),re(r,s,!0);break;case"textarea":Y(r),ce(r);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(r.onclick=Nr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(u=9===a.nodeType?a:a.ownerDocument,e===de&&(e=fe(n)),e===de?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[$r]=t,e[Jr]=r,Ko(e,t),t.stateNode=e,u=Se(n,r),n){case"dialog":Er("cancel",e),Er("close",e),a=r;break;case"iframe":case"object":case"embed":Er("load",e),a=r;break;case"video":case"audio":for(a=0;a<Cr.length;a++)Er(Cr[a],e);a=r;break;case"source":Er("error",e),a=r;break;case"img":case"image":case"link":Er("error",e),Er("load",e),a=r;break;case"details":Er("toggle",e),a=r;break;case"input":ee(e,r),a=Z(e,r),Er("invalid",e);break;case"option":a=ae(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=i({},r,{value:void 0}),Er("invalid",e);break;case"textarea":le(e,r),a=se(e,r),Er("invalid",e);break;default:a=r}Te(n,a);var c=a;for(s in c)if(c.hasOwnProperty(s)){var d=c[s];"style"===s?be(e,d):"dangerouslySetInnerHTML"===s?null!=(d=d?d.__html:void 0)&&ve(e,d):"children"===s?"string"==typeof d?("textarea"!==n||""!==d)&&me(e,d):"number"==typeof d&&me(e,""+d):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(l.hasOwnProperty(s)?null!=d&&"onScroll"===s&&Er("scroll",e):null!=d&&x(e,s,d,u))}switch(n){case"input":Y(e),re(e,r,!1);break;case"textarea":Y(e),ce(e);break;case"option":null!=r.value&&e.setAttribute("value",""+q(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?oe(e,!!r.multiple,s,!1):null!=r.defaultValue&&oe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=Nr)}Gr(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Qo(0,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(o(166));n=Fa(Ra.current),Fa(Aa.current),ja(t)?(r=t.stateNode,n=t.memoizedProps,r[$r]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[$r]=t,t.stateNode=r)}return null;case 13:return ui(za),r=t.memoizedState,0!=(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&ja(t):n=null!==e.memoizedState,r&&!n&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&za.current)?0===Os&&(Os=3):(0!==Os&&3!==Os||(Os=4),null===Rs||0==(134217727&ks)&&0==(134217727&Ns)||_l(Rs,Ls))),(r||n)&&(t.flags|=4),null);case 4:return Ba(),null===e&&Fr(t.stateNode.containerInfo),null;case 10:return na(t),null;case 19:if(ui(za),null===(r=t.memoizedState))return null;if(s=0!=(64&t.flags),null===(u=r.rendering))if(s)rs(r,!1);else{if(0!==Os||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(u=Da(e))){for(t.flags|=64,rs(r,!1),null!==(s=u.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(u=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,e=u.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ci(za,1&za.current|2),t.child}e=e.sibling}null!==r.tail&&Gi()>Hs&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Da(u))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),rs(r,!0),null===r.tail&&"hidden"===r.tailMode&&!u.alternate&&!Ua)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Gi()-r.renderingStartTime>Hs&&1073741824!==n&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432);r.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=r.last)?n.sibling=u:t.child=u,r.last=u)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Gi(),n.sibling=null,t=za.current,ci(za,s?1&t|2:1&t),n):null;case 23:case 24:return xl(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(o(156,t.tag))}function as(e){switch(e.tag){case 1:vi(e.type)&&mi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Ba(),ui(hi),ui(fi),qa(),0!=(64&(t=e.flags)))throw Error(o(285));return e.flags=-4097&t|64,e;case 5:return Oa(e),null;case 13:return ui(za),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ui(za),null;case 4:return Ba(),null;case 10:return na(e),null;case 23:case 24:return xl(),null;default:return null}}function os(e,t){try{var n="",r=t;do{n+=X(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i}}function ss(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}Ko=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},qo=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Fa(Aa.current);var o,s=null;switch(n){case"input":a=Z(e,a),r=Z(e,r),s=[];break;case"option":a=ae(e,a),r=ae(e,r),s=[];break;case"select":a=i({},a,{value:void 0}),r=i({},r,{value:void 0}),s=[];break;case"textarea":a=se(e,a),r=se(e,r),s=[];break;default:"function"!=typeof a.onClick&&"function"==typeof r.onClick&&(e.onclick=Nr)}for(d in Te(n,r),n=null,a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&null!=a[d])if("style"===d){var u=a[d];for(o in u)u.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(l.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in r){var c=r[d];if(u=null!=a?a[d]:void 0,r.hasOwnProperty(d)&&c!==u&&(null!=c||null!=u))if("style"===d)if(u){for(o in u)!u.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&u[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(s=s||[]).push(d,c)):"children"===d?"string"!=typeof c&&"number"!=typeof c||(s=s||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(l.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Er("scroll",e),s||u===c||(s=[])):"object"==typeof c&&null!==c&&c.$$typeof===O?c.toString():(s=s||[]).push(d,c))}n&&(s=s||[]).push("style",n);var d=s;(t.updateQueue=d)&&(t.flags|=4)}},Qo=function(e,t,n,r){n!==r&&(t.flags|=4)};var ls="function"==typeof WeakMap?WeakMap:Map;function us(e,t,n){(n=ua(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Ks||(Ks=!0,qs=r),ss(0,t)},n}function cs(e,t,n){(n=ua(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return ss(0,t),r(i)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===Qs?Qs=new Set([this]):Qs.add(this),ss(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var ds="function"==typeof WeakSet?WeakSet:Set;function fs(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Dl(e,t)}else t.current=null}function hs(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Yi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Xr(t.stateNode.containerInfo))}throw Error(o(163))}function ps(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!=(4&(i=i.tag))&&0!=(1&i)&&(Il(n,e),Bl(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:Yi(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&ha(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}ha(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Gr(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&bt(n)))))}throw Error(o(163))}function _s(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"==typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=null!=i&&i.hasOwnProperty("display")?i.display:null,r.style.display=xe("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function vs(e,t){if(Ti&&"function"==typeof Ti.onCommitFiberUnmount)try{Ti.onCommitFiberUnmount(wi,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!=(4&r))Il(t,n);else{r=t;try{i()}catch(e){Dl(r,e)}}n=n.next}while(n!==e)}break;case 1:if(fs(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Dl(t,e)}break;case 5:fs(t);break;case 4:ws(e,t)}}function ms(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function gs(e){return 5===e.tag||3===e.tag||4===e.tag}function ys(e){e:{for(var t=e.return;null!==t;){if(gs(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.flags&&(me(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||gs(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?xs(e,n,t):bs(e,n,t)}function xs(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Nr));else if(4!==r&&null!==(e=e.child))for(xs(e,t,n),e=e.sibling;null!==e;)xs(e,t,n),e=e.sibling}function bs(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(bs(e,t,n),e=e.sibling;null!==e;)bs(e,t,n),e=e.sibling}function ws(e,t){for(var n,r,i=t,a=!1;;){if(!a){a=i.return;e:for(;;){if(null===a)throw Error(o(160));switch(n=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===i.tag||6===i.tag){e:for(var s=e,l=i,u=l;;)if(vs(s,u),null!==u.child&&4!==u.tag)u.child.return=u,u=u.child;else{if(u===l)break e;for(;null===u.sibling;){if(null===u.return||u.return===l)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}r?(s=n,l=i.stateNode,8===s.nodeType?s.parentNode.removeChild(l):s.removeChild(l)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(vs(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(a=!1)}i.sibling.return=i.return,i=i.sibling}}function Ts(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3==(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:case 12:case 17:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[Jr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),Se(e,i),t=Se(e,r),i=0;i<a.length;i+=2){var s=a[i],l=a[i+1];"style"===s?be(n,l):"dangerouslySetInnerHTML"===s?ve(n,l):"children"===s?me(n,l):x(n,s,l,t)}switch(e){case"input":ne(n,r);break;case"textarea":ue(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(a=r.value)?oe(n,!!r.multiple,a,!1):e!==!!r.multiple&&(null!=r.defaultValue?oe(n,!!r.multiple,r.defaultValue,!0):oe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,bt(n.containerInfo)));case 13:return null!==t.memoizedState&&(Gs=Gi(),_s(t.child,!0)),void Ss(t);case 19:return void Ss(t);case 23:case 24:return void _s(t,null!==t.memoizedState)}throw Error(o(163))}function Ss(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ds),t.forEach((function(t){var r=Nl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Cs(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&null!==(t=t.memoizedState)&&null===t.dehydrated}var Ps=Math.ceil,Ms=b.ReactCurrentDispatcher,As=b.ReactCurrentOwner,Es=0,Rs=null,Fs=null,Ls=0,Bs=0,Is=li(0),Os=0,zs=null,Ds=0,ks=0,Ns=0,Us=0,Vs=null,Gs=0,Hs=1/0;function Ws(){Hs=Gi()+500}var js,Xs=null,Ks=!1,qs=null,Qs=null,Ys=!1,$s=null,Js=90,Zs=[],el=[],tl=null,nl=0,rl=null,il=-1,al=0,ol=0,sl=null,ll=!1;function ul(){return 0!=(48&Es)?Gi():-1!==il?il:il=Gi()}function cl(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Hi()?1:2;if(0===al&&(al=Ds),0!==Qi.transition){0!==ol&&(ol=null!==Vs?Vs.pendingLanes:0),e=al;var t=4186112&~ol;return 0==(t&=-t)&&0==(t=(e=4186112&~e)&-e)&&(t=8192),t}return e=Hi(),e=Nt(0!=(4&Es)&&98===e?12:e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),al)}function dl(e,t,n){if(50<nl)throw nl=0,rl=null,Error(o(185));if(null===(e=fl(e,t)))return null;Gt(e,t,n),e===Rs&&(Ns|=t,4===Os&&_l(e,Ls));var r=Hi();1===t?0!=(8&Es)&&0==(48&Es)?vl(e):(hl(e,n),0===Es&&(Ws(),Ki())):(0==(4&Es)||98!==r&&99!==r||(null===tl?tl=new Set([e]):tl.add(e)),hl(e,n)),Vs=e}function fl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function hl(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var l=31-Ht(s),u=1<<l,c=a[l];if(-1===c){if(0==(u&r)||0!=(u&i)){c=t,zt(u);var d=Ot;a[l]=10<=d?c+250:6<=d?c+5e3:-1}}else c<=t&&(e.expiredLanes|=u);s&=~u}if(r=Dt(e,e===Rs?Ls:0),t=Ot,0===r)null!==n&&(n!==zi&&Pi(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==zi&&Pi(n)}15===t?(n=vl.bind(null,e),null===ki?(ki=[n],Ni=Ci(Fi,qi)):ki.push(n),n=zi):14===t?n=Xi(99,vl.bind(null,e)):(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,e))}}(t),n=Xi(n,pl.bind(null,e))),e.callbackPriority=t,e.callbackNode=n}}function pl(e){if(il=-1,ol=al=0,0!=(48&Es))throw Error(o(327));var t=e.callbackNode;if(Ll()&&e.callbackNode!==t)return null;var n=Dt(e,e===Rs?Ls:0);if(0===n)return null;var r=n,i=Es;Es|=16;var a=Tl();for(Rs===e&&Ls===r||(Ws(),bl(e,r));;)try{Pl();break}catch(t){wl(e,t)}if(ta(),Ms.current=a,Es=i,null!==Fs?r=0:(Rs=null,Ls=0,r=Os),0!=(Ds&Ns))bl(e,0);else if(0!==r){if(2===r&&(Es|=64,e.hydrate&&(e.hydrate=!1,Xr(e.containerInfo)),0!==(n=kt(e))&&(r=Sl(e,n))),1===r)throw t=zs,bl(e,0),_l(e,n),hl(e,Gi()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(o(345));case 2:case 5:El(e);break;case 3:if(_l(e,n),(62914560&n)===n&&10<(r=Gs+500-Gi())){if(0!==Dt(e,0))break;if(((i=e.suspendedLanes)&n)!==n){ul(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Wr(El.bind(null,e),r);break}El(e);break;case 4:if(_l(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var s=31-Ht(n);a=1<<s,(s=r[s])>i&&(i=s),n&=~a}if(n=i,10<(n=(120>(n=Gi()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ps(n/1960))-n)){e.timeoutHandle=Wr(El.bind(null,e),n);break}El(e);break;default:throw Error(o(329))}}return hl(e,Gi()),e.callbackNode===t?pl.bind(null,e):null}function _l(e,t){for(t&=~Us,t&=~Ns,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Ht(t),r=1<<n;e[n]=-1,t&=~r}}function vl(e){if(0!=(48&Es))throw Error(o(327));if(Ll(),e===Rs&&0!=(e.expiredLanes&Ls)){var t=Ls,n=Sl(e,t);0!=(Ds&Ns)&&(n=Sl(e,t=Dt(e,t)))}else n=Sl(e,t=Dt(e,0));if(0!==e.tag&&2===n&&(Es|=64,e.hydrate&&(e.hydrate=!1,Xr(e.containerInfo)),0!==(t=kt(e))&&(n=Sl(e,t))),1===n)throw n=zs,bl(e,0),_l(e,t),hl(e,Gi()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,El(e),hl(e,Gi()),null}function ml(e,t){var n=Es;Es|=1;try{return e(t)}finally{0===(Es=n)&&(Ws(),Ki())}}function gl(e,t){var n=Es;Es&=-2,Es|=8;try{return e(t)}finally{0===(Es=n)&&(Ws(),Ki())}}function yl(e,t){ci(Is,Bs),Bs|=t,Ds|=t}function xl(){Bs=Is.current,ui(Is)}function bl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,jr(n)),null!==Fs)for(n=Fs.return;null!==n;){var r=n;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&mi();break;case 3:Ba(),ui(hi),ui(fi),qa();break;case 5:Oa(r);break;case 4:Ba();break;case 13:case 19:ui(za);break;case 10:na(r);break;case 23:case 24:xl()}n=n.return}Rs=e,Fs=Hl(e.current,null),Ls=Bs=Ds=t,Os=0,zs=null,Us=Ns=ks=0}function wl(e,t){for(;;){var n=Fs;try{if(ta(),Qa.current=Fo,to){for(var r=Ja.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}to=!1}if($a=0,eo=Za=Ja=null,no=!1,As.current=null,null===n||null===n.return){Os=1,zs=t,Fs=null;break}e:{var a=e,o=n.return,s=n,l=t;if(t=Ls,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==l&&"object"==typeof l&&"function"==typeof l.then){var u=l;if(0==(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var d=0!=(1&za.current),f=o;do{var h;if(h=13===f.tag){var p=f.memoizedState;if(null!==p)h=null!==p.dehydrated;else{var _=f.memoizedProps;h=void 0!==_.fallback&&(!0!==_.unstable_avoidThisFallback||!d)}}if(h){var v=f.updateQueue;if(null===v){var m=new Set;m.add(u),f.updateQueue=m}else v.add(u);if(0==(2&f.mode)){if(f.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var g=ua(-1,1);g.tag=2,ca(s,g)}s.lanes|=1;break e}l=void 0,s=t;var y=a.pingCache;if(null===y?(y=a.pingCache=new ls,l=new Set,y.set(u,l)):void 0===(l=y.get(u))&&(l=new Set,y.set(u,l)),!l.has(s)){l.add(s);var x=kl.bind(null,a,u,s);u.then(x,x)}f.flags|=4096,f.lanes=t;break e}f=f.return}while(null!==f);l=Error((K(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Os&&(Os=2),l=os(l,s),f=o;do{switch(f.tag){case 3:a=l,f.flags|=4096,t&=-t,f.lanes|=t,da(f,us(0,a,t));break e;case 1:a=l;var b=f.type,w=f.stateNode;if(0==(64&f.flags)&&("function"==typeof b.getDerivedStateFromError||null!==w&&"function"==typeof w.componentDidCatch&&(null===Qs||!Qs.has(w)))){f.flags|=4096,t&=-t,f.lanes|=t,da(f,cs(f,a,t));break e}}f=f.return}while(null!==f)}Al(n)}catch(e){t=e,Fs===n&&null!==n&&(Fs=n=n.return);continue}break}}function Tl(){var e=Ms.current;return Ms.current=Fo,null===e?Fo:e}function Sl(e,t){var n=Es;Es|=16;var r=Tl();for(Rs===e&&Ls===t||bl(e,t);;)try{Cl();break}catch(t){wl(e,t)}if(ta(),Es=n,Ms.current=r,null!==Fs)throw Error(o(261));return Rs=null,Ls=0,Os}function Cl(){for(;null!==Fs;)Ml(Fs)}function Pl(){for(;null!==Fs&&!Mi();)Ml(Fs)}function Ml(e){var t=js(e.alternate,e,Bs);e.memoizedProps=e.pendingProps,null===t?Al(e):Fs=t,As.current=null}function Al(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(n=is(n,t,Bs)))return void(Fs=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!=(1073741824&Bs)||0==(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=as(t)))return n.flags&=2047,void(Fs=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Fs=t);Fs=t=e}while(null!==t);0===Os&&(Os=5)}function El(e){var t=Hi();return ji(99,Rl.bind(null,e,t)),null}function Rl(e,t){do{Ll()}while(null!==$s);if(0!=(48&Es))throw Error(o(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,a=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var s=e.eventTimes,l=e.expirationTimes;0<a;){var u=31-Ht(a),c=1<<u;i[u]=0,s[u]=-1,l[u]=-1,a&=~c}if(null!==tl&&0==(24&r)&&tl.has(e)&&tl.delete(e),e===Rs&&(Fs=Rs=null,Ls=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Es,Es|=32,As.current=null,Ur=qt,vr(s=_r())){if("selectionStart"in s)l={start:s.selectionStart,end:s.selectionEnd};else e:if(l=(l=s.ownerDocument)&&l.defaultView||window,(c=l.getSelection&&l.getSelection())&&0!==c.rangeCount){l=c.anchorNode,a=c.anchorOffset,u=c.focusNode,c=c.focusOffset;try{l.nodeType,u.nodeType}catch(e){l=null;break e}var d=0,f=-1,h=-1,p=0,_=0,v=s,m=null;t:for(;;){for(var g;v!==l||0!==a&&3!==v.nodeType||(f=d+a),v!==u||0!==c&&3!==v.nodeType||(h=d+c),3===v.nodeType&&(d+=v.nodeValue.length),null!==(g=v.firstChild);)m=v,v=g;for(;;){if(v===s)break t;if(m===l&&++p===a&&(f=d),m===u&&++_===c&&(h=d),null!==(g=v.nextSibling))break;m=(v=m).parentNode}v=g}l=-1===f||-1===h?null:{start:f,end:h}}else l=null;l=l||{start:0,end:0}}else l=null;Vr={focusedElem:s,selectionRange:l},qt=!1,sl=null,ll=!1,Xs=r;do{try{Fl()}catch(e){if(null===Xs)throw Error(o(330));Dl(Xs,e),Xs=Xs.nextEffect}}while(null!==Xs);sl=null,Xs=r;do{try{for(s=e;null!==Xs;){var y=Xs.flags;if(16&y&&me(Xs.stateNode,""),128&y){var x=Xs.alternate;if(null!==x){var b=x.ref;null!==b&&("function"==typeof b?b(null):b.current=null)}}switch(1038&y){case 2:ys(Xs),Xs.flags&=-3;break;case 6:ys(Xs),Xs.flags&=-3,Ts(Xs.alternate,Xs);break;case 1024:Xs.flags&=-1025;break;case 1028:Xs.flags&=-1025,Ts(Xs.alternate,Xs);break;case 4:Ts(Xs.alternate,Xs);break;case 8:ws(s,l=Xs);var w=l.alternate;ms(l),null!==w&&ms(w)}Xs=Xs.nextEffect}}catch(e){if(null===Xs)throw Error(o(330));Dl(Xs,e),Xs=Xs.nextEffect}}while(null!==Xs);if(b=Vr,x=_r(),y=b.focusedElem,s=b.selectionRange,x!==y&&y&&y.ownerDocument&&pr(y.ownerDocument.documentElement,y)){null!==s&&vr(y)&&(x=s.start,void 0===(b=s.end)&&(b=x),"selectionStart"in y?(y.selectionStart=x,y.selectionEnd=Math.min(b,y.value.length)):(b=(x=y.ownerDocument||document)&&x.defaultView||window).getSelection&&(b=b.getSelection(),l=y.textContent.length,w=Math.min(s.start,l),s=void 0===s.end?w:Math.min(s.end,l),!b.extend&&w>s&&(l=s,s=w,w=l),l=hr(y,w),a=hr(y,s),l&&a&&(1!==b.rangeCount||b.anchorNode!==l.node||b.anchorOffset!==l.offset||b.focusNode!==a.node||b.focusOffset!==a.offset)&&((x=x.createRange()).setStart(l.node,l.offset),b.removeAllRanges(),w>s?(b.addRange(x),b.extend(a.node,a.offset)):(x.setEnd(a.node,a.offset),b.addRange(x))))),x=[];for(b=y;b=b.parentNode;)1===b.nodeType&&x.push({element:b,left:b.scrollLeft,top:b.scrollTop});for("function"==typeof y.focus&&y.focus(),y=0;y<x.length;y++)(b=x[y]).element.scrollLeft=b.left,b.element.scrollTop=b.top}qt=!!Ur,Vr=Ur=null,e.current=n,Xs=r;do{try{for(y=e;null!==Xs;){var T=Xs.flags;if(36&T&&ps(y,Xs.alternate,Xs),128&T){x=void 0;var S=Xs.ref;if(null!==S){var C=Xs.stateNode;Xs.tag,x=C,"function"==typeof S?S(x):S.current=x}}Xs=Xs.nextEffect}}catch(e){if(null===Xs)throw Error(o(330));Dl(Xs,e),Xs=Xs.nextEffect}}while(null!==Xs);Xs=null,Di(),Es=i}else e.current=n;if(Ys)Ys=!1,$s=e,Js=t;else for(Xs=r;null!==Xs;)t=Xs.nextEffect,Xs.nextEffect=null,8&Xs.flags&&((T=Xs).sibling=null,T.stateNode=null),Xs=t;if(0===(r=e.pendingLanes)&&(Qs=null),1===r?e===rl?nl++:(nl=0,rl=e):nl=0,n=n.stateNode,Ti&&"function"==typeof Ti.onCommitFiberRoot)try{Ti.onCommitFiberRoot(wi,n,void 0,64==(64&n.current.flags))}catch(e){}if(hl(e,Gi()),Ks)throw Ks=!1,e=qs,qs=null,e;return 0!=(8&Es)||Ki(),null}function Fl(){for(;null!==Xs;){var e=Xs.alternate;ll||null===sl||(0!=(8&Xs.flags)?Ze(Xs,sl)&&(ll=!0):13===Xs.tag&&Cs(e,Xs)&&Ze(Xs,sl)&&(ll=!0));var t=Xs.flags;0!=(256&t)&&hs(e,Xs),0==(512&t)||Ys||(Ys=!0,Xi(97,(function(){return Ll(),null}))),Xs=Xs.nextEffect}}function Ll(){if(90!==Js){var e=97<Js?97:Js;return Js=90,ji(e,Ol)}return!1}function Bl(e,t){Zs.push(t,e),Ys||(Ys=!0,Xi(97,(function(){return Ll(),null})))}function Il(e,t){el.push(t,e),Ys||(Ys=!0,Xi(97,(function(){return Ll(),null})))}function Ol(){if(null===$s)return!1;var e=$s;if($s=null,0!=(48&Es))throw Error(o(331));var t=Es;Es|=32;var n=el;el=[];for(var r=0;r<n.length;r+=2){var i=n[r],a=n[r+1],s=i.destroy;if(i.destroy=void 0,"function"==typeof s)try{s()}catch(e){if(null===a)throw Error(o(330));Dl(a,e)}}for(n=Zs,Zs=[],r=0;r<n.length;r+=2){i=n[r],a=n[r+1];try{var l=i.create;i.destroy=l()}catch(e){if(null===a)throw Error(o(330));Dl(a,e)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Es=t,Ki(),!0}function zl(e,t,n){ca(e,t=us(0,t=os(n,t),1)),t=ul(),null!==(e=fl(e,1))&&(Gt(e,1,t),hl(e,t))}function Dl(e,t){if(3===e.tag)zl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){zl(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Qs||!Qs.has(r))){var i=cs(n,e=os(t,e),1);if(ca(n,i),i=ul(),null!==(n=fl(n,1)))Gt(n,1,i),hl(n,i);else if("function"==typeof r.componentDidCatch&&(null===Qs||!Qs.has(r)))try{r.componentDidCatch(t,e)}catch(e){}break}}n=n.return}}function kl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ul(),e.pingedLanes|=e.suspendedLanes&n,Rs===e&&(Ls&n)===n&&(4===Os||3===Os&&(62914560&Ls)===Ls&&500>Gi()-Gs?bl(e,0):Us|=n),hl(e,t)}function Nl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0==(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Hi()?1:2:(0===al&&(al=Ds),0===(t=Ut(62914560&~al))&&(t=4194304))),n=ul(),null!==(e=fl(e,t))&&(Gt(e,t,n),hl(e,n))}function Ul(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Vl(e,t,n,r){return new Ul(e,t,n,r)}function Gl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Hl(e,t){var n=e.alternate;return null===n?((n=Vl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Wl(e,t,n,r,i,a){var s=2;if(r=e,"function"==typeof e)Gl(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case S:return jl(n.children,i,a,t);case z:s=8,i|=16;break;case C:s=8,i|=1;break;case P:return(e=Vl(12,n,t,8|i)).elementType=P,e.type=P,e.lanes=a,e;case R:return(e=Vl(13,n,t,i)).type=R,e.elementType=R,e.lanes=a,e;case F:return(e=Vl(19,n,t,i)).elementType=F,e.lanes=a,e;case D:return Xl(n,i,a,t);case k:return(e=Vl(24,n,t,i)).elementType=k,e.lanes=a,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case M:s=10;break e;case A:s=9;break e;case E:s=11;break e;case L:s=14;break e;case B:s=16,r=null;break e;case I:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Vl(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function jl(e,t,n,r){return(e=Vl(7,e,r,t)).lanes=n,e}function Xl(e,t,n,r){return(e=Vl(23,e,r,t)).elementType=D,e.lanes=n,e}function Kl(e,t,n){return(e=Vl(6,e,null,t)).lanes=n,e}function ql(e,t,n){return(t=Vl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ql(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Vt(0),this.expirationTimes=Vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vt(0),this.mutableSourceEagerHydrationData=null}function Yl(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function $l(e,t,n,r){var i=t.current,a=ul(),s=cl(i);e:if(n){t:{if(Qe(n=n._reactInternals)!==n||1!==n.tag)throw Error(o(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(vi(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(o(171))}if(1===n.tag){var u=n.type;if(vi(u)){n=yi(n,u,l);break e}}n=l}else n=di;return null===t.context?t.context=n:t.pendingContext=n,(t=ua(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),ca(i,t),dl(i,s,a),s}function Jl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Zl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function eu(e,t){Zl(e,t),(e=e.alternate)&&Zl(e,t)}function tu(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Ql(e,t,null!=n&&!0===n.hydrate),t=Vl(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,sa(t),e[Zr]=n.current,Fr(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function nu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ru(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"==typeof i){var s=i;i=function(){var e=Jl(o);s.call(e)}}$l(t,o,e,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new tu(e,0,t?{hydrate:!0}:void 0)}(n,r),o=a._internalRoot,"function"==typeof i){var l=i;i=function(){var e=Jl(o);l.call(e)}}gl((function(){$l(t,o,e,i)}))}return Jl(o)}function iu(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nu(t))throw Error(o(200));return Yl(e,t,null,n)}js=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||hi.current)zo=!0;else{if(0==(n&r)){switch(zo=!1,t.tag){case 3:Xo(t),Xa();break;case 5:Ia(t);break;case 1:vi(t.type)&&xi(t);break;case 4:La(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;ci($i,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!=(n&t.child.childLanes)?$o(e,t,n):(ci(za,1&za.current),null!==(t=ns(e,t,n))?t.sibling:null);ci(za,1&za.current);break;case 19:if(r=0!=(n&t.childLanes),0!=(64&e.flags)){if(r)return ts(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ci(za,za.current),r)break;return null;case 23:case 24:return t.lanes=0,Vo(e,t,n)}return ns(e,t,n)}zo=0!=(16384&e.flags)}else zo=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=_i(t,fi.current),ia(t,n),i=ao(null,t,r,e,i,n),t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,vi(r)){var a=!0;xi(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,sa(t);var s=r.getDerivedStateFromProps;"function"==typeof s&&_a(t,r,s,e),i.updater=va,t.stateNode=i,i._reactInternals=t,xa(t,r,e,n),t=jo(null,t,r,!0,a,n)}else t.tag=0,Do(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(a=i._init)(i._payload),t.type=i,a=t.tag=function(e){if("function"==typeof e)return Gl(e)?1:0;if(null!=e){if((e=e.$$typeof)===E)return 11;if(e===L)return 14}return 2}(i),e=Yi(i,e),a){case 0:t=Ho(null,t,i,e,n);break e;case 1:t=Wo(null,t,i,e,n);break e;case 11:t=ko(null,t,i,e,n);break e;case 14:t=No(null,t,i,Yi(i.type,e),r,n);break e}throw Error(o(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ho(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Wo(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 3:if(Xo(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,la(e,t),fa(t,r,null,n),(r=t.memoizedState.element)===i)Xa(),t=ns(e,t,n);else{if((a=(i=t.stateNode).hydrate)&&(Na=Kr(t.stateNode.containerInfo.firstChild),ka=t,a=Ua=!0),a){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(a=e[i])._workInProgressVersionPrimary=e[i+1],Ka.push(a);for(n=Pa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Do(e,t,r,n),Xa();t=t.child}return t;case 5:return Ia(t),null===e&&Ha(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,Hr(r,i)?s=null:null!==a&&Hr(r,a)&&(t.flags|=16),Go(e,t),Do(e,t,s,n),t.child;case 6:return null===e&&Ha(t),null;case 13:return $o(e,t,n);case 4:return La(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ca(t,null,r,n):Do(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ko(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 7:return Do(e,t,t.pendingProps,n),t.child;case 8:case 12:return Do(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;var l=t.type._context;if(ci($i,l._currentValue),l._currentValue=a,null!==s)if(l=s.value,0==(a=ur(l,a)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(l,a):1073741823))){if(s.children===i.children&&!hi.current){t=ns(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var u=l.dependencies;if(null!==u){s=l.child;for(var c=u.firstContext;null!==c;){if(c.context===r&&0!=(c.observedBits&a)){1===l.tag&&((c=ua(-1,n&-n)).tag=2,ca(l,c)),l.lanes|=n,null!==(c=l.alternate)&&(c.lanes|=n),ra(l.return,n),u.lanes|=n;break}c=c.next}}else s=10===l.tag&&l.type===t.type?null:l.child;if(null!==s)s.return=l;else for(s=l;null!==s;){if(s===t){s=null;break}if(null!==(l=s.sibling)){l.return=s.return,s=l;break}s=s.return}l=s}Do(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,ia(t,n),r=r(i=aa(i,a.unstable_observedBits)),t.flags|=1,Do(e,t,r,n),t.child;case 14:return a=Yi(i=t.type,t.pendingProps),No(e,t,i,a=Yi(i.type,a),r,n);case 15:return Uo(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Yi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,vi(r)?(e=!0,xi(t)):e=!1,ia(t,n),ga(t,r,i),xa(t,r,i,n),jo(null,t,r,!0,e,n);case 19:return ts(e,t,n);case 23:case 24:return Vo(e,t,n)}throw Error(o(156,t.tag))},tu.prototype.render=function(e){$l(e,this._internalRoot,null,null)},tu.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;$l(null,e,null,(function(){t[Zr]=null}))},et=function(e){13===e.tag&&(dl(e,4,ul()),eu(e,4))},tt=function(e){13===e.tag&&(dl(e,67108864,ul()),eu(e,67108864))},nt=function(e){if(13===e.tag){var t=ul(),n=cl(e);dl(e,n,t),eu(e,n)}},rt=function(e,t){return t()},Pe=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ii(r);if(!i)throw Error(o(90));$(r),ne(r,i)}}}break;case"textarea":ue(e,n);break;case"select":null!=(t=n.value)&&oe(e,!!n.multiple,t,!1)}},Le=ml,Be=function(e,t,n,r,i){var a=Es;Es|=4;try{return ji(98,e.bind(null,t,n,r,i))}finally{0===(Es=a)&&(Ws(),Ki())}},Ie=function(){0==(49&Es)&&(function(){if(null!==tl){var e=tl;tl=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,hl(e,Gi())}))}Ki()}(),Ll())},Oe=function(e,t){var n=Es;Es|=2;try{return e(t)}finally{0===(Es=n)&&(Ws(),Ki())}};var au={Events:[ni,ri,ii,Re,Fe,Ll,{current:!1}]},ou={findFiberByHostInstance:ti,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},su={bundleType:ou.bundleType,version:ou.version,rendererPackageName:ou.rendererPackageName,rendererConfig:ou.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Je(e))?null:e.stateNode},findFiberByHostInstance:ou.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lu.isDisabled&&lu.supportsFiber)try{wi=lu.inject(su),Ti=lu}catch(_e){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=au,t.createPortal=iu,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return null===(e=Je(t))?null:e.stateNode},t.flushSync=function(e,t){var n=Es;if(0!=(48&n))return e(t);Es|=1;try{if(e)return ji(99,e.bind(null,t))}finally{Es=n,Ki()}},t.hydrate=function(e,t,n){if(!nu(t))throw Error(o(200));return ru(null,e,t,!0,n)},t.render=function(e,t,n){if(!nu(t))throw Error(o(200));return ru(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!nu(e))throw Error(o(40));return!!e._reactRootContainer&&(gl((function(){ru(null,null,e,!1,(function(){e._reactRootContainer=null,e[Zr]=null}))})),!0)},t.unstable_batchedUpdates=ml,t.unstable_createPortal=function(e,t){return iu(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!nu(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return ru(e,t,n,!1,r)},t.version="17.0.2"},668:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(223)},146:(e,t,n)=>{"use strict";var r=n(461),i=60103,a=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var o=60109,s=60110,l=60112;t.Suspense=60113;var u=60115,c=60116;if("function"==typeof Symbol&&Symbol.for){var d=Symbol.for;i=d("react.element"),a=d("react.portal"),t.Fragment=d("react.fragment"),t.StrictMode=d("react.strict_mode"),t.Profiler=d("react.profiler"),o=d("react.provider"),s=d("react.context"),l=d("react.forward_ref"),t.Suspense=d("react.suspense"),u=d("react.memo"),c=d("react.lazy")}var f="function"==typeof Symbol&&Symbol.iterator;function h(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function v(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||p}function m(){}function g(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(h(85));this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=v.prototype;var y=g.prototype=new m;y.constructor=g,r(y,v.prototype),y.isPureReactComponent=!0;var x={current:null},b=Object.prototype.hasOwnProperty,w={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,n){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)b.call(t,r)&&!w.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];a.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:x.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var C=/\/+/g;function P(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,n,r,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case a:l=!0}}if(l)return o=o(l=e),e=""===r?"."+P(l,0):r,Array.isArray(o)?(n="",null!=e&&(n=e.replace(C,"$&/")+"/"),M(o,t,n,"",(function(e){return e}))):null!=o&&(S(o)&&(o=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(l=0,r=""===r?".":r+":",Array.isArray(e))for(var u=0;u<e.length;u++){var c=r+P(s=e[u],u);l+=M(s,t,n,c,o)}else if(c=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof c)for(e=c.call(e),u=0;!(s=e.next()).done;)l+=M(s=s.value,t,n,c=r+P(s,u++),o);else if("object"===s)throw t=""+e,Error(h(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function A(e,t,n){if(null==e)return e;var r=[],i=0;return M(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function E(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var R={current:null};function F(){var e=R.current;if(null===e)throw Error(h(321));return e}var L={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:x,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error(h(143));return e}},t.Component=v,t.PureComponent=g,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.cloneElement=function(e,t,n){if(null==e)throw Error(h(267,e));var a=r({},e.props),o=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=x.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)b.call(t,c)&&!w.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){u=Array(c);for(var d=0;d<c;d++)u[d]=arguments[d+2];a.children=u}return{$$typeof:i,type:e.type,key:o,ref:s,props:a,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:c,_payload:{_status:-1,_result:e},_init:E}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return F().useCallback(e,t)},t.useContext=function(e,t){return F().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return F().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return F().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return F().useLayoutEffect(e,t)},t.useMemo=function(e,t){return F().useMemo(e,t)},t.useReducer=function(e,t,n){return F().useReducer(e,t,n)},t.useRef=function(e){return F().useRef(e)},t.useState=function(e){return F().useState(e)},t.version="17.0.2"},191:(e,t,n)=>{"use strict";e.exports=n(146)},160:(e,t)=>{"use strict";var n,r,i,a;if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var u=null,c=null,d=function(){if(null!==u)try{var e=t.unstable_now();u(!0,e),u=null}catch(e){throw setTimeout(d,0),e}};n=function(e){null!==u?setTimeout(n,0,e):(u=e,setTimeout(d,0))},r=function(e,t){c=setTimeout(e,t)},i=function(){clearTimeout(c)},t.unstable_shouldYield=function(){return!1},a=t.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,h=window.clearTimeout;if("undefined"!=typeof console){var p=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof p&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var _=!1,v=null,m=-1,g=5,y=0;t.unstable_shouldYield=function(){return t.unstable_now()>=y},a=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):g=0<e?Math.floor(1e3/e):5};var x=new MessageChannel,b=x.port2;x.port1.onmessage=function(){if(null!==v){var e=t.unstable_now();y=e+g;try{v(!0,e)?b.postMessage(null):(_=!1,v=null)}catch(e){throw b.postMessage(null),e}}else _=!1},n=function(e){v=e,_||(_=!0,b.postMessage(null))},r=function(e,n){m=f((function(){e(t.unstable_now())}),n)},i=function(){h(m),m=-1}}function w(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<C(i,t)))break e;e[r]=t,e[n]=i,n=r}}function T(e){return void 0===(e=e[0])?null:e}function S(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var a=2*(r+1)-1,o=e[a],s=a+1,l=e[s];if(void 0!==o&&0>C(o,n))void 0!==l&&0>C(l,o)?(e[r]=l,e[s]=n,r=s):(e[r]=o,e[a]=n,r=a);else{if(!(void 0!==l&&0>C(l,n)))break e;e[r]=l,e[s]=n,r=s}}}return t}return null}function C(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var P=[],M=[],A=1,E=null,R=3,F=!1,L=!1,B=!1;function I(e){for(var t=T(M);null!==t;){if(null===t.callback)S(M);else{if(!(t.startTime<=e))break;S(M),t.sortIndex=t.expirationTime,w(P,t)}t=T(M)}}function O(e){if(B=!1,I(e),!L)if(null!==T(P))L=!0,n(z);else{var t=T(M);null!==t&&r(O,t.startTime-e)}}function z(e,n){L=!1,B&&(B=!1,i()),F=!0;var a=R;try{for(I(n),E=T(P);null!==E&&(!(E.expirationTime>n)||e&&!t.unstable_shouldYield());){var o=E.callback;if("function"==typeof o){E.callback=null,R=E.priorityLevel;var s=o(E.expirationTime<=n);n=t.unstable_now(),"function"==typeof s?E.callback=s:E===T(P)&&S(P),I(n)}else S(P);E=T(P)}if(null!==E)var l=!0;else{var u=T(M);null!==u&&r(O,u.startTime-n),l=!1}return l}finally{E=null,R=a,F=!1}}var D=a;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){L||F||(L=!0,n(z))},t.unstable_getCurrentPriorityLevel=function(){return R},t.unstable_getFirstCallbackNode=function(){return T(P)},t.unstable_next=function(e){switch(R){case 1:case 2:case 3:var t=3;break;default:t=R}var n=R;R=t;try{return e()}finally{R=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=D,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=R;R=e;try{return t()}finally{R=n}},t.unstable_scheduleCallback=function(e,a,o){var s=t.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?s+o:s,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:A++,callback:a,priorityLevel:e,startTime:o,expirationTime:l=o+l,sortIndex:-1},o>s?(e.sortIndex=o,w(M,e),null===T(P)&&e===T(M)&&(B?i():B=!0,r(O,o-s))):(e.sortIndex=l,w(P,e),L||F||(L=!0,n(z))),e},t.unstable_wrapCallback=function(e){var t=R;return function(){var n=R;R=t;try{return e.apply(this,arguments)}finally{R=n}}}},630:(e,t,n)=>{"use strict";e.exports=n(160)},424:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(397),i=n.n(r),a=n(268),o=n.n(a)()(i());o.push([e.id,'body {\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n  margin: auto;\n  max-width: 38rem;\n  padding: 2rem;\n}\n',"",{version:3,sources:["webpack://./src/index.css"],names:[],mappings:"AAAA;EACE,gGAAgG;EAChG,YAAY;EACZ,gBAAgB;EAChB,aAAa;AACf",sourcesContent:['body {\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n  margin: auto;\n  max-width: 38rem;\n  padding: 2rem;\n}\n'],sourceRoot:""}]);const s=o},548:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n(379),i=n.n(r),a=n(795),o=n.n(a),s=n(569),l=n.n(s),u=n(565),c=n.n(u),d=n(216),f=n.n(d),h=n(589),p=n.n(h),_=n(424),v={};v.styleTagTransform=p(),v.setAttributes=c(),v.insert=l().bind(null,"head"),v.domAPI=o(),v.insertStyleElement=f(),i()(_.Z,v);const m=_.Z&&_.Z.locals?_.Z.locals:void 0},379:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var a={},o=[],s=0;s<e.length;s++){var l=e[s],u=r.base?l[0]+r.base:l[0],c=a[u]||0,d="".concat(u," ").concat(c);a[u]=c+1;var f=n(d),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(h);else{var p=i(h,r);r.byIndex=s,t.splice(s,0,{identifier:d,updater:p,references:1})}o.push(d)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var a=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var s=n(a[o]);t[s].references--}for(var l=r(e,i),u=0;u<a.length;u++){var c=n(a[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}a=l}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},88:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(191)),a=n(401);t.default=function(){return i.default.useEffect((function(){(0,a.createOasis)()}),[]),i.default.createElement("canvas",{id:"canvas",style:{width:"100vw",height:"100vh"}})}},623:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(191)),a=r(n(668)),o=r(n(88));a.default.render(i.default.createElement(i.default.StrictMode,null,i.default.createElement(o.default,null)),document.getElementById("root"))},401:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOasis=void 0;var r=n(856);t.createOasis=function(){var e=new r.WebGLEngine("canvas");e.canvas.resizeByClientSize();var t=e.sceneManager.activeScene,n=t.createRootEntity(),i=n.createChild("camera");i.addComponent(r.Camera);var a=i.transform.position;a.setValue(10,10,10),i.transform.position=a,i.transform.lookAt(new r.Vector3(0,0,0)),t.ambientLight.diffuseSolidColor.setValue(1,1,1,1),t.ambientLight.diffuseIntensity=1.2;var o=n.createChild("cube").addComponent(r.MeshRenderer),s=new r.BlinnPhongMaterial(e),l=s.baseColor;l.r=0,l.g=.8,l.b=.5,l.a=1,o.mesh=r.PrimitiveMesh.createCuboid(e),o.setMaterial(s),e.run()}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.ab="/native_modules/",(()=>{"use strict";n(548),n(623),console.log('👋 This message is being logged by "renderer.js", included via webpack')})()})();
//# sourceMappingURL=index.js.map